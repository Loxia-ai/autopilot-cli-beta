const a0_0x364285=a0_0xfc37;(function(_0x323e5f,_0x32d61a){const _0x565c79=a0_0xfc37,_0x1e6db5=_0x323e5f();while(!![]){try{const _0x435cac=parseInt(_0x565c79(0x146))/0x1+-parseInt(_0x565c79(0x132))/0x2*(parseInt(_0x565c79(0x130))/0x3)+-parseInt(_0x565c79(0x127))/0x4*(-parseInt(_0x565c79(0x145))/0x5)+-parseInt(_0x565c79(0x117))/0x6+parseInt(_0x565c79(0x11b))/0x7+-parseInt(_0x565c79(0x120))/0x8+-parseInt(_0x565c79(0x12a))/0x9;if(_0x435cac===_0x32d61a)break;else _0x1e6db5['push'](_0x1e6db5['shift']());}catch(_0x330dcf){_0x1e6db5['push'](_0x1e6db5['shift']());}}}(a0_0x1237,0x53040));import a0_0x471b58 from'path';import{promises as a0_0x43e458}from'fs';function a0_0xfc37(_0x3044d3,_0x4368da){const _0x1237dd=a0_0x1237();return a0_0xfc37=function(_0xfc3715,_0x15a012){_0xfc3715=_0xfc3715-0x114;let _0x3a9a3b=_0x1237dd[_0xfc3715];if(a0_0xfc37['lcrnxr']===undefined){var _0x589856=function(_0x471b58){const _0x43e458='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x17c161='',_0x118201='';for(let _0x130a84=0x0,_0x16715e,_0x22111a,_0xe3f2fc=0x0;_0x22111a=_0x471b58['charAt'](_0xe3f2fc++);~_0x22111a&&(_0x16715e=_0x130a84%0x4?_0x16715e*0x40+_0x22111a:_0x22111a,_0x130a84++%0x4)?_0x17c161+=String['fromCharCode'](0xff&_0x16715e>>(-0x2*_0x130a84&0x6)):0x0){_0x22111a=_0x43e458['indexOf'](_0x22111a);}for(let _0x539817=0x0,_0x44e9f3=_0x17c161['length'];_0x539817<_0x44e9f3;_0x539817++){_0x118201+='%'+('00'+_0x17c161['charCodeAt'](_0x539817)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x118201);};a0_0xfc37['fpcymT']=_0x589856,_0x3044d3=arguments,a0_0xfc37['lcrnxr']=!![];}const _0x3f0e36=_0x1237dd[0x0],_0x4ea67b=_0xfc3715+_0x3f0e36,_0x400b1e=_0x3044d3[_0x4ea67b];return!_0x400b1e?(_0x3a9a3b=a0_0xfc37['fpcymT'](_0x3a9a3b),_0x3044d3[_0x4ea67b]=_0x3a9a3b):_0x3a9a3b=_0x400b1e,_0x3a9a3b;},a0_0xfc37(_0x3044d3,_0x4368da);}export class ToolRegistry{constructor(_0x17c161,_0x118201,_0x130a84=null,_0x16715e=null){const _0x51b5d2=a0_0xfc37;this['config']=_0x17c161,this['logger']=_0x118201,this['projectDir']=_0x16715e,this['llmService']=_0x130a84,this[_0x51b5d2(0x137)]=new Map(),this[_0x51b5d2(0x122)]=new Map(),this[_0x51b5d2(0x135)]();}[a0_0x364285(0x140)](_0x22111a){const _0x381176=a0_0x364285;this[_0x381176(0x141)]=_0x22111a;if(this[_0x381176(0x137)]['has'](_0x381176(0x116))){const _0xe3f2fc=this[_0x381176(0x137)][_0x381176(0x13c)](_0x381176(0x116));_0xe3f2fc[_0x381176(0x140)](_0x22111a),this[_0x381176(0x142)]['info']('Updated\x20browser\x20tool\x20with\x20LLM\x20service\x20for\x20vision\x20capabilities');}if(this[_0x381176(0x137)]['has'](_0x381176(0x13e))){const _0x539817=this['tools'][_0x381176(0x13c)](_0x381176(0x13e));_0x539817['setLLMService'](_0x22111a),this['logger']['info'](_0x381176(0x148));}}[a0_0x364285(0x129)](_0x44e9f3){const _0x127856=a0_0x364285;this['projectDir']=_0x44e9f3;const _0x2ef0bd=this['tools'][_0x127856(0x13c)]('terminal');_0x2ef0bd&&typeof _0x2ef0bd[_0x127856(0x129)]===_0x127856(0x12b)&&_0x2ef0bd['setProjectDirectory'](_0x44e9f3),this['logger']['info']('Updated\x20project\x20directory\x20for\x20tools:\x20'+_0x44e9f3);}async['registerBuiltInTools'](){const _0x12cfcc=a0_0x364285;this['logger']['info']('Registering\x20built-in\x20tools');try{const {BrowserTool:_0x477b2b}=await import('../tools/browserTool.js'),_0x598a3f=new _0x477b2b(this[_0x12cfcc(0x13f)],this[_0x12cfcc(0x142)],this['llmService']);this['registerTool']('browser',_0x598a3f);const {TerminalTool:_0x143379}=await import('../tools/terminalTool.js'),_0x5440c9=new _0x143379(this['config'],this['logger'],undefined,this['projectDir']);this['registerTool']('terminal',_0x5440c9);const {FileSystemTool:_0x5bbe9d}=await import(_0x12cfcc(0x11d)),_0x27f55e=new _0x5bbe9d(this[_0x12cfcc(0x13f)],this[_0x12cfcc(0x142)]);this['registerTool'](_0x12cfcc(0x125),_0x27f55e);const {FileTreeTool:_0x5d3c7a}=await import(_0x12cfcc(0x13d)),_0x264be2=new _0x5d3c7a(this[_0x12cfcc(0x13f)],this['logger']);this[_0x12cfcc(0x11f)]('file-tree',_0x264be2);const {SeekTool:_0x4b51d0}=await import(_0x12cfcc(0x131)),_0x554eb1=new _0x4b51d0(this['config'],this['logger']);this['registerTool']('seek',_0x554eb1);const {MemoryTool:_0x4d0f2e}=await import('../tools/memoryTool.js'),_0x203647=new _0x4d0f2e(this[_0x12cfcc(0x13f)],this[_0x12cfcc(0x142)]);this[_0x12cfcc(0x11f)]('memory',_0x203647);const {CodeAnalysisTool:_0x5d0c1a}=await import(_0x12cfcc(0x11a)),_0x3c5739=new _0x5d0c1a(this['config'],this[_0x12cfcc(0x142)]);this[_0x12cfcc(0x11f)]('code-analysis',_0x3c5739);const {FileContentReplaceTool:_0xc52345}=await import(_0x12cfcc(0x128)),_0x4fb187=new _0xc52345(this['config'],this['logger']);this[_0x12cfcc(0x11f)](_0x12cfcc(0x115),_0x4fb187);if(this[_0x12cfcc(0x13f)][_0x12cfcc(0x137)]?.['mcpTool']?.[_0x12cfcc(0x12e)]){const _0xcb3d76=new MCPClientTool(this['config'],this['logger']);this['registerTool'](_0x12cfcc(0x147),_0xcb3d76);}if(this[_0x12cfcc(0x13f)][_0x12cfcc(0x137)]?.['uiTool']?.[_0x12cfcc(0x12e)]){const _0x22f7d8=await import(_0x12cfcc(0x119)),_0xc2ff9d=new _0x22f7d8(this[_0x12cfcc(0x13f)],this['logger']);this['registerTool']('ui',_0xc2ff9d);}const {UpdateUserTool:_0x1fa21d}=await import('../tools/updateUserTool.js'),_0x49219e=new _0x1fa21d(this[_0x12cfcc(0x13f)],this['logger']);this['registerTool']('update-user',_0x49219e),this[_0x12cfcc(0x142)][_0x12cfcc(0x114)]('Registered\x20'+this[_0x12cfcc(0x137)]['size']+'\x20tools');}catch(_0x2cbfea){this[_0x12cfcc(0x142)][_0x12cfcc(0x11c)](_0x12cfcc(0x11e),_0x2cbfea);throw _0x2cbfea;}}['registerTool'](_0x108b4d,_0x33e710){const _0x384073=a0_0x364285;this['logger']['info'](_0x384073(0x133)+_0x108b4d);if(typeof _0x33e710['execute']!==_0x384073(0x12b))throw new Error(_0x384073(0x134)+_0x108b4d+'\x20does\x20not\x20have\x20an\x20execute\x20method');if(typeof _0x33e710[_0x384073(0x138)]!=='function')throw new Error('Tool\x20'+_0x108b4d+_0x384073(0x121));this[_0x384073(0x137)][_0x384073(0x144)](_0x108b4d,_0x33e710),this['toolDescriptions']['set'](_0x108b4d,_0x33e710[_0x384073(0x138)]());}['hasTool'](_0x3fb1ae){const _0x14a9da=a0_0x364285;return this['tools'][_0x14a9da(0x12f)](_0x3fb1ae);}[a0_0x364285(0x136)](_0x447271){const _0x5d28cd=a0_0x364285;if(!this['tools']['has'](_0x447271))throw new Error(_0x5d28cd(0x134)+_0x447271+_0x5d28cd(0x12d));return this[_0x5d28cd(0x137)]['get'](_0x447271);}['getToolIds'](){const _0x397429=a0_0x364285;return Array['from'](this['tools'][_0x397429(0x124)]());}[a0_0x364285(0x123)](){const _0x2aa57c=a0_0x364285;let _0x431234='';for(const [_0x54e93c,_0x2445fa]of this['toolDescriptions'][_0x2aa57c(0x118)]()){_0x431234+=_0x2aa57c(0x13b)+_0x54e93c+'\x0a',_0x431234+=_0x2445fa+'\x0a\x0a';}return _0x431234;}['getToolDescription'](_0x42d6fe){const _0xd64092=a0_0x364285;if(!this['toolDescriptions']['has'](_0x42d6fe))throw new Error(_0xd64092(0x134)+_0x42d6fe+_0xd64092(0x12d));return this[_0xd64092(0x122)]['get'](_0x42d6fe);}['createToolsSystemPrompt'](){const _0x30ea5e=a0_0x364285;let _0x47592d=_0x30ea5e(0x139);for(const [_0x438151,_0x34652a]of this['toolDescriptions']['entries']()){_0x47592d+=_0x30ea5e(0x13a)+_0x438151+'\x0a',_0x47592d+=_0x34652a+'\x0a\x0a';}return _0x47592d+='To\x20use\x20a\x20tool,\x20wrap\x20your\x20commands\x20in\x20[tools-commands]\x20and\x20[/tools-commands]\x20tags.\x0a',_0x47592d+='For\x20each\x20tool,\x20use\x20[tool\x20id=\x22tool_id\x22]\x20and\x20[/tool]\x20tags\x20to\x20specify\x20which\x20tool\x20to\x20use.\x0a',_0x47592d+='Each\x20tool\x20has\x20its\x20own\x20specific\x20format\x20for\x20commands\x20as\x20described\x20above.',_0x47592d;}async[a0_0x364285(0x143)](){const _0x558875=a0_0x364285;this[_0x558875(0x142)]['info']('Shutting\x20down\x20all\x20tools');const _0x1d9885=[];for(const [_0x56c5df,_0x160875]of this['tools'][_0x558875(0x118)]()){typeof _0x160875[_0x558875(0x143)]===_0x558875(0x12b)&&(this[_0x558875(0x142)][_0x558875(0x114)]('Shutting\x20down\x20tool:\x20'+_0x56c5df),_0x1d9885['push'](_0x160875[_0x558875(0x143)]()));}await Promise[_0x558875(0x126)](_0x1d9885),this[_0x558875(0x142)]['info'](_0x558875(0x12c));}}function a0_0x1237(){const _0x153a10=['zMLSzs1JB250zw50lxjLCgXHy2u','yNjVD3nLCG','odG0nZm2zgLMDgHf','zw50CMLLCW','lI4VDg9VBhmVDwLuB29SlMPZ','lI4VDg9VBhmVy29KzufUywX5C2LZvg9VBc5QCW','mJaZnJi4nK5nv2HzDa','zxjYB3i','lI4VDg9VBhmVzMLSzvn5C3rLBvrVB2WUANm','rxjYB3iGCMvNAxn0zxjPBMCGyNvPBhqTAw4GDg9VBhm6','CMvNAxn0zxjuB29S','mJi2ndC5mK5iu1zwDG','igrVzxmGBM90igHHDMuGysbNzxrezxnJCMLWDgLVBIbTzxrOB2q','Dg9VBerLC2nYAxb0Aw9UCW','z2v0vg9VBhnezxnJCMLWDgLVBG','A2v5CW','zMLSzxn5CW','ywXSu2v0DgXLza','mJa3mJm2CeTeCeXj','lI4VDg9VBhmVzMLSzunVBNrLBNrszxbSywnLvg9VBc5QCW','C2v0uhjVAMvJDerPCMvJDg9YEq','mtuWmdyYne5PwLH0qW','zNvUy3rPB24','qwXSihrVB2XZihnODxqGzg93BG','ig5VDcbMB3vUzcbPBIbYzwDPC3rYEq','zw5HyMXLza','AgfZ','mtq5ndaWyxPLs21d','lI4VDg9VBhmVC2vLA1rVB2WUANm','mtbzyw1HzLq','uMvNAxn0zxjPBMCGDg9VBdOG','vg9VBca','CMvNAxn0zxjcDwLSDeLUvg9VBhm','z2v0vg9VBa','Dg9VBhm','z2v0rgvZy3jPChrPB24','qxzHAwXHyMXLihrVB2XZoGOk','iYmG','vg9VBcbjrdOG','z2v0','lI4VDg9VBhmVzMLSzvrYzwvuB29SlMPZ','Aw1Hz2uTz2vU','y29UzMLN','C2v0teXnu2vYDMLJzq','BgXTu2vYDMLJzq','Bg9Nz2vY','C2H1DgrVD24','C2v0','ntvTwMrqtKq','mZi1nti2zg1Kzuvu','BwnWlwnSAwvUDa','vxbKyxrLzcbPBwfNzsb0B29SihDPDgGGteXnihnLCNzPy2uGzM9YigLTywDLigDLBMvYyxrPB24','Aw5MBW'];a0_0x1237=function(){return _0x153a10;};return a0_0x1237();}