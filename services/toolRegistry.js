const a0_0xe0456=a0_0x22b7;(function(_0x4ea962,_0x3f635e){const _0x429e16=a0_0x22b7,_0x58640e=_0x4ea962();while(!![]){try{const _0x2e8e89=-parseInt(_0x429e16(0x1a1))/0x1*(-parseInt(_0x429e16(0x18c))/0x2)+-parseInt(_0x429e16(0x1a4))/0x3*(-parseInt(_0x429e16(0x181))/0x4)+-parseInt(_0x429e16(0x1ac))/0x5*(-parseInt(_0x429e16(0x1b4))/0x6)+parseInt(_0x429e16(0x1b8))/0x7+-parseInt(_0x429e16(0x1bb))/0x8*(-parseInt(_0x429e16(0x1b9))/0x9)+parseInt(_0x429e16(0x1a3))/0xa+-parseInt(_0x429e16(0x1b7))/0xb;if(_0x2e8e89===_0x3f635e)break;else _0x58640e['push'](_0x58640e['shift']());}catch(_0x374b23){_0x58640e['push'](_0x58640e['shift']());}}}(a0_0x4354,0xc1385));import a0_0x1188f9 from'path';import{promises as a0_0x4745bc}from'fs';function a0_0x22b7(_0x139b3,_0x22d55d){const _0x435400=a0_0x4354();return a0_0x22b7=function(_0x22b7fb,_0x3731b6){_0x22b7fb=_0x22b7fb-0x180;let _0x307819=_0x435400[_0x22b7fb];if(a0_0x22b7['ZWcFMz']===undefined){var _0x392f22=function(_0x1188f9){const _0x4745bc='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xe8af8f='',_0x232cb1='';for(let _0x15bebc=0x0,_0xc7200f,_0x14cbb6,_0x2a0264=0x0;_0x14cbb6=_0x1188f9['charAt'](_0x2a0264++);~_0x14cbb6&&(_0xc7200f=_0x15bebc%0x4?_0xc7200f*0x40+_0x14cbb6:_0x14cbb6,_0x15bebc++%0x4)?_0xe8af8f+=String['fromCharCode'](0xff&_0xc7200f>>(-0x2*_0x15bebc&0x6)):0x0){_0x14cbb6=_0x4745bc['indexOf'](_0x14cbb6);}for(let _0x7d3ba5=0x0,_0x5d393=_0xe8af8f['length'];_0x7d3ba5<_0x5d393;_0x7d3ba5++){_0x232cb1+='%'+('00'+_0xe8af8f['charCodeAt'](_0x7d3ba5)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x232cb1);};a0_0x22b7['dqtcjw']=_0x392f22,_0x139b3=arguments,a0_0x22b7['ZWcFMz']=!![];}const _0x4fdbec=_0x435400[0x0],_0x793b64=_0x22b7fb+_0x4fdbec,_0xba9385=_0x139b3[_0x793b64];return!_0xba9385?(_0x307819=a0_0x22b7['dqtcjw'](_0x307819),_0x139b3[_0x793b64]=_0x307819):_0x307819=_0xba9385,_0x307819;},a0_0x22b7(_0x139b3,_0x22d55d);}function a0_0x4354(){const _0x4a7d3d=['C2v0uhjVAMvJDerPCMvJDg9YEq','zxjYB3i','BwnWvg9VBa','zMLSzs10CMvL','lI4VDg9VBhmVzMLSzunVBNrLBNrszxbSywnLvg9VBc5QCW','ywXSu2v0DgXLza','rxjYB3iGCMvNAxn0zxjPBMCGyNvPBhqTAw4GDg9VBhm6','z2v0','DwLuB29S','ntqYwgniqxH5','y29Kzs1HBMfSExnPCW','Bg9Nz2vY','C2v0','C2H1DgrVD24','yNjVD3nLCG','DgvYBwLUywW','BwvTB3j5','AgfZvg9VBa','lI4VDg9VBhmVzMLSzvrYzwvuB29SlMPZ','vg9VBcbjrdOG','CMvNAxn0zxjuB29S','ChvZAa','lI4VDg9VBhmVyNjVD3nLCLrVB2WUANm','zxHLy3v0zq','BgXTu2vYDMLJzq','z2v0vg9VBerLC2nYAxb0Aw9U','uMvNAxn0zxjPBMCGyNvPBhqTAw4GDg9VBhm','CMvNAxn0zxjcDwLSDeLUvg9VBhm','Aw1Hz2uTz2vU','ChjVAMvJDerPCG','mJK1m2jJuw1ACq','y29UzMLN','nZq3mZyYmenZufrXta','nK9lshz5EG','A2v5CW','zMLSzs1JB250zw50lxjLCgXHy2u','C2vLAW','zgvWlxjLC29SDMvY','zw5HyMXLza','zw50CMLLCW','C2v0teXnu2vYDMLJzq','mJvdBxDOBMi','Dg9VBerLC2nYAxb0Aw9UCW','lI4VDg9VBhmVzgvWzw5Kzw5JEvjLC29SDMvYvg9VBc5QCW','Dg9VBhm','rwfJAcb0B29SigHHCYbPDhmGB3DUihnWzwnPzMLJigzVCM1HDcbMB3iGy29TBwfUzhmGyxmGzgvZy3jPyMvKigfIB3zLlG','ig5VDcbMB3vUzcbPBIbYzwDPC3rYEq','AgfZ','zNvUy3rPB24','nZy2ndm0CLPfExjw','C2L6zq','Aw5MBW','ntKYoti1otz4uu5gELa','odm0nJK0menvuuHZsq','mZGXmJq5sNHLywjR','vg9VBca','mJGWzfLZDvng','u2H1DhrPBMCGzg93BIb0B29SoIa','vxbKyxrLzcbWCM9Qzwn0igrPCMvJDg9YEsbMB3iGDg9VBhm6ia','mJy0mdu4mgPJqNbHCG','z2v0rgvZy3jPChrPB24'];a0_0x4354=function(){return _0x4a7d3d;};return a0_0x4354();}export class ToolRegistry{constructor(_0xe8af8f,_0x232cb1,_0x15bebc=null,_0xc7200f=null){const _0x1fb602=a0_0x22b7;this['config']=_0xe8af8f,this['logger']=_0x232cb1,this[_0x1fb602(0x1a0)]=_0xc7200f,this[_0x1fb602(0x19b)]=_0x15bebc,this['tools']=new Map(),this['toolDescriptions']=new Map(),this['registerBuiltInTools']();}['setLLMService'](_0x14cbb6){const _0x4a2543=a0_0x22b7;this[_0x4a2543(0x19b)]=_0x14cbb6;if(this[_0x4a2543(0x1af)][_0x4a2543(0x1b2)]('browser')){const _0x2a0264=this[_0x4a2543(0x1af)]['get'](_0x4a2543(0x191));_0x2a0264[_0x4a2543(0x1ab)](_0x14cbb6),this[_0x4a2543(0x18e)]['info']('Updated\x20browser\x20tool\x20with\x20LLM\x20service\x20for\x20vision\x20capabilities');}if(this[_0x4a2543(0x1af)]['has'](_0x4a2543(0x19f))){const _0x7d3ba5=this['tools']['get'](_0x4a2543(0x19f));_0x7d3ba5['setLLMService'](_0x14cbb6),this['logger'][_0x4a2543(0x1b6)]('Updated\x20image\x20tool\x20with\x20LLM\x20service\x20for\x20image\x20generation');}}[a0_0xe0456(0x183)](_0x5d393){const _0x55baac=a0_0xe0456;this[_0x55baac(0x1a0)]=_0x5d393;const _0x22805c=this['tools'][_0x55baac(0x18a)]('terminal');_0x22805c&&typeof _0x22805c['setProjectDirectory']===_0x55baac(0x1b3)&&_0x22805c['setProjectDirectory'](_0x5d393),this[_0x55baac(0x18e)][_0x55baac(0x1b6)](_0x55baac(0x180)+_0x5d393);}async[a0_0xe0456(0x19e)](){const _0x1a6090=a0_0xe0456;this['logger']['info'](_0x1a6090(0x19d));try{const {BrowserTool:_0x5ea833}=await import(_0x1a6090(0x199)),_0x2a2c05=new _0x5ea833(this[_0x1a6090(0x1a2)],this[_0x1a6090(0x18e)],this['llmService']);this[_0x1a6090(0x197)]('browser',_0x2a2c05);const {TerminalTool:_0xd390cc}=await import('../tools/terminalTool.js'),_0x1ed891=new _0xd390cc(this[_0x1a6090(0x1a2)],this['logger'],undefined,this[_0x1a6090(0x1a0)]);this[_0x1a6090(0x197)](_0x1a6090(0x192),_0x1ed891);const {FileSystemTool:_0x161755}=await import('../tools/fileSystemTool.js'),_0x4a14ec=new _0x161755(this['config'],this[_0x1a6090(0x18e)]);this[_0x1a6090(0x197)]('filesys',_0x4a14ec);const {ImageTool:_0x1f628b}=await import('../tools/imageTool.js'),_0x20072d=new _0x1f628b(this[_0x1a6090(0x1a2)],this['logger'],this['llmService']);this[_0x1a6090(0x197)]('image-gen',_0x20072d);const {FileTreeTool:_0x158a55}=await import(_0x1a6090(0x195)),_0x1706bb=new _0x158a55(this['config'],this[_0x1a6090(0x18e)]);this[_0x1a6090(0x197)](_0x1a6090(0x186),_0x1706bb);const {SeekTool:_0x56c96f}=await import('../tools/seekTool.js'),_0x10cb23=new _0x56c96f(this[_0x1a6090(0x1a2)],this['logger']);this[_0x1a6090(0x197)](_0x1a6090(0x1a7),_0x10cb23);const {MemoryTool:_0xc205f1}=await import('../tools/memoryTool.js'),_0x7db0c4=new _0xc205f1(this[_0x1a6090(0x1a2)],this['logger']);this[_0x1a6090(0x197)](_0x1a6090(0x193),_0x7db0c4);const {CodeAnalysisTool:_0x5689df}=await import('../tools/codeAnalysisTool.js'),_0x177377=new _0x5689df(this[_0x1a6090(0x1a2)],this[_0x1a6090(0x18e)]);this['registerTool'](_0x1a6090(0x18d),_0x177377);const {FileContentReplaceTool:_0x3cd8dd}=await import(_0x1a6090(0x187)),_0x490d96=new _0x3cd8dd(this['config'],this['logger']);this['registerTool'](_0x1a6090(0x1a6),_0x490d96);if(this[_0x1a6090(0x1a2)]['tools']?.[_0x1a6090(0x185)]?.['enabled']){const _0x2c728d=new MCPClientTool(this[_0x1a6090(0x1a2)],this['logger']);this[_0x1a6090(0x197)]('mcp-client',_0x2c728d);}if(this[_0x1a6090(0x1a2)][_0x1a6090(0x1af)]?.[_0x1a6090(0x18b)]?.[_0x1a6090(0x1a9)]){const _0x23d9b1=await import('../tools/uiTool.js'),_0xe156ba=new _0x23d9b1(this['config'],this['logger']);this['registerTool']('ui',_0xe156ba);}const {UpdateUserTool:_0x3205d5}=await import('../tools/updateUserTool.js'),_0x8f660=new _0x3205d5(this['config'],this[_0x1a6090(0x18e)]);this['registerTool']('update-user',_0x8f660);const {DependencyResolverTool:_0x337b1a}=await import(_0x1a6090(0x1ae)),_0x49598e=new _0x337b1a(this['config'],this['logger']);this[_0x1a6090(0x197)](_0x1a6090(0x1a8),_0x49598e);const {ImportAnalyzerTool:_0x123de8}=await import('../tools/importAnalyzerTool.js'),_0x4657b5=new _0x123de8(this[_0x1a6090(0x1a2)],this[_0x1a6090(0x18e)]);this[_0x1a6090(0x197)]('import-analyzer',_0x4657b5),this['logger'][_0x1a6090(0x1b6)]('Registered\x20'+this['tools'][_0x1a6090(0x1b5)]+'\x20tools');}catch(_0x5c7949){this[_0x1a6090(0x18e)][_0x1a6090(0x184)](_0x1a6090(0x189),_0x5c7949);throw _0x5c7949;}}['registerTool'](_0x503e8a,_0x44a6a4){const _0x1078c9=a0_0xe0456;this['logger'][_0x1078c9(0x1b6)]('Registering\x20tool:\x20'+_0x503e8a);if(typeof _0x44a6a4[_0x1078c9(0x19a)]!=='function')throw new Error('Tool\x20'+_0x503e8a+'\x20does\x20not\x20have\x20an\x20execute\x20method');if(typeof _0x44a6a4['getDescription']!=='function')throw new Error('Tool\x20'+_0x503e8a+'\x20does\x20not\x20have\x20a\x20getDescription\x20method');this[_0x1078c9(0x1af)][_0x1078c9(0x18f)](_0x503e8a,_0x44a6a4),this[_0x1078c9(0x1ad)][_0x1078c9(0x18f)](_0x503e8a,_0x44a6a4[_0x1078c9(0x182)]());}[a0_0xe0456(0x194)](_0x18b65d){const _0x428b34=a0_0xe0456;return this[_0x428b34(0x1af)][_0x428b34(0x1b2)](_0x18b65d);}['getTool'](_0x279e26){const _0x5deb08=a0_0xe0456;if(!this['tools'][_0x5deb08(0x1b2)](_0x279e26))throw new Error(_0x5deb08(0x1ba)+_0x279e26+_0x5deb08(0x1b1));return this['tools'][_0x5deb08(0x18a)](_0x279e26);}['getToolIds'](){const _0x34deca=a0_0xe0456;return Array['from'](this[_0x34deca(0x1af)][_0x34deca(0x1a5)]());}['getToolsDescription'](){const _0x416541=a0_0xe0456;let _0x81ffe2='';for(const [_0x29ec56,_0x18e2bf]of this[_0x416541(0x1ad)]['entries']()){_0x81ffe2+=_0x416541(0x196)+_0x29ec56+'\x0a',_0x81ffe2+=_0x18e2bf+'\x0a\x0a';}return _0x81ffe2;}[a0_0xe0456(0x19c)](_0x8878fd){const _0x1f8922=a0_0xe0456;if(!this[_0x1f8922(0x1ad)]['has'](_0x8878fd))throw new Error(_0x1f8922(0x1ba)+_0x8878fd+_0x1f8922(0x1b1));return this['toolDescriptions']['get'](_0x8878fd);}['createToolsSystemPrompt'](){const _0x11734b=a0_0xe0456;let _0x12ef40='Available\x20tools:\x0a\x0a';for(const [_0x21f384,_0x846a83]of this[_0x11734b(0x1ad)][_0x11734b(0x1aa)]()){_0x12ef40+='##\x20'+_0x21f384+'\x0a',_0x12ef40+=_0x846a83+'\x0a\x0a';}return _0x12ef40+='To\x20use\x20a\x20tool,\x20wrap\x20your\x20commands\x20in\x20[tools-commands]\x20and\x20[/tools-commands]\x20tags.\x0a',_0x12ef40+='For\x20each\x20tool,\x20use\x20[tool\x20id=\x22tool_id\x22]\x20and\x20[/tool]\x20tags\x20to\x20specify\x20which\x20tool\x20to\x20use.\x0a',_0x12ef40+=_0x11734b(0x1b0),_0x12ef40;}async['shutdown'](){const _0x153a81=a0_0xe0456;this['logger']['info']('Shutting\x20down\x20all\x20tools');const _0x16ab9b=[];for(const [_0x3072d6,_0x2ac0c7]of this[_0x153a81(0x1af)][_0x153a81(0x1aa)]()){typeof _0x2ac0c7[_0x153a81(0x190)]==='function'&&(this[_0x153a81(0x18e)]['info'](_0x153a81(0x1bc)+_0x3072d6),_0x16ab9b[_0x153a81(0x198)](_0x2ac0c7['shutdown']()));}await Promise[_0x153a81(0x188)](_0x16ab9b),this['logger']['info']('All\x20tools\x20shut\x20down');}}