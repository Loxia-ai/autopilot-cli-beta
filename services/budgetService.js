function a0_0x401f(){const _0x353aa5=['tw9KzwWGBMfTzsbTDxn0igjLigeGBM9UlwvTChr5ihn0CMLUzW','BwTKAxi','q2f0zwDVCNKSu2vYDMLJzs9nB2rLBcXdB3n0leLUChv0vg9Rzw5Zle91Dhb1DfrVA2vUCYXszxf1zxn0q291BNq','BgfZDfbYAwnPBMDvCgrHDgu','A2v5CW','zMfSBgjHy2S','Dg9mB2nHBgvtDhjPBMC','y29UzMLN','lcb1C2LUzYbLC3rPBwf0zq','Cgf0Aa','C2vYDMvYteXnu2vYDMLJzq','BM9YBwfS','x3vWzgf0zvvZywDLrgf0yq','DxnHz2u','AgfYzeXPBwL0','x2nSzwfUDxbpBgrtzxnZAw9UrMLSzxm','Bw9KzwXvC2fNzq','Dg9ju09tDhjPBMC','BMfTzq','muSGDg9Rzw5Z','B3v0Chv0vg9Rzw5Z','BwfW','z2v0vgLTzq','x2LUAxrPywXPEMvvC2fNzurHDge','yNjLywTKB3DUqNLnB2rLBa','x3nOB3vSzfvWzgf0zvbYAwnPBMC','BxrPBwu','su5wquXjrf9btu9vtLq','C3rHCNrZv2L0Aa','AM9PBG','C2vYDMLJzvvZywDL','Dg90ywXdB3n0','Dg90ywXpDxrWDxruB2TLBNm','C2vZC2LVBKLK','x2DLDevZDgLTyxrLzfbYAwnPBMC','BNvTyMvY','DxnHz2veAxi','BM93','x2DLDej1zgDLDfjLy29TBwvUzgf0Aw9U','BgfZDfnHDMvKq29ZDa','D3jPDgvgAwXL','z2v0uhjPy2LUz0rHDge','yNvKz2v0sw1Wywn0','C2vZC2LVBLn0yxj0','D291BgrfEgnLzwrcDwrNzxq','x2XVywrvC2fNzurHDge','ChjPy2LUz0rHDge','u2vYDMLJzsbUyw1Lig11C3qGyMuGysbUB24Tzw1WDhKGC3rYAw5N','zMLSDgvY','AxnZDwvZ','CMvXDwvZDenVDw50','yNvKz2v0','Aw5WDxq','mtG3nZG0s1vcv1zL','AgvHBhrOq2HLy2S','yNjLywTKB3DUqNLtzxj2AwnL','Dw5SAw5R','ANnVBG','BgfZDfvWzgf0zwq','vxnHz2u6ia','lMPZB24','x3nHDMvvC2fNzurHDgfjzK5LzwrLza','DxrMltG','qNvKz2v0ia','BwvZC2fNzq','cLbYAwnPBMCGC291CMnLoIa','zxjYB3i','su5wquXjrf9ut0TftLm','CMvTywLUAw5NqNvKz2v0','zw50CMLLCW','Aw5MBW','Bw9KzwXZv2L0AfbYAwnPBMC','lI8UBg94AweTyNvKz2v0','t3bLCMf0Aw9UihDVDwXKigv4y2vLzcbIDwrNzxqGBgLTAxqUienVBNnPzgvYigLUy3jLyxnPBMCGyNvKz2v0ig9YihvZAw5NigeGBgvZCYbLEhbLBNnPDMuGBw9KzwWU','C2XPy2u','mNf0uK5fta','mtC2u3rczuLZ','y3jPDgLJywW','x3zHBgLKyxrLvxnHz2vjBNb1Dhm','ChjPy2LUz0LUzM8','rxjYB3iGAw5PDgLHBgL6Aw5NihvZywDLigrHDgeGzgLYzwn0B3j5oG','y29Kzq','uhjVy2vLzcb3AxrOig9WzxjHDgLVBI4','su5wquXjrf9trvjwsunf','tw9KzwWS','z2v0qNvKz2v0vxnHz2u','y3vYCMvUy3K','mtjNsLjLvMi','rMfPBgvKihrVihjLBw92zsbZzxnZAw9UigzPBguG','D2L0AgLUqNvKz2v0','rKLmrv9twvnuru1Frvjst1i','mJrcA21YzK4','sw52ywXPzcbTB2rLBcbUyw1LihbYB3zPzgvKigzVCIbWCMLJAw5NigXVB2T1Ca','x2DLBMvYyxrLu2vZC2LVBKLK','cJ09psbcuKvbs0rpv04GqLKGtu9eruWGpt09cG','B3v0Chv0','BgLTAxq','D2fYBG','x2vUC3vYzvvZywDLrgLYzwn0B3j5','z2v0tw9KzwXqCMLJAw5N','z2v0vxnHz2vszxbVCNq','C3rYAw5NAwz5','C2L6zq','vg90ywWGB3v0Chv0ihrVA2vUCZOG','ChjPy2LUz1vWzgf0zuLUuhjVz3jLC3m','uMvJB3jKAw5NihvZywDLigzVCIa','mti5mJq1wvrLDKvH','zgvIDwC','x2v4Cg9YDfrVq3n2','C2v0','vg90ywWGAw5WDxqGDg9Rzw5ZoIa','D2fYBMLUz0XLDMvS','Dw5PDa','Dg90ywXjBNb1DfrVA2vUCW','Dg9mB3DLCKnHC2u','Dg9gAxHLza','Bwf4','uhjPy2LUzYb1CgrHDguGywXYzwfKEsbPBIbWCM9NCMvZCW','mZmXoda3v3jrwLjs','CgvYy2vUDgfNzvvZzwq','tw9KzwXZihDPDgGGChjPy2LUzZOG','ChvZAa','C3rHDhvZ','x2nHBgn1Bgf0zunVC3q','oIaK','z2v0uhjPy2LUz0LUzM8','CMvZzxrvC2fNzurHDge','DxbKyxrLuhjPy2LUz0zYB21tzxj2zxi','ndCWmdfXrMDUzwS','y29ZDa','vvne','x2XVywrcDwrNzxrmAw1PDa','Dg90ywXtCgvUDa','Aw5JBhvKzxm','y2XLyxi','C3rYAw5N','BgvUz3rO','x2nOzwnRqNvKz2v0u3rHDhvZ','uMvTB3zLzcbVBgqGC2vZC2LVBIbMAwXLoIa','ndeYodiXrwfcuKDj','yNvKz2v0tgLTAxq','mJm0mdeYv1vSu1rq','x3zHBgLKyxrLqNvKz2v0qw1VDw50','vxnHz2uGCMvJB3jKzwqGC3vJy2vZC2z1BgX5','rMfPBgvKihrVigXVywqGDxnHz2uGzgf0ytO','z2v0q29ZDevZDgLTyxrL','pt09ifvtquDfifjfue9svca9pt0k','Bg9Nz2vY','C2f2zvvZywDLrgf0yq','DxnHz2uUANnVBG','C2vZC2LVBL8','Aw5WDxruB2TLBNm','nJq5nJDLvvDTAe8','C29UBMv0','mtbeuffgs3y','vxbKyxrLzcbWCMLJAw5NigzVCIa','uMvZzxr0Aw5NihvZywDLigrHDge','zxn0Aw1HDgu'];a0_0x401f=function(){return _0x353aa5;};return a0_0x401f();}const a0_0x4f9636=a0_0x444e;(function(_0x55d75d,_0x5af06a){const _0x18b5dd=a0_0x444e,_0x580dd1=_0x55d75d();while(!![]){try{const _0x35286e=parseInt(_0x18b5dd(0x182))/0x1+parseInt(_0x18b5dd(0x1d3))/0x2*(parseInt(_0x18b5dd(0x16a))/0x3)+-parseInt(_0x18b5dd(0x1df))/0x4*(parseInt(_0x18b5dd(0x1f2))/0x5)+-parseInt(_0x18b5dd(0x1e3))/0x6*(parseInt(_0x18b5dd(0x160))/0x7)+parseInt(_0x18b5dd(0x1bd))/0x8+parseInt(_0x18b5dd(0x175))/0x9*(-parseInt(_0x18b5dd(0x184))/0xa)+-parseInt(_0x18b5dd(0x1d4))/0xb*(-parseInt(_0x18b5dd(0x177))/0xc);if(_0x35286e===_0x5af06a)break;else _0x580dd1['push'](_0x580dd1['shift']());}catch(_0x27e52b){_0x580dd1['push'](_0x580dd1['shift']());}}}(a0_0x401f,0x192bf));function a0_0x444e(_0x381357,_0x5caf99){const _0x401f83=a0_0x401f();return a0_0x444e=function(_0x444e74,_0xe2599b){_0x444e74=_0x444e74-0x15d;let _0x826d9d=_0x401f83[_0x444e74];if(a0_0x444e['wZxVLS']===undefined){var _0x47384e=function(_0x53d493){const _0x2070ef='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2ef042='',_0x3b6c24='';for(let _0x10d358=0x0,_0x78cd2d,_0x2d1356,_0x31c000=0x0;_0x2d1356=_0x53d493['charAt'](_0x31c000++);~_0x2d1356&&(_0x78cd2d=_0x10d358%0x4?_0x78cd2d*0x40+_0x2d1356:_0x2d1356,_0x10d358++%0x4)?_0x2ef042+=String['fromCharCode'](0xff&_0x78cd2d>>(-0x2*_0x10d358&0x6)):0x0){_0x2d1356=_0x2070ef['indexOf'](_0x2d1356);}for(let _0x4b7e22=0x0,_0x110b32=_0x2ef042['length'];_0x4b7e22<_0x110b32;_0x4b7e22++){_0x3b6c24+='%'+('00'+_0x2ef042['charCodeAt'](_0x4b7e22)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3b6c24);};a0_0x444e['ECFdbu']=_0x47384e,_0x381357=arguments,a0_0x444e['wZxVLS']=!![];}const _0x2f62f3=_0x401f83[0x0],_0x2047b6=_0x444e74+_0x2f62f3,_0x59d174=_0x381357[_0x2047b6];return!_0x59d174?(_0x826d9d=a0_0x444e['ECFdbu'](_0x826d9d),_0x381357[_0x2047b6]=_0x826d9d):_0x826d9d=_0x59d174,_0x826d9d;},a0_0x444e(_0x381357,_0x5caf99);}import{promises as a0_0x53d493}from'fs';import a0_0x2070ef from'path';const DEFAULT_USAGE_DIR=a0_0x4f9636(0x1d0),USAGE_FILENAME=a0_0x4f9636(0x17f),SESSION_PREFIX=a0_0x4f9636(0x180),PRICING_CACHE_DURATION_MS=0x493e0,PRICING_REFRESH_THRESHOLD_MS=0xea60,MAX_SESSION_FILES=0x64,BUDGET_WARNING_THRESHOLD=0.8,BUDGET_CRITICAL_THRESHOLD=0.95,ERROR_MESSAGES={'INVALID_AMOUNT':'Budget\x20amount\x20must\x20be\x20a\x20positive\x20number','INVALID_TOKENS':'Token\x20counts\x20must\x20be\x20non-negative\x20numbers','INVALID_SERVICE':a0_0x4f9636(0x1b7),'BUDGET_EXCEEDED':'Budget\x20limit\x20exceeded','PRICING_UNAVAILABLE':'Pricing\x20information\x20unavailable','FILE_SYSTEM_ERROR':'File\x20system\x20operation\x20failed'};export class BudgetService{constructor(_0x2ef042,_0x3b6c24,_0x10d358=null){const _0x2c29fc=a0_0x4f9636;this['config']=_0x2ef042,this['logger']=_0x3b6c24,this[_0x2c29fc(0x192)]=_0x10d358,this[_0x2c29fc(0x195)]=this[_0x2c29fc(0x19f)](),this['budgetLimit']=this[_0x2c29fc(0x16d)](),this[_0x2c29fc(0x196)]=_0x2ef042[_0x2c29fc(0x1bb)]?.[_0x2c29fc(0x196)]||![],this['pricingData']=new Map(),this[_0x2c29fc(0x18b)]=null,this[_0x2c29fc(0x1f0)]=![],this['usageDir']=_0x2ef042['budget']?.[_0x2c29fc(0x1ac)]||DEFAULT_USAGE_DIR,this['logger']['info']('Budget\x20service\x20initialized',{'budgetLimit':this['budgetLimit'],'hardLimit':this[_0x2c29fc(0x196)],'usageDir':this['usageDir'],'hasPricingService':!!this['serverLLMService']}),this[_0x2c29fc(0x1b5)]()['catch'](_0x78cd2d=>{const _0x3ca832=_0x2c29fc;this['logger'][_0x3ca832(0x1e9)]('Failed\x20to\x20load\x20previous\x20usage\x20data:',_0x78cd2d);});}[a0_0x4f9636(0x19f)](){return{'totalInputTokens':0x0,'totalOutputTokens':0x0,'totalCost':0x0,'serviceUsage':{},'modelUsage':{},'sessionStart':new Date()['toISOString'](),'sessionId':this['_generateSessionId'](),'lastUpdated':new Date()['toISOString']()};}[a0_0x4f9636(0x1e5)](){const _0x48ace2=a0_0x4f9636,_0x2d1356=Date['now']()['toString'](0x24),_0x31c000=Math['random']()['toString'](0x24)[_0x48ace2(0x1d2)](0x2);return _0x2d1356+'_'+_0x31c000;}[a0_0x4f9636(0x16d)](){const _0x5f04dc=a0_0x4f9636,_0x4b7e22=this[_0x5f04dc(0x18f)][_0x5f04dc(0x1bb)]?.[_0x5f04dc(0x1e8)];if(_0x4b7e22!==undefined&&_0x4b7e22!==null)return this[_0x5f04dc(0x178)](_0x4b7e22);return null;}async['updatePricingFromServer'](){const _0x3e17c2=a0_0x4f9636;if(!this[_0x3e17c2(0x192)])return this['logger'][_0x3e17c2(0x1f3)]('No\x20server\x20LLM\x20service\x20available\x20for\x20pricing\x20updates'),![];if(this['pricingUpdateInProgress'])return this[_0x3e17c2(0x17d)][_0x3e17c2(0x1f3)](_0x3e17c2(0x15f)),![];if(!this[_0x3e17c2(0x1a1)]())return!![];this['pricingUpdateInProgress']=!![];try{this[_0x3e17c2(0x17d)]['info']('Updating pricing data from server');const _0x110b32=await this['serverLLMService'][_0x3e17c2(0x1b1)]();if(_0x110b32[_0x3e17c2(0x1ee)]===0x0)return this[_0x3e17c2(0x17d)]['warn']('No pricing data received from server'),![];this[_0x3e17c2(0x1b6)]['clear']();for(const [_0x275e0c,_0x3147df]of _0x110b32[_0x3e17c2(0x1cd)]()){this[_0x3e17c2(0x1b6)][_0x3e17c2(0x1f5)](_0x275e0c,{'input':_0x3147df['input'],'output':_0x3147df[_0x3e17c2(0x1e7)],'unit':_0x3147df['unit']||'1K\x20tokens','currency':_0x3147df['currency']||_0x3e17c2(0x16c)});}return this[_0x3e17c2(0x18b)]=new Date()['toISOString'](),this['logger']['info'](_0x3e17c2(0x185)+this[_0x3e17c2(0x1b6)][_0x3e17c2(0x1ee)]+'\x20models\x20from\x20server'),!![];}catch(_0x472c3c){return this['logger'][_0x3e17c2(0x1ca)]('Failed to update pricing from server:',_0x472c3c),![];}finally{this[_0x3e17c2(0x1f0)]=![];}}[a0_0x4f9636(0x1a1)](){const _0x6d8e72=a0_0x4f9636;if(!this['lastPricingUpdate'])return!![];const _0x2f3279=Date['now']()-new Date(this[_0x6d8e72(0x18b)])['getTime']();return _0x2f3279>PRICING_REFRESH_THRESHOLD_MS;}[a0_0x4f9636(0x1eb)](_0x4c8c26){const _0x88eb7a=a0_0x4f9636;if(!_0x4c8c26||typeof _0x4c8c26!==_0x88eb7a(0x171))return this[_0x88eb7a(0x17d)]['warn'](_0x88eb7a(0x1e4)),null;return this['pricingData']['get'](_0x4c8c26)||null;}['getAllPricing'](){const _0xd20439=a0_0x4f9636;return this[_0xd20439(0x192)]['getPricingData']();}async['recordUsage'](_0x4e7251,_0xcba32c,_0x12e21d,_0x34a3a3){const _0x407541=a0_0x4f9636;this[_0x407541(0x17d)][_0x407541(0x1ce)](_0x407541(0x1f1)+_0x4e7251+'/'+_0xcba32c,{'inputTokens':_0x12e21d,'outputTokens':_0x34a3a3,'service':_0x4e7251,'model':_0xcba32c}),this[_0x407541(0x1d6)](_0x4e7251,_0xcba32c,_0x12e21d,_0x34a3a3),await this[_0x407541(0x169)]();const _0x567c41=this[_0x407541(0x165)](_0xcba32c,_0x12e21d,_0x34a3a3);!_0x567c41['success']&&this[_0x407541(0x17d)]['warn']('Pricing\x20unavailable\x20for\x20model\x20'+_0xcba32c+_0x407541(0x190));this[_0x407541(0x194)](_0x4e7251,_0xcba32c,_0x12e21d,_0x34a3a3,_0x567c41['totalCost']);const _0xc08f8e=this[_0x407541(0x173)]();await this['_saveUsageDataIfNeeded']();const _0x5d5453={'service':_0x4e7251,'model':_0xcba32c,'inputTokens':_0x12e21d,'outputTokens':_0x34a3a3,'cost':_0x567c41,'budgetStatus':_0xc08f8e,'timestamp':new Date()[_0x407541(0x199)]()};return this[_0x407541(0x17d)][_0x407541(0x1f3)](_0x407541(0x179),_0x5d5453),_0x5d5453;}[a0_0x4f9636(0x1d6)](_0x513abf,_0x8f9567,_0x3f492e,_0x291d30){const _0x2584a0=a0_0x4f9636;if(!_0x513abf||typeof _0x513abf!=='string')throw new Error(ERROR_MESSAGES[_0x2584a0(0x1db)]);if(!_0x8f9567||typeof _0x8f9567!=='string')throw new Error(_0x2584a0(0x188));if(typeof _0x3f492e!==_0x2584a0(0x1ab)||_0x3f492e<0x0)throw new Error(ERROR_MESSAGES[_0x2584a0(0x1cb)]);if(typeof _0x291d30!=='number'||_0x291d30<0x0)throw new Error(ERROR_MESSAGES[_0x2584a0(0x1cb)]);}[a0_0x4f9636(0x165)](_0x5090aa,_0x244cf5,_0x521de8){const _0x1ab72d=a0_0x4f9636,_0x1c8dae=this[_0x1ab72d(0x1eb)](_0x5090aa);if(!_0x1c8dae){const _0x272afb=this[_0x1ab72d(0x1aa)](_0x5090aa),_0x567e68=_0x244cf5/0x3e8*_0x272afb[_0x1ab72d(0x1bc)],_0x111987=_0x521de8/0x3e8*_0x272afb['output'];return{'success':![],'inputCost':_0x567e68,'outputCost':_0x111987,'totalCost':_0x567e68+_0x111987,'currency':_0x1ab72d(0x16c),'unit':_0x1ab72d(0x19b),'estimated':!![],'reason':'Pricing\x20data\x20unavailable\x20for\x20model'};}const _0x2e2ecb=_0x244cf5/0x3e8*_0x1c8dae['input'],_0x42b682=_0x521de8/0x3e8*_0x1c8dae[_0x1ab72d(0x1e7)];return{'success':!![],'inputCost':_0x2e2ecb,'outputCost':_0x42b682,'totalCost':_0x2e2ecb+_0x42b682,'currency':_0x1c8dae[_0x1ab72d(0x1de)],'unit':_0x1c8dae[_0x1ab72d(0x1f8)],'estimated':![]};}[a0_0x4f9636(0x1aa)](_0x2ef4b9){const _0x2d6692=a0_0x4f9636,_0x5b61c9=_0x2ef4b9[_0x2d6692(0x1fa)]();if(_0x5b61c9['includes']('opus')||_0x5b61c9['includes']('gpt-4'))return{'input':0.015,'output':0.075};else{if(_0x5b61c9['includes'](_0x2d6692(0x183))||_0x5b61c9['includes']('gpt-3.5'))return{'input':0.003,'output':0.015};else{if(_0x5b61c9[_0x2d6692(0x16f)]('haiku')||_0x5b61c9['includes']('phi'))return{'input':0.001,'output':0.004};}}return{'input':0.005,'output':0.02};}['_updateUsageData'](_0x5008f7,_0x261bec,_0x5d2557,_0x14087a,_0x269ffc){const _0x4c1734=a0_0x4f9636;this[_0x4c1734(0x195)][_0x4c1734(0x1f9)]+=_0x5d2557,this['usage'][_0x4c1734(0x1a8)]+=_0x14087a,this['usage'][_0x4c1734(0x1a7)]+=_0x269ffc,this[_0x4c1734(0x195)]['lastUpdated']=new Date()[_0x4c1734(0x199)](),!this['usage']['serviceUsage'][_0x5008f7]&&(this['usage']['serviceUsage'][_0x5008f7]={'inputTokens':0x0,'outputTokens':0x0,'cost':0x0,'requestCount':0x0}),this['usage'][_0x4c1734(0x1a6)][_0x5008f7][_0x4c1734(0x181)]+=_0x5d2557,this['usage'][_0x4c1734(0x1a6)][_0x5008f7][_0x4c1734(0x19c)]+=_0x14087a,this[_0x4c1734(0x195)]['serviceUsage'][_0x5008f7][_0x4c1734(0x16b)]+=_0x269ffc,this[_0x4c1734(0x195)][_0x4c1734(0x1a6)][_0x5008f7][_0x4c1734(0x1ba)]+=0x1,!this[_0x4c1734(0x195)][_0x4c1734(0x198)][_0x261bec]&&(this[_0x4c1734(0x195)]['modelUsage'][_0x261bec]={'inputTokens':0x0,'outputTokens':0x0,'cost':0x0,'requestCount':0x0}),this['usage'][_0x4c1734(0x198)][_0x261bec]['inputTokens']+=_0x5d2557,this['usage']['modelUsage'][_0x261bec]['outputTokens']+=_0x14087a,this[_0x4c1734(0x195)][_0x4c1734(0x198)][_0x261bec]['cost']+=_0x269ffc,this[_0x4c1734(0x195)][_0x4c1734(0x198)][_0x261bec]['requestCount']+=0x1;}[a0_0x4f9636(0x173)](){const _0x52efb6=a0_0x4f9636,_0x23fce2={'withinBudget':!![],'budgetLimit':this[_0x52efb6(0x176)],'totalSpent':this[_0x52efb6(0x195)]['totalCost'],'remainingBudget':null,'percentageUsed':null,'warningLevel':_0x52efb6(0x193)};if(this['budgetLimit']!==null){_0x23fce2[_0x52efb6(0x1cc)]=Math['max'](0x0,this['budgetLimit']-this[_0x52efb6(0x195)]['totalCost']),_0x23fce2['percentageUsed']=this['usage'][_0x52efb6(0x1a7)]/this['budgetLimit']*0x64,_0x23fce2['withinBudget']=this['usage'][_0x52efb6(0x1a7)]<=this[_0x52efb6(0x176)];if(_0x23fce2[_0x52efb6(0x161)]>=BUDGET_CRITICAL_THRESHOLD*0x64)_0x23fce2[_0x52efb6(0x1f7)]=_0x52efb6(0x1d5);else _0x23fce2['percentageUsed']>=BUDGET_WARNING_THRESHOLD*0x64&&(_0x23fce2['warningLevel']='warning');_0x23fce2[_0x52efb6(0x1f7)]!==_0x52efb6(0x193)&&this['logger'][_0x52efb6(0x1e9)](_0x52efb6(0x1c7)+_0x23fce2[_0x52efb6(0x1f7)]+':\x20'+_0x23fce2['percentageUsed'][_0x52efb6(0x15d)](0x1)+'%\x20used',{'totalSpent':this['usage']['totalCost'],'budgetLimit':this['budgetLimit'],'remainingBudget':_0x23fce2['remainingBudget']});if(!_0x23fce2[_0x52efb6(0x1e1)]&&this['hardLimit']){const _0xe0c801=new Error(ERROR_MESSAGES['BUDGET_EXCEEDED']+_0x52efb6(0x166)+this[_0x52efb6(0x195)]['totalCost'][_0x52efb6(0x15d)](0x2)+'\x20exceeds\x20limit\x20of\x20$'+this[_0x52efb6(0x176)][_0x52efb6(0x15d)](0x2));_0xe0c801['code']='BUDGET_EXCEEDED',_0xe0c801['budgetStatus']=_0x23fce2;throw _0xe0c801;}}return _0x23fce2;}async['setBudgetLimit'](_0x353e35){const _0xa173e0=a0_0x4f9636,_0x5aa6ba=this['_validateBudgetAmount'](_0x353e35);this[_0xa173e0(0x176)]=_0x5aa6ba,this['config']['budget']=this[_0xa173e0(0x18f)][_0xa173e0(0x1bb)]||{},this[_0xa173e0(0x18f)]['budget'][_0xa173e0(0x1e8)]=_0x5aa6ba,this[_0xa173e0(0x17d)][_0xa173e0(0x1ce)]('Budget\x20limit\x20set\x20to\x20$'+_0x5aa6ba['toFixed'](0x2),{'previousLimit':this['budgetLimit'],'newLimit':_0x5aa6ba}),await this['saveUsageData']();}[a0_0x4f9636(0x178)](_0x263ae3){const _0x45265f=a0_0x4f9636;if(typeof _0x263ae3!=='number'||_0x263ae3<0x0||!isFinite(_0x263ae3))throw new Error(ERROR_MESSAGES[_0x45265f(0x1a3)]);return _0x263ae3;}async['getBudgetUsage'](){const _0x505bec=a0_0x4f9636;await this['updatePricingFromServer']();const _0x39314a={'totalSpent':this['usage'][_0x505bec(0x1a7)],'budgetLimit':this['budgetLimit'],'inputTokens':this[_0x505bec(0x195)][_0x505bec(0x1f9)],'outputTokens':this[_0x505bec(0x195)][_0x505bec(0x1a8)],'remainingBudget':this['budgetLimit']!==null?Math[_0x505bec(0x15e)](0x0,this['budgetLimit']-this[_0x505bec(0x195)]['totalCost']):null,'percentageUsed':this[_0x505bec(0x176)]!==null?this['usage']['totalCost']/this[_0x505bec(0x176)]*0x64:null,'sessionStart':this[_0x505bec(0x195)][_0x505bec(0x1b3)],'lastUpdated':this['usage'][_0x505bec(0x1c2)],'breakdownByService':{},'breakdownByModel':{},'pricingInfo':{'lastUpdate':this['lastPricingUpdate'],'modelsWithPricing':this[_0x505bec(0x1b6)]['size'],'source':this['serverLLMService']?'server':'fallback'}};for(const [_0x5c84e8,_0x5d6f5d]of Object[_0x505bec(0x1cd)](this['usage']['serviceUsage'])){_0x39314a['breakdownByService'][_0x5c84e8]={'cost':_0x5d6f5d['cost'],'inputTokens':_0x5d6f5d[_0x505bec(0x181)],'outputTokens':_0x5d6f5d[_0x505bec(0x19c)],'requestCount':_0x5d6f5d[_0x505bec(0x1ba)]};}for(const [_0x590533,_0x4fd126]of Object[_0x505bec(0x1cd)](this['usage'][_0x505bec(0x198)])){_0x39314a['breakdownByModel'][_0x590533]={'cost':_0x4fd126['cost'],'inputTokens':_0x4fd126[_0x505bec(0x181)],'outputTokens':_0x4fd126[_0x505bec(0x19c)],'requestCount':_0x4fd126[_0x505bec(0x1ba)]};}return _0x39314a;}async[a0_0x4f9636(0x1ec)](){const _0x4f3b01=a0_0x4f9636,_0x3f472c=await this[_0x4f3b01(0x1dd)]();let _0x1b7d17=_0x4f3b01(0x17c);_0x1b7d17+='Total\x20cost:\x20$'+_0x3f472c[_0x4f3b01(0x16e)][_0x4f3b01(0x15d)](0x4)+'\x0a',_0x1b7d17+=_0x4f3b01(0x1f6)+_0x3f472c['inputTokens'][_0x4f3b01(0x18e)]()+'\x0a',_0x1b7d17+=_0x4f3b01(0x1ef)+_0x3f472c[_0x4f3b01(0x19c)][_0x4f3b01(0x18e)]()+'\x0a';_0x3f472c['budgetLimit']!==null&&(_0x1b7d17+='Budget\x20limit:\x20$'+_0x3f472c['budgetLimit']['toFixed'](0x2)+'\x0a',_0x1b7d17+='Remaining:\x20$'+_0x3f472c['remainingBudget']['toFixed'](0x4)+'\x0a',_0x1b7d17+=_0x4f3b01(0x1c3)+_0x3f472c[_0x4f3b01(0x161)]['toFixed'](0x1)+'%\x0a');_0x1b7d17+=_0x4f3b01(0x1c9)+_0x3f472c[_0x4f3b01(0x1d7)]['source']+'\x0a',_0x1b7d17+=_0x4f3b01(0x162)+_0x3f472c['pricingInfo'][_0x4f3b01(0x1cf)]+'\x0a';if(Object[_0x4f3b01(0x18c)](_0x3f472c[_0x4f3b01(0x1bf)])['length']>0x0){_0x1b7d17+='\x0a===\x20BREAKDOWN\x20BY\x20SERVICE\x20===\x0a';for(const [_0x30077c,_0x2695f5]of Object[_0x4f3b01(0x1cd)](_0x3f472c[_0x4f3b01(0x1bf)])){_0x1b7d17+=_0x30077c+':\x20$'+_0x2695f5[_0x4f3b01(0x16b)]['toFixed'](0x4)+'\x20('+_0x2695f5[_0x4f3b01(0x1ba)]+'\x20requests)\x0a';}}if(Object[_0x4f3b01(0x18c)](_0x3f472c[_0x4f3b01(0x1a0)])[_0x4f3b01(0x172)]>0x0){_0x1b7d17+=_0x4f3b01(0x1e6);for(const [_0x55cc20,_0x2c0d25]of Object[_0x4f3b01(0x1cd)](_0x3f472c[_0x4f3b01(0x1a0)])){_0x1b7d17+=_0x55cc20+':\x20$'+_0x2c0d25[_0x4f3b01(0x16b)][_0x4f3b01(0x15d)](0x4)+'\x20('+_0x2c0d25['requestCount']+'\x20requests)\x0a';}}return _0x1b7d17;}async[a0_0x4f9636(0x1c5)](){const _0xf35b45=a0_0x4f9636,_0x3d5765=0.1,_0x2d141a=this['usage'][_0xf35b45(0x1af)]||0x0;this[_0xf35b45(0x195)][_0xf35b45(0x1a7)]-_0x2d141a>=_0x3d5765&&(await this[_0xf35b45(0x17e)](),this[_0xf35b45(0x195)][_0xf35b45(0x1af)]=this[_0xf35b45(0x195)][_0xf35b45(0x1a7)]);}async['_loadUsageData'](){const _0x48de67=a0_0x4f9636;try{await this[_0x48de67(0x1ea)]();const _0x1ed7f5=a0_0x2070ef[_0x48de67(0x1a5)](this['usageDir'],USAGE_FILENAME);try{const _0x44616d=await a0_0x53d493['readFile'](_0x1ed7f5,_0x48de67(0x1c6)),_0xc19682=JSON['parse'](_0x44616d);this[_0x48de67(0x195)]['totalInputTokens']=_0xc19682[_0x48de67(0x1f9)]||0x0,this[_0x48de67(0x195)][_0x48de67(0x1a8)]=_0xc19682['totalOutputTokens']||0x0,this[_0x48de67(0x195)][_0x48de67(0x1a7)]=_0xc19682[_0x48de67(0x1a7)]||0x0,this['usage'][_0x48de67(0x1a6)]=_0xc19682[_0x48de67(0x1a6)]||{},this['usage']['modelUsage']=_0xc19682[_0x48de67(0x198)]||{},this['logger']['info']('Loaded\x20previous\x20usage\x20data',{'totalCost':this[_0x48de67(0x195)][_0x48de67(0x1a7)],'totalTokens':this['usage']['totalInputTokens']+this[_0x48de67(0x195)][_0x48de67(0x1a8)]});}catch(_0x48c885){_0x48c885[_0x48de67(0x1d9)]!=='ENOENT'&&this[_0x48de67(0x17d)][_0x48de67(0x1e9)](_0x48de67(0x17a),_0x48c885);}}catch(_0x3d4e0a){this['logger']['warn'](_0x48de67(0x1d8),_0x3d4e0a);}}async['_ensureUsageDirectory'](){const _0x3506d4=a0_0x4f9636;try{await a0_0x53d493[_0x3506d4(0x189)](this[_0x3506d4(0x1ac)],{'recursive':!![]});}catch(_0x152488){throw new Error(ERROR_MESSAGES['FILE_SYSTEM_ERROR']+':\x20'+_0x152488['message']);}}async['saveUsageData'](){const _0x2897f4=a0_0x4f9636;try{await this[_0x2897f4(0x1ea)](),this[_0x2897f4(0x195)]['sessionEnd']=new Date()['toISOString']();const _0x501dbb=a0_0x2070ef[_0x2897f4(0x1a5)](this[_0x2897f4(0x1ac)],USAGE_FILENAME);await a0_0x53d493[_0x2897f4(0x1b0)](_0x501dbb,JSON[_0x2897f4(0x1ed)](this[_0x2897f4(0x195)],null,0x2),_0x2897f4(0x1c6));const _0x3433c6=a0_0x2070ef[_0x2897f4(0x1a5)](this['usageDir'],''+SESSION_PREFIX+this['usage'][_0x2897f4(0x1a9)]+_0x2897f4(0x1c4));await a0_0x53d493['writeFile'](_0x3433c6,JSON[_0x2897f4(0x1ed)](this[_0x2897f4(0x195)],null,0x2),_0x2897f4(0x1c6)),await this[_0x2897f4(0x197)](),this[_0x2897f4(0x17d)][_0x2897f4(0x1ce)]('Usage\x20data\x20saved\x20successfully',{'totalCost':this['usage'][_0x2897f4(0x1a7)],'sessionId':this['usage'][_0x2897f4(0x1a9)]});}catch(_0x223b99){this['logger']['error']('Failed\x20to\x20save\x20usage\x20data:',_0x223b99);throw new Error(ERROR_MESSAGES[_0x2897f4(0x1e2)]+':\x20'+_0x223b99[_0x2897f4(0x1c8)]);}}async[a0_0x4f9636(0x197)](){const _0x37dadf=a0_0x4f9636;try{const _0x1135a4=await a0_0x53d493['readdir'](this[_0x37dadf(0x1ac)]),_0x26840d=_0x1135a4[_0x37dadf(0x1b8)](_0x2089bb=>_0x2089bb[_0x37dadf(0x1a4)](SESSION_PREFIX)&&_0x2089bb['endsWith']('.json'))['map'](_0x10ae91=>({'name':_0x10ae91,'path':a0_0x2070ef[_0x37dadf(0x1a5)](this['usageDir'],_0x10ae91)}));if(_0x26840d[_0x37dadf(0x172)]<=MAX_SESSION_FILES)return;const _0x5a56b5=await Promise['all'](_0x26840d[_0x37dadf(0x19d)](async _0x36e722=>{const _0x4efa98=_0x37dadf;try{const _0xc87238=await a0_0x53d493['stat'](_0x36e722[_0x4efa98(0x191)]);return{..._0x36e722,'mtime':_0xc87238['mtime']};}catch(_0x352b8b){return null;}})),_0x4ed0ca=_0x5a56b5['filter'](_0x13c1d6=>_0x13c1d6!==null)['sort']((_0x57abf3,_0x35a06b)=>_0x35a06b['mtime']-_0x57abf3[_0x37dadf(0x1a2)]),_0x46640b=_0x4ed0ca['slice'](MAX_SESSION_FILES);for(const _0x4e792e of _0x46640b){try{await a0_0x53d493['unlink'](_0x4e792e[_0x37dadf(0x191)]),this[_0x37dadf(0x17d)]['debug'](_0x37dadf(0x174)+_0x4e792e[_0x37dadf(0x19a)]);}catch(_0x53e79e){this[_0x37dadf(0x17d)]['warn'](_0x37dadf(0x1e0)+_0x4e792e[_0x37dadf(0x19a)]+':',_0x53e79e);}}_0x46640b['length']>0x0&&this['logger']['info']('Cleaned\x20up\x20'+_0x46640b['length']+'\x20old\x20session\x20files');}catch(_0x5bd072){this['logger'][_0x37dadf(0x1e9)]('Failed\x20to\x20cleanup\x20old\x20session\x20files:',_0x5bd072);}}async[a0_0x4f9636(0x168)](_0x40224c=![]){const _0x2c5e16=a0_0x4f9636;this['logger'][_0x2c5e16(0x1ce)](_0x2c5e16(0x186),{'preserveTotal':_0x40224c});if(!_0x40224c)this[_0x2c5e16(0x195)]=this[_0x2c5e16(0x19f)]();else{const _0x5bd0dd=this['usage']['totalCost'],_0x3f9924=this[_0x2c5e16(0x195)][_0x2c5e16(0x1f9)],_0x183b60=this['usage'][_0x2c5e16(0x1a8)];this['usage']=this['_initializeUsageData'](),this[_0x2c5e16(0x195)]['totalCost']=_0x5bd0dd,this['usage']['totalInputTokens']=_0x3f9924,this[_0x2c5e16(0x195)][_0x2c5e16(0x1a8)]=_0x183b60;}await this[_0x2c5e16(0x17e)]();}async['exportUsageData'](_0x1b5165=a0_0x4f9636(0x1c1)){const _0x30f5b1=a0_0x4f9636,_0x4a1822=await this['getBudgetUsage']();if(_0x1b5165==='csv')return this[_0x30f5b1(0x1f4)](_0x4a1822);return JSON[_0x30f5b1(0x1ed)](_0x4a1822,null,0x2);}['_exportToCsv'](_0x437fe5){const _0x426ea3=a0_0x4f9636,_0x2a0507=[_0x426ea3(0x18a)];for(const [_0x219f4a,_0x289cc2]of Object['entries'](_0x437fe5['breakdownByService'])){_0x2a0507[_0x426ea3(0x163)]('Service,'+_0x219f4a+','+_0x289cc2['cost']+','+_0x289cc2[_0x426ea3(0x181)]+','+_0x289cc2['outputTokens']+','+_0x289cc2['requestCount']);}for(const [_0x54021f,_0x437266]of Object['entries'](_0x437fe5['breakdownByModel'])){_0x2a0507[_0x426ea3(0x163)](_0x426ea3(0x1dc)+_0x54021f+','+_0x437266['cost']+','+_0x437266[_0x426ea3(0x181)]+','+_0x437266[_0x426ea3(0x19c)]+','+_0x437266[_0x426ea3(0x1ba)]);}return _0x2a0507[_0x426ea3(0x1a5)]('\x0a');}[a0_0x4f9636(0x17b)](_0x1822ab,_0x2132b0,_0x3eb14c){const _0x25157b=a0_0x4f9636;this['_validateUsageInputs'](_0x25157b(0x187),_0x1822ab,_0x2132b0,_0x3eb14c);const _0x221d6f=this['_calculateCost'](_0x1822ab,_0x2132b0,_0x3eb14c),_0x17cfcf={'model':_0x1822ab,'estimatedInputTokens':_0x2132b0,'estimatedOutputTokens':_0x3eb14c,'estimatedCost':_0x221d6f[_0x25157b(0x1a7)],..._0x221d6f,'budgetImpact':null};if(this['budgetLimit']!==null){const _0x21c3aa=this['usage'][_0x25157b(0x1a7)]+_0x221d6f[_0x25157b(0x1a7)];_0x17cfcf[_0x25157b(0x1b2)]={'currentSpent':this[_0x25157b(0x195)]['totalCost'],'afterOperation':_0x21c3aa,'remainingAfter':Math['max'](0x0,this['budgetLimit']-_0x21c3aa),'wouldExceedBudget':_0x21c3aa>this['budgetLimit'],'percentageAfter':_0x21c3aa/this[_0x25157b(0x176)]*0x64};}return _0x17cfcf;}['checkBudgetForOperation'](_0x4d3e52,_0x31a0ad,_0x11c0c0){const _0x131657=a0_0x4f9636,_0x569eb3=this['getCostEstimate'](_0x4d3e52,_0x31a0ad,_0x11c0c0);return{'canProceed':this[_0x131657(0x176)]===null||!_0x569eb3['budgetImpact']?.[_0x131657(0x1b4)],'estimate':_0x569eb3,'recommendation':this[_0x131657(0x1ae)](_0x569eb3)};}['_getBudgetRecommendation'](_0x1632b2){const _0x19aaca=a0_0x4f9636;if(this[_0x19aaca(0x176)]===null)return'No\x20budget\x20limit\x20set.\x20Consider\x20setting\x20a\x20budget\x20for\x20cost\x20control.';if(!_0x1632b2['budgetImpact'])return _0x19aaca(0x1da);const {percentageAfter:_0x4d7d36,wouldExceedBudget:_0x4ecbf5}=_0x1632b2['budgetImpact'];if(_0x4ecbf5)return _0x19aaca(0x1d1);if(_0x4d7d36>BUDGET_CRITICAL_THRESHOLD*0x64)return'Operation\x20would\x20use\x20most\x20of\x20your\x20budget.\x20Monitor\x20usage\x20carefully.';if(_0x4d7d36>BUDGET_WARNING_THRESHOLD*0x64)return'Operation\x20would\x20use\x20significant\x20portion\x20of\x20budget.\x20Consider\x20cost\x20optimization.';return'Operation\x20is\x20within\x20budget\x20guidelines.';}[a0_0x4f9636(0x167)](){const _0x252f56=a0_0x4f9636,_0x3cefb4=Array['from'](this[_0x252f56(0x1b6)]['entries']())['map'](([_0x3a65c8,_0x400491])=>({'model':_0x3a65c8,'inputPrice':_0x400491[_0x252f56(0x1bc)],'outputPrice':_0x400491['output'],'unit':_0x400491['unit'],'currency':_0x400491[_0x252f56(0x1de)]}));return{'models':_0x3cefb4,'lastUpdate':this[_0x252f56(0x18b)],'source':this['serverLLMService']?'server':_0x252f56(0x18d),'totalModels':this[_0x252f56(0x1b6)]['size']};}async[a0_0x4f9636(0x1be)](){const _0x582563=a0_0x4f9636,_0x3ad1c0={'status':'healthy','issues':[],'metrics':{'totalCost':this['usage']['totalCost'],'totalTokens':this[_0x582563(0x195)][_0x582563(0x1f9)]+this[_0x582563(0x195)]['totalOutputTokens'],'modelsWithPricing':this[_0x582563(0x1b6)][_0x582563(0x1ee)],'budgetLimit':this['budgetLimit']}};try{await this[_0x582563(0x1ea)]();const _0x5a8ba2=a0_0x2070ef[_0x582563(0x1a5)](this[_0x582563(0x1ac)],'.health-check');await a0_0x53d493['writeFile'](_0x5a8ba2,'test'),await a0_0x53d493[_0x582563(0x1c0)](_0x5a8ba2);}catch(_0x137347){_0x3ad1c0['status']='degraded',_0x3ad1c0['issues']['push']('File\x20system\x20access\x20issues');}this[_0x582563(0x1b6)]['size']===0x0&&(_0x3ad1c0['status']='degraded',_0x3ad1c0['issues']['push']('No\x20pricing\x20data\x20available'));if(this['lastPricingUpdate']){const _0x526708=(Date[_0x582563(0x1ad)]()-new Date(this[_0x582563(0x18b)])[_0x582563(0x19e)]())/(0x3e8*0x3c*0x3c);_0x526708>0x18&&_0x3ad1c0['issues'][_0x582563(0x163)]('Pricing\x20data\x20is\x20stale\x20(>24\x20hours\x20old)');}if(this[_0x582563(0x176)]!==null){const _0x2112a5=this[_0x582563(0x173)]();_0x2112a5['warningLevel']!=='normal'&&_0x3ad1c0[_0x582563(0x1b9)][_0x582563(0x163)](_0x582563(0x1c7)+_0x2112a5[_0x582563(0x1f7)]+':\x20'+_0x2112a5[_0x582563(0x161)]['toFixed'](0x1)+'%\x20used');}return _0x3ad1c0[_0x582563(0x1b9)][_0x582563(0x172)]>0x0&&_0x3ad1c0[_0x582563(0x164)]==='healthy'&&(_0x3ad1c0[_0x582563(0x164)]='warning'),_0x3ad1c0;}async['shutdown'](){const _0xfa82fd=a0_0x4f9636;this[_0xfa82fd(0x17d)][_0xfa82fd(0x1ce)]('Shutting\x20down\x20budget\x20service');try{await this['saveUsageData'](),this['pricingData'][_0xfa82fd(0x170)](),this[_0xfa82fd(0x17d)]['info']('Budget\x20service\x20shut\x20down\x20successfully');}catch(_0x5ef4bb){this['logger'][_0xfa82fd(0x1ca)]('Error\x20during\x20budget\x20service\x20shutdown:',_0x5ef4bb);throw _0x5ef4bb;}}}