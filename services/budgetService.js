const a0_0x28eb3f=a0_0x55ea;(function(_0x942a94,_0xd97e07){const _0x3a84ef=a0_0x55ea,_0x4dcc41=_0x942a94();while(!![]){try{const _0x41cd7a=-parseInt(_0x3a84ef(0x1ed))/0x1+-parseInt(_0x3a84ef(0x19c))/0x2*(-parseInt(_0x3a84ef(0x20c))/0x3)+parseInt(_0x3a84ef(0x210))/0x4+-parseInt(_0x3a84ef(0x200))/0x5+parseInt(_0x3a84ef(0x216))/0x6+-parseInt(_0x3a84ef(0x1db))/0x7+-parseInt(_0x3a84ef(0x18e))/0x8*(-parseInt(_0x3a84ef(0x196))/0x9);if(_0x41cd7a===_0xd97e07)break;else _0x4dcc41['push'](_0x4dcc41['shift']());}catch(_0xbf91a8){_0x4dcc41['push'](_0x4dcc41['shift']());}}}(a0_0x55e8,0x69b77));function a0_0x55e8(){const _0x55d1da=['vvne','yNjLywTKB3DUqNLnB2rLBa','DxnHz2veAxi','rMLSzsbZExn0zw0GywnJzxnZigLZC3vLCW','lMPZB24','x3vWzgf0zvvZywDLrgf0yq','yNvKz2v0sw1Wywn0','rKLmrv9twvnuru1Frvjst1i','lMHLywX0Ac1JAgvJAW','zgvIDwC','C2f2zvvZywDLrgf0yq','x2nSzwfUDxbpBgrtzxnZAw9UrMLSzxm','A2v5CW','C3vJy2vZCW','Dg9mB3DLCKnHC2u','zw50CMLLCW','lI8UBg94AweTyNvKz2v0','ChjPy2LUz0rHDge','ig1VzgvSCYbMCM9TihnLCNzLCG','vg90ywWGAw5WDxqGDg9Rzw5ZoIa','C291CMnL','tw9KzwWS','D2fYBG','Dg9mB2nHBgvtDhjPBMC','yNvKz2v0','CgHP','ihjLCxvLC3rZkqO','vg90ywWGy29ZDdOGja','Dg90ywXpDxrWDxruB2TLBNm','tw9KzwWGBMfTzsbTDxn0igjLigeGBM9UlwvTChr5ihn0CMLUzW','x2DLBMvYyxrLu2vZC2LVBKLK','x3zHBgLKyxrLvxnHz2vjBNb1Dhm','qLver0vux0vyq0vfreve','Cgf0Aa','rMfPBgvKihrVigXVywqGChjLDMLVDxmGDxnHz2uGzgf0ytO','B3v0Chv0vg9Rzw5Z','rxjYB3iGAw5PDgLHBgL6Aw5NihvZywDLigrHDgeGzgLYzwn0B3j5oG','yNjLywTKB3DUqNLtzxj2AwnL','zxjYB3i','DgvZDa','vg90ywWGB3v0Chv0ihrVA2vUCZOG','D2fYBMLUz0XLDMvS','BNvTyMvY','rMfPBgvKihrVigXVywqGDxnHz2uGzgf0ytO','AxnZDwvZ','x2XVywrvC2fNzurHDge','x2LUAxrPywXPEMvvC2fNzurHDge','y3vYCMvUy3K','cJ09psbcuKvbs0rpv04GqLKGu0vsvKLdrsa9pt0k','BxrPBwu','uhjPy2LUzYbKyxrHihvUyxzHAwXHyMXLigzVCIbTB2rLBa','zw5KC1DPDgG','mJKYmJaZoezLwhDyEG','Aw5JBhvKzxm','x2DLDevZDgLTyxrLzfbYAwnPBMC','C2vYDMvYteXnu2vYDMLJzq','C2vZC2LVBKLK','z2v0tw9KzwXqCMLJAw5N','su5wquXjrf9ut0TftLm','AgfPA3u','CMvXDwvZDenVDw50','Dg90ywXdB3n0','x3nOB3vSzfvWzgf0zvbYAwnPBMC','Aw5MBW','uhjPy2LUzYbKyxrHigLZihn0ywXLicG+mJqGAg91CNmGB2XKkq','DxbKyxrLuhjPy2LUz0zYB21tzxj2zxi','C3rHDhvZ','Dw5PDa','su5wquXjrf9btu9vtLq','CMvHzezPBgu','mJK2mtDZB0Tetfu','qNvKz2v0igXPBwL0igv4y2vLzgvK','qNvKz2v0igXPBwL0ihnLDcb0BYaK','CMvTywLUAw5NqNvKz2v0','ig9SzcbZzxnZAw9UigzPBgvZ','Aw5WDxq','uhjVy2vLzcb3AxrOig9WzxjHDgLVBI4','ChjPy2LUz0LUzM8','BwfW','ywXS','C2vZC2LVBL8','sw52ywXPzcbTB2rLBcbUyw1LihbYB3zPzgvKigzVCIbWCMLJAw5NigXVB2T1Ca','y29ZDa','x2DLDej1zgDLDfjLy29TBwvUzgf0Aw9U','qNvKz2v0igXPBwL0oIaK','B3v0Chv0','Bwf4','Dw5SAw5R','Bg9Nz2vY','mZC3odGZmeHKzvHHvW','qNvKz2v0igfTB3vUDcbTDxn0igjLigeGCg9ZAxrPDMuGBNvTyMvY','Bw9KzwXvC2fNzq','Aw5WDxruB2TLBNm','z2v0vxnHz2vszxbVCNq','D2fYBMLUzW','q2f0zwDVCNKSu2vYDMLJzs9nB2rLBcXdB3n0leLUChv0vg9Rzw5Zle91Dhb1DfrVA2vUCYXszxf1zxn0q291BNq','z2v0uhjPy2LUz0rHDge','yNvKz2v0tgLTAxq','D3jPDgvgAwXL','x2vUC3vYzvvZywDLrgLYzwn0B3j5','vxnHz2u6ia','mJr5BgjVu1e','y29UzMLN','Dg9ju09tDhjPBMC','uMvTywLUAw5NoIaK','mteXnZi3mNDdDMnzsa','BwvZC2fNzq','zMfSBgjHy2S','yNvKz2v0u3rHDhvZ','Dg90ywXjBNb1DfrVA2vUCW','rMfPBgvKihrVihnHDMuGDxnHz2uGzgf0ytO','ntm5mdi4qufrAhfz','oIaK','y3jPDgLJywW','qNvKz2v0ihnLCNzPy2uGC2H1DcbKB3DUihn1y2nLC3nMDwXSEq','BgfZDfbYAwnPBMDvCgrHDgu','ChvZAa','ru5pru5u','C2v0','uhjPy2LUzYb1BMf2ywLSywjSzsbMB3iGBw9KzwWG','u2vYDMLJzsW','DxnHz2u','AM9PBG','BgvUz3rO','mtuYmeLvwfvZDa','x2v4Cg9YDfrVq3n2','tM8GC2vYDMvYieXmtsbZzxj2AwnLigf2ywLSywjSzsbMB3iGChjPy2LUzYb1CgrHDgvZ','AgfYzeXPBwL0','DxrMltG','y2f0y2G','C2vYDMLJzvvZywDL','x2nOzwnRqNvKz2v0u3rHDhvZ','nty4mJzzv2XoAKS','C29UBMv0','t3bLCMf0Aw9UigLZihDPDgHPBIbIDwrNzxqGz3vPzgvSAw5LCY4','su5wquXjrf9trvjwsunf','BM93','ANnVBG','mty3ntrSrevWD2m','BM9YBwfS','CgvYy2vUDgfNzvvZzwq','Dg9gAxHLza','uMvZzxr0Aw5NihvZywDLigrHDge','Dg90ywXtCgvUDa','ChjPy2LUz1vWzgf0zuLUuhjVz3jLC3m','C2L6zq','AgvHBhrOq2HLy2S','y29Kzq','C2XPy2u'];a0_0x55e8=function(){return _0x55d1da;};return a0_0x55e8();}import{promises as a0_0x25dd39}from'fs';function a0_0x55ea(_0xcc9753,_0x2ce75b){const _0x55e837=a0_0x55e8();return a0_0x55ea=function(_0x55ea4f,_0x15d7e6){_0x55ea4f=_0x55ea4f-0x187;let _0x696890=_0x55e837[_0x55ea4f];if(a0_0x55ea['zlGZLX']===undefined){var _0x15c75c=function(_0x25dd39){const _0x45893f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3274ff='',_0x386ab5='';for(let _0x1e1b45=0x0,_0x2e1a93,_0x4b8d05,_0x2cd65a=0x0;_0x4b8d05=_0x25dd39['charAt'](_0x2cd65a++);~_0x4b8d05&&(_0x2e1a93=_0x1e1b45%0x4?_0x2e1a93*0x40+_0x4b8d05:_0x4b8d05,_0x1e1b45++%0x4)?_0x3274ff+=String['fromCharCode'](0xff&_0x2e1a93>>(-0x2*_0x1e1b45&0x6)):0x0){_0x4b8d05=_0x45893f['indexOf'](_0x4b8d05);}for(let _0x9f92b5=0x0,_0x2cf119=_0x3274ff['length'];_0x9f92b5<_0x2cf119;_0x9f92b5++){_0x386ab5+='%'+('00'+_0x3274ff['charCodeAt'](_0x9f92b5)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x386ab5);};a0_0x55ea['MlzmnL']=_0x15c75c,_0xcc9753=arguments,a0_0x55ea['zlGZLX']=!![];}const _0x4053b2=_0x55e837[0x0],_0x253536=_0x55ea4f+_0x4053b2,_0x2f193a=_0xcc9753[_0x253536];return!_0x2f193a?(_0x696890=a0_0x55ea['MlzmnL'](_0x696890),_0xcc9753[_0x253536]=_0x696890):_0x696890=_0x2f193a,_0x696890;},a0_0x55ea(_0xcc9753,_0x2ce75b);}import a0_0x45893f from'path';const DEFAULT_USAGE_DIR=a0_0x28eb3f(0x1b7),USAGE_FILENAME='usage.json',SESSION_PREFIX=a0_0x28eb3f(0x1f7),PRICING_CACHE_DURATION_MS=0x493e0,PRICING_REFRESH_THRESHOLD_MS=0xea60,MAX_SESSION_FILES=0x64,BUDGET_WARNING_THRESHOLD=0.8,BUDGET_CRITICAL_THRESHOLD=0.95,ERROR_MESSAGES={'INVALID_AMOUNT':a0_0x28eb3f(0x201),'INVALID_TOKENS':'Token\x20counts\x20must\x20be\x20non-negative\x20numbers','INVALID_SERVICE':'Service\x20name\x20must\x20be\x20a\x20non-empty\x20string','BUDGET_EXCEEDED':a0_0x28eb3f(0x1ee),'PRICING_UNAVAILABLE':'Pricing\x20information\x20unavailable','FILE_SYSTEM_ERROR':'File\x20system\x20operation\x20failed'};export class BudgetService{constructor(_0x3274ff,_0x386ab5,_0x1e1b45=null){const _0x186de4=a0_0x28eb3f;this[_0x186de4(0x20d)]=_0x3274ff,this[_0x186de4(0x1ff)]=_0x386ab5,this[_0x186de4(0x1de)]=_0x1e1b45,this[_0x186de4(0x18b)]=this['_initializeUsageData'](),this['budgetLimit']=this['_loadBudgetLimit'](),this[_0x186de4(0x191)]=_0x3274ff['budget']?.[_0x186de4(0x191)]||![],this['pricingData']=new Map(),this[_0x186de4(0x21a)]=null,this[_0x186de4(0x1a2)]=![],this['usageDir']=_0x3274ff['budget']?.['usageDir']||DEFAULT_USAGE_DIR,this[_0x186de4(0x1ff)][_0x186de4(0x1e6)]('Budget\x20service\x20initialized',{'budgetLimit':this[_0x186de4(0x208)],'hardLimit':this['hardLimit'],'usageDir':this['usageDir'],'hasPricingService':!!this[_0x186de4(0x1de)]}),this[_0x186de4(0x1d4)]()[_0x186de4(0x193)](_0x2e1a93=>{const _0x5efa98=_0x186de4;this[_0x5efa98(0x1ff)]['warn'](_0x5efa98(0x1c9),_0x2e1a93);});}['_initializeUsageData'](){const _0x216fd4=a0_0x28eb3f;return{'totalInputTokens':0x0,'totalOutputTokens':0x0,'totalCost':0x0,'serviceUsage':{},'modelUsage':{},'sessionStart':new Date()[_0x216fd4(0x20e)](),'sessionId':this[_0x216fd4(0x1c5)](),'lastUpdated':new Date()['toISOString']()};}[a0_0x28eb3f(0x1c5)](){const _0x229fb1=a0_0x28eb3f,_0x4b8d05=Date['now']()['toString'](0x24),_0x2cd65a=Math['random']()['toString'](0x24)[_0x229fb1(0x1a6)](0x2);return _0x4b8d05+'_'+_0x2cd65a;}['_loadBudgetLimit'](){const _0x9f92b5=this['config']['budget']?.['limit'];if(_0x9f92b5!==undefined&&_0x9f92b5!==null)return this['_validateBudgetAmount'](_0x9f92b5);return null;}async['updatePricingFromServer'](){const _0x4ecd77=a0_0x28eb3f;if(!this[_0x4ecd77(0x1de)])return this['logger']['debug'](_0x4ecd77(0x190)),![];if(this[_0x4ecd77(0x1a2)])return this['logger'][_0x4ecd77(0x1b0)]('Pricing\x20update\x20already\x20in\x20progress'),![];if(!this[_0x4ecd77(0x1e5)]())return!![];this['pricingUpdateInProgress']=!![];try{this['logger'][_0x4ecd77(0x1e6)]('Updating pricing data from server');const _0x2cf119=await this['serverLLMService'][_0x4ecd77(0x207)]();if(_0x2cf119['size']===0x0)return this[_0x4ecd77(0x1ff)][_0x4ecd77(0x1bd)]('No pricing data received from server'),![];this['pricingData']['clear']();for(const [_0x5d1c1f,_0x4f0228]of _0x2cf119[_0x4ecd77(0x1b6)]()){this['pricingData'][_0x4ecd77(0x188)](_0x5d1c1f,{'input':_0x4f0228['input'],'output':_0x4f0228[_0x4ecd77(0x1fc)],'unit':_0x4f0228['unit']||'1K\x20tokens','currency':_0x4f0228['currency']||_0x4ecd77(0x1a7)});}return this[_0x4ecd77(0x21a)]=new Date()[_0x4ecd77(0x20e)](),this['logger']['info']('Updated\x20pricing\x20for\x20'+this[_0x4ecd77(0x1b8)][_0x4ecd77(0x1a3)]+_0x4ecd77(0x1b9)),!![];}catch(_0x8ed7fb){return this[_0x4ecd77(0x1ff)]['error']('Failed to update pricing from server:',_0x8ed7fb),![];}finally{this[_0x4ecd77(0x1a2)]=![];}}[a0_0x28eb3f(0x1e5)](){const _0x4376ec=a0_0x28eb3f;if(!this['lastPricingUpdate'])return!![];const _0x592835=Date[_0x4376ec(0x19a)]()-new Date(this['lastPricingUpdate'])['getTime']();return _0x592835>PRICING_REFRESH_THRESHOLD_MS;}['getModelPricing'](_0x37e3ff){const _0x130272=a0_0x28eb3f;if(!_0x37e3ff||typeof _0x37e3ff!=='string')return this['logger']['warn'](_0x130272(0x1f8)),null;return this[_0x130272(0x1b8)]['get'](_0x37e3ff)||null;}['getAllPricing'](){const _0x5b27e9=a0_0x28eb3f;return this['serverLLMService'][_0x5b27e9(0x207)]();}async['recordUsage'](_0x116740,_0x3112a6,_0x3c045f,_0x190f21){const _0x4ee340=a0_0x28eb3f;this['logger'][_0x4ee340(0x1e6)]('Recording\x20usage\x20for\x20'+_0x116740+'/'+_0x3112a6,{'inputTokens':_0x3c045f,'outputTokens':_0x190f21,'service':_0x116740,'model':_0x3112a6}),this[_0x4ee340(0x1c6)](_0x116740,_0x3112a6,_0x3c045f,_0x190f21),await this[_0x4ee340(0x1e8)]();const _0x2da44b=this['_calculateCost'](_0x3112a6,_0x3c045f,_0x190f21);!_0x2da44b[_0x4ee340(0x1b4)]&&this[_0x4ee340(0x1ff)][_0x4ee340(0x1bd)](_0x4ee340(0x189)+_0x3112a6+',\x20using\x20estimate');this['_updateUsageData'](_0x116740,_0x3112a6,_0x3c045f,_0x190f21,_0x2da44b['totalCost']);const _0x19cf71=this[_0x4ee340(0x195)]();await this['_saveUsageDataIfNeeded']();const _0xa9a3ab={'service':_0x116740,'model':_0x3112a6,'inputTokens':_0x3c045f,'outputTokens':_0x190f21,'cost':_0x2da44b,'budgetStatus':_0x19cf71,'timestamp':new Date()['toISOString']()};return this['logger']['debug']('Usage\x20recorded\x20successfully',_0xa9a3ab),_0xa9a3ab;}[a0_0x28eb3f(0x1c6)](_0x5ad74f,_0x4a1019,_0x48312b,_0x5ad0f5){const _0x5e09c4=a0_0x28eb3f;if(!_0x5ad74f||typeof _0x5ad74f!=='string')throw new Error(ERROR_MESSAGES[_0x5e09c4(0x199)]);if(!_0x4a1019||typeof _0x4a1019!=='string')throw new Error(_0x5e09c4(0x1c4));if(typeof _0x48312b!=='number'||_0x48312b<0x0)throw new Error(ERROR_MESSAGES['INVALID_TOKENS']);if(typeof _0x5ad0f5!=='number'||_0x5ad0f5<0x0)throw new Error(ERROR_MESSAGES[_0x5e09c4(0x1e1)]);}['_calculateCost'](_0x9a3f6d,_0x2d9537,_0x11179e){const _0x56d1e5=a0_0x28eb3f,_0x3921d5=this[_0x56d1e5(0x1e0)](_0x9a3f6d);if(!_0x3921d5){const _0x49a089=this['_getEstimatedPricing'](_0x9a3f6d),_0x15a457=_0x2d9537/0x3e8*_0x49a089['input'],_0x38dbd3=_0x11179e/0x3e8*_0x49a089[_0x56d1e5(0x1fc)];return{'success':![],'inputCost':_0x15a457,'outputCost':_0x38dbd3,'totalCost':_0x15a457+_0x38dbd3,'currency':'USD','unit':'1K\x20tokens','estimated':!![],'reason':_0x56d1e5(0x1d9)};}const _0x4bc2d4=_0x2d9537/0x3e8*_0x3921d5[_0x56d1e5(0x1f2)],_0x576a08=_0x11179e/0x3e8*_0x3921d5['output'];return{'success':!![],'inputCost':_0x4bc2d4,'outputCost':_0x576a08,'totalCost':_0x4bc2d4+_0x576a08,'currency':_0x3921d5[_0x56d1e5(0x1d6)],'unit':_0x3921d5[_0x56d1e5(0x1ea)],'estimated':![]};}[a0_0x28eb3f(0x1dd)](_0x11a3ae){const _0x32d490=a0_0x28eb3f,_0x591663=_0x11a3ae[_0x32d490(0x1b5)]();if(_0x591663['includes']('opus')||_0x591663[_0x32d490(0x1dc)]('gpt-4'))return{'input':0.015,'output':0.075};else{if(_0x591663['includes'](_0x32d490(0x197))||_0x591663[_0x32d490(0x1dc)]('gpt-3.5'))return{'input':0.003,'output':0.015};else{if(_0x591663[_0x32d490(0x1dc)](_0x32d490(0x1e2))||_0x591663[_0x32d490(0x1dc)](_0x32d490(0x1c0)))return{'input':0.001,'output':0.004};}}return{'input':0.005,'output':0.02};}[a0_0x28eb3f(0x1ac)](_0x225711,_0x34272a,_0x1e2827,_0x4f1b4c,_0x4781f3){const _0x13293d=a0_0x28eb3f;this['usage']['totalInputTokens']+=_0x1e2827,this[_0x13293d(0x18b)]['totalOutputTokens']+=_0x4f1b4c,this[_0x13293d(0x18b)][_0x13293d(0x1e4)]+=_0x4781f3,this['usage']['lastUpdated']=new Date()['toISOString'](),!this['usage'][_0x13293d(0x194)][_0x225711]&&(this[_0x13293d(0x18b)]['serviceUsage'][_0x225711]={'inputTokens':0x0,'outputTokens':0x0,'cost':0x0,'requestCount':0x0}),this['usage'][_0x13293d(0x194)][_0x225711][_0x13293d(0x203)]+=_0x1e2827,this[_0x13293d(0x18b)]['serviceUsage'][_0x225711]['outputTokens']+=_0x4f1b4c,this['usage']['serviceUsage'][_0x225711][_0x13293d(0x1f9)]+=_0x4781f3,this['usage']['serviceUsage'][_0x225711]['requestCount']+=0x1,!this['usage']['modelUsage'][_0x34272a]&&(this[_0x13293d(0x18b)]['modelUsage'][_0x34272a]={'inputTokens':0x0,'outputTokens':0x0,'cost':0x0,'requestCount':0x0}),this['usage'][_0x13293d(0x202)][_0x34272a][_0x13293d(0x203)]+=_0x1e2827,this['usage'][_0x13293d(0x202)][_0x34272a][_0x13293d(0x1ca)]+=_0x4f1b4c,this['usage'][_0x13293d(0x202)][_0x34272a]['cost']+=_0x4781f3,this['usage']['modelUsage'][_0x34272a][_0x13293d(0x1e3)]+=0x1;}[a0_0x28eb3f(0x195)](){const _0x22a2ab=a0_0x28eb3f,_0x416c13={'withinBudget':!![],'budgetLimit':this['budgetLimit'],'totalSpent':this[_0x22a2ab(0x18b)][_0x22a2ab(0x1e4)],'remainingBudget':null,'percentageUsed':null,'warningLevel':_0x22a2ab(0x19d)};if(this[_0x22a2ab(0x208)]!==null){_0x416c13[_0x22a2ab(0x1f0)]=Math['max'](0x0,this['budgetLimit']-this[_0x22a2ab(0x18b)][_0x22a2ab(0x1e4)]),_0x416c13['percentageUsed']=this[_0x22a2ab(0x18b)]['totalCost']/this[_0x22a2ab(0x208)]*0x64,_0x416c13['withinBudget']=this['usage'][_0x22a2ab(0x1e4)]<=this[_0x22a2ab(0x208)];if(_0x416c13[_0x22a2ab(0x19e)]>=BUDGET_CRITICAL_THRESHOLD*0x64)_0x416c13['warningLevel']=_0x22a2ab(0x218);else _0x416c13[_0x22a2ab(0x19e)]>=BUDGET_WARNING_THRESHOLD*0x64&&(_0x416c13[_0x22a2ab(0x1d0)]=_0x22a2ab(0x205));_0x416c13['warningLevel']!==_0x22a2ab(0x19d)&&this['logger'][_0x22a2ab(0x1bd)]('Budget\x20'+_0x416c13['warningLevel']+':\x20'+_0x416c13[_0x22a2ab(0x19e)]['toFixed'](0x1)+'%\x20used',{'totalSpent':this['usage']['totalCost'],'budgetLimit':this[_0x22a2ab(0x208)],'remainingBudget':_0x416c13[_0x22a2ab(0x1f0)]});if(!_0x416c13['withinBudget']&&this[_0x22a2ab(0x191)]){const _0x590ec0=new Error(ERROR_MESSAGES[_0x22a2ab(0x1c7)]+':\x20$'+this[_0x22a2ab(0x18b)][_0x22a2ab(0x1e4)]['toFixed'](0x2)+'\x20exceeds\x20limit\x20of\x20$'+this[_0x22a2ab(0x208)][_0x22a2ab(0x19f)](0x2));_0x590ec0[_0x22a2ab(0x1a5)]='BUDGET_EXCEEDED',_0x590ec0[_0x22a2ab(0x213)]=_0x416c13;throw _0x590ec0;}}return _0x416c13;}async['setBudgetLimit'](_0x2ef29d){const _0xae4fdc=a0_0x28eb3f,_0x45a17c=this['_validateBudgetAmount'](_0x2ef29d);this['budgetLimit']=_0x45a17c,this[_0xae4fdc(0x20d)][_0xae4fdc(0x1bf)]=this['config']['budget']||{},this['config']['budget']['limit']=_0x45a17c,this['logger']['info'](_0xae4fdc(0x1ef)+_0x45a17c['toFixed'](0x2),{'previousLimit':this[_0xae4fdc(0x208)],'newLimit':_0x45a17c}),await this[_0xae4fdc(0x1b1)]();}['_validateBudgetAmount'](_0x3ca5c5){const _0x445c51=a0_0x28eb3f;if(typeof _0x3ca5c5!==_0x445c51(0x1d1)||_0x3ca5c5<0x0||!isFinite(_0x3ca5c5))throw new Error(ERROR_MESSAGES[_0x445c51(0x1eb)]);return _0x3ca5c5;}async['getBudgetUsage'](){const _0xb35189=a0_0x28eb3f;await this[_0xb35189(0x1e8)]();const _0x5d6436={'totalSpent':this[_0xb35189(0x18b)][_0xb35189(0x1e4)],'budgetLimit':this['budgetLimit'],'inputTokens':this['usage'][_0xb35189(0x214)],'outputTokens':this['usage'][_0xb35189(0x1c3)],'remainingBudget':this[_0xb35189(0x208)]!==null?Math['max'](0x0,this[_0xb35189(0x208)]-this[_0xb35189(0x18b)][_0xb35189(0x1e4)]):null,'percentageUsed':this[_0xb35189(0x208)]!==null?this['usage']['totalCost']/this['budgetLimit']*0x64:null,'sessionStart':this[_0xb35189(0x18b)]['sessionStart'],'lastUpdated':this[_0xb35189(0x18b)]['lastUpdated'],'breakdownByService':{},'breakdownByModel':{},'pricingInfo':{'lastUpdate':this[_0xb35189(0x21a)],'modelsWithPricing':this[_0xb35189(0x1b8)]['size'],'source':this['serverLLMService']?'server':_0xb35189(0x212)}};for(const [_0x12174f,_0x3a87b4]of Object['entries'](this[_0xb35189(0x18b)]['serviceUsage'])){_0x5d6436['breakdownByService'][_0x12174f]={'cost':_0x3a87b4[_0xb35189(0x1f9)],'inputTokens':_0x3a87b4['inputTokens'],'outputTokens':_0x3a87b4[_0xb35189(0x1ca)],'requestCount':_0x3a87b4[_0xb35189(0x1e3)]};}for(const [_0x3baa04,_0x2994b3]of Object[_0xb35189(0x1b6)](this[_0xb35189(0x18b)][_0xb35189(0x202)])){_0x5d6436[_0xb35189(0x1a8)][_0x3baa04]={'cost':_0x2994b3[_0xb35189(0x1f9)],'inputTokens':_0x2994b3['inputTokens'],'outputTokens':_0x2994b3[_0xb35189(0x1ca)],'requestCount':_0x2994b3['requestCount']};}return _0x5d6436;}async[a0_0x28eb3f(0x204)](){const _0x1830e2=a0_0x28eb3f,_0x37a9a1=await this['getBudgetUsage']();let _0x170436='===\x20USAGE\x20REPORT\x20===\x0a';_0x170436+=_0x1830e2(0x1c2)+_0x37a9a1[_0x1830e2(0x1a1)][_0x1830e2(0x19f)](0x4)+'\x0a',_0x170436+=_0x1830e2(0x1ba)+_0x37a9a1[_0x1830e2(0x203)][_0x1830e2(0x1be)]()+'\x0a',_0x170436+=_0x1830e2(0x1cf)+_0x37a9a1[_0x1830e2(0x1ca)]['toLocaleString']()+'\x0a';_0x37a9a1[_0x1830e2(0x208)]!==null&&(_0x170436+=_0x1830e2(0x1fb)+_0x37a9a1['budgetLimit'][_0x1830e2(0x19f)](0x2)+'\x0a',_0x170436+=_0x1830e2(0x20f)+_0x37a9a1['remainingBudget'][_0x1830e2(0x19f)](0x4)+'\x0a',_0x170436+=_0x1830e2(0x20b)+_0x37a9a1[_0x1830e2(0x19e)]['toFixed'](0x1)+'%\x0a');_0x170436+='\x0aPricing\x20source:\x20'+_0x37a9a1[_0x1830e2(0x1f4)][_0x1830e2(0x1bb)]+'\x0a',_0x170436+='Models\x20with\x20pricing:\x20'+_0x37a9a1[_0x1830e2(0x1f4)]['modelsWithPricing']+'\x0a';if(Object[_0x1830e2(0x1b3)](_0x37a9a1['breakdownByService'])['length']>0x0){_0x170436+=_0x1830e2(0x1d7);for(const [_0x2bdbe7,_0x3fd982]of Object['entries'](_0x37a9a1[_0x1830e2(0x1cc)])){_0x170436+=_0x2bdbe7+':\x20$'+_0x3fd982['cost']['toFixed'](0x4)+'\x20('+_0x3fd982['requestCount']+_0x1830e2(0x1c1);}}if(Object['keys'](_0x37a9a1['breakdownByModel'])[_0x1830e2(0x18d)]>0x0){_0x170436+='\x0a===\x20BREAKDOWN\x20BY\x20MODEL\x20===\x0a';for(const [_0x20985c,_0x3434f6]of Object[_0x1830e2(0x1b6)](_0x37a9a1['breakdownByModel'])){_0x170436+=_0x20985c+_0x1830e2(0x217)+_0x3434f6['cost']['toFixed'](0x4)+'\x20('+_0x3434f6[_0x1830e2(0x1e3)]+_0x1830e2(0x1c1);}}return _0x170436;}async['_saveUsageDataIfNeeded'](){const _0x5e2b1c=a0_0x28eb3f,_0x26d3d4=0.1,_0x4d104f=this[_0x5e2b1c(0x18b)]['lastSavedCost']||0x0;this[_0x5e2b1c(0x18b)]['totalCost']-_0x4d104f>=_0x26d3d4&&(await this['saveUsageData'](),this['usage']['lastSavedCost']=this['usage'][_0x5e2b1c(0x1e4)]);}async[a0_0x28eb3f(0x1d4)](){const _0x33b177=a0_0x28eb3f;try{await this[_0x33b177(0x20a)]();const _0x1c332e=a0_0x45893f[_0x33b177(0x18c)](this[_0x33b177(0x1a9)],USAGE_FILENAME);try{const _0x5c27ce=await a0_0x25dd39[_0x33b177(0x1ec)](_0x1c332e,'utf-8'),_0x7e4d05=JSON['parse'](_0x5c27ce);this[_0x33b177(0x18b)]['totalInputTokens']=_0x7e4d05[_0x33b177(0x214)]||0x0,this[_0x33b177(0x18b)]['totalOutputTokens']=_0x7e4d05[_0x33b177(0x1c3)]||0x0,this['usage'][_0x33b177(0x1e4)]=_0x7e4d05[_0x33b177(0x1e4)]||0x0,this['usage'][_0x33b177(0x194)]=_0x7e4d05[_0x33b177(0x194)]||{},this[_0x33b177(0x18b)]['modelUsage']=_0x7e4d05['modelUsage']||{},this[_0x33b177(0x1ff)]['info']('Loaded\x20previous\x20usage\x20data',{'totalCost':this['usage'][_0x33b177(0x1e4)],'totalTokens':this['usage']['totalInputTokens']+this[_0x33b177(0x18b)]['totalOutputTokens']});}catch(_0xdeecd2){_0xdeecd2[_0x33b177(0x1a5)]!==_0x33b177(0x187)&&this[_0x33b177(0x1ff)]['warn'](_0x33b177(0x1d2),_0xdeecd2);}}catch(_0x29fa78){this[_0x33b177(0x1ff)][_0x33b177(0x1bd)](_0x33b177(0x1cb),_0x29fa78);}}async[a0_0x28eb3f(0x20a)](){const _0x316f22=a0_0x28eb3f;try{await a0_0x25dd39['mkdir'](this[_0x316f22(0x1a9)],{'recursive':!![]});}catch(_0x3cb70d){throw new Error(ERROR_MESSAGES[_0x316f22(0x1ae)]+':\x20'+_0x3cb70d[_0x316f22(0x211)]);}}async[a0_0x28eb3f(0x1b1)](){const _0x1dbf1a=a0_0x28eb3f;try{await this[_0x1dbf1a(0x20a)](),this['usage']['sessionEnd']=new Date()[_0x1dbf1a(0x20e)]();const _0x32bbb4=a0_0x45893f['join'](this[_0x1dbf1a(0x1a9)],USAGE_FILENAME);await a0_0x25dd39['writeFile'](_0x32bbb4,JSON['stringify'](this[_0x1dbf1a(0x18b)],null,0x2),_0x1dbf1a(0x192));const _0x4ab11a=a0_0x45893f['join'](this[_0x1dbf1a(0x1a9)],''+SESSION_PREFIX+this['usage']['sessionId']+_0x1dbf1a(0x1ab));await a0_0x25dd39[_0x1dbf1a(0x209)](_0x4ab11a,JSON['stringify'](this['usage'],null,0x2),_0x1dbf1a(0x192)),await this['_cleanupOldSessionFiles'](),this['logger']['info']('Usage\x20data\x20saved\x20successfully',{'totalCost':this['usage']['totalCost'],'sessionId':this[_0x1dbf1a(0x18b)][_0x1dbf1a(0x1df)]});}catch(_0x33e6dd){this['logger']['error'](_0x1dbf1a(0x215),_0x33e6dd);throw new Error(ERROR_MESSAGES[_0x1dbf1a(0x1ae)]+':\x20'+_0x33e6dd[_0x1dbf1a(0x211)]);}}async[a0_0x28eb3f(0x1b2)](){const _0x431901=a0_0x28eb3f;try{const _0x179399=await a0_0x25dd39['readdir'](this['usageDir']),_0x372a80=_0x179399['filter'](_0x3feac8=>_0x3feac8['startsWith'](SESSION_PREFIX)&&_0x3feac8[_0x431901(0x1da)]('.json'))['map'](_0x2bf1c0=>({'name':_0x2bf1c0,'path':a0_0x45893f[_0x431901(0x18c)](this['usageDir'],_0x2bf1c0)}));if(_0x372a80['length']<=MAX_SESSION_FILES)return;const _0xf046e4=await Promise[_0x431901(0x1f6)](_0x372a80[_0x431901(0x1f5)](async _0x27d439=>{const _0x41be8c=_0x431901;try{const _0x2ac61b=await a0_0x25dd39['stat'](_0x27d439[_0x41be8c(0x1c8)]);return{..._0x27d439,'mtime':_0x2ac61b[_0x41be8c(0x1d8)]};}catch(_0x55f2e2){return null;}})),_0xe451e9=_0xf046e4['filter'](_0x4e69e2=>_0x4e69e2!==null)['sort']((_0x1a10aa,_0x121b2d)=>_0x121b2d['mtime']-_0x1a10aa['mtime']),_0x33edf1=_0xe451e9['slice'](MAX_SESSION_FILES);for(const _0x390e21 of _0x33edf1){try{await a0_0x25dd39['unlink'](_0x390e21['path']),this['logger']['debug']('Removed\x20old\x20session\x20file:\x20'+_0x390e21['name']);}catch(_0x5db71b){this[_0x431901(0x1ff)][_0x431901(0x1bd)]('Failed\x20to\x20remove\x20session\x20file\x20'+_0x390e21['name']+':',_0x5db71b);}}_0x33edf1[_0x431901(0x18d)]>0x0&&this[_0x431901(0x1ff)]['info']('Cleaned\x20up\x20'+_0x33edf1['length']+_0x431901(0x1f1));}catch(_0x7f52ce){this[_0x431901(0x1ff)]['warn']('Failed\x20to\x20cleanup\x20old\x20session\x20files:',_0x7f52ce);}}async['resetUsageData'](_0x4aac75=![]){const _0x2201a3=a0_0x28eb3f;this['logger'][_0x2201a3(0x1e6)](_0x2201a3(0x1a0),{'preserveTotal':_0x4aac75});if(!_0x4aac75)this[_0x2201a3(0x18b)]=this[_0x2201a3(0x1d5)]();else{const _0x26d8e0=this[_0x2201a3(0x18b)][_0x2201a3(0x1e4)],_0x5dfee6=this['usage']['totalInputTokens'],_0x200e5f=this['usage']['totalOutputTokens'];this['usage']=this['_initializeUsageData'](),this['usage'][_0x2201a3(0x1e4)]=_0x26d8e0,this[_0x2201a3(0x18b)]['totalInputTokens']=_0x5dfee6,this[_0x2201a3(0x18b)][_0x2201a3(0x1c3)]=_0x200e5f;}await this[_0x2201a3(0x1b1)]();}async['exportUsageData'](_0x4163af=a0_0x28eb3f(0x19b)){const _0x390f03=await this['getBudgetUsage']();if(_0x4163af==='csv')return this['_exportToCsv'](_0x390f03);return JSON['stringify'](_0x390f03,null,0x2);}[a0_0x28eb3f(0x18f)](_0x16323a){const _0x44c96c=a0_0x28eb3f,_0x3e9d89=[_0x44c96c(0x206)];for(const [_0x32b154,_0x4b3efb]of Object['entries'](_0x16323a['breakdownByService'])){_0x3e9d89['push'](_0x44c96c(0x18a)+_0x32b154+','+_0x4b3efb['cost']+','+_0x4b3efb['inputTokens']+','+_0x4b3efb['outputTokens']+','+_0x4b3efb[_0x44c96c(0x1e3)]);}for(const [_0x198810,_0x1488df]of Object[_0x44c96c(0x1b6)](_0x16323a['breakdownByModel'])){_0x3e9d89['push'](_0x44c96c(0x1bc)+_0x198810+','+_0x1488df['cost']+','+_0x1488df['inputTokens']+','+_0x1488df[_0x44c96c(0x1ca)]+','+_0x1488df['requestCount']);}return _0x3e9d89['join']('\x0a');}['getCostEstimate'](_0x485e82,_0x12c889,_0x112419){const _0x2c6149=a0_0x28eb3f;this['_validateUsageInputs']('estimate',_0x485e82,_0x12c889,_0x112419);const _0x2808f5=this['_calculateCost'](_0x485e82,_0x12c889,_0x112419),_0x5aabed={'model':_0x485e82,'estimatedInputTokens':_0x12c889,'estimatedOutputTokens':_0x112419,'estimatedCost':_0x2808f5[_0x2c6149(0x1e4)],..._0x2808f5,'budgetImpact':null};if(this[_0x2c6149(0x208)]!==null){const _0x22015f=this['usage']['totalCost']+_0x2808f5['totalCost'];_0x5aabed[_0x2c6149(0x1ad)]={'currentSpent':this[_0x2c6149(0x18b)]['totalCost'],'afterOperation':_0x22015f,'remainingAfter':Math[_0x2c6149(0x1fd)](0x0,this[_0x2c6149(0x208)]-_0x22015f),'wouldExceedBudget':_0x22015f>this[_0x2c6149(0x208)],'percentageAfter':_0x22015f/this['budgetLimit']*0x64};}return _0x5aabed;}['checkBudgetForOperation'](_0x524703,_0x450bcf,_0x903c76){const _0x9472c3=a0_0x28eb3f,_0x17c866=this['getCostEstimate'](_0x524703,_0x450bcf,_0x903c76);return{'canProceed':this['budgetLimit']===null||!_0x17c866[_0x9472c3(0x1ad)]?.['wouldExceedBudget'],'estimate':_0x17c866,'recommendation':this[_0x9472c3(0x1fa)](_0x17c866)};}['_getBudgetRecommendation'](_0xd85134){const _0x49c640=a0_0x28eb3f;if(this['budgetLimit']===null)return'No\x20budget\x20limit\x20set.\x20Consider\x20setting\x20a\x20budget\x20for\x20cost\x20control.';if(!_0xd85134['budgetImpact'])return _0x49c640(0x1f3);const {percentageAfter:_0x1a91af,wouldExceedBudget:_0x145a1c}=_0xd85134['budgetImpact'];if(_0x145a1c)return'Operation\x20would\x20exceed\x20budget\x20limit.\x20Consider\x20increasing\x20budget\x20or\x20using\x20a\x20less\x20expensive\x20model.';if(_0x1a91af>BUDGET_CRITICAL_THRESHOLD*0x64)return'Operation\x20would\x20use\x20most\x20of\x20your\x20budget.\x20Monitor\x20usage\x20carefully.';if(_0x1a91af>BUDGET_WARNING_THRESHOLD*0x64)return'Operation\x20would\x20use\x20significant\x20portion\x20of\x20budget.\x20Consider\x20cost\x20optimization.';return _0x49c640(0x198);}['getPricingInfo'](){const _0x18c809=a0_0x28eb3f,_0x2e3ecd=Array['from'](this[_0x18c809(0x1b8)]['entries']())['map'](([_0xb9deae,_0x759f67])=>({'model':_0xb9deae,'inputPrice':_0x759f67[_0x18c809(0x1f2)],'outputPrice':_0x759f67[_0x18c809(0x1fc)],'unit':_0x759f67[_0x18c809(0x1ea)],'currency':_0x759f67['currency']}));return{'models':_0x2e3ecd,'lastUpdate':this['lastPricingUpdate'],'source':this[_0x18c809(0x1de)]?'server':_0x18c809(0x212),'totalModels':this['pricingData'][_0x18c809(0x1a3)]};}async[a0_0x28eb3f(0x1a4)](){const _0x49b455=a0_0x28eb3f,_0x37bd39={'status':'healthy','issues':[],'metrics':{'totalCost':this['usage'][_0x49b455(0x1e4)],'totalTokens':this['usage']['totalInputTokens']+this[_0x49b455(0x18b)]['totalOutputTokens'],'modelsWithPricing':this['pricingData']['size'],'budgetLimit':this[_0x49b455(0x208)]}};try{await this['_ensureUsageDirectory']();const _0x4e553f=a0_0x45893f[_0x49b455(0x18c)](this[_0x49b455(0x1a9)],_0x49b455(0x1af));await a0_0x25dd39['writeFile'](_0x4e553f,_0x49b455(0x1ce)),await a0_0x25dd39[_0x49b455(0x1fe)](_0x4e553f);}catch(_0x585997){_0x37bd39['status']='degraded',_0x37bd39['issues']['push'](_0x49b455(0x1aa));}this[_0x49b455(0x1b8)][_0x49b455(0x1a3)]===0x0&&(_0x37bd39[_0x49b455(0x1e9)]='degraded',_0x37bd39['issues']['push']('No\x20pricing\x20data\x20available'));if(this['lastPricingUpdate']){const _0xdbe17b=(Date['now']()-new Date(this[_0x49b455(0x21a)])['getTime']())/(0x3e8*0x3c*0x3c);_0xdbe17b>0x18&&_0x37bd39[_0x49b455(0x1d3)][_0x49b455(0x21b)](_0x49b455(0x1e7));}if(this['budgetLimit']!==null){const _0x391d9=this['_checkBudgetStatus']();_0x391d9[_0x49b455(0x1d0)]!=='normal'&&_0x37bd39[_0x49b455(0x1d3)][_0x49b455(0x21b)]('Budget\x20'+_0x391d9[_0x49b455(0x1d0)]+':\x20'+_0x391d9[_0x49b455(0x19e)][_0x49b455(0x19f)](0x1)+'%\x20used');}return _0x37bd39[_0x49b455(0x1d3)]['length']>0x0&&_0x37bd39[_0x49b455(0x1e9)]==='healthy'&&(_0x37bd39['status']='warning'),_0x37bd39;}async['shutdown'](){const _0x102e13=a0_0x28eb3f;this['logger'][_0x102e13(0x1e6)]('Shutting\x20down\x20budget\x20service');try{await this[_0x102e13(0x1b1)](),this[_0x102e13(0x1b8)]['clear'](),this[_0x102e13(0x1ff)][_0x102e13(0x1e6)](_0x102e13(0x219));}catch(_0x4af33a){this['logger'][_0x102e13(0x1cd)]('Error\x20during\x20budget\x20service\x20shutdown:',_0x4af33a);throw _0x4af33a;}}}