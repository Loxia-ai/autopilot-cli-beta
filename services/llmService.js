function a0_0x34a7(_0x40066e,_0x29d4ac){const _0x44d9c8=a0_0x44d9();return a0_0x34a7=function(_0x34a7db,_0x300936){_0x34a7db=_0x34a7db-0x112;let _0xa72697=_0x44d9c8[_0x34a7db];if(a0_0x34a7['UfKjer']===undefined){var _0x532291=function(_0x304429){const _0x4e7438='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x533508='',_0xa2657d='';for(let _0x4dca6a=0x0,_0x33e199,_0x4d89cf,_0x5e1a56=0x0;_0x4d89cf=_0x304429['charAt'](_0x5e1a56++);~_0x4d89cf&&(_0x33e199=_0x4dca6a%0x4?_0x33e199*0x40+_0x4d89cf:_0x4d89cf,_0x4dca6a++%0x4)?_0x533508+=String['fromCharCode'](0xff&_0x33e199>>(-0x2*_0x4dca6a&0x6)):0x0){_0x4d89cf=_0x4e7438['indexOf'](_0x4d89cf);}for(let _0x285c19=0x0,_0x3b401f=_0x533508['length'];_0x285c19<_0x3b401f;_0x285c19++){_0xa2657d+='%'+('00'+_0x533508['charCodeAt'](_0x285c19)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xa2657d);};a0_0x34a7['dHqxkd']=_0x532291,_0x40066e=arguments,a0_0x34a7['UfKjer']=!![];}const _0x1056b5=_0x44d9c8[0x0],_0x5ea726=_0x34a7db+_0x1056b5,_0x300a62=_0x40066e[_0x5ea726];return!_0x300a62?(_0xa72697=a0_0x34a7['dHqxkd'](_0xa72697),_0x40066e[_0x5ea726]=_0xa72697):_0xa72697=_0x300a62,_0xa72697;},a0_0x34a7(_0x40066e,_0x29d4ac);}function a0_0x44d9(){const _0x5a8be0=['CMf0zv9SAw1PDa','yxP1CMuTB3bLBMfPlwDWDdm1','y29UBMvJDgLVBIbYzwz1C2vK','yw50AhjVCgLJlwHHAwT1','mtKYq2j4teP1','yNvKz2v0u2vYDMLJzq','x2nHBgn1Bgf0zvjLDhj5rgvSyxK','C29Tzq','rMfPBgvKihrVigLUAxrPywXPEMuGC2vYDMvYieXmtsbZzxj2AwnLoG','C2vYDMLJzvn0yxr1CW','C2vYDMLJzuLUC3rHBMnLCW','rMfPBgvKihrVihvWzgf0zsbJB252zxjZyxrPB24G','x2LUAxrPywXPEMvtzxj2zxjtzxj2AwnL','qNvKz2v0ihnLCNzPy2uGAw5PDgLHBgL6zwqGD2L0AcbKEw5HBwLJihbYAwnPBMCGC3vWCg9YDa','u1rsqvrfr1K','z2v0uhjPy2LUz0rHDge','x2DLDerLzMf1BhrnB2rLBezVCLnLCNzPy2u','x2LZuhjVBxb0vg9Vtg9Uz0vYCM9Y','Aw5PDgLHBgL6zq','mtKZodm5uur5tLfx','C2L6zq','x3nLBMrnzxnZywDLv2L0AfjLDhj5','qwrKAw5Nia','C2H1DgrVD24','u2H1DhrPBMCGzg93BIbZzxj2AwnLoIa','y2f0y2G','ig5VDcbMB3vUzcbMB3iGy29UDMvYC2f0Aw9Uia','ywXSu2v0DgXLza','C2vYDMvYlwXSBq','yw50AhjVCgLJlw9WDxm','q29TCgfJDgL6yxrPB24GzMfPBgvKoG','z2vUzxjHDgvjBwfNzq','q29UDMvYC2f0Aw9Uia','B3v0Chv0x3rVA2vUCW','zxn0Aw1HDgvuB2TLBKnVDw50','x3nLBgvJDfnLCNzPy2vcEvbYzwzLCMvUy2vpCMrLCG','DMfSAwrHDgLVBG','mJeWnJK0meLnCMnprW','x3nLBgvJDfnLCNzPy2vgB3jdB252zxjZyxrPB24','qvzbsuXbqKXf','BxmGzgvSyxKGywz0zxiGzw1LCMDLBMn5ignVBxbHy3rPEMf0Aw9U','DxbKyxrLq29UDMvYC2f0Aw9U','C2vYDMLJzxm','x3rYEuzHBgXIywnRu2vYDMLJzq','z2v0ugvYzM9YBwfUy2vnzxrYAwnZ','z29Vz2XLlwDLBwLUAq','rMfSBgLUzYbIywnRihrVigXVy2fSieXmtsbZzxj2AwnLCW','yMfZzurLBgf5txm','u2H1DhrPBMCGzg93BIbmte0GC2vYDMLJzq','Aw52ywXPzcbHCgKGA2v5','x2DLDfnLCNzPy2vnB2rLBeLK','CMvJB3jKvxnHz2u','sw1Hz2uGz2vUzxjHDgLVBIbYzxf1AxjLCYbZzxj2zxiGC2vYDMLJzs4GugXLyxnLignOzwnRihLVDxiGy29UBMvJDgLVBIbHBMqGqvbjigTLEs4','C2vYDMLJzsb1BMf2ywLSywjSzq','AxnjBML0AwfSAxPLza','x3nLBgvJDezHBgXIywnRu2vYDMLJzq','x3jLy29YzfvZywDLqw5Ktwv0CMLJCW','B25qCM9TChruB29mB25N','BM93','nfzOywDnuG','x3nLBgvJDef2ywLSywjSzvnLCNzPy2u','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','x2LZtM9UuMv0CNLHyMXLrxjYB3i','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','yMfSyw5Jzwq','z2v0sw1Hz2vezxnJCMLWDgLVBG','C3rHDhvZ','u2vYDMvYigLTywDLigDLBMvYyxrPB24GzMfPBgvKoG','tu9eruXFufjfrKvsru5drq','z2v0','DxbKyxrLuhjPy2LUz0zYB21tzxj2zxi','ig5VDcbHDMfPBgfIBgu','B3bLBMfP','yw50AhjVCgLJ','zNjVBq','AgfZ','Bw9KzwW','vw5RBM93BIbLCNjVCG','BgXTu3rYyxrLz3K','D2fYBG','yw50AhjVCgLJlxnVBM5LDa','z2v0twf4q29UDgv4DfnPEMu','z2v0sgvHBhrOu3rHDhvZ','Dg90ywXnB2rLBhm','C3rYAw5NAwz5','z29Vz2XL','BMv0D29YAW','x3nLBgvJDejHBgfUy2vKu2vYDMLJzq','yNvKz2v0','Bwf4uMv0CMLLCW','zw5ZDxjLsw5PDgLHBgL6zwq','A2v5CW','Dg9mB3DLCKnHC2u','Dg9VigXVBMC','vu5bvKfjtefcteu','C2vYDMvY','ic0GCgvYzM9YBwLUzYbLBwvYz2vUy3KGy29TCgfJDgL6yxrPB24','y29TCgfJDgL6yxrPB25ezwXHEu1Z','BgvUz3rO','yxP1CMuTywKTz3jVAZm','x3nLBgvJDeXHCMDLC3rdB250zxH0u2vYDMLJzq','D2fPDeLMtMvLzgvK','C2v0qNvKz2v0tgLTAxq','z2v0q29ZDevZDgLTyxrL','C2vYDMvYteXnu2vYDMLJzq','x3nLBgvJDfzPC2LVBLnLCNzPy2u','z2v0uMf0zuXPBwL0Aw5Nu3rHDhvZ','C2vYDMvYsgvHBhrO','yxP1CMuTB3bLBMfPlwDWDdq','DxnLu2vYDMvYteXn','CMvXDwvZDcbSAw1PDa','x2rLBgf5','zNvUy3rPB24','mtjou1zLsgq','qKfmqu5druq','z2v0u3vTBwfYEq','nZy2ndyWDgPJvKvZ','z2v0u2vYDMvYsgvHBhrO','oeHvv2rYuG','yxP1CMuTB3bLBMfPlwrHBgXLmW','CMv0CMLLCW','C3bLzwq','q29TCgfJDgL6yxrPB24Gy29TCgXLDgvKlcbYzxrYEwLUzYbYzxf1zxn0','CMvMCMvZAfbYAwnPBMDeyxrH','Aw5MBW','x2HHBMrSzvjLCxvLC3ruB29myxjNzuvYCM9Y','BwvZC2fNzq','mtfNquDyC1a','r2vUzxjHDgLUzYbPBwfNzsb1C2LUzYbZzxj2zxiTyMfZzwqGAw1Hz2uGz2vUzxjHDgLVBG','x2LUAxrPywXPEMvcDwrNzxrtzxj2AwnL','BwvZC2fNzsb0B28GBg9UzW','u3DPDgnOAw5NihrVigzHBgXIywnRihnLCNzPy2u6ia','mtaWnJz4t3bwwMO','z2v0qwXSuhjPy2LUzW','zMLSDgvY','C2v0','C3LZDgvTuhjVBxb0','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','revhuKferuq','u0vsvKLdrv9tvefuvvm','AgvHBhrOEq','zgvNCMfKzwq','Bg9Nz2vY','Bwf4Aw11BsbJB250zxH0igXLBMD0Aa','CMvXDwvZDcbLBNrPDhKGDg9VigXHCMDL','AgvHBhrOq2HLy2S','u2vYDMLJzsa','ChjPBwfYEvnLCNzPy2u','zxjYB3i','Dg90ywXszxf1zxn0CW','x3nLBgvJDezHC3rLC3rtzxj2AwnL','ig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','u2vUzcbTzxnZywDLigzHAwXLzcbMB3iGy29UDMvYC2f0Aw9Uia','mZa4suDVzKjc','CMvZzxrsyxrLtgLTAxriAxrZ','otu2A0zJA2Px','zMfPBgvKuMvXDwvZDhm','qNvKz2v0ihnLCNzPy2uGBM90igf2ywLSywjSzq','qwXSihjLDhj5igf0DgvTChrZigzHAwXLzdOG','z2v0qNvKz2v0vxnHz2u','4PYfievTzxjNzw5JEsbJB21Wywn0AxPHDgLVBIbJB21WBgv0zwqGzM9Yia','CMf0zuXPBwL0u2vYDMLJzq','Aw5JBhvKzxm','DgHYB3r0Bgu','ntaZ','Dg9Vig1HBNKGCMvXDwvZDhm','uMf0zsbSAw1PDcbLCNjVCIbKzxrLy3rLzcWGD2fPDgLUzYbHBMqGCMv0CNLPBMCUlI4GkhjHDguGBgLTAxqGyxr0zw1WDca','mJC4mZKXmvnovxPbuW','x2LZuMvXDwvZDfrVB0XHCMDLrxjYB3i','CMvXDwvZDcb0B28GBgfYz2u','ndaZ','y29UDgv4Da','revgqvvmvf9srvrswv9eruXbwv9nuW','x2LZu2vYDMvYrxjYB3i','CMf0zsbSAw1PDa','oty3nJK4BeXuBe1e','C2vUze1LC3nHz2u','z2v0tgfZDe91Dhb1DfrVA2vUq291BNq','CMvNAxn0zxjdB252zxjZyxrPB24','CgvYzM9YBwfUy2vnzxrYAwnZ','x2LZuMf0zuXPBwL0rxjYB3i','y29UDgv4DcbSzw5NDgGGzxHJzwvKzwq','y2XLyxi','AgfUzgXLuMf0zuXPBwL0sgL0','C291CMnL','uMvNAxn0zxjLzcbJB252zxjZyxrPB24G','z2v0qxzHAwXHyMXLtw9KzwXZ','zw50CMLLCW','ChvZAa','Cgf5Bg9Hzcb0B28GBgfYz2u','yxv0AgvUDgLJyxrPB24','y29UzMLN','u1bfruq','ndaW','teXnihnLCNzPy2uGAw5PDgLHBgL6yxrPB24GzMfPBgvKlcbIDxqGy29UDgLUDwLUzYb3AxrOigXPBwL0zwqGzNvUy3rPB25HBgL0Eq'];a0_0x44d9=function(){return _0x5a8be0;};return a0_0x44d9();}const a0_0x406fb9=a0_0x34a7;(function(_0x1c7b2c,_0x480e9a){const _0x57e68f=a0_0x34a7,_0x4b1d2b=_0x1c7b2c();while(!![]){try{const _0x4a6780=-parseInt(_0x57e68f(0x133))/0x1*(parseInt(_0x57e68f(0x135))/0x2)+-parseInt(_0x57e68f(0x170))/0x3*(-parseInt(_0x57e68f(0x198))/0x4)+parseInt(_0x57e68f(0x1d1))/0x5+-parseInt(_0x57e68f(0x161))/0x6*(-parseInt(_0x57e68f(0x11e))/0x7)+-parseInt(_0x57e68f(0x1d3))/0x8*(-parseInt(_0x57e68f(0x149))/0x9)+-parseInt(_0x57e68f(0x182))/0xa*(-parseInt(_0x57e68f(0x119))/0xb)+-parseInt(_0x57e68f(0x1ce))/0xc*(parseInt(_0x57e68f(0x141))/0xd);if(_0x4a6780===_0x480e9a)break;else _0x4b1d2b['push'](_0x4b1d2b['shift']());}catch(_0x1df567){_0x4b1d2b['push'](_0x4b1d2b['shift']());}}}(a0_0x44d9,0x35e5e));import{ServerLLMService}from'./serverLLMService.js';import{BudgetService}from'./budgetService.js';import{RateLimitService}from'./rateLimitService.js';const HTTP_STATUS_CODES={'REQUEST_ENTITY_TOO_LARGE':0x19d,'BAD_REQUEST':0x190,'UNAUTHORIZED':0x191,'FORBIDDEN':0x193,'NOT_FOUND':0x194,'TOO_MANY_REQUESTS':0x1ad,'INTERNAL_SERVER_ERROR':0x1f4},REQUEST_SIZE_ERROR_PATTERNS=[a0_0x406fb9(0x12a),a0_0x406fb9(0x157),a0_0x406fb9(0x143),a0_0x406fb9(0x11c),'content\x20length\x20exceeds\x20limit'],LLM_CONSTANTS={'HTTP_STATUS':HTTP_STATUS_CODES,'ERROR_PATTERNS':{'REQUEST_TOO_LARGE':REQUEST_SIZE_ERROR_PATTERNS,'PROMPT_TOO_LONG':['too\x20long','exceeds\x20context\x20window',a0_0x406fb9(0x14f),a0_0x406fb9(0x129)],'RATE_LIMIT':[a0_0x406fb9(0x148),'too\x20many\x20requests','quota\x20exceeded','throttle']},'STRATEGY':{'SPEED':a0_0x406fb9(0x113),'INTELLIGENCE':'intelligence','CONTEXT':a0_0x406fb9(0x145),'BALANCED':a0_0x406fb9(0x19d)},'DEFAULT_MAX_RETRIES':0x3,'DEFAULT_RETRY_DELAY_MS':0x3e8,'DEFAULT_RETRY_MULTIPLIER':0x2,'DEFAULT_SUMMARY_SERVICE':a0_0x406fb9(0x1bc),'SERVICE_STATUS':{'AVAILABLE':'available','DEGRADED':a0_0x406fb9(0x127),'UNAVAILABLE':'unavailable'},'MODEL_PREFERENCE':{'SPEED':['anthropic-haiku','azure-ai-phi4',a0_0x406fb9(0x15e),a0_0x406fb9(0x18a),a0_0x406fb9(0x1ad),'azure-openai-gpt4',a0_0x406fb9(0x17a)],'INTELLIGENCE':[a0_0x406fb9(0x17a),'azure-openai-gpt4',a0_0x406fb9(0x1c0),a0_0x406fb9(0x1ad),'google-gemini',a0_0x406fb9(0x15e),a0_0x406fb9(0x160)],'BALANCED':[a0_0x406fb9(0x1ad),'azure-openai-gpt4',a0_0x406fb9(0x1c0),'google-gemini',a0_0x406fb9(0x17a),a0_0x406fb9(0x15e),'anthropic-haiku']},'ERROR_TYPES':{'PROMPT_TOO_LONG':'prompt_too_long','RATE_LIMIT':a0_0x406fb9(0x15d),'AUTHENTICATION':a0_0x406fb9(0x158),'NETWORK':a0_0x406fb9(0x1b3),'SERVER':a0_0x406fb9(0x1bc),'VALIDATION':a0_0x406fb9(0x181)}};export class LLMService{constructor(_0x304429,_0x4e7438){const _0x1bb771=a0_0x406fb9;this['config']=_0x304429,this['logger']=_0x4e7438,this[_0x1bb771(0x167)]=new Map(),this['conversationServices']=new Map(),this[_0x1bb771(0x166)]=new Map(),this[_0x1bb771(0x1ca)]=_0x304429['useServerLLM']!==![],this[_0x1bb771(0x12d)]=null,this[_0x1bb771(0x1c5)]=null,this['isInitialized']=![],this['rateLimitService']=new RateLimitService(_0x4e7438),this[_0x1bb771(0x162)]=null,this['onPromptTooLong']=null,this['performanceMetrics']={'totalRequests':0x0,'successfulRequests':0x0,'failedRequests':0x0,'totalLatency':0x0,'averageLatency':0x0},this['logger']['info']('LLM\x20service\x20initialized',{'useServerLLM':this['useServerLLM'],'strategy':_0x304429['llmStrategy']||LLM_CONSTANTS['STRATEGY'][_0x1bb771(0x1cf)]}),this['initialize']()[_0x1bb771(0x176)](_0x533508=>{const _0x2093a0=_0x1bb771;this[_0x2093a0(0x128)][_0x2093a0(0x12e)]('Failed\x20to\x20initialize\x20LLM\x20services\x20in\x20constructor:',_0x533508);});}async[a0_0x406fb9(0x16f)](){const _0x2abb07=a0_0x406fb9;if(this['isInitialized'])return;this[_0x2abb07(0x128)][_0x2abb07(0x116)]('Initializing\x20LLM\x20services\x20(Server\x20mode:\x20'+this[_0x2abb07(0x1ca)]+')');try{this[_0x2abb07(0x1ca)]&&await this[_0x2abb07(0x169)]();this[_0x2abb07(0x11b)]();if(this[_0x2abb07(0x167)][_0x2abb07(0x171)]===0x0)throw new Error('No\x20LLM\x20services\x20are\x20available');this[_0x2abb07(0x193)]=!![],this[_0x2abb07(0x128)][_0x2abb07(0x116)]('Initialized\x20'+this[_0x2abb07(0x167)]['size']+'\x20LLM\x20services',{'primary':this['primaryService'],'services':Array['from'](this['serviceInstances']['keys']())});}catch(_0xa2657d){this['logger'][_0x2abb07(0x12e)]('Failed\x20to\x20initialize\x20LLM\x20services:',_0xa2657d);if(this['isInitialized']===![])this[_0x2abb07(0x128)][_0x2abb07(0x1ac)](_0x2abb07(0x15c));else throw _0xa2657d;}}async[a0_0x406fb9(0x169)](){const _0x5302d5=a0_0x406fb9;try{this[_0x5302d5(0x128)][_0x5302d5(0x116)]('Initializing\x20server-based\x20LLM\x20service...'),this['serverLLMService']=new ServerLLMService(this[_0x5302d5(0x159)],this['logger']),await this['serverLLMService'][_0x5302d5(0x16f)](),this[_0x5302d5(0x167)]['set'](_0x5302d5(0x1bc),this['serverLLMService']),this['serviceStatus']['set'](_0x5302d5(0x1bc),LLM_CONSTANTS['SERVICE_STATUS'][_0x5302d5(0x184)]),this['primaryService']=_0x5302d5(0x1bc);const _0x4dca6a=await this['serverLLMService']['getAvailableModels']()||[];this['logger'][_0x5302d5(0x116)]('Server-based\x20LLM\x20service\x20initialized\x20successfully',{'modelsAvailable':this[_0x5302d5(0x1c5)]['getAvailableModels']()['length']});}catch(_0x33e199){this[_0x5302d5(0x128)][_0x5302d5(0x12e)](_0x5302d5(0x165),_0x33e199),this[_0x5302d5(0x1ca)]=![],this['primaryService']=null,this[_0x5302d5(0x1c5)]=null,this['logger'][_0x5302d5(0x1ac)](_0x5302d5(0x18b));}}['_initializeBudgetService'](){const _0x45c91f=a0_0x406fb9;this[_0x45c91f(0x162)]=new BudgetService(this[_0x45c91f(0x159)],this[_0x45c91f(0x128)],this['serverLLMService']),this['logger'][_0x45c91f(0x116)](_0x45c91f(0x16a));}async['ensureInitialized'](){const _0x28f40e=a0_0x406fb9;!this['isInitialized']&&await this[_0x28f40e(0x16f)]();}async[a0_0x406fb9(0x154)](){const _0x47e7b1=a0_0x406fb9;await this['ensureInitialized']();const _0x4d89cf=[];if(this[_0x47e7b1(0x1c5)]&&this[_0x47e7b1(0x193)])try{let _0x5e1a56=await this['serverLLMService']['getAvailableModels']();_0x4d89cf[_0x47e7b1(0x156)](..._0x5e1a56);}catch(_0x285c19){this[_0x47e7b1(0x128)][_0x47e7b1(0x1ac)]('Failed to get models from server service:',_0x285c19);}return _0x4d89cf;}async[a0_0x406fb9(0x16c)](){const _0x35fec8=a0_0x406fb9;return this['budgetService']?await this['budgetService'][_0x35fec8(0x11f)]():new Map();}async['registerConversation'](_0x3b401f,_0x3cfe35,_0x52526a){const _0x58fceb=a0_0x406fb9;await this[_0x58fceb(0x1b7)](),this['logger'][_0x58fceb(0x116)]('Registering\x20conversation:\x20'+_0x3b401f);const _0x175d54=this[_0x58fceb(0x183)](_0x3b401f);if(!_0x175d54){const _0x13ea2f={'useServerLLM':this['useServerLLM'],'serviceInstancesCount':this['serviceInstances'][_0x58fceb(0x171)],'serviceInstances':Array[_0x58fceb(0x1a7)](this[_0x58fceb(0x167)]['keys']()),'serviceStatusCount':this[_0x58fceb(0x166)]['size'],'serviceStatus':Object['fromEntries'](this['serviceStatus'][_0x58fceb(0x155)]()),'isInitialized':this['isInitialized']};this[_0x58fceb(0x128)][_0x58fceb(0x12e)]('No\x20suitable\x20LLM\x20service\x20available\x20-\x20Debug\x20info:',_0x13ea2f);throw new Error('No\x20suitable\x20LLM\x20service\x20available\x20for\x20this\x20conversation.\x20Debug:\x20'+JSON[_0x58fceb(0x1b1)](_0x13ea2f));}const _0x477746=this[_0x58fceb(0x167)]['get'](_0x175d54);try{await _0x477746['registerConversation'](_0x3b401f,_0x3cfe35,_0x52526a),this['conversationServices']['set'](_0x3b401f,_0x175d54),this['logger'][_0x58fceb(0x116)]('Registered\x20conversation\x20'+_0x3b401f+'\x20with\x20service\x20'+_0x175d54);}catch(_0xa82316){this[_0x58fceb(0x128)]['error']('Failed\x20to\x20register\x20conversation\x20'+_0x3b401f+':',_0xa82316);const _0x653c62=this['_selectFallbackService'](_0x175d54);if(_0x653c62){const _0x1a117b=this['serviceInstances'][_0x58fceb(0x1a2)](_0x653c62);await _0x1a117b[_0x58fceb(0x14c)](_0x3b401f,_0x3cfe35,_0x52526a),this['conversationServices']['set'](_0x3b401f,_0x653c62),this[_0x58fceb(0x128)]['info'](_0x58fceb(0x153)+_0x3b401f+'\x20with\x20fallback\x20service\x20'+_0x653c62);}else throw new Error('Failed\x20to\x20register\x20conversation\x20'+_0x3b401f+'\x20with\x20any\x20service');}}async[a0_0x406fb9(0x14a)](_0x3531e1,_0x10dbe6,_0xa79161){const _0x1afb46=a0_0x406fb9,_0x3d828a=Date['now']();this['performanceMetrics']['totalRequests']++;try{const _0x24e8e1=this[_0x1afb46(0x19a)][_0x1afb46(0x1a2)](_0x3531e1);if(!_0x24e8e1)throw new Error('Conversation\x20'+_0x3531e1+_0x1afb46(0x19c));const _0x1bc900=this['serviceInstances'][_0x1afb46(0x1a2)](_0x24e8e1);if(!_0x1bc900)throw new Error('Service\x20'+_0x24e8e1+_0x1afb46(0x177)+_0x3531e1);const _0x31a054=this['_getServiceModelId'](_0x24e8e1);await this[_0x1afb46(0x13b)]['waitIfNeeded'](_0x31a054);const _0x1778cd=await this[_0x1afb46(0x172)](_0x1bc900,_0x24e8e1,_0x3531e1,_0x10dbe6,_0xa79161);return await this['_recordUsageAndMetrics'](_0x1bc900,_0x24e8e1,_0x3d828a,!![]),_0x1778cd;}catch(_0x4bf9e7){this['performanceMetrics'][_0x1afb46(0x136)]++,this[_0x1afb46(0x128)]['error'](_0x1afb46(0x132)+_0x3531e1+':',_0x4bf9e7);throw _0x4bf9e7;}}async[a0_0x406fb9(0x172)](_0x58c114,_0x1d7a36,_0x166d93,_0x330bb5,_0x19184a){const _0x179c47=a0_0x406fb9,_0x3aecc4=this['config'][_0x179c47(0x112)]?.['maxRetries']||LLM_CONSTANTS['DEFAULT_MAX_RETRIES'],_0x3b65d4=this['config']['retries']?.['maxRateLimitRetries']||0x5,_0x403267=this['config'][_0x179c47(0x112)]?.[_0x179c47(0x1be)]||0x7d0;let _0x2d0ec1=0x0,_0x6f065b=0x0,_0x46daa0=null;while(_0x2d0ec1<=_0x3aecc4){try{const _0x43b15e=await _0x58c114[_0x179c47(0x14a)](_0x166d93,_0x330bb5,_0x19184a);if(_0x1d7a36!=='server'){const _0x16ac33=this[_0x179c47(0x18f)](_0x1d7a36);this['rateLimitService'][_0x179c47(0x134)](_0x16ac33);}return this[_0x179c47(0x166)]['get'](_0x1d7a36)===LLM_CONSTANTS['SERVICE_STATUS'][_0x179c47(0x124)]&&this['serviceStatus']['set'](_0x1d7a36,LLM_CONSTANTS[_0x179c47(0x125)]['AVAILABLE']),_0x43b15e;}catch(_0x222c8d){_0x46daa0=_0x222c8d,this['logger']['error']('Request\x20failed\x20(attempt\x20'+(_0x2d0ec1+0x1)+'/'+(_0x3aecc4+0x1)+'):',_0x222c8d);if(this[_0x179c47(0x16e)](_0x222c8d)){await this['_handlePromptTooLongError'](_0x166d93);const _0x1ca34a=this[_0x179c47(0x18f)](_0x1d7a36);this['logger'][_0x179c47(0x116)](_0x179c47(0x173)+_0x403267+'ms\x20delay\x20after\x20compactization'),await this[_0x179c47(0x1cc)](_0x403267),await this[_0x179c47(0x13b)]['waitIfNeeded'](_0x1ca34a);continue;}if(this[_0x179c47(0x142)](_0x222c8d)){await this[_0x179c47(0x117)](_0x166d93);const _0x1871f2=this['_getServiceModelId'](_0x1d7a36);this[_0x179c47(0x128)][_0x179c47(0x116)]('Adding\x20'+_0x403267+_0x179c47(0x185)),await this[_0x179c47(0x1cc)](_0x403267),await this[_0x179c47(0x13b)][_0x179c47(0x1c2)](_0x1871f2);continue;}if(_0x1d7a36!=='server'&&this['_isRateLimitError'](_0x222c8d)){const _0x343fdc=this[_0x179c47(0x18f)](_0x1d7a36);_0x6f065b++;if(_0x6f065b>_0x3b65d4)throw new Error('Rate\x20limit\x20retry\x20threshold\x20exceeded\x20('+_0x3b65d4+'):\x20'+_0x222c8d['message']);this[_0x179c47(0x13b)]['handleRateLimitHit'](_0x343fdc);if(_0x2d0ec1<_0x3aecc4){this[_0x179c47(0x128)]['info'](_0x179c47(0x140)+_0x6f065b+'/'+_0x3b65d4+')'),await this[_0x179c47(0x13b)]['waitIfNeeded'](_0x343fdc);continue;}}if(_0x1d7a36==='server'&&this['_isServerError'](_0x222c8d)){const _0x1d09fd=await this[_0x179c47(0x188)](_0x166d93,_0x330bb5,_0x19184a);if(_0x1d09fd)return _0x1d09fd;}if(this['_isNonRetryableError'](_0x222c8d))break;if(_0x2d0ec1>=_0x3aecc4)break;this['serviceStatus'][_0x179c47(0x121)](_0x1d7a36,LLM_CONSTANTS[_0x179c47(0x125)]['DEGRADED']);const _0x258860=this['_calculateRetryDelay'](_0x2d0ec1);await this[_0x179c47(0x1cc)](_0x258860),_0x2d0ec1++;}}throw new Error(_0x179c47(0x138)+(_0x46daa0?.['message']||'Unknown\x20error'));}async['_tryFallbackService'](_0x24fdb1,_0x3496bd,_0x67c30a){const _0x3fe271=a0_0x406fb9,_0xaaff17=this[_0x3fe271(0x194)](_0x3fe271(0x1bc));if(!_0xaaff17)return null;try{this[_0x3fe271(0x128)][_0x3fe271(0x116)](_0x3fe271(0x11d)+_0xaaff17);const _0x31de18=this[_0x3fe271(0x167)][_0x3fe271(0x1a2)](_0xaaff17);return await _0x31de18[_0x3fe271(0x14c)](_0x24fdb1,_0x67c30a[_0x3fe271(0x122)]||'Conversation\x20resumed'),this[_0x3fe271(0x19a)]['set'](_0x24fdb1,_0xaaff17),await _0x31de18[_0x3fe271(0x14a)](_0x24fdb1,_0x3496bd,_0x67c30a);}catch(_0x301648){return this['logger']['error']('Fallback\x20service\x20also\x20failed:\x20'+_0x301648['message']),null;}}async[a0_0x406fb9(0x195)](_0x920672,_0x6bf260,_0x2fa177,_0xc3da54){const _0x15c14b=a0_0x406fb9,_0x269202=Date[_0x15c14b(0x197)]()-_0x2fa177;this[_0x15c14b(0x14d)]['totalLatency']+=_0x269202,this['performanceMetrics']['averageLatency']=this[_0x15c14b(0x14d)]['totalLatency']/this['performanceMetrics'][_0x15c14b(0x12f)];_0xc3da54&&this['performanceMetrics']['successfulRequests']++;if(this['budgetService']&&_0x6bf260!==_0x15c14b(0x1bc))try{const _0x2c7e9d=_0x920672['getLastInputTokenCount'](),_0xee793e=_0x920672[_0x15c14b(0x14b)](),_0x51c9dc=this['_getDefaultModelForService'](_0x6bf260);await this['budgetService'][_0x15c14b(0x190)](_0x6bf260,_0x51c9dc,_0x2c7e9d,_0xee793e);}catch(_0xa384d4){this['logger']['warn']('Failed\x20to\x20record\x20usage\x20for\x20budget\x20tracking:',_0xa384d4);}}async['_handlePromptTooLongError'](_0x9893fa){const _0x5d901d=a0_0x406fb9;this[_0x5d901d(0x128)][_0x5d901d(0x1ac)]('Prompt\x20too\x20long\x20error\x20detected\x20-\x20requesting\x20compactization');if(this['onPromptTooLong'])try{await this[_0x5d901d(0x196)](_0x9893fa),this['logger'][_0x5d901d(0x116)](_0x5d901d(0x114));}catch(_0x5bf191){this['logger'][_0x5d901d(0x12e)](_0x5d901d(0x17b),_0x5bf191);throw _0x5bf191;}else throw new Error('Prompt\x20too\x20long\x20and\x20no\x20compactization\x20handler\x20available');}async[a0_0x406fb9(0x186)](_0x24f932,_0x1b8261){const _0x59c6a5=a0_0x406fb9;this['logger']['info']('Updating\x20conversation:\x20'+_0x24f932);const _0x5a986b=this['conversationServices']['get'](_0x24f932);if(!_0x5a986b)throw new Error(_0x59c6a5(0x17d)+_0x24f932+_0x59c6a5(0x19c));const _0x20f39e=this['serviceInstances']['get'](_0x5a986b);if(!_0x20f39e)throw new Error('Service\x20'+_0x5a986b+'\x20not\x20found\x20for\x20conversation\x20'+_0x24f932);try{await _0x20f39e['updateConversation'](_0x24f932,_0x1b8261);}catch(_0x221468){this[_0x59c6a5(0x128)][_0x59c6a5(0x12e)](_0x59c6a5(0x168)+_0x24f932+':',_0x221468);throw _0x221468;}}async[a0_0x406fb9(0x1d0)](_0x51a50e,_0xe9548){const _0x388b62=a0_0x406fb9;this[_0x388b62(0x128)][_0x388b62(0x116)]('Getting\x20summary\x20for\x20conversation:\x20'+_0x51a50e);const _0x32ee3b=this['conversationServices'][_0x388b62(0x1a2)](_0x51a50e);if(!_0x32ee3b)throw new Error('Cannot\x20get\x20summary:\x20conversation\x20'+_0x51a50e+_0x388b62(0x131));const _0x2bf07f=this[_0x388b62(0x167)][_0x388b62(0x1a2)](_0x32ee3b);if(!_0x2bf07f)throw new Error('Cannot\x20get\x20summary:\x20service\x20'+_0x32ee3b+_0x388b62(0x1a4));this['logger'][_0x388b62(0x116)]('Using\x20same\x20service\x20for\x20summary:\x20'+_0x32ee3b);try{const _0x56706d=await _0x2bf07f['getSummary'](_0xe9548,_0x51a50e);if(this['budgetService']&&_0x32ee3b!==_0x388b62(0x1bc)){const _0x555db2=this[_0x388b62(0x16d)](_0x32ee3b);await this[_0x388b62(0x162)][_0x388b62(0x190)](_0x32ee3b,_0x555db2,_0x2bf07f['getLastInputTokenCount'](),_0x2bf07f['getLastOutputTokenCount']());}return _0x56706d;}catch(_0x2276ac){this[_0x388b62(0x128)]['error']('Failed\x20to\x20get\x20summary\x20using\x20same\x20service\x20'+_0x32ee3b+':',_0x2276ac);throw _0x2276ac;}}async['getImageDescription'](_0x19cb37,_0x52e1dd,_0x343ad5={}){const _0x3cb8c6=a0_0x406fb9;this['logger'][_0x3cb8c6(0x116)]('Getting\x20image\x20description\x20using\x20vision-capable\x20model');if(this[_0x3cb8c6(0x1ca)]&&this['serviceInstances']['has'](_0x3cb8c6(0x1bc)))try{const _0x2f4fe7=this['serviceInstances'][_0x3cb8c6(0x1a2)](_0x3cb8c6(0x1bc));return await _0x2f4fe7[_0x3cb8c6(0x19e)](_0x19cb37,_0x52e1dd,_0x343ad5);}catch(_0x3c1237){this[_0x3cb8c6(0x128)]['warn']('Server\x20vision\x20service\x20failed,\x20trying\x20fallback:',_0x3c1237);}const _0x33e9e8=this['_selectVisionService']();if(!_0x33e9e8)throw new Error('No\x20vision-capable\x20services\x20available');const _0x2ccaed=this[_0x3cb8c6(0x167)]['get'](_0x33e9e8),_0x13af66=this[_0x3cb8c6(0x18f)](_0x33e9e8);await this['rateLimitService'][_0x3cb8c6(0x1c2)](_0x13af66);const _0x5484ec=this['config']['retries']?.[_0x3cb8c6(0x1b6)]||LLM_CONSTANTS['DEFAULT_MAX_RETRIES'];let _0x52dc47=0x0,_0xaf3d47=null;while(_0x52dc47<=_0x5484ec){try{const _0x543dfb=await _0x2ccaed[_0x3cb8c6(0x19e)](_0x19cb37,_0x52e1dd,_0x343ad5);this[_0x3cb8c6(0x13b)]['resetRateLimitHits'](_0x13af66);if(this[_0x3cb8c6(0x162)]){const _0x4785af=this[_0x3cb8c6(0x16d)](_0x33e9e8);await this[_0x3cb8c6(0x162)]['recordUsage'](_0x33e9e8,_0x4785af,_0x2ccaed[_0x3cb8c6(0x123)](),_0x2ccaed[_0x3cb8c6(0x14b)]());}return _0x543dfb;}catch(_0x1e4a6d){_0xaf3d47=_0x1e4a6d,this['logger'][_0x3cb8c6(0x12e)]('Vision\x20request\x20failed\x20(attempt\x20'+(_0x52dc47+0x1)+'/'+(_0x5484ec+0x1)+'):',_0x1e4a6d);if(this[_0x3cb8c6(0x14e)](_0x1e4a6d)){this[_0x3cb8c6(0x13b)][_0x3cb8c6(0x151)](_0x13af66);if(_0x52dc47<_0x5484ec){await this['rateLimitService']['waitIfNeeded'](_0x13af66);continue;}}if(this['_isNonRetryableError'](_0x1e4a6d))throw _0x1e4a6d;if(_0x52dc47>=_0x5484ec)break;const _0x55086e=this['_calculateRetryDelay'](_0x52dc47);await this[_0x3cb8c6(0x1cc)](_0x55086e),_0x52dc47++;}}throw new Error('All\x20vision\x20retry\x20attempts\x20failed:\x20'+(_0xaf3d47?.['message']||_0x3cb8c6(0x1aa)));}async['generateImage'](_0x5e7583,_0x11b30c={}){const _0x3cbe58=a0_0x406fb9;this['logger'][_0x3cbe58(0x116)](_0x3cbe58(0x11a));const _0x2f980c=this['serviceInstances']['get']('server');if(_0x2f980c)try{const _0x17e420=await _0x2f980c[_0x3cbe58(0x17c)](_0x5e7583,_0x11b30c);return this[_0x3cbe58(0x162)]&&_0x17e420['usage']&&await this[_0x3cbe58(0x162)][_0x3cbe58(0x190)](_0x3cbe58(0x1bc),_0x11b30c[_0x3cbe58(0x1a9)]||_0x3cbe58(0x1d4),_0x17e420['usage']['input_tokens']||0x0,_0x17e420['usage'][_0x3cbe58(0x17e)]||0x0),_0x17e420;}catch(_0x4e1dc3){this['logger']['warn'](_0x3cbe58(0x1a0),_0x4e1dc3);throw _0x4e1dc3;}throw new Error(_0x3cbe58(0x191));}async[a0_0x406fb9(0x17f)](_0x23abfc){const _0x2d6c7b=a0_0x406fb9,_0x26735a=this['conversationServices']['get'](_0x23abfc);if(!_0x26735a)throw new Error(_0x2d6c7b(0x17d)+_0x23abfc+_0x2d6c7b(0x19c));const _0x53a6bd=this['serviceInstances'][_0x2d6c7b(0x1a2)](_0x26735a);if(!_0x53a6bd)throw new Error(_0x2d6c7b(0x12c)+_0x26735a+'\x20not\x20found\x20for\x20conversation\x20'+_0x23abfc);try{return await _0x53a6bd[_0x2d6c7b(0x17f)](_0x23abfc);}catch(_0x251b23){return this[_0x2d6c7b(0x128)]['error']('Failed\x20to\x20estimate\x20token\x20count\x20for\x20conversation\x20'+_0x23abfc+':',_0x251b23),0x0;}}[a0_0x406fb9(0x1c4)](_0x32d5c9,_0x5ecad0,_0x4c9575){const _0x3e70aa=a0_0x406fb9;if(!this[_0x3e70aa(0x162)])return null;return this[_0x3e70aa(0x162)][_0x3e70aa(0x1c4)](_0x32d5c9,_0x5ecad0,_0x4c9575);}['checkBudgetForOperation'](_0x41c8e1,_0x10b022,_0x13275b){const _0x295c32=a0_0x406fb9;if(!this['budgetService'])return null;return this[_0x295c32(0x162)]['checkBudgetForOperation'](_0x41c8e1,_0x10b022,_0x13275b);}async['getBudgetUsage'](){const _0x37ff43=a0_0x406fb9;if(!this[_0x37ff43(0x162)])return null;return await this['budgetService'][_0x37ff43(0x139)]();}async[a0_0x406fb9(0x1c3)](_0x2e515a){const _0x458780=a0_0x406fb9;if(!this[_0x458780(0x162)])throw new Error(_0x458780(0x137));await this['budgetService']['setBudgetLimit'](_0x2e515a);}async[a0_0x406fb9(0x115)](){const _0x1a46b2=a0_0x406fb9;if(!this['budgetService'])return![];return await this[_0x1a46b2(0x162)][_0x1a46b2(0x1a3)]();}['getServiceStatus'](){const _0x3c5846=a0_0x406fb9,_0x1f375b={};for(const [_0x429704,_0x2a92b5]of this['serviceStatus']['entries']()){_0x1f375b[_0x429704]={'status':_0x2a92b5,'available':_0x2a92b5!==LLM_CONSTANTS[_0x3c5846(0x125)][_0x3c5846(0x1bb)],'isPrimary':_0x429704===this['primaryService']};}return _0x1f375b;}['getPerformanceMetrics'](){const _0xedfdb5=a0_0x406fb9;return{...this['performanceMetrics'],'successRate':this[_0xedfdb5(0x14d)][_0xedfdb5(0x12f)]>0x0?this['performanceMetrics']['successfulRequests']/this['performanceMetrics']['totalRequests']*0x64:0x0};}[a0_0x406fb9(0x1c7)](){const _0x3aaf24=a0_0x406fb9;return this[_0x3aaf24(0x13b)]['getAllStatus']();}['registerPromptTooLongHandler'](_0x44159a){const _0x112a13=a0_0x406fb9;this[_0x112a13(0x196)]=_0x44159a,this[_0x112a13(0x128)]['info']('Prompt\x20too\x20long\x20handler\x20registered');}async[a0_0x406fb9(0x1af)](){const _0x4cd0a9=a0_0x406fb9,_0x530eae={'overall':_0x4cd0a9(0x126),'services':{},'budget':null,'performance':this[_0x4cd0a9(0x189)](),'pricing':{'available':![],'modelsWithPricing':0x0,'lastUpdate':null}};for(const [_0x54d2cd,_0x629377]of this['serviceStatus'][_0x4cd0a9(0x155)]()){_0x530eae['services'][_0x54d2cd]={'status':_0x629377,'available':_0x629377!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']},_0x629377===LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']&&(_0x530eae['overall']=_0x4cd0a9(0x127));}if(this[_0x4cd0a9(0x1c5)])try{const _0xb6514=await this['serverLLMService'][_0x4cd0a9(0x1d2)]();_0x530eae[_0x4cd0a9(0x187)]['server'][_0x4cd0a9(0x1c8)]=_0xb6514,_0xb6514[_0x4cd0a9(0x19f)]!==_0x4cd0a9(0x126)&&(_0x530eae['overall']='degraded');}catch(_0x5602db){_0x530eae[_0x4cd0a9(0x187)]['server']['serverHealth']={'status':'error','error':_0x5602db['message']},_0x530eae['overall']=_0x4cd0a9(0x127);}if(this['budgetService'])try{_0x530eae['budget']=await this['budgetService'][_0x4cd0a9(0x12b)](),_0x530eae[_0x4cd0a9(0x1b5)][_0x4cd0a9(0x19f)]!==_0x4cd0a9(0x126)&&(_0x530eae['overall']=_0x4cd0a9(0x127));}catch(_0x2df472){_0x530eae['budget']={'status':_0x4cd0a9(0x12e),'error':_0x2df472[_0x4cd0a9(0x118)]},_0x530eae['overall']=_0x4cd0a9(0x127);}if(this[_0x4cd0a9(0x162)]){const _0x148fe5=this[_0x4cd0a9(0x162)]['getPricingInfo']();_0x530eae['pricing']={'available':_0x148fe5['totalModels']>0x0,'modelsWithPricing':_0x148fe5[_0x4cd0a9(0x1b0)],'lastUpdate':_0x148fe5['lastUpdate'],'source':_0x148fe5[_0x4cd0a9(0x152)]};}return _0x530eae;}async[a0_0x406fb9(0x174)](){const _0x187410=a0_0x406fb9;this[_0x187410(0x128)][_0x187410(0x116)](_0x187410(0x18d));const _0x3459d4=[];for(const [_0x531635,_0x5b509e]of this[_0x187410(0x167)][_0x187410(0x155)]()){typeof _0x5b509e['shutdown']===_0x187410(0x1cd)&&(this[_0x187410(0x128)][_0x187410(0x116)](_0x187410(0x175)+_0x531635),_0x3459d4[_0x187410(0x156)](_0x5b509e[_0x187410(0x174)]()['catch'](_0x3f8334=>{this['logger']['error']('Error\x20shutting\x20down\x20service\x20'+_0x531635+':',_0x3f8334);})));}this[_0x187410(0x162)]&&typeof this['budgetService']['shutdown']==='function'&&_0x3459d4[_0x187410(0x156)](this[_0x187410(0x162)]['shutdown']()['catch'](_0x51cdba=>{const _0x2c2781=_0x187410;this[_0x2c2781(0x128)][_0x2c2781(0x12e)]('Error\x20shutting\x20down\x20budget\x20service:',_0x51cdba);})),await Promise[_0x187410(0x178)](_0x3459d4),this[_0x187410(0x167)][_0x187410(0x150)](),this['conversationServices'][_0x187410(0x150)](),this['serviceStatus'][_0x187410(0x150)](),this[_0x187410(0x128)]['info']('All\x20LLM\x20services\x20shut\x20down');}[a0_0x406fb9(0x183)](_0x5643c1,_0x3ad98a=[]){const _0x26f69e=a0_0x406fb9;if(this[_0x26f69e(0x1ca)]&&this[_0x26f69e(0x167)][_0x26f69e(0x1a8)](_0x26f69e(0x1bc))&&!_0x3ad98a['includes']('server')&&this[_0x26f69e(0x166)][_0x26f69e(0x1a2)](_0x26f69e(0x1bc))===LLM_CONSTANTS[_0x26f69e(0x125)][_0x26f69e(0x184)])return'server';return this[_0x26f69e(0x199)](_0x3ad98a);}[a0_0x406fb9(0x199)](_0x545c25=[]){const _0x565f32=a0_0x406fb9,_0x34e3be=Array['from'](this['serviceInstances'][_0x565f32(0x1b8)]())['filter'](_0x562e43=>!_0x545c25[_0x565f32(0x13c)](_0x562e43)&&this[_0x565f32(0x166)][_0x565f32(0x1a2)](_0x562e43)!==LLM_CONSTANTS[_0x565f32(0x125)][_0x565f32(0x1bb)]);if(_0x34e3be[_0x565f32(0x1bf)]===0x0)return null;const _0x19cd23=this[_0x565f32(0x159)][_0x565f32(0x1ab)]||LLM_CONSTANTS[_0x565f32(0x16b)][_0x565f32(0x1cf)];switch(_0x19cd23){case LLM_CONSTANTS[_0x565f32(0x16b)][_0x565f32(0x15a)]:return this[_0x565f32(0x130)](_0x34e3be);case LLM_CONSTANTS[_0x565f32(0x16b)]['INTELLIGENCE']:return this['_selectSmartestService'](_0x34e3be);case LLM_CONSTANTS[_0x565f32(0x16b)]['CONTEXT']:return this['_selectLargestContextService'](_0x34e3be);case LLM_CONSTANTS[_0x565f32(0x16b)]['BALANCED']:default:return this[_0x565f32(0x1b4)](_0x34e3be);}}['_selectFallbackService'](_0x234d44){const _0xbd7ee0=a0_0x406fb9,_0x226c4b=Array['from'](this[_0xbd7ee0(0x167)]['keys']())[_0xbd7ee0(0x120)](_0x449167=>_0x449167!==_0x234d44&&this[_0xbd7ee0(0x166)]['get'](_0x449167)!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']);if(_0x226c4b[_0xbd7ee0(0x1bf)]===0x0)return null;if(_0x234d44!=='anthropic'&&_0x226c4b['includes'](_0xbd7ee0(0x1a6)))return _0xbd7ee0(0x1a6);return _0x226c4b[0x0];}[a0_0x406fb9(0x1c6)](_0x71d352=[]){const _0x215714=a0_0x406fb9,_0x4566e6=['anthropic','openai','google'],_0x154b08=_0x4566e6['filter'](_0xb9929b=>!_0x71d352['includes'](_0xb9929b)&&this[_0x215714(0x167)][_0x215714(0x1a8)](_0xb9929b)&&this['serviceStatus']['get'](_0xb9929b)!==LLM_CONSTANTS[_0x215714(0x125)][_0x215714(0x1bb)]);if(_0x154b08[_0x215714(0x1bf)]===0x0)return null;const _0x378269=['anthropic',_0x215714(0x1a5),_0x215714(0x1b2)];for(const _0x1ce1f5 of _0x378269){if(_0x154b08['includes'](_0x1ce1f5))return _0x1ce1f5;}return _0x154b08[0x0];}[a0_0x406fb9(0x130)](_0x528968){const _0x1f4f0c=a0_0x406fb9;return this[_0x1f4f0c(0x180)](_0x528968,LLM_CONSTANTS[_0x1f4f0c(0x1a1)][_0x1f4f0c(0x15a)]);}['_selectSmartestService'](_0x32edeb){return this['_selectServiceByPreferenceOrder'](_0x32edeb,LLM_CONSTANTS['MODEL_PREFERENCE']['INTELLIGENCE']);}[a0_0x406fb9(0x1c1)](_0x5cf995){const _0x216886=a0_0x406fb9;let _0x4882cf=null,_0x595c6e=0x0;for(const _0xdf0e41 of _0x5cf995){const _0x123381=this[_0x216886(0x167)]['get'](_0xdf0e41);if(!_0x123381||typeof _0x123381[_0x216886(0x1ae)]!=='function')continue;const _0x1f28ac=_0x123381['getMaxContextSize']();_0x1f28ac>_0x595c6e&&(_0x595c6e=_0x1f28ac,_0x4882cf=_0xdf0e41);}return _0x4882cf||_0x5cf995[0x0];}['_selectBalancedService'](_0x406d1b){const _0x4421f6=a0_0x406fb9;return this[_0x4421f6(0x180)](_0x406d1b,LLM_CONSTANTS['MODEL_PREFERENCE']['BALANCED']);}['_selectServiceByPreferenceOrder'](_0x1f502c,_0x3b8213){const _0x122da8=a0_0x406fb9,_0x3a04c1={'anthropic':['anthropic-opus',_0x122da8(0x1ad),'anthropic-haiku'],'openai':[_0x122da8(0x1c9),_0x122da8(0x15e)],'google':[_0x122da8(0x18a)],'server':[]};for(const _0x1599fd of _0x3b8213){for(const _0x33507d of _0x1f502c){if(_0x33507d==='server')return _0x33507d;const _0x46a234=_0x3a04c1[_0x33507d]||[];if(_0x46a234[_0x122da8(0x13c)](_0x1599fd))return _0x33507d;}}return _0x1f502c[0x0];}[a0_0x406fb9(0x18f)](_0x1f0774){const _0x11c103=a0_0x406fb9,_0x3acf56={'anthropic':_0x11c103(0x1ad),'openai':'azure-openai-gpt4','google':'google-gemini','server':_0x11c103(0x179)};return _0x3acf56[_0x1f0774]||_0x1f0774;}['_getDefaultModelForService'](_0x3a13a9){return this['_getServiceModelId'](_0x3a13a9);}[a0_0x406fb9(0x163)](_0x199cfb){const _0x3b08a8=a0_0x406fb9,_0x26c16d=this['config']['retries']?.[_0x3b08a8(0x18c)]||LLM_CONSTANTS[_0x3b08a8(0x146)],_0x528f81=this['config'][_0x3b08a8(0x112)]?.['delayMultiplier']||LLM_CONSTANTS['DEFAULT_RETRY_MULTIPLIER'];return _0x26c16d*Math['pow'](_0x528f81,_0x199cfb);}['_delay'](_0x5a1f3f){return new Promise(_0x4d6c43=>setTimeout(_0x4d6c43,_0x5a1f3f));}['_isRateLimitError'](_0x14e607){const _0x12757f=a0_0x406fb9,_0x1e0f23=[_0x12757f(0x148),_0x12757f(0x13f),'quota\x20exceeded',_0x12757f(0x1cb),'429',_0x12757f(0x13d)],_0x29039d=_0x14e607[_0x12757f(0x118)]?.[_0x12757f(0x1b9)]()||'';return _0x1e0f23[_0x12757f(0x164)](_0x29a506=>_0x29039d[_0x12757f(0x13c)](_0x29a506));}[a0_0x406fb9(0x19b)](_0x25400c){const _0x56fed6=a0_0x406fb9,_0x51cc7e=[_0x56fed6(0x18e),'authentication\x20failed','unauthorized','model\x20not\x20found','invalid\x20request\x20format','content\x20policy'],_0x34834e=_0x25400c[_0x56fed6(0x118)]?.[_0x56fed6(0x1b9)]()||'';return _0x51cc7e[_0x56fed6(0x164)](_0x418104=>_0x34834e[_0x56fed6(0x13c)](_0x418104));}['_isPromptTooLongError'](_0x5092c1){const _0x67d6a3=a0_0x406fb9,_0x4d5f3f=_0x5092c1['message']?.[_0x67d6a3(0x1b9)]()||'',_0x58538a=_0x5092c1['toString']?.()?.['toLowerCase']()||'';return(_0x4d5f3f['includes'](_0x67d6a3(0x1ba))||_0x58538a[_0x67d6a3(0x13c)]('too\x20long'))&&(_0x5092c1['status']===0x190||_0x4d5f3f[_0x67d6a3(0x13c)](_0x67d6a3(0x15b))||_0x58538a['includes']('400'));}['_isRequestTooLargeError'](_0x29df40){const _0x3b26a7=a0_0x406fb9,_0x82fd9f=_0x29df40[_0x3b26a7(0x118)]?.['toLowerCase']()||'',_0x2aea7e=_0x29df40[_0x3b26a7(0x19f)]||_0x29df40['originalError']?.['status'];return _0x2aea7e===0x19d||_0x82fd9f[_0x3b26a7(0x13c)](_0x3b26a7(0x12a))||_0x82fd9f[_0x3b26a7(0x13c)](_0x3b26a7(0x157))||_0x82fd9f[_0x3b26a7(0x13c)]('request\x20too\x20large');}async[a0_0x406fb9(0x117)](_0x238173){const _0x466eb5=a0_0x406fb9;this['logger'][_0x466eb5(0x1ac)]('🚨\x20Request\x20too\x20large\x20detected\x20for\x20'+_0x238173+_0x466eb5(0x1bd));if(this[_0x466eb5(0x196)])try{await this['onPromptTooLong'](_0x238173),this['logger'][_0x466eb5(0x116)](_0x466eb5(0x13a)+_0x238173);}catch(_0x5c3476){this[_0x466eb5(0x128)]['error']('Emergency\x20compactization\x20failed:',_0x5c3476);throw _0x5c3476;}else throw new Error('Request\x20too\x20large\x20and\x20no\x20compactization\x20handler\x20available');}[a0_0x406fb9(0x147)](_0x598323){const _0x35589d=a0_0x406fb9,_0x2641af=['401',_0x35589d(0x144),'500','502',_0x35589d(0x13e),'504',_0x35589d(0x158),_0x35589d(0x15f),_0x35589d(0x1b3),'server\x20error',_0x35589d(0x192)],_0x422290=_0x598323['message']?.['toLowerCase']()||'';return _0x2641af[_0x35589d(0x164)](_0x1d6bb1=>_0x422290[_0x35589d(0x13c)](_0x1d6bb1));}}export{LLM_CONSTANTS};