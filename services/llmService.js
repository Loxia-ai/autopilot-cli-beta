const a0_0x512e3e=a0_0x56b9;function a0_0x1758(){const _0xf28352=['D2fYBG','BxmGzgvSyxKGywz0zxiGy29TCgfJDgL6yxrPB24','C2v0','C2vYDMLJzvn0yxr1CW','y2XLyxi','Aw52ywXPzcbHCgKGA2v5','z2v0qNvKz2v0vxnHz2u','z2v0qwXSuhjPy2LUzW','Aw5JBhvKzxm','yxzHAwXHyMXL','nJqYug5iuhvl','CMvXDwvZDcb0B28GBgfYz2u','BxmGzgvSyxKGywz0zxiGzw1LCMDLBMn5ignVBxbHy3rPEMf0Aw9U','su5uruXmsuDftKnf','z2v0q29ZDevZDgLTyxrL','C2v0qNvKz2v0tgLTAxq','ihDPDgGGzMfSBgjHy2SGC2vYDMLJzsa','ywXSu2v0DgXLza','Dg9VigXVBMC','z2v0','ndaW','x2HHBMrSzvjLCxvLC3ruB29myxjNzuvYCM9Y','yxP1CMuTB3bLBMfPlwDWDdq','y2HLy2TcDwrNzxrgB3jpCgvYyxrPB24','DgHYB3r0Bgu','qwXSieXmtsbZzxj2AwnLCYbZAhv0igrVD24','BwvZC2fNzsb0B28GBg9UzW','x3nLBgvJDfnLCNzPy2vgB3jdB252zxjZyxrPB24','z2v0uhjPy2LUz0rHDge','Dg90ywXszxf1zxn0CW','ihDPDgGGC2vYDMLJzsa','CMf0zsbSAw1PDa','CMv0CMLLCW','uhjVBxb0ihrVBYbSB25NigfUzcbUBYbJB21Wywn0AxPHDgLVBIbOyw5KBgvYigf2ywLSywjSzq','zxHJzwvKCYbJB250zxH0ihDPBMrVDW','revhuKferuq','DxbKyxrLq29UDMvYC2f0Aw9U','ntaZ','BgvUz3rO','Cg93','uMf0zsbSAw1PDcbLCNjVCIbKzxrLy3rLzcWGD2fPDgLUzYbHBMqGCMv0CNLPBMCUlI4GkhjHDguGBgLTAxqGyxr0zw1WDca','zNjVBq','A2v5CW','yw50AhjVCgLJlwHHAwT1','C2vYDMLJzsb1BMf2ywLSywjSzq','zgvNCMfKzwq','CMvNAxn0zxjdB252zxjZyxrPB24','BwvZC2fNzq','x2DLDerLzMf1BhrnB2rLBezVCLnLCNzPy2u','r2v0DgLUzYbPBwfNzsbKzxnJCMLWDgLVBIb1C2LUzYb2AxnPB24Ty2fWywjSzsbTB2rLBa','CMvXDwvZDcbSAw1PDa','yMfSyw5Jzwq','Dg90ywXnB2rLBhm','u2H1DhrPBMCGzg93BIbZzxj2AwnLoIa','B3bLBMfP','x3nLBgvJDfnLCNzPy2vcEvbYzwzLCMvUy2vpCMrLCG','zgvSyxLnDwX0AxbSAwvY','x3jLy29YzfvZywDLqw5Ktwv0CMLJCW','CMvNAxn0zxjqCM9TChruB29mB25NsgfUzgXLCG','C2vYDMvYteXnu2vYDMLJzq','vu5bvKfjtefcteu','vxbKyxrPBMCGy29UDMvYC2f0Aw9UoIa','rxjYB3iGC2H1DhrPBMCGzg93BIbIDwrNzxqGC2vYDMLJztO','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','C2vYDMvY','y2f0y2G','yxzLCMfNzuXHDgvUy3K','ChjPBwfYEvnLCNzPy2u','x3nLBgvJDfzPC2LVBLnLCNzPy2u','z2v0tgfZDe91Dhb1DfrVA2vUq291BNq','rMfPBgvKihrVihjLz2LZDgvYignVBNzLCNnHDgLVBIa','z29Vz2XLlwDLBwLUAq','zMLSDgvY','x2HHBMrSzvbYB21WDfrVB0XVBMDfCNjVCG','ig5VDcbMB3vUzcbMB3iGy29UDMvYC2f0Aw9Uia','Aw50zwXSAwDLBMnL','mJa5odCZn1nIA01wCq','yxv0AgvUDgLJyxrPB24','yxP1CMuTB3bLBMfPlwDWDdm1','yw50AhjVCgLJlw9WDxm','mJe2nJe1ofvYrwvfyq','Dw5HDMfPBgfIBgu','x3nLBMrnzxnZywDLv2L0AfjLDhj5','Bwf4uMv0CMLLCW','DxnLu2vYDMvYteXn','AgfUzgXLuMf0zuXPBwL0sgL0','y29UzMLN','revgqvvmvf9nqvHFuKvuuKLfuW','DMfSAwrHDgLVBG','z2v0u3vTBwfYEq','B25qCM9TChruB29mB25N','C3rYAw5NAwz5','rxjYB3iGC2H1DhrPBMCGzg93BIbZzxj2AwnLia','sw5PDgLHBgL6zwqG','z2v0qxzHAwXHyMXLtw9KzwXZ','u2vYDMvYihzPC2LVBIbZzxj2AwnLigzHAwXLzcWGDhj5Aw5NigzHBgXIywnRoG','ig5VDcbHDMfPBgfIBgu','qvzbsuXbqKXf','rw1LCMDLBMn5ignVBxbHy3rPEMf0Aw9UigzHAwXLzdO','revgqvvmvf9srvrswv9eruXbwv9nuW','AgfZ','mtu1nZe5nhjeBK5QDW','zw5ZDxjLsw5PDgLHBgL6zwq','uMvNAxn0zxjLzcbJB252zxjZyxrPB24G','B3zLCMfSBa','x2LZuhjVBxb0vg9Vtg9Uz0vYCM9Y','C2vYDMLJzuLUC3rHBMnLCW','tM8GC3vPDgfIBguGteXnihnLCNzPy2uGyxzHAwXHyMXLigzVCIb0AgLZignVBNzLCNnHDgLVBI4GrgvIDwC6ia','y29TCgfJDgL6yxrPB25ezwXHEu1Z','otu1odvMDgT1Bvi','D2fPDeLMtMvLzgvK','rMfPBgvKihrVigLUAxrPywXPEMuGteXnihnLCNzPy2vZoG','x2LZtM9UuMv0CNLHyMXLrxjYB3i','CMvZzxrsyxrLtgLTAxriAxrZ','z2v0u2vYDMvYsgvHBhrO','q29UDMvYC2f0Aw9Uia','zNvUy3rPB24','x3rYEuzHBgXIywnRu2vYDMLJzq','C3vJy2vZC2z1BfjLCxvLC3rZ','C29Tzq','ndiXmte2otzjvfzKrKu','C2vYDMLJzxm','Aw52ywXPzcbYzxf1zxn0igzVCM1HDa','uhjVBxb0ihrVBYbSB25NigvYCM9YigrLDgvJDgvKic0GCMvXDwvZDgLUzYbJB21Wywn0AxPHDgLVBG','u2vYDMLJzsa','ntaY','x3nLBgvJDeXHCMDLC3rdB250zxH0u2vYDMLJzq','Dg9Vig1HBNKGCMvXDwvZDhm','AxnjBML0AwfSAxPLza','ic0GCgvYzM9YBwLUzYbLBwvYz2vUy3KGy29TCgfJDgL6yxrPB24','C2vUze1LC3nHz2u','ndi5','Cgf5Bg9Hzcb0B28GBgfYz2u','qwrKAw5Nia','x2rLBgf5','u2vYDMvYlwjHC2vKieXmtsbZzxj2AwnLigLUAxrPywXPEMvKihn1y2nLC3nMDwXSEq','z2v0sw1Hz2vezxnJCMLWDgLVBG','qNvKz2v0ihnLCNzPy2uGBM90igf2ywLSywjSzq','mJGZndCZnvnuC1Hmyq','Aw5PDgLHBgL6zq','x2DLDfnLCNzPy2vnB2rLBeLK','C2L6zq','C2vYDMvYlwXSBq','C3rHDhvZ','teXnihnLCNzPy2uGAw5PDgLHBgL6yxrPB24GzMfPBgvKlcbIDxqGy29UDgLUDwLUzYb3AxrOigXPBwL0zwqGzNvUy3rPB25HBgL0Eq','CgvYzM9YBwfUy2vnzxrYAwnZ','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','CMvJB3jKvxnHz2u','C2H1DgrVD24','zw50CMLLCW','DxbKyxrLuhjPy2LUz0zYB21tzxj2zxi','qNvKz2v0ihnLCNzPy2uGAw5PDgLHBgL6zwqGD2L0AcbKEw5HBwLJihbYAwnPBMCGC3vWCg9YDa','ChvZAa','tM8GteXnihnLCNzPy2vZigfYzsbHDMfPBgfIBgu','C2vYDMvYigvYCM9Y','yNvKz2v0','Dg9mB3DLCKnHC2u','CMf0zuXPBwL0u2vYDMLJzq','ogvOwhnYAW','BM93','mte5odGWohnfBhrswq','u1rsqvrfr1K','yMfZzurLBgf5txm','zxjYB3i','m2rKBLblEG','x2LZuMf0zuXPBwL0rxjYB3i','Dw5HDxrOB3jPEMvK','teXnihnLCNzPy2uGAw5PDgLHBgL6zwq','q2fUBM90igDLDcbZDw1Tyxj5oIbJB252zxjZyxrPB24G','Bg9Nz2vY','z29Vz2XL','vw5RBM93BIbLCNjVCG','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','8j+AQcbszxf1zxn0ihrVBYbSyxjNzsbKzxrLy3rLzcbMB3iG','z2v0twf4q29UDgv4DfnPEMu','sw5PDgLHBgL6Aw5NihnLCNzLCI1IyxnLzcbmte0GC2vYDMLJzs4UlG','nJbsD09SBwy','yNvKz2v0u2vYDMLJzq','u1bfruq','Aw5MBW','CMf0zv9SAw1PDa','qKfmqu5druq','AgvHBhrOEq','x2LUAxrPywXPEMvcDwrNzxrtzxj2AwnL','z2v0ugvYzM9YBwfUy2vnzxrYAwnZ','u0vsvKLdrv9tvefuvvm','BMv0D29YAW','x3nLBgvJDezHBgXIywnRu2vYDMLJzq','yw50AhjVCgLJlxnVBM5LDa','ig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','yxP1CMuTywKTz3jVAZm','yw50AhjVCgLJ'];a0_0x1758=function(){return _0xf28352;};return a0_0x1758();}(function(_0x1a59b4,_0x4b1353){const _0x56cb80=a0_0x56b9,_0x4172f7=_0x1a59b4();while(!![]){try{const _0x45c94e=parseInt(_0x56cb80(0x251))/0x1+parseInt(_0x56cb80(0x23c))/0x2*(-parseInt(_0x56cb80(0x1d0))/0x3)+parseInt(_0x56cb80(0x1ca))/0x4*(parseInt(_0x56cb80(0x1b6))/0x5)+-parseInt(_0x56cb80(0x1f6))/0x6*(-parseInt(_0x56cb80(0x259))/0x7)+parseInt(_0x56cb80(0x1cc))/0x8+parseInt(_0x56cb80(0x238))/0x9*(parseInt(_0x56cb80(0x1dc))/0xa)+-parseInt(_0x56cb80(0x264))/0xb;if(_0x45c94e===_0x4b1353)break;else _0x4172f7['push'](_0x4172f7['shift']());}catch(_0x4f2fa3){_0x4172f7['push'](_0x4172f7['shift']());}}}(a0_0x1758,0xc0d07));import{ServerLLMService}from'./serverLLMService.js';function a0_0x56b9(_0x4dba20,_0x488f13){const _0x1758d7=a0_0x1758();return a0_0x56b9=function(_0x56b987,_0x308f13){_0x56b987=_0x56b987-0x1b5;let _0x42ac90=_0x1758d7[_0x56b987];if(a0_0x56b9['TXuOfY']===undefined){var _0x2c9981=function(_0x76d740){const _0x5771a3='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3938a1='',_0x2dde21='';for(let _0x42e715=0x0,_0x487f61,_0xfc7cd7,_0x17222d=0x0;_0xfc7cd7=_0x76d740['charAt'](_0x17222d++);~_0xfc7cd7&&(_0x487f61=_0x42e715%0x4?_0x487f61*0x40+_0xfc7cd7:_0xfc7cd7,_0x42e715++%0x4)?_0x3938a1+=String['fromCharCode'](0xff&_0x487f61>>(-0x2*_0x42e715&0x6)):0x0){_0xfc7cd7=_0x5771a3['indexOf'](_0xfc7cd7);}for(let _0x18bb2f=0x0,_0x5b8d95=_0x3938a1['length'];_0x18bb2f<_0x5b8d95;_0x18bb2f++){_0x2dde21+='%'+('00'+_0x3938a1['charCodeAt'](_0x18bb2f)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2dde21);};a0_0x56b9['QEJRXc']=_0x2c9981,_0x4dba20=arguments,a0_0x56b9['TXuOfY']=!![];}const _0x3aa324=_0x1758d7[0x0],_0x5210f6=_0x56b987+_0x3aa324,_0x1eb184=_0x4dba20[_0x5210f6];return!_0x1eb184?(_0x42ac90=a0_0x56b9['QEJRXc'](_0x42ac90),_0x4dba20[_0x5210f6]=_0x42ac90):_0x42ac90=_0x1eb184,_0x42ac90;},a0_0x56b9(_0x4dba20,_0x488f13);}import{BudgetService}from'./budgetService.js';import{RateLimitService}from'./rateLimitService.js';const HTTP_STATUS_CODES={'REQUEST_ENTITY_TOO_LARGE':0x19d,'BAD_REQUEST':0x190,'UNAUTHORIZED':0x191,'FORBIDDEN':0x193,'NOT_FOUND':0x194,'TOO_MANY_REQUESTS':0x1ad,'INTERNAL_SERVER_ERROR':0x1f4},REQUEST_SIZE_ERROR_PATTERNS=['request\x20entity\x20too\x20large',a0_0x512e3e(0x270),'request\x20too\x20large',a0_0x512e3e(0x206),'content\x20length\x20exceeds\x20limit'],LLM_CONSTANTS={'HTTP_STATUS':HTTP_STATUS_CODES,'ERROR_PATTERNS':{'REQUEST_TOO_LARGE':REQUEST_SIZE_ERROR_PATTERNS,'PROMPT_TOO_LONG':['too\x20long',a0_0x512e3e(0x20e),'context\x20length\x20exceeded','maximum\x20context\x20length'],'RATE_LIMIT':[a0_0x512e3e(0x20b),a0_0x512e3e(0x26b),'quota\x20exceeded','throttle']},'STRATEGY':{'SPEED':'speed','INTELLIGENCE':a0_0x512e3e(0x237),'CONTEXT':'context','BALANCED':a0_0x512e3e(0x21f)},'DEFAULT_MAX_RETRIES':0x3,'DEFAULT_RETRY_DELAY_MS':0x3e8,'DEFAULT_RETRY_MULTIPLIER':0x2,'DEFAULT_SUMMARY_SERVICE':a0_0x512e3e(0x22c),'SERVICE_STATUS':{'AVAILABLE':a0_0x512e3e(0x1f5),'DEGRADED':'degraded','UNAVAILABLE':a0_0x512e3e(0x23d)},'MODEL_PREFERENCE':{'SPEED':[a0_0x512e3e(0x217),'azure-ai-phi4',a0_0x512e3e(0x23a),'google-gemini','anthropic-sonnet',a0_0x512e3e(0x202),'anthropic-opus'],'INTELLIGENCE':[a0_0x512e3e(0x23b),a0_0x512e3e(0x202),'azure-ai-grok3',a0_0x512e3e(0x1e8),'google-gemini',a0_0x512e3e(0x23a),'anthropic-haiku'],'BALANCED':[a0_0x512e3e(0x1e8),'azure-openai-gpt4',a0_0x512e3e(0x1ea),a0_0x512e3e(0x233),a0_0x512e3e(0x23b),'azure-openai-gpt35','anthropic-haiku']},'ERROR_TYPES':{'PROMPT_TOO_LONG':'prompt_too_long','RATE_LIMIT':a0_0x512e3e(0x1e0),'AUTHENTICATION':a0_0x512e3e(0x239),'NETWORK':a0_0x512e3e(0x1e6),'SERVER':'server','VALIDATION':a0_0x512e3e(0x244)}};export class LLMService{constructor(_0x76d740,_0x5771a3){const _0xfc00b1=a0_0x512e3e;this['config']=_0x76d740,this['logger']=_0x5771a3,this['serviceInstances']=new Map(),this['conversationServices']=new Map(),this[_0xfc00b1(0x1ef)]=new Map(),this['useServerLLM']=_0x76d740['useServerLLM']!==![],this[_0xfc00b1(0x22f)]=null,this['serverLLMService']=null,this['isInitialized']=![],this[_0xfc00b1(0x1c9)]=new RateLimitService(_0x5771a3),this['budgetService']=null,this[_0xfc00b1(0x246)]=null,this[_0xfc00b1(0x1bd)]={'totalRequests':0x0,'successfulRequests':0x0,'failedRequests':0x0,'totalLatency':0x0,'averageLatency':0x0},this[_0xfc00b1(0x1d5)][_0xfc00b1(0x1df)](_0xfc00b1(0x1d3),{'useServerLLM':this['useServerLLM'],'strategy':_0x76d740['llmStrategy']||LLM_CONSTANTS['STRATEGY']['BALANCED']}),this['initialize']()[_0xfc00b1(0x22d)](_0x3938a1=>{this['logger']['error']('Failed\x20to\x20initialize\x20LLM\x20services\x20in\x20constructor:',_0x3938a1);});}async['initialize'](){const _0x897a80=a0_0x512e3e;if(this['isInitialized'])return;this['logger'][_0x897a80(0x1df)]('Initializing\x20LLM\x20services\x20(Server\x20mode:\x20'+this['useServerLLM']+')');try{this['useServerLLM']&&await this['_initializeServerService']();this[_0x897a80(0x1e3)]();if(this[_0x897a80(0x256)][_0x897a80(0x1b9)]===0x0)throw new Error(_0x897a80(0x1c5));this['isInitialized']=!![],this[_0x897a80(0x1d5)][_0x897a80(0x1df)](_0x897a80(0x249)+this[_0x897a80(0x256)]['size']+'\x20LLM\x20services',{'primary':this['primaryService'],'services':Array['from'](this[_0x897a80(0x256)]['keys']())});}catch(_0x2dde21){this['logger'][_0x897a80(0x1cf)](_0x897a80(0x25b),_0x2dde21);if(this['isInitialized']===![])this[_0x897a80(0x1d5)]['warn'](_0x897a80(0x1bc));else throw _0x2dde21;}}async['_initializeServerService'](){const _0x47f5dd=a0_0x512e3e;try{this['logger'][_0x47f5dd(0x1df)](_0x47f5dd(0x1db)),this[_0x47f5dd(0x227)]=new ServerLLMService(this[_0x47f5dd(0x242)],this[_0x47f5dd(0x1d5)]),await this[_0x47f5dd(0x227)]['initialize'](),this['serviceInstances']['set'](_0x47f5dd(0x22c),this[_0x47f5dd(0x227)]),this[_0x47f5dd(0x1ef)][_0x47f5dd(0x1ee)]('server',LLM_CONSTANTS['SERVICE_STATUS'][_0x47f5dd(0x24d)]),this['primaryService']=_0x47f5dd(0x22c);const _0x42e715=await this[_0x47f5dd(0x227)][_0x47f5dd(0x24a)]()||[];this['logger'][_0x47f5dd(0x1df)](_0x47f5dd(0x273),{'modelsAvailable':this['serverLLMService'][_0x47f5dd(0x24a)]()[_0x47f5dd(0x212)]});}catch(_0x487f61){this[_0x47f5dd(0x1d5)][_0x47f5dd(0x1cf)]('Failed\x20to\x20initialize\x20server\x20LLM\x20service:',_0x487f61),this['useServerLLM']=![],this[_0x47f5dd(0x22f)]=null,this[_0x47f5dd(0x227)]=null,this[_0x47f5dd(0x1d5)]['warn']('Falling\x20back\x20to\x20local\x20LLM\x20services');}}[a0_0x512e3e(0x1e3)](){const _0x30980a=a0_0x512e3e;this['budgetService']=new BudgetService(this['config'],this['logger'],this['serverLLMService']),this[_0x30980a(0x1d5)][_0x30980a(0x1df)](_0x30980a(0x1c3));}async[a0_0x512e3e(0x252)](){const _0x25479d=a0_0x512e3e;!this['isInitialized']&&await this[_0x25479d(0x1b7)]();}async[a0_0x512e3e(0x24a)](){const _0x208da2=a0_0x512e3e;await this['ensureInitialized']();const _0xfc7cd7=[];if(this[_0x208da2(0x227)]&&this[_0x208da2(0x26c)])try{let _0x17222d=await this[_0x208da2(0x227)][_0x208da2(0x24a)]();_0xfc7cd7[_0x208da2(0x1c4)](..._0x17222d);}catch(_0x18bb2f){this['logger']['warn']('Failed to get models from server service:',_0x18bb2f);}return _0xfc7cd7;}async[a0_0x512e3e(0x208)](){const _0x598740=a0_0x512e3e;return this['budgetService']?await this[_0x598740(0x1dd)][_0x598740(0x1f3)]():new Map();}async[a0_0x512e3e(0x21a)](_0x5b8d95,_0x47c543,_0x4dd5c9){const _0x1eddf7=a0_0x512e3e;await this[_0x1eddf7(0x252)](),this['logger'][_0x1eddf7(0x1df)]('Registering\x20conversation:\x20'+_0x5b8d95);const _0x1293fc=this[_0x1eddf7(0x207)](_0x5b8d95);if(!_0x1293fc){const _0x3e1f37={'useServerLLM':this['useServerLLM'],'serviceInstancesCount':this['serviceInstances'][_0x1eddf7(0x1b9)],'serviceInstances':Array[_0x1eddf7(0x215)](this['serviceInstances']['keys']()),'serviceStatusCount':this['serviceStatus']['size'],'serviceStatus':Object['fromEntries'](this[_0x1eddf7(0x1ef)]['entries']()),'isInitialized':this['isInitialized']};this['logger']['error']('No\x20suitable\x20LLM\x20service\x20available\x20-\x20Debug\x20info:',_0x3e1f37);throw new Error(_0x1eddf7(0x257)+JSON[_0x1eddf7(0x247)](_0x3e1f37));}const _0x12c415=this['serviceInstances']['get'](_0x1293fc);try{await _0x12c415[_0x1eddf7(0x21a)](_0x5b8d95,_0x47c543,_0x4dd5c9),this[_0x1eddf7(0x22b)]['set'](_0x5b8d95,_0x1293fc),this['logger']['info']('Registered\x20conversation\x20'+_0x5b8d95+_0x1eddf7(0x20a)+_0x1293fc);}catch(_0x1da280){this[_0x1eddf7(0x1d5)]['error'](_0x1eddf7(0x232)+_0x5b8d95+':',_0x1da280);const _0x2b651e=this[_0x1eddf7(0x1e7)](_0x1293fc);if(_0x2b651e){const _0x188e18=this[_0x1eddf7(0x256)]['get'](_0x2b651e);await _0x188e18[_0x1eddf7(0x21a)](_0x5b8d95,_0x47c543,_0x4dd5c9),this[_0x1eddf7(0x22b)][_0x1eddf7(0x1ee)](_0x5b8d95,_0x2b651e),this['logger']['info'](_0x1eddf7(0x253)+_0x5b8d95+_0x1eddf7(0x1fc)+_0x2b651e);}else throw new Error('Failed\x20to\x20register\x20conversation\x20'+_0x5b8d95+'\x20with\x20any\x20service');}}async[a0_0x512e3e(0x26e)](_0x32365e,_0x4e55d2,_0x137f85){const _0xa0c83d=a0_0x512e3e,_0x3076d8=Date[_0xa0c83d(0x1cb)]();this[_0xa0c83d(0x1bd)][_0xa0c83d(0x209)]++;try{const _0x15aae7=this['conversationServices']['get'](_0x32365e);if(!_0x15aae7)throw new Error(_0xa0c83d(0x25f)+_0x32365e+_0xa0c83d(0x1be));const _0x9a1b35=this[_0xa0c83d(0x256)]['get'](_0x15aae7);if(!_0x9a1b35)throw new Error(_0xa0c83d(0x268)+_0x15aae7+'\x20not\x20found\x20for\x20conversation\x20'+_0x32365e);const _0x295b22=this['_getServiceModelId'](_0x15aae7);await this['rateLimitService'][_0xa0c83d(0x25a)](_0x295b22);const _0x407d6e=await this['_sendMessageWithRetry'](_0x9a1b35,_0x15aae7,_0x32365e,_0x4e55d2,_0x137f85);return await this['_recordUsageAndMetrics'](_0x9a1b35,_0x15aae7,_0x3076d8,!![]),_0x407d6e;}catch(_0x535d26){this['performanceMetrics']['failedRequests']++,this['logger'][_0xa0c83d(0x1cf)]('Send\x20message\x20failed\x20for\x20conversation\x20'+_0x32365e+':',_0x535d26);throw _0x535d26;}}async[a0_0x512e3e(0x23e)](_0x249ced,_0x10bb3a,_0x3ebbf1,_0x17f39d,_0xdfaba1){const _0x29e9b0=a0_0x512e3e,_0x246a7c=this['config']['retries']?.[_0x29e9b0(0x23f)]||LLM_CONSTANTS[_0x29e9b0(0x243)],_0x10c7ad=this[_0x29e9b0(0x242)]['retries']?.['maxRateLimitRetries']||0x5,_0x10c276=this['config']['retries']?.[_0x29e9b0(0x258)]||0x7d0;let _0x5e468e=0x0,_0x23e73a=0x0,_0x33dfcc=null;while(_0x5e468e<=_0x246a7c){try{const _0x7580a9=await _0x249ced['sendMessage'](_0x3ebbf1,_0x17f39d,_0xdfaba1);if(_0x10bb3a!==_0x29e9b0(0x22c)){const _0x548972=this[_0x29e9b0(0x1b8)](_0x10bb3a);this['rateLimitService'][_0x29e9b0(0x25d)](_0x548972);}return this[_0x29e9b0(0x1ef)]['get'](_0x10bb3a)===LLM_CONSTANTS['SERVICE_STATUS'][_0x29e9b0(0x20f)]&&this['serviceStatus'][_0x29e9b0(0x1ee)](_0x10bb3a,LLM_CONSTANTS['SERVICE_STATUS']['AVAILABLE']),_0x7580a9;}catch(_0x396cce){_0x33dfcc=_0x396cce,this['logger']['error']('Request\x20failed\x20(attempt\x20'+(_0x5e468e+0x1)+'/'+(_0x246a7c+0x1)+'):',_0x396cce);if(this[_0x29e9b0(0x255)](_0x396cce)){await this['_handlePromptTooLongError'](_0x3ebbf1);const _0x39b28c=this[_0x29e9b0(0x1b8)](_0x10bb3a);this['logger']['info'](_0x29e9b0(0x271)+_0x10c276+_0x29e9b0(0x1ed)),await this[_0x29e9b0(0x272)](_0x10c276),await this['rateLimitService'][_0x29e9b0(0x25a)](_0x39b28c);continue;}if(this['_isRequestTooLargeError'](_0x396cce)){await this[_0x29e9b0(0x201)](_0x3ebbf1);const _0x153e66=this[_0x29e9b0(0x1b8)](_0x10bb3a);this[_0x29e9b0(0x1d5)]['info']('Adding\x20'+_0x10c276+_0x29e9b0(0x1f8)),await this[_0x29e9b0(0x272)](_0x10c276),await this['rateLimitService']['waitIfNeeded'](_0x153e66);continue;}if(_0x10bb3a!==_0x29e9b0(0x22c)&&this[_0x29e9b0(0x1d1)](_0x396cce)){const _0x10d68d=this[_0x29e9b0(0x1b8)](_0x10bb3a);_0x23e73a++;if(_0x23e73a>_0x10c7ad)throw new Error('Rate\x20limit\x20retry\x20threshold\x20exceeded\x20('+_0x10c7ad+'):\x20'+_0x396cce['message']);this['rateLimitService'][_0x29e9b0(0x241)](_0x10d68d);if(_0x5e468e<_0x246a7c){this['logger'][_0x29e9b0(0x1df)](_0x29e9b0(0x214)+_0x23e73a+'/'+_0x10c7ad+')'),await this['rateLimitService'][_0x29e9b0(0x25a)](_0x10d68d);continue;}}if(_0x10bb3a==='server'&&this['_isServerError'](_0x396cce)){const _0x1ec362=await this['_tryFallbackService'](_0x3ebbf1,_0x17f39d,_0xdfaba1);if(_0x1ec362)return _0x1ec362;}if(this['_isNonRetryableError'](_0x396cce))break;if(_0x5e468e>=_0x246a7c)break;this[_0x29e9b0(0x1ef)][_0x29e9b0(0x1ee)](_0x10bb3a,LLM_CONSTANTS[_0x29e9b0(0x1e5)]['DEGRADED']);const _0xf1540d=this['_calculateRetryDelay'](_0x5e468e);await this['_delay'](_0xf1540d),_0x5e468e++;}}throw new Error('All\x20retry\x20attempts\x20failed:\x20'+(_0x33dfcc?.[_0x29e9b0(0x21b)]||_0x29e9b0(0x1d7)));}async[a0_0x512e3e(0x261)](_0x29b570,_0x5ead06,_0x16d3c3){const _0x2476af=a0_0x512e3e,_0x2c2818=this['_selectFallbackService'](_0x2476af(0x22c));if(!_0x2c2818)return null;try{this['logger'][_0x2476af(0x1df)]('Switching\x20to\x20fallback\x20service:\x20'+_0x2c2818);const _0x5301ff=this['serviceInstances'][_0x2476af(0x1ff)](_0x2c2818);return await _0x5301ff[_0x2476af(0x21a)](_0x29b570,_0x16d3c3['systemPrompt']||'Conversation\x20resumed'),this['conversationServices']['set'](_0x29b570,_0x2c2818),await _0x5301ff[_0x2476af(0x26e)](_0x29b570,_0x5ead06,_0x16d3c3);}catch(_0x48515c){return this[_0x2476af(0x1d5)]['error']('Fallback\x20service\x20also\x20failed:\x20'+_0x48515c[_0x2476af(0x21b)]),null;}}async[a0_0x512e3e(0x225)](_0x521f41,_0x599aa1,_0x2e3bf0,_0x396a9a){const _0x5df4bd=a0_0x512e3e,_0x41cf0e=Date['now']()-_0x2e3bf0;this['performanceMetrics']['totalLatency']+=_0x41cf0e,this['performanceMetrics'][_0x5df4bd(0x22e)]=this[_0x5df4bd(0x1bd)]['totalLatency']/this[_0x5df4bd(0x1bd)][_0x5df4bd(0x209)];_0x396a9a&&this['performanceMetrics'][_0x5df4bd(0x262)]++;if(this[_0x5df4bd(0x1dd)]&&_0x599aa1!=='server')try{const _0x7a7e28=_0x521f41[_0x5df4bd(0x1d8)](),_0x819bfb=_0x521f41[_0x5df4bd(0x231)](),_0x170304=this[_0x5df4bd(0x21c)](_0x599aa1);await this[_0x5df4bd(0x1dd)][_0x5df4bd(0x1bf)](_0x599aa1,_0x170304,_0x7a7e28,_0x819bfb);}catch(_0x1a7df8){this[_0x5df4bd(0x1d5)][_0x5df4bd(0x1ec)]('Failed\x20to\x20record\x20usage\x20for\x20budget\x20tracking:',_0x1a7df8);}}async[a0_0x512e3e(0x235)](_0x4e4d32){const _0x45ef33=a0_0x512e3e;this[_0x45ef33(0x1d5)][_0x45ef33(0x1ec)](_0x45ef33(0x267));if(this[_0x45ef33(0x246)])try{await this['onPromptTooLong'](_0x4e4d32),this[_0x45ef33(0x1d5)][_0x45ef33(0x1df)]('Compactization\x20completed,\x20retrying\x20request');}catch(_0xb507a0){this['logger']['error']('Compactization\x20failed:',_0xb507a0);throw _0xb507a0;}else throw new Error(_0x45ef33(0x20d));}async['updateConversation'](_0x8874d1,_0x523226){const _0x5a5682=a0_0x512e3e;this[_0x5a5682(0x1d5)]['info'](_0x5a5682(0x229)+_0x8874d1);const _0x4645a7=this['conversationServices']['get'](_0x8874d1);if(!_0x4645a7)throw new Error('Conversation\x20'+_0x8874d1+_0x5a5682(0x1be));const _0x2eb639=this[_0x5a5682(0x256)][_0x5a5682(0x1ff)](_0x4645a7);if(!_0x2eb639)throw new Error('Service\x20'+_0x4645a7+_0x5a5682(0x236)+_0x8874d1);try{await _0x2eb639[_0x5a5682(0x210)](_0x8874d1,_0x523226);}catch(_0x2da0b7){this['logger'][_0x5a5682(0x1cf)]('Failed\x20to\x20update\x20conversation\x20'+_0x8874d1+':',_0x2da0b7);throw _0x2da0b7;}}async[a0_0x512e3e(0x245)](_0xf57e60,_0xe0ef63){const _0x4dab49=a0_0x512e3e;this['logger']['info']('Getting\x20summary\x20for\x20conversation:\x20'+_0xf57e60);const _0x4ab823=this['conversationServices'][_0x4dab49(0x1ff)](_0xf57e60);if(!_0x4ab823)throw new Error(_0x4dab49(0x1d4)+_0xf57e60+_0x4dab49(0x1e9));const _0x156ea0=this[_0x4dab49(0x256)][_0x4dab49(0x1ff)](_0x4ab823);if(!_0x156ea0)throw new Error('Cannot\x20get\x20summary:\x20service\x20'+_0x4ab823+_0x4dab49(0x24c));this['logger']['info']('Using\x20same\x20service\x20for\x20summary:\x20'+_0x4ab823);try{const _0x406fed=await _0x156ea0[_0x4dab49(0x245)](_0xe0ef63,_0xf57e60);if(this[_0x4dab49(0x1dd)]&&_0x4ab823!=='server'){const _0x5ea6e1=this['_getDefaultModelForService'](_0x4ab823);await this[_0x4dab49(0x1dd)]['recordUsage'](_0x4ab823,_0x5ea6e1,_0x156ea0[_0x4dab49(0x1d8)](),_0x156ea0['getLastOutputTokenCount']());}return _0x406fed;}catch(_0x3973db){this['logger'][_0x4dab49(0x1cf)]('Failed\x20to\x20get\x20summary\x20using\x20same\x20service\x20'+_0x4ab823+':',_0x3973db);throw _0x3973db;}}async[a0_0x512e3e(0x274)](_0x2b702f,_0x402bb5,_0x2c29bf={}){const _0x335598=a0_0x512e3e;this['logger'][_0x335598(0x1df)](_0x335598(0x21d));if(this[_0x335598(0x240)]&&this['serviceInstances']['has']('server'))try{const _0x5a4a0e=this[_0x335598(0x256)][_0x335598(0x1ff)](_0x335598(0x22c));return await _0x5a4a0e[_0x335598(0x274)](_0x2b702f,_0x402bb5,_0x2c29bf);}catch(_0x45da8d){this['logger']['warn'](_0x335598(0x24b),_0x45da8d);}const _0xd791ba=this['_selectVisionService']();if(!_0xd791ba)throw new Error('No\x20vision-capable\x20services\x20available');const _0x574327=this['serviceInstances'][_0x335598(0x1ff)](_0xd791ba),_0x54f303=this['_getServiceModelId'](_0xd791ba);await this[_0x335598(0x1c9)][_0x335598(0x25a)](_0x54f303);const _0x1f2e78=this['config']['retries']?.[_0x335598(0x23f)]||LLM_CONSTANTS[_0x335598(0x243)];let _0x4d3f48=0x0,_0x1b10af=null;while(_0x4d3f48<=_0x1f2e78){try{const _0x21aac2=await _0x574327['getImageDescription'](_0x2b702f,_0x402bb5,_0x2c29bf);this[_0x335598(0x1c9)][_0x335598(0x25d)](_0x54f303);if(this[_0x335598(0x1dd)]){const _0x2861eb=this['_getDefaultModelForService'](_0xd791ba);await this['budgetService']['recordUsage'](_0xd791ba,_0x2861eb,_0x574327['getLastInputTokenCount'](),_0x574327['getLastOutputTokenCount']());}return _0x21aac2;}catch(_0x276f38){_0x1b10af=_0x276f38,this['logger']['error']('Vision\x20request\x20failed\x20(attempt\x20'+(_0x4d3f48+0x1)+'/'+(_0x1f2e78+0x1)+'):',_0x276f38);if(this[_0x335598(0x1d1)](_0x276f38)){this['rateLimitService'][_0x335598(0x241)](_0x54f303);if(_0x4d3f48<_0x1f2e78){await this['rateLimitService']['waitIfNeeded'](_0x54f303);continue;}}if(this[_0x335598(0x25c)](_0x276f38))throw _0x276f38;if(_0x4d3f48>=_0x1f2e78)break;const _0x286a2a=this['_calculateRetryDelay'](_0x4d3f48);await this[_0x335598(0x272)](_0x286a2a),_0x4d3f48++;}}throw new Error('All\x20vision\x20retry\x20attempts\x20failed:\x20'+(_0x1b10af?.['message']||'Unknown\x20error'));}async['estimateTokenCount'](_0x10faa7){const _0x6f2297=a0_0x512e3e,_0x2bef8f=this[_0x6f2297(0x22b)][_0x6f2297(0x1ff)](_0x10faa7);if(!_0x2bef8f)throw new Error('Conversation\x20'+_0x10faa7+_0x6f2297(0x1be));const _0x1d245b=this['serviceInstances'][_0x6f2297(0x1ff)](_0x2bef8f);if(!_0x1d245b)throw new Error('Service\x20'+_0x2bef8f+'\x20not\x20found\x20for\x20conversation\x20'+_0x10faa7);try{return await _0x1d245b['estimateTokenCount'](_0x10faa7);}catch(_0x280ea6){return this['logger'][_0x6f2297(0x1cf)]('Failed\x20to\x20estimate\x20token\x20count\x20for\x20conversation\x20'+_0x10faa7+':',_0x280ea6),0x0;}}['getCostEstimate'](_0x5cd80e,_0x5f58d7,_0x3dfed2){const _0x52e706=a0_0x512e3e;if(!this['budgetService'])return null;return this[_0x52e706(0x1dd)][_0x52e706(0x1fa)](_0x5cd80e,_0x5f58d7,_0x3dfed2);}['checkBudgetForOperation'](_0x3d45d6,_0x263e22,_0x5c9ebf){const _0x55191c=a0_0x512e3e;if(!this[_0x55191c(0x1dd)])return null;return this['budgetService'][_0x55191c(0x203)](_0x3d45d6,_0x263e22,_0x5c9ebf);}async[a0_0x512e3e(0x1f2)](){const _0x148052=a0_0x512e3e;if(!this[_0x148052(0x1dd)])return null;return await this['budgetService'][_0x148052(0x1f2)]();}async[a0_0x512e3e(0x1fb)](_0x20a76d){const _0x229acc=a0_0x512e3e;if(!this['budgetService'])throw new Error(_0x229acc(0x1b5));await this['budgetService'][_0x229acc(0x1fb)](_0x20a76d);}async['refreshPricingData'](){const _0x3343a8=a0_0x512e3e;if(!this['budgetService'])return![];return await this[_0x3343a8(0x1dd)][_0x3343a8(0x1c2)]();}['getServiceStatus'](){const _0x12ae12=a0_0x512e3e,_0x4eba95={};for(const [_0x73f037,_0x20f28e]of this[_0x12ae12(0x1ef)]['entries']()){_0x4eba95[_0x73f037]={'status':_0x20f28e,'available':_0x20f28e!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE'],'isPrimary':_0x73f037===this[_0x12ae12(0x22f)]};}return _0x4eba95;}['getPerformanceMetrics'](){const _0x33b746=a0_0x512e3e;return{...this[_0x33b746(0x1bd)],'successRate':this['performanceMetrics']['totalRequests']>0x0?this['performanceMetrics'][_0x33b746(0x262)]/this[_0x33b746(0x1bd)][_0x33b746(0x209)]*0x64:0x0};}['getRateLimitingStatus'](){const _0x2e4c47=a0_0x512e3e;return this[_0x2e4c47(0x1c9)]['getAllStatus']();}[a0_0x512e3e(0x226)](_0x52f95d){const _0x252e72=a0_0x512e3e;this['onPromptTooLong']=_0x52f95d,this[_0x252e72(0x1d5)]['info']('Prompt\x20too\x20long\x20handler\x20registered');}async['getHealthStatus'](){const _0x5d4534=a0_0x512e3e,_0x341331={'overall':'healthy','services':{},'budget':null,'performance':this[_0x5d4534(0x1e4)](),'pricing':{'available':![],'modelsWithPricing':0x0,'lastUpdate':null}};for(const [_0x1cf03e,_0x14adb1]of this[_0x5d4534(0x1ef)][_0x5d4534(0x1c1)]()){_0x341331[_0x5d4534(0x265)][_0x1cf03e]={'status':_0x14adb1,'available':_0x14adb1!==LLM_CONSTANTS[_0x5d4534(0x1e5)]['UNAVAILABLE']},_0x14adb1===LLM_CONSTANTS[_0x5d4534(0x1e5)]['UNAVAILABLE']&&(_0x341331[_0x5d4534(0x254)]='degraded');}if(this[_0x5d4534(0x227)])try{const _0xc08b3=await this['serverLLMService'][_0x5d4534(0x25e)]();_0x341331[_0x5d4534(0x265)][_0x5d4534(0x22c)]['serverHealth']=_0xc08b3,_0xc08b3['status']!==_0x5d4534(0x1e2)&&(_0x341331[_0x5d4534(0x254)]=_0x5d4534(0x219));}catch(_0x29efb4){_0x341331['services'][_0x5d4534(0x22c)]['serverHealth']={'status':'error','error':_0x29efb4['message']},_0x341331['overall']=_0x5d4534(0x219);}if(this[_0x5d4534(0x1dd)])try{_0x341331[_0x5d4534(0x1c7)]=await this[_0x5d4534(0x1dd)]['healthCheck'](),_0x341331[_0x5d4534(0x1c7)]['status']!==_0x5d4534(0x1e2)&&(_0x341331[_0x5d4534(0x254)]=_0x5d4534(0x219));}catch(_0x51df8c){_0x341331[_0x5d4534(0x1c7)]={'status':'error','error':_0x51df8c[_0x5d4534(0x21b)]},_0x341331[_0x5d4534(0x254)]='degraded';}if(this['budgetService']){const _0x99526c=this['budgetService']['getPricingInfo']();_0x341331['pricing']={'available':_0x99526c['totalModels']>0x0,'modelsWithPricing':_0x99526c[_0x5d4534(0x220)],'lastUpdate':_0x99526c['lastUpdate'],'source':_0x99526c['source']};}return _0x341331;}async[a0_0x512e3e(0x1c0)](){const _0x5e1831=a0_0x512e3e;this[_0x5e1831(0x1d5)][_0x5e1831(0x1df)]('Shutting\x20down\x20LLM\x20service');const _0x111b35=[];for(const [_0x373873,_0x2bfb41]of this['serviceInstances']['entries']()){typeof _0x2bfb41['shutdown']==='function'&&(this[_0x5e1831(0x1d5)][_0x5e1831(0x1df)](_0x5e1831(0x221)+_0x373873),_0x111b35['push'](_0x2bfb41['shutdown']()[_0x5e1831(0x22d)](_0x45824f=>{const _0xf3840=_0x5e1831;this['logger']['error'](_0xf3840(0x248)+_0x373873+':',_0x45824f);})));}this['budgetService']&&typeof this['budgetService']['shutdown']==='function'&&_0x111b35[_0x5e1831(0x1c4)](this[_0x5e1831(0x1dd)][_0x5e1831(0x1c0)]()['catch'](_0x1067e0=>{const _0x224626=_0x5e1831;this['logger'][_0x224626(0x1cf)](_0x224626(0x22a),_0x1067e0);})),await Promise[_0x5e1831(0x1fd)](_0x111b35),this['serviceInstances'][_0x5e1831(0x1f0)](),this[_0x5e1831(0x22b)][_0x5e1831(0x1f0)](),this['serviceStatus']['clear'](),this[_0x5e1831(0x1d5)]['info'](_0x5e1831(0x205));}['_selectServiceForConversation'](_0x57f1fd,_0x4d80d2=[]){const _0x2474cc=a0_0x512e3e;if(this[_0x2474cc(0x240)]&&this[_0x2474cc(0x256)][_0x2474cc(0x250)](_0x2474cc(0x22c))&&!_0x4d80d2['includes'](_0x2474cc(0x22c))&&this['serviceStatus']['get'](_0x2474cc(0x22c))===LLM_CONSTANTS[_0x2474cc(0x1e5)]['AVAILABLE'])return'server';return this['_selectAvailableService'](_0x4d80d2);}['_selectAvailableService'](_0x237b66=[]){const _0x647f94=a0_0x512e3e,_0x2f233a=Array['from'](this['serviceInstances'][_0x647f94(0x216)]())[_0x647f94(0x234)](_0x5943bf=>!_0x237b66['includes'](_0x5943bf)&&this['serviceStatus']['get'](_0x5943bf)!==LLM_CONSTANTS[_0x647f94(0x1e5)]['UNAVAILABLE']);if(_0x2f233a[_0x647f94(0x212)]===0x0)return null;const _0x325c7c=this['config']['llmStrategy']||LLM_CONSTANTS['STRATEGY'][_0x647f94(0x1e1)];switch(_0x325c7c){case LLM_CONSTANTS['STRATEGY'][_0x647f94(0x1de)]:return this['_selectFastestService'](_0x2f233a);case LLM_CONSTANTS[_0x647f94(0x1cd)]['INTELLIGENCE']:return this['_selectSmartestService'](_0x2f233a);case LLM_CONSTANTS[_0x647f94(0x1cd)]['CONTEXT']:return this[_0x647f94(0x26a)](_0x2f233a);case LLM_CONSTANTS['STRATEGY'][_0x647f94(0x1e1)]:default:return this['_selectBalancedService'](_0x2f233a);}}[a0_0x512e3e(0x1e7)](_0x3d3e94){const _0x212431=a0_0x512e3e,_0x45de8e=Array['from'](this['serviceInstances'][_0x212431(0x216)]())[_0x212431(0x234)](_0x953c60=>_0x953c60!==_0x3d3e94&&this['serviceStatus']['get'](_0x953c60)!==LLM_CONSTANTS['SERVICE_STATUS'][_0x212431(0x228)]);if(_0x45de8e[_0x212431(0x212)]===0x0)return null;if(_0x3d3e94!=='anthropic'&&_0x45de8e['includes'](_0x212431(0x1eb)))return _0x212431(0x1eb);return _0x45de8e[0x0];}[a0_0x512e3e(0x230)](_0x10199d=[]){const _0x4b98df=a0_0x512e3e,_0x5f2b2f=['anthropic',_0x4b98df(0x222),_0x4b98df(0x1d6)],_0x260854=_0x5f2b2f['filter'](_0x357a3d=>!_0x10199d[_0x4b98df(0x1f4)](_0x357a3d)&&this['serviceInstances']['has'](_0x357a3d)&&this[_0x4b98df(0x1ef)]['get'](_0x357a3d)!==LLM_CONSTANTS[_0x4b98df(0x1e5)]['UNAVAILABLE']);if(_0x260854['length']===0x0)return null;const _0xc12145=[_0x4b98df(0x1eb),_0x4b98df(0x222),_0x4b98df(0x1d6)];for(const _0x556f78 of _0xc12145){if(_0x260854['includes'](_0x556f78))return _0x556f78;}return _0x260854[0x0];}['_selectFastestService'](_0x40058d){const _0x3c2c74=a0_0x512e3e;return this[_0x3c2c74(0x223)](_0x40058d,LLM_CONSTANTS['MODEL_PREFERENCE'][_0x3c2c74(0x1de)]);}['_selectSmartestService'](_0x3195d6){const _0x45076e=a0_0x512e3e;return this['_selectServiceByPreferenceOrder'](_0x3195d6,LLM_CONSTANTS['MODEL_PREFERENCE'][_0x45076e(0x1f9)]);}['_selectLargestContextService'](_0x1c0895){const _0x1ed401=a0_0x512e3e;let _0x4903a7=null,_0x28f802=0x0;for(const _0x3e36bc of _0x1c0895){const _0x1d1072=this['serviceInstances']['get'](_0x3e36bc);if(!_0x1d1072||typeof _0x1d1072['getMaxContextSize']!==_0x1ed401(0x260))continue;const _0x10dbac=_0x1d1072[_0x1ed401(0x1da)]();_0x10dbac>_0x28f802&&(_0x28f802=_0x10dbac,_0x4903a7=_0x3e36bc);}return _0x4903a7||_0x1c0895[0x0];}['_selectBalancedService'](_0x2a2422){const _0x356939=a0_0x512e3e;return this[_0x356939(0x223)](_0x2a2422,LLM_CONSTANTS['MODEL_PREFERENCE'][_0x356939(0x1e1)]);}['_selectServiceByPreferenceOrder'](_0x4d78a2,_0x5a80b4){const _0x4f98ca=a0_0x512e3e,_0x596723={'anthropic':[_0x4f98ca(0x23b),_0x4f98ca(0x1e8),'anthropic-haiku'],'openai':[_0x4f98ca(0x202),'azure-openai-gpt35'],'google':['google-gemini'],'server':[]};for(const _0x5e98b2 of _0x5a80b4){for(const _0x525472 of _0x4d78a2){if(_0x525472==='server')return _0x525472;const _0x5d945f=_0x596723[_0x525472]||[];if(_0x5d945f['includes'](_0x5e98b2))return _0x525472;}}return _0x4d78a2[0x0];}['_getServiceModelId'](_0x261111){const _0x3d237b=a0_0x512e3e,_0x53fa71={'anthropic':_0x3d237b(0x1e8),'openai':_0x3d237b(0x202),'google':'google-gemini','server':_0x3d237b(0x1ba)};return _0x53fa71[_0x261111]||_0x261111;}[a0_0x512e3e(0x21c)](_0x5cddcb){return this['_getServiceModelId'](_0x5cddcb);}['_calculateRetryDelay'](_0x209a67){const _0x24e742=a0_0x512e3e,_0x306fb5=this[_0x24e742(0x242)][_0x24e742(0x20c)]?.[_0x24e742(0x1ce)]||LLM_CONSTANTS[_0x24e742(0x24f)],_0x34e4bd=this[_0x24e742(0x242)]['retries']?.[_0x24e742(0x224)]||LLM_CONSTANTS['DEFAULT_RETRY_MULTIPLIER'];return _0x306fb5*Math[_0x24e742(0x213)](_0x34e4bd,_0x209a67);}[a0_0x512e3e(0x272)](_0x2d564e){return new Promise(_0x52ab31=>setTimeout(_0x52ab31,_0x2d564e));}[a0_0x512e3e(0x1d1)](_0x552937){const _0x2fa69a=a0_0x512e3e,_0x189bce=[_0x2fa69a(0x20b),'too\x20many\x20requests','quota\x20exceeded',_0x2fa69a(0x21e),_0x2fa69a(0x26f),_0x2fa69a(0x204)],_0x1d36fb=_0x552937[_0x2fa69a(0x21b)]?.['toLowerCase']()||'';return _0x189bce['some'](_0x40bafb=>_0x1d36fb[_0x2fa69a(0x1f4)](_0x40bafb));}['_isNonRetryableError'](_0x50adbb){const _0x38d2ad=a0_0x512e3e,_0xad4db2=[_0x38d2ad(0x1f1),'authentication\x20failed',_0x38d2ad(0x1d2),'model\x20not\x20found',_0x38d2ad(0x266),'content\x20policy'],_0x167e3d=_0x50adbb['message']?.['toLowerCase']()||'';return _0xad4db2[_0x38d2ad(0x263)](_0x35b965=>_0x167e3d['includes'](_0x35b965));}[a0_0x512e3e(0x255)](_0x8f3aa){const _0x43d7b3=a0_0x512e3e,_0x5133f5=_0x8f3aa['message']?.[_0x43d7b3(0x1c8)]()||'',_0x3e737b=_0x8f3aa['toString']?.()?.['toLowerCase']()||'';return(_0x5133f5[_0x43d7b3(0x1f4)](_0x43d7b3(0x1fe))||_0x3e737b['includes'](_0x43d7b3(0x1fe)))&&(_0x8f3aa[_0x43d7b3(0x1bb)]===0x190||_0x5133f5[_0x43d7b3(0x1f4)](_0x43d7b3(0x200))||_0x3e737b['includes'](_0x43d7b3(0x200)));}['_isRequestTooLargeError'](_0x3125aa){const _0x131aeb=a0_0x512e3e,_0x3fb4b3=_0x3125aa['message']?.[_0x131aeb(0x1c8)]()||'',_0x442d7f=_0x3125aa[_0x131aeb(0x1bb)]||_0x3125aa['originalError']?.[_0x131aeb(0x1bb)];return _0x442d7f===0x19d||_0x3fb4b3[_0x131aeb(0x1f4)]('request\x20entity\x20too\x20large')||_0x3fb4b3['includes'](_0x131aeb(0x270))||_0x3fb4b3[_0x131aeb(0x1f4)](_0x131aeb(0x1f7));}async[a0_0x512e3e(0x201)](_0x262404){const _0x9a319f=a0_0x512e3e;this[_0x9a319f(0x1d5)]['warn'](_0x9a319f(0x1d9)+_0x262404+_0x9a319f(0x26d));if(this[_0x9a319f(0x246)])try{await this['onPromptTooLong'](_0x262404),this['logger']['info']('âœ…\x20Emergency\x20compactization\x20completed\x20for\x20'+_0x262404);}catch(_0x4b71a4){this['logger']['error'](_0x9a319f(0x24e),_0x4b71a4);throw _0x4b71a4;}else throw new Error('Request\x20too\x20large\x20and\x20no\x20compactization\x20handler\x20available');}['_isServerError'](_0x38ded4){const _0xa13f81=a0_0x512e3e,_0xd90914=['401','403','500',_0xa13f81(0x269),_0xa13f81(0x211),'504',_0xa13f81(0x239),'connection\x20refused','network',_0xa13f81(0x1c6),_0xa13f81(0x218)],_0x522eeb=_0x38ded4[_0xa13f81(0x21b)]?.[_0xa13f81(0x1c8)]()||'';return _0xd90914['some'](_0x7fd3e4=>_0x522eeb['includes'](_0x7fd3e4));}}export{LLM_CONSTANTS};