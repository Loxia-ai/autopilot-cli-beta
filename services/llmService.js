const a0_0x2f5c87=a0_0x5706;(function(_0x5164f2,_0x33a135){const _0x216a09=a0_0x5706,_0xe2d8b7=_0x5164f2();while(!![]){try{const _0x31692f=-parseInt(_0x216a09(0x147))/0x1*(-parseInt(_0x216a09(0x1ae))/0x2)+-parseInt(_0x216a09(0x1c2))/0x3*(-parseInt(_0x216a09(0x203))/0x4)+-parseInt(_0x216a09(0x1c6))/0x5*(-parseInt(_0x216a09(0x1ed))/0x6)+-parseInt(_0x216a09(0x1d2))/0x7*(parseInt(_0x216a09(0x16f))/0x8)+parseInt(_0x216a09(0x1ce))/0x9+-parseInt(_0x216a09(0x1eb))/0xa*(parseInt(_0x216a09(0x172))/0xb)+parseInt(_0x216a09(0x1a2))/0xc*(parseInt(_0x216a09(0x1ea))/0xd);if(_0x31692f===_0x33a135)break;else _0xe2d8b7['push'](_0xe2d8b7['shift']());}catch(_0x284c7b){_0xe2d8b7['push'](_0xe2d8b7['shift']());}}}(a0_0x4125,0x8b2d1));import{ServerLLMService}from'./serverLLMService.js';import{BudgetService}from'./budgetService.js';import{RateLimitService}from'./rateLimitService.js';function a0_0x4125(){const _0x5cd89c=['ndrcCgnfrxe','zgvSyxLnDwX0AxbSAwvY','BM93','Bwf4Aw11BsbJB250zxH0igXLBMD0Aa','vMLZAw9UihjLCxvLC3qGzMfPBgvKicHHDhrLBxb0ia','B3bLBMfP','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','rMfPBgvKihrVihjLz2LZDgvYignVBNzLCNnHDgLVBIa','z2v0uhjPy2LUz0LUzM8','DMfSAwrHDgLVBG','z2v0','ChjPy2LUzW','CMv0CMLLCW','yxP1CMuTywKTz3jVAZm','x3nLBgvJDfnLCNzPy2vgB3jdB252zxjZyxrPB24','rMfSBgLUzYbIywnRihrVigXVy2fSieXmtsbZzxj2AwnLCW','C2vYDMvYlwXSBq','CMvZzxrsyxrLtgLTAxriAxrZ','sw5PDgLHBgL6Aw5NieXmtsbZzxj2AwnLCYaOu2vYDMvYig1Vzgu6ia','x2LUAxrPywXPEMvtzxj2zxjtzxj2AwnL','u2vYDMLJzsa','teXnihnLCNzPy2uGAw5PDgLHBgL6yxrPB24GzMfPBgvKlcbIDxqGy29UDgLUDwLUzYb3AxrOigXPBwL0zwqGzNvUy3rPB25HBgL0Eq','yxzHAwXHyMXL','x2LZuhjVBxb0vg9Vtg9Uz0vYCM9Y','x3nLBgvJDfzPC2LVBLnLCNzPy2u','q09ovevyva','uMvNAxn0zxjLzcbJB252zxjZyxrPB24G','q29TCgfJDgL6yxrPB24Gy29TCgXLDgvKlcbYzxrYEwLUzYbYzxf1zxn0','x3jLy29YzfvZywDLqw5Ktwv0CMLJCW','CMvJB3jKvxnHz2u','vu5bvKfjtefcteu','zNjVBq','y29UzMLN','D2fYBG','AgfUzgXLuMf0zuXPBwL0sgL0','rMfPBgvKihrVigLUAxrPywXPEMuGteXnihnLCNzPy2vZigLUignVBNn0CNvJDg9YoG','Dg9tDhjPBMC','y29TCgfJDgL6yxrPB25ezwXHEu1Z','Aw5WDxrFDg9Rzw5Z','x2nHBgn1Bgf0zvjLDhj5rgvSyxK','tM8GDMLZAw9UlwnHCgfIBguGC2vYDMLJzxmGyxzHAwXHyMXL','yw50AhjVCgLJlw9WDxm','ChvZAa','qwXSihzPC2LVBIbYzxrYEsbHDhrLBxb0CYbMywLSzwq6ia','zxn0Aw1HDgvuB2TLBKnVDw50','qwXSieXmtsbZzxj2AwnLCYbZAhv0igrVD24','yNvKz2v0','ihDPDgGGzMfSBgjHy2SGC2vYDMLJzsa','mtiXnta4odHLtMTfr3m','uMvXDwvZDcb0B28GBgfYz2uGyw5Kig5VignVBxbHy3rPEMf0Aw9UigHHBMrSzxiGyxzHAwXHyMXL','yxP1CMuTywKTCgHPna','uhjVBxb0ihrVBYbSB25NigfUzcbUBYbJB21Wywn0AxPHDgLVBIbOyw5KBgvYigf2ywLSywjSzq','zxjYB3i','qvzbsuXbqKXf','qKfmqu5druq','AgvHBhrOq2HLy2S','ntaY','CgvYzM9YBwfUy2vnzxrYAwnZ','z2v0tgfZDe91Dhb1DfrVA2vUq291BNq','uMvNAxn0zxjPBMCGy29UDMvYC2f0Aw9UoIa','mZa2t0PQr2DT','Aw5MBW','revgqvvmvf9srvrswv9eruXbwv9nuW','C2vUze1LC3nHz2u','ChjPBwfYEvnLCNzPy2u','q2fUBM90igDLDcbZDw1Tyxj5oIbZzxj2AwnLia','DgHYB3r0Bgu','Aw52ywXPzcbHCgKGA2v5','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','rMfPBgvKihrVihjLy29Yzcb1C2fNzsbMB3iGyNvKz2v0ihrYywnRAw5NoG','x3nLBgvJDfnLCNzPy2vcEvbYzwzLCMvUy2vpCMrLCG','C2vYDMvYsgvHBhrO','B3zLCMfSBa','C2vYDMLJzvn0yxr1CW','yNvKz2v0u2vYDMLJzq','C2vYDMLJzuLUC3rHBMnLCW','AgfZ','CMvNAxn0zxjdB252zxjZyxrPB24','z2vUzxjHDgvjBwfNzq','zgvNCMfKzwq','mJe3nvLguLrYza','DxbKyxrLuhjPy2LUz0zYB21tzxj2zxi','Dw5HDxrOB3jPEMvK','x3rYEuzHBgXIywnRu2vYDMLJzq','mZvrrK9qr1y','y2f0y2G','yxP1CMuTB3bLBMfPlwDWDdq','CMvXDwvZDcbSAw1PDa','tu9eruXFufjfrKvsru5drq','tM8GC3vPDgfIBguGteXnihnLCNzPy2uGyxzHAwXHyMXLic0GrgvIDwCGAw5MBZO','CMvNAxn0zxjqCM9TChruB29mB25NsgfUzgXLCG','Aw5JBhvKzxm','mJG3nty1m0nfCvvWsW','BwvZC2fNzq','yw50AhjVCgLJ','x3nLBgvJDeXHCMDLC3rdB250zxH0u2vYDMLJzq','nZy1nZKYm0LIqNDjDq','CMf0zsbSAw1PDa','yxP1CMuTB3bLBMfPlwDWDdm1','C2vYDMLJzxm','x2LZu2vYDMvYrxjYB3i','ywXSu2v0DgXLza','C2v0','DxnHz2u','revgqvvmvf9nqvHFuKvuuKLfuW','Bwf4uMv0CMLLCW','C2L6zq','Dg90ywXnB2rLBhm','A2v5CW','revhuKferuq','y29UBMvJDgLVBIbYzwz1C2vK','CMvXDwvZDcb0B28GBgfYz2u','nta0','tM8GteXnihnLCNzPy2vZigfYzsbHDMfPBgfIBgu','D2fPDeLMtMvLzgvK','C29Tzq','x3nLBgvJDezHC3rLC3rtzxj2AwnL','yMfZzurLBgf5txm','z2v0u2vYDMvYsgvHBhrO','vxbKyxrPBMCGy29UDMvYC2f0Aw9UoIa','mtnJwe14Bg4','mti5mdiYmenLuKrWuW','C3vJy2vZC2z1BfjLCxvLC3rZ','mtqWmtqYzundsMDx','vxnPBMCGC2fTzsbZzxj2AwnLigzVCIbZDw1Tyxj5oIa','zMLSDgvY','AxnjBML0AwfSAxPLza','CMvMCMvZAfbYAwnPBMDeyxrH','teXnihnLCNzPy2uGAw5PDgLHBgL6zwq','z2v0sw1Hz2vezxnJCMLWDgLVBG','C2vYDMvYteXnu2vYDMLJzq','Dg9Vig1HBNKGCMvXDwvZDhm','x2HHBMrSzvjLCxvLC3ruB29myxjNzuvYCM9Y','BwvZC2fNzsb0B28GBg9UzW','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','u1bfruq','x2HHBMrSzvbYB21WDfrVB0XVBMDfCNjVCG','zMfPBgvKuMvXDwvZDhm','zxHJzwvKCYbJB250zxH0ihDPBMrVDW','u0vsvKLdrv9tvefuvvm','q2fUBM90igDLDcbZDw1Tyxj5oIbJB252zxjZyxrPB24G','C3LZDgvTuhjVBxb0','z2v0uMf0zuXPBwL0Aw5Nu3rHDhvZ','rMfSBgjHy2SGC2vYDMLJzsbHBhnVigzHAwXLzdOG','q29UDMvYC2f0Aw9Uia','mty4mgnQsev0Ea','Cgf5Bg9Hzcb0B28GBgfYz2u','C2vYDMvY','C2H1DgrVD24','revgqvvmvf9srvrswv9nvuXusvbmsuvs','DxnLu2vYDMvYteXn','r2v0DgLUzYbPBwfNzsbKzxnJCMLWDgLVBIb1C2LUzYb2AxnPB24Ty2fWywjSzsbTB2rLBa','zw5ZDxjLsw5PDgLHBgL6zwq','x2DLDfnLCNzPy2vnB2rLBeLK','Aw52ywXPzcbYzxf1zxn0igzVCM1HDa','x2rLBgf5','sw5PDgLHBgL6zwqG','z2v0u2vYDMLJzvn0yxr1CW','y2HLy2TcDwrNzxrgB3jpCgvYyxrPB24','Dg90ywXmyxrLBMn5','x3nLBgvJDejHBgfUy2vKu2vYDMLJzq','su5uruXmsuDftKnf','zw50CMLLCW','mJq4ng9dqKDVta','ndaZ','qNvKz2v0ihnLCNzPy2uGAw5PDgLHBgL6zwqGD2L0AcbKEw5HBwLJihbYAwnPBMCGC3vWCg9YDa','uhjVBxb0ihrVBYbSB25NigvYCM9YigrLDgvJDgvKic0GCMvXDwvZDgLUzYbJB21Wywn0AxPHDgLVBG','u1rsqvrfr1K','C3bLzwq','x3nLBgvJDezHBgXIywnRu2vYDMLJzq','x2DLDerLzMf1BhrnB2rLBezVCLnLCNzPy2u','BgvUz3rO','Dg90ywXszxf1zxn0CW','Dg9VigXVBMC','BgXTu3rYyxrLz3K','B25qCM9TChruB29mB25N','rMfPBgvKihrVigLUAxrPywXPEMuGteXnihnLCNzPy2vZoG','ndaW','CMf0zuXPBwL0u2vYDMLJzq','x2LZtM9UuMv0CNLHyMXLrxjYB3i','z2v0qwXSuhjPy2LUzW','C2v0qNvKz2v0tgLTAxq','Dg9mB3DLCKnHC2u','z2v0twf4q29UDgv4DfnPEMu','z2v0q29ZDevZDgLTyxrL','CxvVDgeGzxHJzwvKzwq','tM8GC3vPDgfIBguGteXnihnLCNzPy2uGyxzHAwXHyMXLigzVCIb0AgLZignVBNzLCNnHDgLVBI4GrgvIDwC6ia','Bg9Nz2vY','Aw5PDgLHBgL6zq','DxbKyxrLq29UDMvYC2f0Aw9U','ig5VDcbMB3vUzcbMB3iGy29UDMvYC2f0Aw9Uia','B3v0Chv0x3rVA2vUCW','ktOG','C3rHDhvZ','B3jPz2LUywXfCNjVCG','BMv0D29YAW','CMf0zv9SAw1PDa','4PYfievTzxjNzw5JEsbJB21Wywn0AxPHDgLVBIbJB21WBgv0zwqGzM9Yia','uhjVBxb0ihrVBYbSB25NigHHBMrSzxiGCMvNAxn0zxjLza','rxjYB3iGC2H1DhrPBMCGzg93BIbZzxj2AwnLia','ieXmtsbZzxj2AwnLCW','C3rYAw5NAwz5','sw1Hz2uGz2vUzxjHDgLVBIbYzxf1AxjLCYbZzxj2zxiGC2vYDMLJzs4GugXLyxnLignOzwnRihLVDxiGy29UBMvJDgLVBIbHBMqGqvbjigTLEs4','ohHUz0rSDG','yw50AhjVCgLJlxnVBM5LDa','BxmGzgvSyxKGywz0zxiGzw1LCMDLBMn5ignVBxbHy3rPEMf0Aw9U'];a0_0x4125=function(){return _0x5cd89c;};return a0_0x4125();}const HTTP_STATUS_CODES={'REQUEST_ENTITY_TOO_LARGE':0x19d,'BAD_REQUEST':0x190,'UNAUTHORIZED':0x191,'FORBIDDEN':0x193,'NOT_FOUND':0x194,'TOO_MANY_REQUESTS':0x1ad,'INTERNAL_SERVER_ERROR':0x1f4},REQUEST_SIZE_ERROR_PATTERNS=['request\x20entity\x20too\x20large',a0_0x2f5c87(0x204),a0_0x2f5c87(0x1e1),a0_0x2f5c87(0x1f7),'content\x20length\x20exceeds\x20limit'],LLM_CONSTANTS={'HTTP_STATUS':HTTP_STATUS_CODES,'ERROR_PATTERNS':{'REQUEST_TOO_LARGE':REQUEST_SIZE_ERROR_PATTERNS,'PROMPT_TOO_LONG':['too\x20long',a0_0x2f5c87(0x1fc),'context\x20length\x20exceeded',a0_0x2f5c87(0x175)],'RATE_LIMIT':[a0_0x2f5c87(0x1d3),'too\x20many\x20requests',a0_0x2f5c87(0x15d),'throttle']},'STRATEGY':{'SPEED':a0_0x2f5c87(0x14c),'INTELLIGENCE':'intelligence','CONTEXT':'context','BALANCED':'balanced'},'DEFAULT_MAX_RETRIES':0x3,'DEFAULT_RETRY_DELAY_MS':0x3e8,'DEFAULT_RETRY_MULTIPLIER':0x2,'DEFAULT_SUMMARY_SERVICE':a0_0x2f5c87(0x205),'SERVICE_STATUS':{'AVAILABLE':a0_0x2f5c87(0x188),'DEGRADED':'degraded','UNAVAILABLE':'unavailable'},'MODEL_PREFERENCE':{'SPEED':['anthropic-haiku',a0_0x2f5c87(0x1a4),a0_0x2f5c87(0x1d4),'google-gemini','anthropic-sonnet','azure-openai-gpt4',a0_0x2f5c87(0x19b)],'INTELLIGENCE':['anthropic-opus',a0_0x2f5c87(0x1c8),a0_0x2f5c87(0x17f),'anthropic-sonnet','google-gemini',a0_0x2f5c87(0x1d4),'anthropic-haiku'],'BALANCED':[a0_0x2f5c87(0x170),a0_0x2f5c87(0x1c8),'azure-ai-grok3','google-gemini',a0_0x2f5c87(0x19b),'azure-openai-gpt35','anthropic-haiku']},'ERROR_TYPES':{'PROMPT_TOO_LONG':'prompt_too_long','RATE_LIMIT':a0_0x2f5c87(0x168),'AUTHENTICATION':'authentication','NETWORK':a0_0x2f5c87(0x167),'SERVER':a0_0x2f5c87(0x205),'VALIDATION':a0_0x2f5c87(0x17b)}};export class LLMService{constructor(_0x15cb59,_0x4fdc38){const _0x153da3=a0_0x2f5c87;this[_0x153da3(0x192)]=_0x15cb59,this[_0x153da3(0x15f)]=_0x4fdc38,this['serviceInstances']=new Map(),this[_0x153da3(0x1b6)]=new Map(),this[_0x153da3(0x1bb)]=new Map(),this['useServerLLM']=_0x15cb59[_0x153da3(0x208)]!==![],this[_0x153da3(0x1b2)]=null,this[_0x153da3(0x1f4)]=null,this[_0x153da3(0x1f0)]=![],this[_0x153da3(0x156)]=new RateLimitService(_0x4fdc38),this[_0x153da3(0x1bc)]=null,this[_0x153da3(0x153)]=null,this['performanceMetrics']={'totalRequests':0x0,'successfulRequests':0x0,'failedRequests':0x0,'totalLatency':0x0,'averageLatency':0x0},this['logger'][_0x153da3(0x1af)](_0x153da3(0x1f2),{'useServerLLM':this['useServerLLM'],'strategy':_0x15cb59[_0x153da3(0x152)]||LLM_CONSTANTS['STRATEGY'][_0x153da3(0x1a8)]}),this[_0x153da3(0x160)]()['catch'](_0x1e6f75=>{const _0x28936a=_0x153da3;this[_0x28936a(0x15f)][_0x28936a(0x1a6)](_0x28936a(0x195),_0x1e6f75);});}async['initialize'](){const _0x2a1bf8=a0_0x2f5c87;if(this[_0x2a1bf8(0x1f0)])return;this['logger']['info'](_0x2a1bf8(0x184)+this['useServerLLM']+')');try{this['useServerLLM']&&await this['_initializeServerService']();this['_initializeBudgetService']();if(this[_0x2a1bf8(0x1bd)][_0x2a1bf8(0x1dc)]===0x0)throw new Error(_0x2a1bf8(0x1e3));this[_0x2a1bf8(0x1f0)]=!![],this[_0x2a1bf8(0x15f)]['info'](_0x2a1bf8(0x20e)+this[_0x2a1bf8(0x1bd)]['size']+_0x2a1bf8(0x16c),{'primary':this[_0x2a1bf8(0x1b2)],'services':Array[_0x2a1bf8(0x191)](this['serviceInstances']['keys']())});}catch(_0x3b3852){this[_0x2a1bf8(0x15f)][_0x2a1bf8(0x1a6)](_0x2a1bf8(0x154),_0x3b3852);if(this['isInitialized']===![])this[_0x2a1bf8(0x15f)]['warn'](_0x2a1bf8(0x187));else throw _0x3b3852;}}async[a0_0x2f5c87(0x185)](){const _0x35da10=a0_0x2f5c87;try{this['logger'][_0x35da10(0x1af)]('Initializing\x20server-based\x20LLM\x20service...'),this[_0x35da10(0x1f4)]=new ServerLLMService(this['config'],this['logger']),await this['serverLLMService']['initialize'](),this[_0x35da10(0x1bd)]['set']('server',this['serverLLMService']),this[_0x35da10(0x1bb)]['set'](_0x35da10(0x205),LLM_CONSTANTS['SERVICE_STATUS'][_0x35da10(0x1a7)]),this['primaryService']=_0x35da10(0x205);const _0x67da99=await this['serverLLMService']['getAvailableModels']()||[];this['logger'][_0x35da10(0x1af)]('Server-based\x20LLM\x20service\x20initialized\x20successfully',{'modelsAvailable':this['serverLLMService']['getAvailableModels']()['length']});}catch(_0x6293ef){this[_0x35da10(0x15f)]['error']('Failed\x20to\x20initialize\x20server\x20LLM\x20service:',_0x6293ef),this[_0x35da10(0x208)]=![],this['primaryService']=null,this[_0x35da10(0x1f4)]=null,this['logger'][_0x35da10(0x193)](_0x35da10(0x181));}}['_initializeBudgetService'](){const _0x11dd02=a0_0x2f5c87;this['budgetService']=new BudgetService(this['config'],this[_0x11dd02(0x15f)],this[_0x11dd02(0x1f4)]),this['logger']['info'](_0x11dd02(0x149));}async[a0_0x2f5c87(0x20a)](){!this['isInitialized']&&await this['initialize']();}async['getAvailableModels'](){const _0x35cc07=a0_0x2f5c87;await this[_0x35cc07(0x20a)]();const _0x2ae01f=[];if(this[_0x35cc07(0x1f4)]&&this[_0x35cc07(0x1f0)])try{let _0x832218=await this[_0x35cc07(0x1f4)]['getAvailableModels']();_0x2ae01f['push'](..._0x832218);}catch(_0x5dd9de){this['logger'][_0x35cc07(0x193)]('Failed to get models from server service:',_0x5dd9de);}return _0x2ae01f;}async['getPricingData'](){const _0x5ad33e=a0_0x2f5c87;return this[_0x5ad33e(0x1bc)]?await this[_0x5ad33e(0x1bc)][_0x5ad33e(0x158)]():new Map();}async[a0_0x2f5c87(0x1bf)](_0x4d91dd,_0x2faa46,_0x5c2940){const _0x3b0bb3=a0_0x2f5c87;await this[_0x3b0bb3(0x20a)](),this[_0x3b0bb3(0x15f)]['info'](_0x3b0bb3(0x1ad)+_0x4d91dd);const _0x56c8c8=this[_0x3b0bb3(0x180)](_0x4d91dd);if(!_0x56c8c8){const _0x2da88f={'useServerLLM':this['useServerLLM'],'serviceInstancesCount':this[_0x3b0bb3(0x1bd)][_0x3b0bb3(0x1dc)],'serviceInstances':Array[_0x3b0bb3(0x191)](this['serviceInstances'][_0x3b0bb3(0x1de)]()),'serviceStatusCount':this['serviceStatus']['size'],'serviceStatus':Object['fromEntries'](this['serviceStatus'][_0x3b0bb3(0x214)]()),'isInitialized':this['isInitialized']};this['logger']['error'](_0x3b0bb3(0x1cb),_0x2da88f);throw new Error(_0x3b0bb3(0x15e)+JSON[_0x3b0bb3(0x16d)](_0x2da88f));}const _0x2e7aca=this[_0x3b0bb3(0x1bd)]['get'](_0x56c8c8);try{await _0x2e7aca[_0x3b0bb3(0x1bf)](_0x4d91dd,_0x2faa46,_0x5c2940),this['conversationServices']['set'](_0x4d91dd,_0x56c8c8),this[_0x3b0bb3(0x15f)]['info'](_0x3b0bb3(0x18c)+_0x4d91dd+'\x20with\x20service\x20'+_0x56c8c8);}catch(_0x307dfb){this[_0x3b0bb3(0x15f)]['error']('Failed\x20to\x20register\x20conversation\x20'+_0x4d91dd+':',_0x307dfb);const _0x2b802d=this[_0x3b0bb3(0x14d)](_0x56c8c8);if(_0x2b802d){const _0xe404f4=this['serviceInstances'][_0x3b0bb3(0x17c)](_0x2b802d);await _0xe404f4['registerConversation'](_0x4d91dd,_0x2faa46,_0x5c2940),this[_0x3b0bb3(0x1b6)][_0x3b0bb3(0x1d8)](_0x4d91dd,_0x2b802d),this[_0x3b0bb3(0x15f)][_0x3b0bb3(0x1af)]('Registered\x20conversation\x20'+_0x4d91dd+_0x3b0bb3(0x1a1)+_0x2b802d);}else throw new Error(_0x3b0bb3(0x179)+_0x4d91dd+'\x20with\x20any\x20service');}}async[a0_0x2f5c87(0x1b1)](_0x5bc7a1,_0x128161,_0x2a8dd5){const _0x39bada=a0_0x2f5c87,_0x1f75eb=Date['now']();this[_0x39bada(0x1ab)][_0x39bada(0x150)]++;try{const _0xe76bdf=this['conversationServices']['get'](_0x5bc7a1);if(!_0xe76bdf)throw new Error(_0x39bada(0x202)+_0x5bc7a1+_0x39bada(0x1f8));const _0x40ed01=this[_0x39bada(0x1bd)][_0x39bada(0x17c)](_0xe76bdf);if(!_0x40ed01)throw new Error(_0x39bada(0x186)+_0xe76bdf+'\x20not\x20found\x20for\x20conversation\x20'+_0x5bc7a1);const _0x527a3c=this['_getServiceModelId'](_0xe76bdf);await this[_0x39bada(0x156)][_0x39bada(0x1e4)](_0x527a3c);const _0x5c7750=await this['_sendMessageWithRetry'](_0x40ed01,_0xe76bdf,_0x5bc7a1,_0x128161,_0x2a8dd5);return await this['_recordUsageAndMetrics'](_0x40ed01,_0xe76bdf,_0x1f75eb,!![]),_0x5c7750;}catch(_0xbb1d4a){this[_0x39bada(0x1ab)][_0x39bada(0x1fb)]++,this['logger']['error']('Send\x20message\x20failed\x20for\x20conversation\x20'+_0x5bc7a1+':',_0xbb1d4a);throw _0xbb1d4a;}}async['_sendMessageWithRetry'](_0x4e8719,_0x316db9,_0x5cca2c,_0x5377e1,_0x2ca6e9){const _0x1c356b=a0_0x2f5c87,_0x1d3a4e=this['config']['retries']?.[_0x1c356b(0x1db)]||LLM_CONSTANTS[_0x1c356b(0x1da)],_0x129ba8=this[_0x1c356b(0x192)][_0x1c356b(0x17e)]?.['maxRateLimitRetries']||0x5,_0x3e1e18=this['config']['retries']?.[_0x1c356b(0x197)]||0x7d0;let _0x308552=0x0,_0x59ec3e=0x0,_0x4e7ffa=null;while(_0x308552<=_0x1d3a4e){try{const _0x7b8cfb=await _0x4e8719['sendMessage'](_0x5cca2c,_0x5377e1,_0x2ca6e9);if(_0x316db9!==_0x1c356b(0x205)){const _0x279b5c=this['_getServiceModelId'](_0x316db9);this[_0x1c356b(0x156)]['resetRateLimitHits'](_0x279b5c);}return this['serviceStatus'][_0x1c356b(0x17c)](_0x316db9)===LLM_CONSTANTS[_0x1c356b(0x1fd)][_0x1c356b(0x1df)]&&this[_0x1c356b(0x1bb)][_0x1c356b(0x1d8)](_0x316db9,LLM_CONSTANTS[_0x1c356b(0x1fd)][_0x1c356b(0x1a7)]),_0x7b8cfb;}catch(_0x55f416){_0x4e7ffa=_0x55f416,this[_0x1c356b(0x15f)]['error']('Request\x20failed\x20(attempt\x20'+(_0x308552+0x1)+'/'+(_0x1d3a4e+0x1)+'):',_0x55f416);if(this[_0x1c356b(0x189)](_0x55f416)){await this[_0x1c356b(0x1fa)](_0x5cca2c);const _0x1659e6=this['_getServiceModelId'](_0x316db9);this['logger'][_0x1c356b(0x1af)]('Adding\x20'+_0x3e1e18+'ms\x20delay\x20after\x20compactization'),await this[_0x1c356b(0x20d)](_0x3e1e18),await this[_0x1c356b(0x156)][_0x1c356b(0x1e4)](_0x1659e6);continue;}if(this['_isRequestTooLargeError'](_0x55f416)){await this[_0x1c356b(0x1f6)](_0x5cca2c);const _0x2a4061=this['_getServiceModelId'](_0x316db9);this['logger']['info']('Adding\x20'+_0x3e1e18+_0x1c356b(0x171)),await this[_0x1c356b(0x20d)](_0x3e1e18),await this['rateLimitService']['waitIfNeeded'](_0x2a4061);continue;}if(_0x316db9!==_0x1c356b(0x205)&&this['_isRateLimitError'](_0x55f416)){const _0x415215=this['_getServiceModelId'](_0x316db9);_0x59ec3e++;if(_0x59ec3e>_0x129ba8)throw new Error('Rate\x20limit\x20retry\x20threshold\x20exceeded\x20('+_0x129ba8+_0x1c356b(0x164)+_0x55f416['message']);this['rateLimitService'][_0x1c356b(0x194)](_0x415215);if(_0x308552<_0x1d3a4e){this['logger'][_0x1c356b(0x1af)]('Rate\x20limit\x20error\x20detected,\x20waiting\x20and\x20retrying...\x20(rate\x20limit\x20attempt\x20'+_0x59ec3e+'/'+_0x129ba8+')'),await this['rateLimitService'][_0x1c356b(0x1e4)](_0x415215);continue;}}if(_0x316db9===_0x1c356b(0x205)&&this[_0x1c356b(0x1d6)](_0x55f416)){const _0x346017=await this['_tryFallbackService'](_0x5cca2c,_0x5377e1,_0x2ca6e9);if(_0x346017)return _0x346017;}if(this[_0x1c356b(0x157)](_0x55f416))break;if(_0x308552>=_0x1d3a4e)break;this['serviceStatus'][_0x1c356b(0x1d8)](_0x316db9,LLM_CONSTANTS['SERVICE_STATUS']['DEGRADED']);const _0xe8805d=this['_calculateRetryDelay'](_0x308552);await this[_0x1c356b(0x20d)](_0xe8805d),_0x308552++;}}throw new Error('All\x20retry\x20attempts\x20failed:\x20'+(_0x4e7ffa?.[_0x1c356b(0x1cf)]||'Unknown\x20error'));}async[a0_0x2f5c87(0x1c5)](_0x4e13ae,_0x25538b,_0x3ff5ab){const _0x51fc22=a0_0x2f5c87,_0xf4a0a6=this['_selectFallbackService']('server');if(!_0xf4a0a6)return null;try{this['logger']['info']('Switching\x20to\x20fallback\x20service:\x20'+_0xf4a0a6);const _0x59882d=this['serviceInstances']['get'](_0xf4a0a6);return await _0x59882d[_0x51fc22(0x1bf)](_0x4e13ae,_0x3ff5ab[_0x51fc22(0x1ff)]||'Conversation\x20resumed'),this['conversationServices']['set'](_0x4e13ae,_0xf4a0a6),await _0x59882d['sendMessage'](_0x4e13ae,_0x25538b,_0x3ff5ab);}catch(_0x267557){return this['logger']['error'](_0x51fc22(0x201)+_0x267557['message']),null;}}async[a0_0x2f5c87(0x18e)](_0x593f4a,_0x2d1fba,_0x37b263,_0x39baa4){const _0x167f40=a0_0x2f5c87,_0x138119=Date[_0x167f40(0x174)]()-_0x37b263;this['performanceMetrics']['totalLatency']+=_0x138119,this['performanceMetrics']['averageLatency']=this['performanceMetrics'][_0x167f40(0x211)]/this['performanceMetrics'][_0x167f40(0x150)];_0x39baa4&&this['performanceMetrics'][_0x167f40(0x1ec)]++;if(this['budgetService']&&_0x2d1fba!=='server')try{const _0x52afed=_0x593f4a['getLastInputTokenCount'](),_0x5b066a=_0x593f4a['getLastOutputTokenCount'](),_0x53f1a0=this['_getDefaultModelForService'](_0x2d1fba);await this[_0x167f40(0x1bc)]['recordUsage'](_0x2d1fba,_0x53f1a0,_0x52afed,_0x5b066a);}catch(_0x55c909){this[_0x167f40(0x15f)][_0x167f40(0x193)](_0x167f40(0x1b7),_0x55c909);}}async[a0_0x2f5c87(0x1fa)](_0x2eb0cc){const _0x171863=a0_0x2f5c87;this[_0x171863(0x15f)]['warn'](_0x171863(0x14a));if(this['onPromptTooLong'])try{await this['onPromptTooLong'](_0x2eb0cc),this['logger']['info'](_0x171863(0x18d));}catch(_0x5ae9d6){this['logger']['error']('Compactization\x20failed:',_0x5ae9d6);throw _0x5ae9d6;}else throw new Error(_0x171863(0x1a5));}async['updateConversation'](_0x12940f,_0xc0f38c){const _0x5b9303=a0_0x2f5c87;this['logger']['info'](_0x5b9303(0x1e9)+_0x12940f);const _0x3f7165=this['conversationServices']['get'](_0x12940f);if(!_0x3f7165)throw new Error(_0x5b9303(0x202)+_0x12940f+_0x5b9303(0x1f8));const _0x3ab9b9=this[_0x5b9303(0x1bd)]['get'](_0x3f7165);if(!_0x3ab9b9)throw new Error(_0x5b9303(0x186)+_0x3f7165+'\x20not\x20found\x20for\x20conversation\x20'+_0x12940f);try{await _0x3ab9b9[_0x5b9303(0x161)](_0x12940f,_0xc0f38c);}catch(_0x349347){this[_0x5b9303(0x15f)]['error']('Failed\x20to\x20update\x20conversation\x20'+_0x12940f+':',_0x349347);throw _0x349347;}}async['getSummary'](_0x1261f0,_0x4e92c1){const _0x3694d1=a0_0x2f5c87;this['logger']['info']('Getting\x20summary\x20for\x20conversation:\x20'+_0x1261f0);const _0x27daab=this['conversationServices']['get'](_0x1261f0);if(!_0x27daab)throw new Error(_0x3694d1(0x1fe)+_0x1261f0+'\x20not\x20registered\x20with\x20any\x20service');const _0x4450f2=this[_0x3694d1(0x1bd)][_0x3694d1(0x17c)](_0x27daab);if(!_0x4450f2)throw new Error(_0x3694d1(0x1b3)+_0x27daab+'\x20not\x20available');this[_0x3694d1(0x15f)]['info'](_0x3694d1(0x1ee)+_0x27daab);try{const _0x476bf5=await _0x4450f2['getSummary'](_0x4e92c1,_0x1261f0);if(this[_0x3694d1(0x1bc)]&&_0x27daab!==_0x3694d1(0x205)){const _0x37bfd4=this[_0x3694d1(0x14e)](_0x27daab);await this['budgetService']['recordUsage'](_0x27daab,_0x37bfd4,_0x4450f2[_0x3694d1(0x178)](),_0x4450f2['getLastOutputTokenCount']());}return _0x476bf5;}catch(_0x47e4df){this[_0x3694d1(0x15f)]['error']('Failed\x20to\x20get\x20summary\x20using\x20same\x20service\x20'+_0x27daab+':',_0x47e4df);throw _0x47e4df;}}async[a0_0x2f5c87(0x1f3)](_0x564f16,_0x56bf3f,_0x41e27c={}){const _0x58f624=a0_0x2f5c87;this['logger'][_0x58f624(0x1af)](_0x58f624(0x209));if(this[_0x58f624(0x208)]&&this[_0x58f624(0x1bd)]['has'](_0x58f624(0x205)))try{const _0x185db5=this['serviceInstances'][_0x58f624(0x17c)]('server');return await _0x185db5[_0x58f624(0x1f3)](_0x564f16,_0x56bf3f,_0x41e27c);}catch(_0x2c7b2b){this['logger']['warn']('Server\x20vision\x20service\x20failed,\x20trying\x20fallback:',_0x2c7b2b);}const _0x159be9=this['_selectVisionService']();if(!_0x159be9)throw new Error(_0x58f624(0x19a));const _0x614928=this['serviceInstances'][_0x58f624(0x17c)](_0x159be9),_0x34b392=this[_0x58f624(0x20b)](_0x159be9);await this[_0x58f624(0x156)][_0x58f624(0x1e4)](_0x34b392);const _0x40deae=this['config']['retries']?.['maxRetries']||LLM_CONSTANTS[_0x58f624(0x1da)];let _0x182e30=0x0,_0x428edc=null;while(_0x182e30<=_0x40deae){try{const _0x1af075=await _0x614928[_0x58f624(0x1f3)](_0x564f16,_0x56bf3f,_0x41e27c);this[_0x58f624(0x156)][_0x58f624(0x183)](_0x34b392);if(this[_0x58f624(0x1bc)]){const _0x409beb=this['_getDefaultModelForService'](_0x159be9);await this[_0x58f624(0x1bc)]['recordUsage'](_0x159be9,_0x409beb,_0x614928['getLastInputTokenCount'](),_0x614928[_0x58f624(0x1ac)]());}return _0x1af075;}catch(_0x13dab7){_0x428edc=_0x13dab7,this[_0x58f624(0x15f)][_0x58f624(0x1a6)](_0x58f624(0x176)+(_0x182e30+0x1)+'/'+(_0x40deae+0x1)+'):',_0x13dab7);if(this['_isRateLimitError'](_0x13dab7)){this[_0x58f624(0x156)]['handleRateLimitHit'](_0x34b392);if(_0x182e30<_0x40deae){await this[_0x58f624(0x156)]['waitIfNeeded'](_0x34b392);continue;}}if(this[_0x58f624(0x157)](_0x13dab7))throw _0x13dab7;if(_0x182e30>=_0x40deae)break;const _0xf097da=this['_calculateRetryDelay'](_0x182e30);await this['_delay'](_0xf097da),_0x182e30++;}}throw new Error(_0x58f624(0x19d)+(_0x428edc?.[_0x58f624(0x1cf)]||'Unknown\x20error'));}async[a0_0x2f5c87(0x1c0)](_0x1b2417,_0x58871a={}){const _0x42af23=a0_0x2f5c87;this[_0x42af23(0x15f)][_0x42af23(0x1af)]('Generating\x20image\x20using\x20server-based\x20image\x20generation');const _0x3a4e7c=this[_0x42af23(0x1bd)][_0x42af23(0x17c)](_0x42af23(0x205));if(_0x3a4e7c)try{const _0x314dff=await _0x3a4e7c[_0x42af23(0x1c0)](_0x1b2417,_0x58871a);return this[_0x42af23(0x1bc)]&&_0x314dff[_0x42af23(0x1d9)]&&await this['budgetService'][_0x42af23(0x18f)]('server',_0x58871a['model']||'azure-openai-dalle3',_0x314dff[_0x42af23(0x1d9)][_0x42af23(0x198)]||0x0,_0x314dff[_0x42af23(0x1d9)][_0x42af23(0x163)]||0x0),_0x314dff;}catch(_0x4f2e86){this['logger'][_0x42af23(0x193)]('Server\x20image\x20generation\x20failed:',_0x4f2e86);throw _0x4f2e86;}throw new Error(_0x42af23(0x16e));}async[a0_0x2f5c87(0x19e)](_0x368c95){const _0x16bc30=a0_0x2f5c87,_0x4ef38d=this[_0x16bc30(0x1b6)]['get'](_0x368c95);if(!_0x4ef38d)throw new Error(_0x16bc30(0x202)+_0x368c95+_0x16bc30(0x1f8));const _0x2c5930=this[_0x16bc30(0x1bd)][_0x16bc30(0x17c)](_0x4ef38d);if(!_0x2c5930)throw new Error('Service\x20'+_0x4ef38d+_0x16bc30(0x162)+_0x368c95);try{return await _0x2c5930['estimateTokenCount'](_0x368c95);}catch(_0x3595c7){return this['logger'][_0x16bc30(0x1a6)]('Failed\x20to\x20estimate\x20token\x20count\x20for\x20conversation\x20'+_0x368c95+':',_0x3595c7),0x0;}}[a0_0x2f5c87(0x15c)](_0x2c2a65,_0x35dfee,_0x1dbc8f){const _0x5cc6dd=a0_0x2f5c87;if(!this[_0x5cc6dd(0x1bc)])return null;return this[_0x5cc6dd(0x1bc)][_0x5cc6dd(0x15c)](_0x2c2a65,_0x35dfee,_0x1dbc8f);}[a0_0x2f5c87(0x210)](_0x1256fc,_0x1c64b8,_0x1d3ac2){const _0x386178=a0_0x2f5c87;if(!this[_0x386178(0x1bc)])return null;return this['budgetService'][_0x386178(0x210)](_0x1256fc,_0x1c64b8,_0x1d3ac2);}async['getBudgetUsage'](){if(!this['budgetService'])return null;return await this['budgetService']['getBudgetUsage']();}async['setBudgetLimit'](_0x204b96){const _0x34bc17=a0_0x2f5c87;if(!this[_0x34bc17(0x1bc)])throw new Error('Budget\x20service\x20not\x20available');await this['budgetService'][_0x34bc17(0x159)](_0x204b96);}async[a0_0x2f5c87(0x1f1)](){const _0x28e7b6=a0_0x2f5c87;if(!this['budgetService'])return![];return await this[_0x28e7b6(0x1bc)][_0x28e7b6(0x1c3)]();}[a0_0x2f5c87(0x20f)](){const _0x1e009c=a0_0x2f5c87,_0x4c3c40={};for(const [_0x52a12d,_0x1efa28]of this['serviceStatus']['entries']()){_0x4c3c40[_0x52a12d]={'status':_0x1efa28,'available':_0x1efa28!==LLM_CONSTANTS[_0x1e009c(0x1fd)][_0x1e009c(0x190)],'isPrimary':_0x52a12d===this[_0x1e009c(0x1b2)]};}return _0x4c3c40;}['getPerformanceMetrics'](){const _0x396ccb=a0_0x2f5c87;return{...this['performanceMetrics'],'successRate':this['performanceMetrics'][_0x396ccb(0x150)]>0x0?this['performanceMetrics'][_0x396ccb(0x1ec)]/this[_0x396ccb(0x1ab)]['totalRequests']*0x64:0x0};}[a0_0x2f5c87(0x200)](){const _0x221735=a0_0x2f5c87;return this[_0x221735(0x156)]['getAllStatus']();}[a0_0x2f5c87(0x1cc)](_0x5602a4){const _0x19fa30=a0_0x2f5c87;this[_0x19fa30(0x153)]=_0x5602a4,this[_0x19fa30(0x15f)][_0x19fa30(0x1af)](_0x19fa30(0x16a));}async['getHealthStatus'](){const _0x3211a6=a0_0x2f5c87,_0x42b131={'overall':'healthy','services':{},'budget':null,'performance':this['getPerformanceMetrics'](),'pricing':{'available':![],'modelsWithPricing':0x0,'lastUpdate':null}};for(const [_0x35e402,_0xf975c9]of this[_0x3211a6(0x1bb)][_0x3211a6(0x214)]()){_0x42b131['services'][_0x35e402]={'status':_0xf975c9,'available':_0xf975c9!==LLM_CONSTANTS[_0x3211a6(0x1fd)]['UNAVAILABLE']},_0xf975c9===LLM_CONSTANTS['SERVICE_STATUS'][_0x3211a6(0x190)]&&(_0x42b131[_0x3211a6(0x1ba)]=_0x3211a6(0x1c1));}if(this[_0x3211a6(0x1f4)])try{const _0x189f66=await this[_0x3211a6(0x1f4)][_0x3211a6(0x1e8)]();_0x42b131[_0x3211a6(0x1d5)]['server'][_0x3211a6(0x1b9)]=_0x189f66,_0x189f66['status']!=='healthy'&&(_0x42b131[_0x3211a6(0x1ba)]=_0x3211a6(0x1c1));}catch(_0x4abe87){_0x42b131[_0x3211a6(0x1d5)]['server'][_0x3211a6(0x1b9)]={'status':_0x3211a6(0x1a6),'error':_0x4abe87['message']},_0x42b131[_0x3211a6(0x1ba)]=_0x3211a6(0x1c1);}if(this[_0x3211a6(0x1bc)])try{_0x42b131[_0x3211a6(0x1a0)]=await this['budgetService'][_0x3211a6(0x1a9)](),_0x42b131[_0x3211a6(0x1a0)][_0x3211a6(0x165)]!=='healthy'&&(_0x42b131['overall']=_0x3211a6(0x1c1));}catch(_0x379f9b){_0x42b131['budget']={'status':_0x3211a6(0x1a6),'error':_0x379f9b[_0x3211a6(0x1cf)]},_0x42b131['overall']=_0x3211a6(0x1c1);}if(this[_0x3211a6(0x1bc)]){const _0x2eb272=this[_0x3211a6(0x1bc)][_0x3211a6(0x17a)]();_0x42b131[_0x3211a6(0x17d)]={'available':_0x2eb272[_0x3211a6(0x1dd)]>0x0,'modelsWithPricing':_0x2eb272['totalModels'],'lastUpdate':_0x2eb272['lastUpdate'],'source':_0x2eb272['source']};}return _0x42b131;}async[a0_0x2f5c87(0x206)](){const _0x51790c=a0_0x2f5c87;this['logger']['info']('Shutting\x20down\x20LLM\x20service');const _0x1e08d8=[];for(const [_0x18aab2,_0xbb8a8f]of this['serviceInstances']['entries']()){typeof _0xbb8a8f['shutdown']==='function'&&(this[_0x51790c(0x15f)][_0x51790c(0x1af)]('Shutting\x20down\x20service:\x20'+_0x18aab2),_0x1e08d8[_0x51790c(0x19c)](_0xbb8a8f[_0x51790c(0x206)]()['catch'](_0xe4b122=>{const _0x888d90=_0x51790c;this['logger']['error'](_0x888d90(0x16b)+_0x18aab2+':',_0xe4b122);})));}this[_0x51790c(0x1bc)]&&typeof this['budgetService']['shutdown']==='function'&&_0x1e08d8['push'](this['budgetService']['shutdown']()[_0x51790c(0x1c7)](_0x2887cd=>{this['logger']['error']('Error\x20shutting\x20down\x20budget\x20service:',_0x2887cd);})),await Promise[_0x51790c(0x1d7)](_0x1e08d8),this['serviceInstances']['clear'](),this['conversationServices']['clear'](),this[_0x51790c(0x1bb)]['clear'](),this[_0x51790c(0x15f)][_0x51790c(0x1af)](_0x51790c(0x19f));}['_selectServiceForConversation'](_0x7f3234,_0x58d2d5=[]){const _0x13be1f=a0_0x2f5c87;if(this[_0x13be1f(0x208)]&&this[_0x13be1f(0x1bd)][_0x13be1f(0x1be)]('server')&&!_0x58d2d5[_0x13be1f(0x1cd)]('server')&&this['serviceStatus']['get']('server')===LLM_CONSTANTS[_0x13be1f(0x1fd)]['AVAILABLE'])return _0x13be1f(0x205);return this['_selectAvailableService'](_0x58d2d5);}['_selectAvailableService'](_0x3c3e43=[]){const _0xabd830=a0_0x2f5c87,_0x512f0b=Array[_0xabd830(0x191)](this['serviceInstances']['keys']())['filter'](_0x2780d0=>!_0x3c3e43['includes'](_0x2780d0)&&this['serviceStatus']['get'](_0x2780d0)!==LLM_CONSTANTS[_0xabd830(0x1fd)]['UNAVAILABLE']);if(_0x512f0b['length']===0x0)return null;const _0x3ca290=this['config'][_0xabd830(0x152)]||LLM_CONSTANTS[_0xabd830(0x14b)]['BALANCED'];switch(_0x3ca290){case LLM_CONSTANTS['STRATEGY'][_0xabd830(0x1f9)]:return this['_selectFastestService'](_0x512f0b);case LLM_CONSTANTS[_0xabd830(0x14b)][_0xabd830(0x213)]:return this['_selectSmartestService'](_0x512f0b);case LLM_CONSTANTS['STRATEGY'][_0xabd830(0x18b)]:return this[_0xabd830(0x1d1)](_0x512f0b);case LLM_CONSTANTS[_0xabd830(0x14b)]['BALANCED']:default:return this[_0xabd830(0x212)](_0x512f0b);}}['_selectFallbackService'](_0x14f266){const _0x54f862=a0_0x2f5c87,_0xf00818=Array['from'](this[_0x54f862(0x1bd)][_0x54f862(0x1de)]())['filter'](_0x2a7b5d=>_0x2a7b5d!==_0x14f266&&this['serviceStatus']['get'](_0x2a7b5d)!==LLM_CONSTANTS[_0x54f862(0x1fd)]['UNAVAILABLE']);if(_0xf00818[_0x54f862(0x14f)]===0x0)return null;if(_0x14f266!=='anthropic'&&_0xf00818['includes']('anthropic'))return'anthropic';return _0xf00818[0x0];}[a0_0x2f5c87(0x18a)](_0x3b21ae=[]){const _0x53f403=a0_0x2f5c87,_0x547be2=[_0x53f403(0x1d0),'openai','google'],_0x220aba=_0x547be2[_0x53f403(0x1ef)](_0xa8d018=>!_0x3b21ae[_0x53f403(0x1cd)](_0xa8d018)&&this[_0x53f403(0x1bd)][_0x53f403(0x1be)](_0xa8d018)&&this[_0x53f403(0x1bb)][_0x53f403(0x17c)](_0xa8d018)!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']);if(_0x220aba['length']===0x0)return null;const _0x3fa91c=[_0x53f403(0x1d0),_0x53f403(0x177),'google'];for(const _0x2f4cbf of _0x3fa91c){if(_0x220aba['includes'](_0x2f4cbf))return _0x2f4cbf;}return _0x220aba[0x0];}[a0_0x2f5c87(0x1e6)](_0x256c44){const _0x7f1f45=a0_0x2f5c87;return this[_0x7f1f45(0x1b8)](_0x256c44,LLM_CONSTANTS[_0x7f1f45(0x1ca)][_0x7f1f45(0x1f9)]);}['_selectSmartestService'](_0x2a7112){const _0x3a06af=a0_0x2f5c87;return this['_selectServiceByPreferenceOrder'](_0x2a7112,LLM_CONSTANTS[_0x3a06af(0x1ca)]['INTELLIGENCE']);}['_selectLargestContextService'](_0x3cc204){const _0x2db32c=a0_0x2f5c87;let _0xb37eb7=null,_0x2deee0=0x0;for(const _0x2ccb49 of _0x3cc204){const _0x339150=this['serviceInstances']['get'](_0x2ccb49);if(!_0x339150||typeof _0x339150[_0x2db32c(0x15b)]!=='function')continue;const _0xb5deb1=_0x339150['getMaxContextSize']();_0xb5deb1>_0x2deee0&&(_0x2deee0=_0xb5deb1,_0xb37eb7=_0x2ccb49);}return _0xb37eb7||_0x3cc204[0x0];}['_selectBalancedService'](_0x1900f3){const _0x400a5d=a0_0x2f5c87;return this[_0x400a5d(0x1b8)](_0x1900f3,LLM_CONSTANTS['MODEL_PREFERENCE'][_0x400a5d(0x1a8)]);}['_selectServiceByPreferenceOrder'](_0x427396,_0x1119f5){const _0x436f6a=a0_0x2f5c87,_0x2cc181={'anthropic':[_0x436f6a(0x19b),'anthropic-sonnet','anthropic-haiku'],'openai':['azure-openai-gpt4','azure-openai-gpt35'],'google':['google-gemini'],'server':[]};for(const _0x45aa6e of _0x1119f5){for(const _0x5e8d33 of _0x427396){if(_0x5e8d33===_0x436f6a(0x205))return _0x5e8d33;const _0x1700d7=_0x2cc181[_0x5e8d33]||[];if(_0x1700d7[_0x436f6a(0x1cd)](_0x45aa6e))return _0x5e8d33;}}return _0x427396[0x0];}['_getServiceModelId'](_0x819ae1){const _0xc7672e=a0_0x2f5c87,_0x158b00={'anthropic':'anthropic-sonnet','openai':_0xc7672e(0x1c8),'google':'google-gemini','server':_0xc7672e(0x182)};return _0x158b00[_0x819ae1]||_0x819ae1;}[a0_0x2f5c87(0x14e)](_0x2a3795){return this['_getServiceModelId'](_0x2a3795);}[a0_0x2f5c87(0x199)](_0x229d66){const _0x23c1f0=a0_0x2f5c87,_0x41e468=this[_0x23c1f0(0x192)]['retries']?.[_0x23c1f0(0x1e7)]||LLM_CONSTANTS[_0x23c1f0(0x1b0)],_0x1eb617=this['config'][_0x23c1f0(0x17e)]?.[_0x23c1f0(0x173)]||LLM_CONSTANTS[_0x23c1f0(0x207)];return _0x41e468*Math['pow'](_0x1eb617,_0x229d66);}[a0_0x2f5c87(0x20d)](_0x22bada){return new Promise(_0x3b03c0=>setTimeout(_0x3b03c0,_0x22bada));}['_isRateLimitError'](_0x122e45){const _0x30e9bb=a0_0x2f5c87,_0x345d4f=[_0x30e9bb(0x1d3),_0x30e9bb(0x1f5),_0x30e9bb(0x15d),_0x30e9bb(0x1c9),'429',_0x30e9bb(0x1b4)],_0x3d4f48=_0x122e45[_0x30e9bb(0x1cf)]?.['toLowerCase']()||'';return _0x345d4f[_0x30e9bb(0x1e5)](_0x125b2b=>_0x3d4f48['includes'](_0x125b2b));}['_isNonRetryableError'](_0x216492){const _0x3fc7af=a0_0x2f5c87,_0x30d18c=[_0x3fc7af(0x1b5),'authentication\x20failed',_0x3fc7af(0x1c4),'model\x20not\x20found',_0x3fc7af(0x20c),'content\x20policy'],_0x1bc94d=_0x216492['message']?.[_0x3fc7af(0x15a)]()||'';return _0x30d18c[_0x3fc7af(0x1e5)](_0x5efa08=>_0x1bc94d[_0x3fc7af(0x1cd)](_0x5efa08));}['_isPromptTooLongError'](_0x25e892){const _0xd336b1=a0_0x2f5c87,_0x3fca07=_0x25e892[_0xd336b1(0x1cf)]?.[_0xd336b1(0x15a)]()||'',_0x1ba140=_0x25e892[_0xd336b1(0x196)]?.()?.['toLowerCase']()||'';return(_0x3fca07[_0xd336b1(0x1cd)](_0xd336b1(0x151))||_0x1ba140[_0xd336b1(0x1cd)]('too\x20long'))&&(_0x25e892[_0xd336b1(0x165)]===0x190||_0x3fca07['includes'](_0xd336b1(0x155))||_0x1ba140[_0xd336b1(0x1cd)]('400'));}['_isRequestTooLargeError'](_0x206b04){const _0x35091d=a0_0x2f5c87,_0x4ade61=_0x206b04[_0x35091d(0x1cf)]?.['toLowerCase']()||'',_0x4ff30b=_0x206b04[_0x35091d(0x165)]||_0x206b04[_0x35091d(0x166)]?.[_0x35091d(0x165)];return _0x4ff30b===0x19d||_0x4ade61[_0x35091d(0x1cd)]('request\x20entity\x20too\x20large')||_0x4ade61[_0x35091d(0x1cd)](_0x35091d(0x204))||_0x4ade61['includes'](_0x35091d(0x1e1));}async['_handleRequestTooLargeError'](_0x4fa40c){const _0x274e8a=a0_0x2f5c87;this['logger']['warn']('🚨\x20Request\x20too\x20large\x20detected\x20for\x20'+_0x4fa40c+'\x20-\x20performing\x20emergency\x20compactization');if(this[_0x274e8a(0x153)])try{await this['onPromptTooLong'](_0x4fa40c),this[_0x274e8a(0x15f)]['info'](_0x274e8a(0x169)+_0x4fa40c);}catch(_0x3aa5cd){this['logger']['error']('Emergency\x20compactization\x20failed:',_0x3aa5cd);throw _0x3aa5cd;}else throw new Error(_0x274e8a(0x1a3));}['_isServerError'](_0x19487c){const _0x40f5f5=a0_0x2f5c87,_0x366f58=['401',_0x40f5f5(0x148),'500',_0x40f5f5(0x1aa),'503',_0x40f5f5(0x1e2),'authentication',_0x40f5f5(0x1e0),_0x40f5f5(0x167),'server\x20error','service\x20unavailable'],_0x17c91f=_0x19487c[_0x40f5f5(0x1cf)]?.['toLowerCase']()||'';return _0x366f58[_0x40f5f5(0x1e5)](_0xfe774e=>_0x17c91f['includes'](_0xfe774e));}}function a0_0x5706(_0x52d67b,_0x2af259){const _0x412543=a0_0x4125();return a0_0x5706=function(_0x5706e,_0x302232){_0x5706e=_0x5706e-0x147;let _0x5c0420=_0x412543[_0x5706e];if(a0_0x5706['xxkFmh']===undefined){var _0x5d5bc5=function(_0x15cb59){const _0x4fdc38='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1e6f75='',_0x3b3852='';for(let _0x67da99=0x0,_0x6293ef,_0x2ae01f,_0x832218=0x0;_0x2ae01f=_0x15cb59['charAt'](_0x832218++);~_0x2ae01f&&(_0x6293ef=_0x67da99%0x4?_0x6293ef*0x40+_0x2ae01f:_0x2ae01f,_0x67da99++%0x4)?_0x1e6f75+=String['fromCharCode'](0xff&_0x6293ef>>(-0x2*_0x67da99&0x6)):0x0){_0x2ae01f=_0x4fdc38['indexOf'](_0x2ae01f);}for(let _0x5dd9de=0x0,_0x4d91dd=_0x1e6f75['length'];_0x5dd9de<_0x4d91dd;_0x5dd9de++){_0x3b3852+='%'+('00'+_0x1e6f75['charCodeAt'](_0x5dd9de)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3b3852);};a0_0x5706['PijLXH']=_0x5d5bc5,_0x52d67b=arguments,a0_0x5706['xxkFmh']=!![];}const _0x2c6d1e=_0x412543[0x0],_0x1812ed=_0x5706e+_0x2c6d1e,_0x5e23db=_0x52d67b[_0x1812ed];return!_0x5e23db?(_0x5c0420=a0_0x5706['PijLXH'](_0x5c0420),_0x52d67b[_0x1812ed]=_0x5c0420):_0x5c0420=_0x5e23db,_0x5c0420;},a0_0x5706(_0x52d67b,_0x2af259);}export{LLM_CONSTANTS};