const a0_0x246453=a0_0x5c74;(function(_0x22ca61,_0x3ac674){const _0x109e9f=a0_0x5c74,_0x294b69=_0x22ca61();while(!![]){try{const _0x42e5cb=-parseInt(_0x109e9f(0x127))/0x1*(-parseInt(_0x109e9f(0x140))/0x2)+parseInt(_0x109e9f(0x173))/0x3+parseInt(_0x109e9f(0x19e))/0x4+-parseInt(_0x109e9f(0x1b7))/0x5+parseInt(_0x109e9f(0x150))/0x6+parseInt(_0x109e9f(0x167))/0x7+parseInt(_0x109e9f(0x1a0))/0x8*(-parseInt(_0x109e9f(0x1ab))/0x9);if(_0x42e5cb===_0x3ac674)break;else _0x294b69['push'](_0x294b69['shift']());}catch(_0x48a320){_0x294b69['push'](_0x294b69['shift']());}}}(a0_0x3501,0x3f532));function a0_0x3501(){const _0x58040c=['CMvNAxn0zxjqCM9TChruB29mB25NsgfUzgXLCG','zNjVBq','C2v0qNvKz2v0tgLTAxq','yNvKz2v0','Dg9VigXVBMC','z2v0ugvYzM9YBwfUy2vnzxrYAwnZ','B3zLCMfSBa','u3DPDgnOAw5NihrVigzHBgXIywnRihnLCNzPy2u6ia','x3nLBgvJDfnLCNzPy2vcEvbYzwzLCMvUy2vpCMrLCG','z2v0u2vYDMLJzvn0yxr1CW','C3rHDhvZ','CxvVDgeGzxHJzwvKzwq','CMvXDwvZDcbSAw1PDa','C2vYDMLJzxm','ig5VDcbMB3vUzcbMB3iGy29UDMvYC2f0Aw9Uia','CMf0zuXPBwL0u2vYDMLJzq','Aw5PDgLHBgL6zq','CgvYzM9YBwfUy2vnzxrYAwnZ','qvzbsuXbqKXf','AgvHBhrOq2HLy2S','Aw52ywXPzcbYzxf1zxn0igzVCM1HDa','mZu4mdm2D3z4sgDl','Dw5HDxrOB3jPEMvK','nZjXAezduuy','x3nLBMrnzxnZywDLv2L0AfjLDhj5','ieXmtsbZzxj2AwnLCW','z2v0sw1Hz2vezxnJCMLWDgLVBG','qwXSihzPC2LVBIbYzxrYEsbHDhrLBxb0CYbMywLSzwq6ia','DxbKyxrLq29UDMvYC2f0Aw9U','Bwf4Aw11BsbJB250zxH0igXLBMD0Aa','yw50AhjVCgLJlxnVBM5LDa','x2rLBgf5','uMf0zsbSAw1PDcbYzxrYEsb0AhjLC2HVBgqGzxHJzwvKzwqGka','ntaY','mZq4ndG5zePTDhf5','CMvXDwvZDcb0B28GBgfYz2u','x2HHBMrSzvjLCxvLC3ruB29myxjNzuvYCM9Y','revgqvvmvf9nqvHFuKvuuKLfuW','Cgf5Bg9Hzcb0B28GBgfYz2u','CMvNAxn0zxjdB252zxjZyxrPB24','qNvKz2v0ihnLCNzPy2uGBM90igf2ywLSywjSzq','AgvHBhrOEq','uhjVBxb0ihrVBYbSB25NigHHBMrSzxiGCMvNAxn0zxjLza','C2H1DgrVD24','tM8GDMLZAw9UlwnHCgfIBguGC2vYDMLJzxmGyxzHAwXHyMXL','z2v0uhjPy2LUz0rHDge','mteXmdGWnxjpyM5AvW','C2vYDMvYsgvHBhrO','yMfZzurLBgf5txm','C2L6zq','yw50AhjVCgLJlw9WDxm','zMfPBgvKuMvXDwvZDhm','yxP1CMuTB3bLBMfPlwDWDdq','z29Vz2XLlwDLBwLUAq','rMfPBgvKihrVihvWzgf0zsbJB252zxjZyxrPB24G','zNjVBuvUDhjPzxm','ChjPy2LUzW','yxzHAwXHyMXL','rxjYB3iGC2H1DhrPBMCGzg93BIbZzxj2AwnLia','vMLZAw9UihjLCxvLC3qGzMfPBgvKicHHDhrLBxb0ia','x2LZuhjVBxb0vg9Vtg9Uz0vYCM9Y','CMf0zv9SAw1PDa','D2fPDeLMtMvLzgvK','Bwf4uMv0CMLLCW','C2v0','z2v0qxzHAwXHyMXLtw9KzwXZ','C2vYDMLJzvn0yxr1CW','qwXSihjLDhj5igf0DgvTChrZigzHAwXLzdOG','Dg9mB3DLCKnHC2u','uhjVBxb0ihrVBYbSB25NigvYCM9YigrLDgvJDgvKic0GCMvXDwvZDgLUzYbJB21Wywn0AxPHDgLVBG','B3bLBMfP','y2HLy2TcDwrNzxrgB3jpCgvYyxrPB24','y29UDgvUDcbWB2XPy3K','rMfPBgvKihrVihjLy29Yzcb1C2fNzsbMB3iGyNvKz2v0ihrYywnRAw5NoG','Aw5JBhvKzxm','ntaZ','Bg9Nz2vY','AgfUzgXLuMf0zuXPBwL0sgL0','Aw5MBW','u1rsqvrfr1K','C29Tzq','q29UDMvYC2f0Aw9Uia','yxv0AgvUDgLJyxrPB24GzMfPBgvK','x3nLBgvJDef2ywLSywjSzvnLCNzPy2u','Dg90ywXmyxrLBMn5','x3nLBgvJDfnLCNzPy2vgB3jdB252zxjZyxrPB24','yxzLCMfNzuXHDgvUy3K','rMfPBgvKihrVigLUAxrPywXPEMuGteXnihnLCNzPy2vZoG','rMfSBgjHy2SGC2vYDMLJzsbHBhnVigzHAwXLzdOG','CMv0CMLLCW','su5uruXmsuDftKnf','yw50AhjVCgLJ','sw5PDgLHBgL6zwqG','q29UDMvYC2f0Aw9UihjLC3vTzwq','x2LUAxrPywXPEMvtzxj2zxjtzxj2AwnL','mJu3mdn0C0r4tNa','CMvMCMvZAfbYAwnPBMDeyxrH','B25qCM9TChruB29mB25N','y29UzMLN','uhjVBxb0ihrVBYbSB25NigfUzcbUBYbJB21Wywn0AxPHDgLVBIbOyw5KBgvYigf2ywLSywjSzq','u0vsvKLdrv9tvefuvvm','zw5ZDxjLsw5PDgLHBgL6zwq','x3nLBgvJDeXHCMDLC3rdB250zxH0u2vYDMLJzq','r2v0DgLUzYbPBwfNzsbKzxnJCMLWDgLVBIb1C2LUzYb2AxnPB24Ty2fWywjSzsbTB2rLBa','ndaX','CMvXDwvZDcbLBNrPDhKGDg9VigXHCMDL','z2v0qwXSu3rHDhvZ','x3nLBgvJDfnTyxj0zxn0u2vYDMLJzq','Dg90ywXszxf1zxn0CW','z2v0qwXSuhjPy2LUzW','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','vw5RBM93BIbLCNjVCG','C3LZDgvTuhjVBxb0','C2vYDMvYteXnu2vYDMLJzq','yNvKz2v0u2vYDMLJzq','revgqvvmvf9srvrswv9eruXbwv9nuW','x2DLDerLzMf1BhrnB2rLBezVCLnLCNzPy2u','qwrKAw5Nia','C2vYDMLJzuLUC3rHBMnLCW','z2v0tgfZDe91Dhb1DfrVA2vUq291BNq','mJzsC2HVtLC','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','z2v0uMf0zuXPBwL0Aw5Nu3rHDhvZ','x3nLBgvJDezHBgXIywnRu2vYDMLJzq','u2vYDMLJzsa','z2v0u3vTBwfYEq','teXnihnLCNzPy2uGAw5PDgLHBgL6yxrPB24GzMfPBgvKlcbIDxqGy29UDgLUDwLUzYb3AxrOigXPBwL0zwqGzNvUy3rPB25HBgL0Eq','x3nLBgvJDejHBgfUy2vKu2vYDMLJzq','rMfPBgvKihrVigLUAxrPywXPEMuGteXnihnLCNzPy2vZigLUignVBNn0CNvJDg9YoG','y2f0y2G','u2H1DhrPBMCGzg93BIbZzxj2AwnLoIa','x2LZu2vYDMvYrxjYB3i','yw50AhjVCgLJlwHHAwT1','CMf0zsbSAw1PDa','Aw52ywXPzcbHCgKGA2v5','ChjPBwfYEvnLCNzPy2u','ntC1ntm4zevQCw1X','x2DLDfnLCNzPy2vnB2rLBeLK','A2v5CW','yxP1CMuTB3bLBMfPlwDWDdm1','x3nLBgvJDfzPC2LVBLnLCNzPy2u','z2v0sgvHBhrOu3rHDhvZ','x3rYEuzHBgXIywnRu2vYDMLJzq','Cg93','tu9eruXFufjfrKvsru5drq','ktOG','x3jLy29YzfvZywDLqw5Ktwv0CMLJCW','zxjYB3i','u2vYDMvYlwjHC2vKieXmtsbZzxj2AwnLigLUAxrPywXPEMvKihn1y2nLC3nMDwXSEq','zgvNCMfKzwq','x2LZuMvXDwvZDfrVB0XHCMDLrxjYB3i','CMvZzxrsyxrLtgLTAxriAxrZ','x2HHBMrSzvbYB21WDfrVB0XVBMDfCNjVCG','Dg9Vig1HBNKGCMvXDwvZDhm','q29TCgfJDgL6yxrPB24GzMfPBgvKoG','DxnLu2vYDMvYteXn','AgfZ','BgvUz3rO','Dg90ywXnB2rLBhm','mtyZnZu4n05erNbPCq','tM8GC3vPDgfIBguGteXnihnLCNzPy2uGyxzHAwXHyMXLic0GrgvIDwCGAw5MBZO','AxnjBML0AwfSAxPLza','z2v0','yMfSyw5Jzwq','C2vYDMvYlwXSBq','ntaW','zw50CMLLCW','BwvZC2fNzq','ywXSu2v0DgXLza','rMfPBgvKihrVigDLDcbZDw1Tyxj5ihvZAw5NihnHBwuGC2vYDMLJzsa','revhuKferuq','mJi5ntq4ANHKDLPr','z2v0q29ZDevZDgLTyxrL','zMLSDgvY','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','tM8GteXnihnLCNzPy2vZigfYzsbHDMfPBgfIBgu','z2v0twf4q29UDgv4DfnPEMu','Bwf4uMf0zuXPBwL0uMv0CMLLCW','DgHYB3r0Bgu','x2nHBgn1Bgf0zvjLDhj5rgvSyxK','x2LZuMf0zuXPBwL0rxjYB3i','y29TCgfJDgL6yxrPB25ezwXHEu1Z','C2vYDMvY','yxv0AgvUDgLJyxrPB24','D2fYBG','z2v0qNvKz2v0vxnHz2u','C3vJy2vZC2z1BfjLCxvLC3rZ','ihDPDgGGzMfSBgjHy2SGC2vYDMLJzsa','u1bfruq','y29UDgv4DcbSzw5NDgGGzxHJzwvKzwq','C2vYDMvYigvYCM9Y','zNvUy3rPB24','r2v0DgLUzYbZDw1Tyxj5igzVCIbJB252zxjZyxrPB246ia'];a0_0x3501=function(){return _0x58040c;};return a0_0x3501();}import{ServerLLMService}from'./serverLLMService.js';function a0_0x5c74(_0x1bc7af,_0x41c1fc){const _0x350193=a0_0x3501();return a0_0x5c74=function(_0x5c742d,_0x3a0309){_0x5c742d=_0x5c742d-0xfb;let _0x1b9e41=_0x350193[_0x5c742d];if(a0_0x5c74['toVzlE']===undefined){var _0x4e6334=function(_0x4ebcb2){const _0xfd51d5='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5dccbf='',_0x16e879='';for(let _0x28caa3=0x0,_0x51bb93,_0x2ba174,_0x16b9d1=0x0;_0x2ba174=_0x4ebcb2['charAt'](_0x16b9d1++);~_0x2ba174&&(_0x51bb93=_0x28caa3%0x4?_0x51bb93*0x40+_0x2ba174:_0x2ba174,_0x28caa3++%0x4)?_0x5dccbf+=String['fromCharCode'](0xff&_0x51bb93>>(-0x2*_0x28caa3&0x6)):0x0){_0x2ba174=_0xfd51d5['indexOf'](_0x2ba174);}for(let _0x3f9fb5=0x0,_0x10459b=_0x5dccbf['length'];_0x3f9fb5<_0x10459b;_0x3f9fb5++){_0x16e879+='%'+('00'+_0x5dccbf['charCodeAt'](_0x3f9fb5)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x16e879);};a0_0x5c74['sczTOx']=_0x4e6334,_0x1bc7af=arguments,a0_0x5c74['toVzlE']=!![];}const _0x28ccb2=_0x350193[0x0],_0x2df7e5=_0x5c742d+_0x28ccb2,_0x5a7055=_0x1bc7af[_0x2df7e5];return!_0x5a7055?(_0x1b9e41=a0_0x5c74['sczTOx'](_0x1b9e41),_0x1bc7af[_0x2df7e5]=_0x1b9e41):_0x1b9e41=_0x5a7055,_0x1b9e41;},a0_0x5c74(_0x1bc7af,_0x41c1fc);}import{BudgetService}from'./budgetService.js';import{RateLimitService}from'./rateLimitService.js';const HTTP_STATUS_CODES={'REQUEST_ENTITY_TOO_LARGE':0x19d,'BAD_REQUEST':0x190,'UNAUTHORIZED':0x191,'FORBIDDEN':0x193,'NOT_FOUND':0x194,'TOO_MANY_REQUESTS':0x1ad,'INTERNAL_SERVER_ERROR':0x1f4},REQUEST_SIZE_ERROR_PATTERNS=[a0_0x246453(0x131),'payload\x20too\x20large','request\x20too\x20large','message\x20too\x20long','content\x20length\x20exceeds\x20limit'],LLM_CONSTANTS={'HTTP_STATUS':HTTP_STATUS_CODES,'ERROR_PATTERNS':{'REQUEST_TOO_LARGE':REQUEST_SIZE_ERROR_PATTERNS,'PROMPT_TOO_LONG':[a0_0x246453(0x18d),'exceeds\x20context\x20window',a0_0x246453(0x185),a0_0x246453(0x1a6)],'RATE_LIMIT':[a0_0x246453(0x14d),'too\x20many\x20requests',a0_0x246453(0x194),a0_0x246453(0x17a)]},'STRATEGY':{'SPEED':'speed','INTELLIGENCE':'intelligence','CONTEXT':'context','BALANCED':a0_0x246453(0x16b)},'DEFAULT_MAX_RETRIES':0x3,'DEFAULT_RETRY_DELAY_MS':0x3e8,'DEFAULT_RETRY_MULTIPLIER':0x2,'DEFAULT_SUMMARY_SERVICE':'server','SERVICE_STATUS':{'AVAILABLE':a0_0x246453(0x101),'DEGRADED':'degraded','UNAVAILABLE':'unavailable'},'MODEL_PREFERENCE':{'SPEED':['anthropic-haiku','azure-ai-phi4',a0_0x246453(0x153),'google-gemini',a0_0x246453(0x1a7),a0_0x246453(0xfc),a0_0x246453(0x1bb)],'INTELLIGENCE':[a0_0x246453(0x1bb),a0_0x246453(0xfc),'azure-ai-grok3','anthropic-sonnet',a0_0x246453(0xfd),'azure-openai-gpt35',a0_0x246453(0x14c)],'BALANCED':['anthropic-sonnet','azure-openai-gpt4','azure-ai-grok3',a0_0x246453(0xfd),'anthropic-opus',a0_0x246453(0x153),a0_0x246453(0x14c)]},'ERROR_TYPES':{'PROMPT_TOO_LONG':'prompt_too_long','RATE_LIMIT':a0_0x246453(0x105),'AUTHENTICATION':a0_0x246453(0x17f),'NETWORK':'network','SERVER':a0_0x246453(0x17e),'VALIDATION':'validation'}};export class LLMService{constructor(_0x4ebcb2,_0xfd51d5){const _0x590d5a=a0_0x246453;this['config']=_0x4ebcb2,this[_0x590d5a(0x114)]=_0xfd51d5,this[_0x590d5a(0x13e)]=new Map(),this['conversationServices']=new Map(),this[_0x590d5a(0x10a)]=new Map(),this['useServerLLM']=_0x4ebcb2['useServerLLM']!==![],this['primaryService']=null,this[_0x590d5a(0x139)]=null,this[_0x590d5a(0x169)]=![],this['rateLimitService']=new RateLimitService(_0xfd51d5),this[_0x590d5a(0x13a)]=null,this[_0x590d5a(0x129)]=null,this['performanceMetrics']={'totalRequests':0x0,'successfulRequests':0x0,'failedRequests':0x0,'totalLatency':0x0,'averageLatency':0x0},this['logger'][_0x590d5a(0x116)]('LLM\x20service\x20initialized',{'useServerLLM':this[_0x590d5a(0x163)],'strategy':_0x4ebcb2['llmStrategy']||LLM_CONSTANTS['STRATEGY']['BALANCED']}),this[_0x590d5a(0x199)]()['catch'](_0x5dccbf=>{const _0x496613=_0x590d5a;this[_0x496613(0x114)][_0x496613(0x15b)](_0x496613(0x148),_0x5dccbf);});}async[a0_0x246453(0x199)](){const _0x5f00b6=a0_0x246453;if(this[_0x5f00b6(0x169)])return;this[_0x5f00b6(0x114)][_0x5f00b6(0x116)]('Initializing\x20LLM\x20services\x20(Server\x20mode:\x20'+this[_0x5f00b6(0x163)]+')');try{this['useServerLLM']&&await this[_0x5f00b6(0x126)]();this['_initializeBudgetService']();if(this[_0x5f00b6(0x13e)][_0x5f00b6(0x1ba)]===0x0)throw new Error(_0x5f00b6(0x177));this[_0x5f00b6(0x169)]=!![],this['logger']['info'](_0x5f00b6(0x124)+this[_0x5f00b6(0x13e)]['size']+_0x5f00b6(0x1a2),{'primary':this[_0x5f00b6(0x14f)],'services':Array['from'](this['serviceInstances']['keys']())});}catch(_0x16e879){this[_0x5f00b6(0x114)][_0x5f00b6(0x15b)](_0x5f00b6(0x11f),_0x16e879);if(this[_0x5f00b6(0x169)]===![])this[_0x5f00b6(0x114)]['warn'](_0x5f00b6(0x146));else throw _0x16e879;}}async['_initializeServerService'](){const _0x48c2f8=a0_0x246453;try{this['logger'][_0x48c2f8(0x116)]('Initializing\x20server-based\x20LLM\x20service...'),this[_0x48c2f8(0x139)]=new ServerLLMService(this[_0x48c2f8(0x12a)],this[_0x48c2f8(0x114)]),await this[_0x48c2f8(0x139)][_0x48c2f8(0x199)](),this['serviceInstances'][_0x48c2f8(0x108)](_0x48c2f8(0x17e),this[_0x48c2f8(0x139)]),this[_0x48c2f8(0x10a)]['set'](_0x48c2f8(0x17e),LLM_CONSTANTS[_0x48c2f8(0x12c)][_0x48c2f8(0x19b)]),this['primaryService']='server';const _0x28caa3=await this[_0x48c2f8(0x139)][_0x48c2f8(0x109)]()||[];this['logger'][_0x48c2f8(0x116)](_0x48c2f8(0x15c),{'modelsAvailable':this['serverLLMService']['getAvailableModels']()[_0x48c2f8(0x165)]});}catch(_0x51bb93){this['logger'][_0x48c2f8(0x15b)]('Failed\x20to\x20initialize\x20server\x20LLM\x20service:',_0x51bb93),this[_0x48c2f8(0x163)]=![],this[_0x48c2f8(0x14f)]=null,this['serverLLMService']=null,this['logger']['warn']('Falling\x20back\x20to\x20local\x20LLM\x20services');}}['_initializeBudgetService'](){const _0x222cc4=a0_0x246453;this[_0x222cc4(0x13a)]=new BudgetService(this['config'],this[_0x222cc4(0x114)],this['serverLLMService']),this['logger'][_0x222cc4(0x116)]('Budget\x20service\x20initialized\x20with\x20dynamic\x20pricing\x20support');}async[a0_0x246453(0x12d)](){!this['isInitialized']&&await this['initialize']();}async[a0_0x246453(0x109)](){const _0x26c2cc=a0_0x246453;await this['ensureInitialized']();const _0x2ba174=[];if(this[_0x26c2cc(0x139)]&&this[_0x26c2cc(0x169)])try{let _0x16b9d1=await this['serverLLMService']['getAvailableModels']();_0x2ba174['push'](..._0x16b9d1);}catch(_0x3f9fb5){this['logger'][_0x26c2cc(0x180)]('Failed to get models from server service:',_0x3f9fb5);}return _0x2ba174;}async[a0_0x246453(0x1b6)](){const _0x11b63e=a0_0x246453;return this['budgetService']?await this[_0x11b63e(0x13a)][_0x11b63e(0x135)]():new Map();}async[a0_0x246453(0x1b0)](_0x10459b,_0x4c5901,_0x237c44){const _0x1ff9a6=a0_0x246453;await this[_0x1ff9a6(0x12d)](),this['logger'][_0x1ff9a6(0x116)]('Registering\x20conversation:\x20'+_0x10459b);const _0x48ed27=this[_0x1ff9a6(0x11d)](_0x10459b);if(!_0x48ed27){const _0x239ab5={'useServerLLM':this[_0x1ff9a6(0x163)],'serviceInstancesCount':this[_0x1ff9a6(0x13e)][_0x1ff9a6(0x1ba)],'serviceInstances':Array['from'](this['serviceInstances']['keys']()),'serviceStatusCount':this['serviceStatus']['size'],'serviceStatus':Object[_0x1ff9a6(0xff)](this[_0x1ff9a6(0x10a)][_0x1ff9a6(0x16e)]()),'isInitialized':this[_0x1ff9a6(0x169)]};this[_0x1ff9a6(0x114)][_0x1ff9a6(0x15b)](_0x1ff9a6(0x168),_0x239ab5);throw new Error('No\x20suitable\x20LLM\x20service\x20available\x20for\x20this\x20conversation.\x20Debug:\x20'+JSON['stringify'](_0x239ab5));}const _0x5e163d=this['serviceInstances']['get'](_0x48ed27);try{await _0x5e163d[_0x1ff9a6(0x1b0)](_0x10459b,_0x4c5901,_0x237c44),this[_0x1ff9a6(0x141)][_0x1ff9a6(0x108)](_0x10459b,_0x48ed27),this['logger']['info']('Registered\x20conversation\x20'+_0x10459b+'\x20with\x20service\x20'+_0x48ed27);}catch(_0x5e4d07){this['logger']['error']('Failed\x20to\x20register\x20conversation\x20'+_0x10459b+':',_0x5e4d07);const _0x4afedb=this['_selectFallbackService'](_0x48ed27);if(_0x4afedb){const _0x25d650=this[_0x1ff9a6(0x13e)][_0x1ff9a6(0x16a)](_0x4afedb);await _0x25d650[_0x1ff9a6(0x1b0)](_0x10459b,_0x4c5901,_0x237c44),this[_0x1ff9a6(0x141)]['set'](_0x10459b,_0x4afedb),this[_0x1ff9a6(0x114)]['info']('Registered\x20conversation\x20'+_0x10459b+_0x1ff9a6(0x183)+_0x4afedb);}else throw new Error('Failed\x20to\x20register\x20conversation\x20'+_0x10459b+'\x20with\x20any\x20service');}}async['sendMessage'](_0x5f5b99,_0x2842bc,_0x4c3be5){const _0x53f090=a0_0x246453,_0x5473c4=Date['now']();this['performanceMetrics'][_0x53f090(0x134)]++;try{const _0x3c86a5=this['conversationServices']['get'](_0x5f5b99);if(!_0x3c86a5)throw new Error(_0x53f090(0x119)+_0x5f5b99+_0x53f090(0x136));const _0x1ef38a=this['serviceInstances'][_0x53f090(0x16a)](_0x3c86a5);if(!_0x1ef38a)throw new Error(_0x53f090(0x144)+_0x3c86a5+'\x20not\x20found\x20for\x20conversation\x20'+_0x5f5b99);const _0x21ac93=this[_0x53f090(0x151)](_0x3c86a5);await this['rateLimitService']['waitIfNeeded'](_0x21ac93);const _0x451677=await this['_sendMessageWithRetry'](_0x1ef38a,_0x3c86a5,_0x5f5b99,_0x2842bc,_0x4c3be5);return await this[_0x53f090(0x15a)](_0x1ef38a,_0x3c86a5,_0x5473c4,!![]),_0x451677;}catch(_0x58b8c3){this[_0x53f090(0x19a)][_0x53f090(0xfb)]++,this['logger'][_0x53f090(0x15b)]('Send\x20message\x20failed\x20for\x20conversation\x20'+_0x5f5b99+':',_0x58b8c3);throw _0x58b8c3;}}async[a0_0x246453(0x1a1)](_0x5f54bd,_0x5e2c08,_0x14c5fe,_0xb53c9,_0x758ea8){const _0x863b70=a0_0x246453,_0x25136e=this['config']['retries']?.[_0x863b70(0x107)]||LLM_CONSTANTS[_0x863b70(0x1ae)],_0x2c5535=this['config'][_0x863b70(0x121)]?.[_0x863b70(0x179)]||0x5,_0x444690=this[_0x863b70(0x12a)][_0x863b70(0x121)]?.[_0x863b70(0x17d)]||0x7d0;let _0x5911ba=0x0,_0x224340=0x0,_0x1960dd=null;while(_0x5911ba<=_0x25136e){try{const _0x2f9788=await _0x5f54bd['sendMessage'](_0x14c5fe,_0xb53c9,_0x758ea8);if(_0x5e2c08!==_0x863b70(0x17e)){const _0x228210=this['_getServiceModelId'](_0x5e2c08);this[_0x863b70(0x198)][_0x863b70(0x15f)](_0x228210);}return this['serviceStatus'][_0x863b70(0x16a)](_0x5e2c08)===LLM_CONSTANTS[_0x863b70(0x12c)]['DEGRADED']&&this['serviceStatus'][_0x863b70(0x108)](_0x5e2c08,LLM_CONSTANTS[_0x863b70(0x12c)][_0x863b70(0x19b)]),_0x2f9788;}catch(_0x59f100){_0x1960dd=_0x59f100,this[_0x863b70(0x114)][_0x863b70(0x15b)]('Request\x20failed\x20(attempt\x20'+(_0x5911ba+0x1)+'/'+(_0x25136e+0x1)+'):',_0x59f100);if(this['_isPromptTooLongError'](_0x59f100)){await this[_0x863b70(0x160)](_0x14c5fe);const _0x454d2e=this[_0x863b70(0x151)](_0x5e2c08);this[_0x863b70(0x114)]['info']('Adding\x20'+_0x444690+'ms\x20delay\x20after\x20compactization'),await this['_delay'](_0x444690),await this['rateLimitService']['waitIfNeeded'](_0x454d2e);continue;}if(this[_0x863b70(0x15e)](_0x59f100)){await this['_handleRequestTooLargeError'](_0x14c5fe);const _0x2e4fd1=this[_0x863b70(0x151)](_0x5e2c08);this['logger'][_0x863b70(0x116)](_0x863b70(0x13d)+_0x444690+'ms\x20delay\x20after\x20emergency\x20compactization'),await this[_0x863b70(0x1a8)](_0x444690),await this[_0x863b70(0x198)][_0x863b70(0x106)](_0x2e4fd1);continue;}if(_0x5e2c08!==_0x863b70(0x17e)&&this['_isRateLimitError'](_0x59f100)){const _0x271175=this[_0x863b70(0x151)](_0x5e2c08);_0x224340++;if(_0x224340>_0x2c5535)throw new Error(_0x863b70(0x1a9)+_0x2c5535+_0x863b70(0x159)+_0x59f100[_0x863b70(0x16f)]);this['rateLimitService']['handleRateLimitHit'](_0x271175);if(_0x5911ba<_0x25136e){this['logger'][_0x863b70(0x116)]('Rate\x20limit\x20error\x20detected,\x20waiting\x20and\x20retrying...\x20(rate\x20limit\x20attempt\x20'+_0x224340+'/'+_0x2c5535+')'),await this[_0x863b70(0x198)]['waitIfNeeded'](_0x271175);continue;}}if(_0x5e2c08===_0x863b70(0x17e)&&this[_0x863b70(0x14b)](_0x59f100)){const _0x177ccb=await this[_0x863b70(0x156)](_0x14c5fe,_0xb53c9,_0x758ea8);if(_0x177ccb)return _0x177ccb;}if(this['_isNonRetryableError'](_0x59f100))break;if(_0x5911ba>=_0x25136e)break;this[_0x863b70(0x10a)][_0x863b70(0x108)](_0x5e2c08,LLM_CONSTANTS['SERVICE_STATUS'][_0x863b70(0x172)]);const _0x9c5d27=this[_0x863b70(0x17b)](_0x5911ba);await this[_0x863b70(0x1a8)](_0x9c5d27),_0x5911ba++;}}throw new Error(_0x863b70(0x10b)+(_0x1960dd?.['message']||'Unknown\x20error'));}async['_tryFallbackService'](_0x1e348d,_0x2a1a44,_0x34063d){const _0x3a9835=a0_0x246453,_0x28578c=this['_selectFallbackService'](_0x3a9835(0x17e));if(!_0x28578c)return null;try{this[_0x3a9835(0x114)]['info'](_0x3a9835(0x190)+_0x28578c);const _0x59d53b=this['serviceInstances']['get'](_0x28578c);return await _0x59d53b['registerConversation'](_0x1e348d,_0x34063d[_0x3a9835(0x138)]||_0x3a9835(0x125)),this[_0x3a9835(0x141)]['set'](_0x1e348d,_0x28578c),await _0x59d53b['sendMessage'](_0x1e348d,_0x2a1a44,_0x34063d);}catch(_0x3acac5){return this['logger'][_0x3a9835(0x15b)](_0x3a9835(0x120)+_0x3acac5[_0x3a9835(0x16f)]),null;}}async['_recordUsageAndMetrics'](_0x1f9dbe,_0x36f5e0,_0x262188,_0x188e44){const _0x3d7416=a0_0x246453,_0x26038c=Date['now']()-_0x262188;this['performanceMetrics']['totalLatency']+=_0x26038c,this[_0x3d7416(0x19a)][_0x3d7416(0x11e)]=this['performanceMetrics'][_0x3d7416(0x11c)]/this['performanceMetrics']['totalRequests'];_0x188e44&&this[_0x3d7416(0x19a)]['successfulRequests']++;if(this[_0x3d7416(0x13a)]&&_0x36f5e0!==_0x3d7416(0x17e))try{const _0x43cc8b=_0x1f9dbe[_0x3d7416(0x176)](),_0x47d805=_0x1f9dbe['getLastOutputTokenCount'](),_0x361180=this['_getDefaultModelForService'](_0x36f5e0);await this['budgetService']['recordUsage'](_0x36f5e0,_0x361180,_0x43cc8b,_0x47d805);}catch(_0x58648b){this[_0x3d7416(0x114)][_0x3d7416(0x180)](_0x3d7416(0x111),_0x58648b);}}async['_handlePromptTooLongError'](_0x2d6d47){const _0x1449b7=a0_0x246453;this[_0x1449b7(0x114)][_0x1449b7(0x180)](_0x1449b7(0x10d));if(this[_0x1449b7(0x129)])try{await this['onPromptTooLong'](_0x2d6d47),this['logger']['info']('Compactization\x20completed,\x20retrying\x20request');}catch(_0x33f1c3){this[_0x1449b7(0x114)][_0x1449b7(0x15b)](_0x1449b7(0x162),_0x33f1c3);throw _0x33f1c3;}else throw new Error(_0x1449b7(0x12b));}async[a0_0x246453(0x1a5)](_0x5e02b5,_0x488cc0){const _0x20a621=a0_0x246453;this['logger'][_0x20a621(0x116)]('Updating\x20conversation:\x20'+_0x5e02b5);const _0x38c0aa=this['conversationServices']['get'](_0x5e02b5);if(!_0x38c0aa)throw new Error('Conversation\x20'+_0x5e02b5+_0x20a621(0x136));const _0x439aa0=this[_0x20a621(0x13e)][_0x20a621(0x16a)](_0x38c0aa);if(!_0x439aa0)throw new Error('Service\x20'+_0x38c0aa+'\x20not\x20found\x20for\x20conversation\x20'+_0x5e02b5);try{await _0x439aa0['updateConversation'](_0x5e02b5,_0x488cc0);}catch(_0x227031){this['logger']['error'](_0x20a621(0xfe)+_0x5e02b5+':',_0x227031);throw _0x227031;}}async[a0_0x246453(0x145)](_0x3c8d2e,_0x4c1b4b){const _0x51f9a2=a0_0x246453;this['logger']['info'](_0x51f9a2(0x188)+_0x3c8d2e);const _0x57fb2b=this[_0x51f9a2(0x141)]['get'](_0x3c8d2e);if(!_0x57fb2b)throw new Error('Cannot\x20get\x20summary:\x20conversation\x20'+_0x3c8d2e+'\x20not\x20registered\x20with\x20any\x20service');const _0x54a177=this['serviceInstances'][_0x51f9a2(0x16a)](_0x57fb2b);if(!_0x54a177)throw new Error('Cannot\x20get\x20summary:\x20service\x20'+_0x57fb2b+'\x20not\x20available');this[_0x51f9a2(0x114)][_0x51f9a2(0x116)]('Using\x20same\x20service\x20for\x20summary:\x20'+_0x57fb2b);try{const _0x1546a1=await _0x54a177['getSummary'](_0x4c1b4b,_0x3c8d2e);if(this[_0x51f9a2(0x13a)]&&_0x57fb2b!=='server'){const _0x57b3fa=this[_0x51f9a2(0x13c)](_0x57fb2b);await this[_0x51f9a2(0x13a)]['recordUsage'](_0x57fb2b,_0x57b3fa,_0x54a177['getLastInputTokenCount'](),_0x54a177[_0x51f9a2(0x13f)]());}return _0x1546a1;}catch(_0x140a3f){this[_0x51f9a2(0x114)][_0x51f9a2(0x15b)](_0x51f9a2(0x171)+_0x57fb2b+':',_0x140a3f);throw _0x140a3f;}}async['getImageDescription'](_0x3c93b4,_0x233939,_0x2f4b0c={}){const _0x2aba46=a0_0x246453;this['logger']['info'](_0x2aba46(0x12f));if(this[_0x2aba46(0x163)]&&this['serviceInstances'][_0x2aba46(0x164)]('server'))try{const _0x28969c=this[_0x2aba46(0x13e)]['get'](_0x2aba46(0x17e));return await _0x28969c['getImageDescription'](_0x3c93b4,_0x233939,_0x2f4b0c);}catch(_0x4f273e){this['logger']['warn']('Server\x20vision\x20service\x20failed,\x20trying\x20fallback:',_0x4f273e);}const _0x153785=this[_0x2aba46(0x154)]();if(!_0x153785)throw new Error(_0x2aba46(0x1b5));const _0x395e27=this[_0x2aba46(0x13e)]['get'](_0x153785),_0xd2a591=this[_0x2aba46(0x151)](_0x153785);await this['rateLimitService']['waitIfNeeded'](_0xd2a591);const _0x40713c=this['config'][_0x2aba46(0x121)]?.['maxRetries']||LLM_CONSTANTS['DEFAULT_MAX_RETRIES'];let _0x4a1683=0x0,_0x3c2560=null;while(_0x4a1683<=_0x40713c){try{const _0x57ac39=await _0x395e27[_0x2aba46(0x1a3)](_0x3c93b4,_0x233939,_0x2f4b0c);this['rateLimitService']['resetRateLimitHits'](_0xd2a591);if(this[_0x2aba46(0x13a)]){const _0x24adb8=this[_0x2aba46(0x13c)](_0x153785);await this['budgetService']['recordUsage'](_0x153785,_0x24adb8,_0x395e27['getLastInputTokenCount'](),_0x395e27[_0x2aba46(0x13f)]());}return _0x57ac39;}catch(_0x458d96){_0x3c2560=_0x458d96,this['logger'][_0x2aba46(0x15b)](_0x2aba46(0x103)+(_0x4a1683+0x1)+'/'+(_0x40713c+0x1)+'):',_0x458d96);if(this[_0x2aba46(0x17c)](_0x458d96)){this[_0x2aba46(0x198)][_0x2aba46(0x115)](_0xd2a591);if(_0x4a1683<_0x40713c){await this['rateLimitService']['waitIfNeeded'](_0xd2a591);continue;}}if(this['_isNonRetryableError'](_0x458d96))throw _0x458d96;if(_0x4a1683>=_0x40713c)break;const _0x496d5c=this[_0x2aba46(0x17b)](_0x4a1683);await this[_0x2aba46(0x1a8)](_0x496d5c),_0x4a1683++;}}throw new Error(_0x2aba46(0x1a4)+(_0x3c2560?.['message']||_0x2aba46(0x137)));}async['estimateTokenCount'](_0x3ef760){const _0xb4f5ba=a0_0x246453,_0x25119f=this['conversationServices']['get'](_0x3ef760);if(!_0x25119f)throw new Error(_0xb4f5ba(0x119)+_0x3ef760+'\x20is\x20not\x20registered\x20with\x20any\x20service');const _0x42a5b9=this[_0xb4f5ba(0x13e)]['get'](_0x25119f);if(!_0x42a5b9)throw new Error(_0xb4f5ba(0x144)+_0x25119f+_0xb4f5ba(0x197)+_0x3ef760);try{return await _0x42a5b9['estimateTokenCount'](_0x3ef760);}catch(_0x3f8b2d){return this[_0xb4f5ba(0x114)]['error']('Failed\x20to\x20estimate\x20token\x20count\x20for\x20conversation\x20'+_0x3ef760+':',_0x3f8b2d),0x0;}}[a0_0x246453(0x174)](_0x18f088,_0x2c0758,_0x21626c){const _0x43b17a=a0_0x246453;if(!this['budgetService'])return null;return this[_0x43b17a(0x13a)]['getCostEstimate'](_0x18f088,_0x2c0758,_0x21626c);}[a0_0x246453(0x10f)](_0x420850,_0xe711,_0x321b6d){const _0x2b4f46=a0_0x246453;if(!this[_0x2b4f46(0x13a)])return null;return this['budgetService'][_0x2b4f46(0x10f)](_0x420850,_0xe711,_0x321b6d);}async[a0_0x246453(0x181)](){const _0x3f46d6=a0_0x246453;if(!this['budgetService'])return null;return await this['budgetService'][_0x3f46d6(0x181)]();}async['setBudgetLimit'](_0x16482f){const _0x283489=a0_0x246453;if(!this[_0x283489(0x13a)])throw new Error(_0x283489(0x1b1));await this['budgetService'][_0x283489(0x18b)](_0x16482f);}async[a0_0x246453(0x128)](){if(!this['budgetService'])return![];return await this['budgetService']['updatePricingFromServer']();}[a0_0x246453(0x192)](){const _0x347810=a0_0x246453,_0x5e104e={};for(const [_0x5600ea,_0x23698d]of this[_0x347810(0x10a)]['entries']()){_0x5e104e[_0x5600ea]={'status':_0x23698d,'available':_0x23698d!==LLM_CONSTANTS[_0x347810(0x12c)]['UNAVAILABLE'],'isPrimary':_0x5600ea===this[_0x347810(0x14f)]};}return _0x5e104e;}['getPerformanceMetrics'](){const _0x47fd5b=a0_0x246453;return{...this['performanceMetrics'],'successRate':this[_0x47fd5b(0x19a)][_0x47fd5b(0x134)]>0x0?this[_0x47fd5b(0x19a)][_0x47fd5b(0x182)]/this['performanceMetrics'][_0x47fd5b(0x134)]*0x64:0x0};}[a0_0x246453(0x142)](){const _0x202cad=a0_0x246453;return this[_0x202cad(0x198)][_0x202cad(0x132)]();}[a0_0x246453(0x189)](_0x330e03){const _0x7ab664=a0_0x246453;this['onPromptTooLong']=_0x330e03,this[_0x7ab664(0x114)][_0x7ab664(0x116)](_0x7ab664(0x1b3));}async[a0_0x246453(0x155)](){const _0x5dfee0=a0_0x246453,_0x1f2876={'overall':'healthy','services':{},'budget':null,'performance':this[_0x5dfee0(0x18e)](),'pricing':{'available':![],'modelsWithPricing':0x0,'lastUpdate':null}};for(const [_0x2f5038,_0x3086db]of this[_0x5dfee0(0x10a)][_0x5dfee0(0x16e)]()){_0x1f2876['services'][_0x2f5038]={'status':_0x3086db,'available':_0x3086db!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']},_0x3086db===LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']&&(_0x1f2876['overall']='degraded');}if(this['serverLLMService'])try{const _0x5b9c35=await this[_0x5dfee0(0x139)]['getServerHealth']();_0x1f2876['services']['server'][_0x5dfee0(0x1b8)]=_0x5b9c35,_0x5b9c35[_0x5dfee0(0x193)]!==_0x5dfee0(0x1b2)&&(_0x1f2876[_0x5dfee0(0x18f)]='degraded');}catch(_0xa36890){_0x1f2876[_0x5dfee0(0x196)]['server']['serverHealth']={'status':_0x5dfee0(0x15b),'error':_0xa36890['message']},_0x1f2876[_0x5dfee0(0x18f)]=_0x5dfee0(0x15d);}if(this[_0x5dfee0(0x13a)])try{_0x1f2876['budget']=await this[_0x5dfee0(0x13a)][_0x5dfee0(0x19c)](),_0x1f2876[_0x5dfee0(0x18c)][_0x5dfee0(0x193)]!=='healthy'&&(_0x1f2876['overall']='degraded');}catch(_0x345546){_0x1f2876['budget']={'status':_0x5dfee0(0x15b),'error':_0x345546['message']},_0x1f2876['overall']=_0x5dfee0(0x15d);}if(this[_0x5dfee0(0x13a)]){const _0x410ea8=this[_0x5dfee0(0x13a)]['getPricingInfo']();_0x1f2876[_0x5dfee0(0x100)]={'available':_0x410ea8[_0x5dfee0(0x166)]>0x0,'modelsWithPricing':_0x410ea8['totalModels'],'lastUpdate':_0x410ea8['lastUpdate'],'source':_0x410ea8['source']};}return _0x1f2876;}async[a0_0x246453(0x1b4)](){const _0x3ea8af=a0_0x246453;this[_0x3ea8af(0x114)]['info']('Shutting\x20down\x20LLM\x20service');const _0x1afa1b=[];for(const [_0x544994,_0x5dc470]of this[_0x3ea8af(0x13e)]['entries']()){typeof _0x5dc470[_0x3ea8af(0x1b4)]==='function'&&(this[_0x3ea8af(0x114)][_0x3ea8af(0x116)](_0x3ea8af(0x14a)+_0x544994),_0x1afa1b['push'](_0x5dc470[_0x3ea8af(0x1b4)]()[_0x3ea8af(0x149)](_0x33ba86=>{const _0x325367=_0x3ea8af;this[_0x325367(0x114)]['error'](_0x325367(0x102)+_0x544994+':',_0x33ba86);})));}this['budgetService']&&typeof this['budgetService'][_0x3ea8af(0x1b4)]==='function'&&_0x1afa1b['push'](this['budgetService']['shutdown']()['catch'](_0x336fe0=>{const _0xfa76f8=_0x3ea8af;this[_0xfa76f8(0x114)]['error']('Error\x20shutting\x20down\x20budget\x20service:',_0x336fe0);})),await Promise[_0x3ea8af(0x170)](_0x1afa1b),this['serviceInstances']['clear'](),this['conversationServices']['clear'](),this[_0x3ea8af(0x10a)]['clear'](),this['logger']['info']('All\x20LLM\x20services\x20shut\x20down');}['_selectServiceForConversation'](_0x145022,_0x586a02=[]){const _0x223850=a0_0x246453;if(this[_0x223850(0x163)]&&this['serviceInstances'][_0x223850(0x164)](_0x223850(0x17e))&&!_0x586a02[_0x223850(0x112)]('server')&&this['serviceStatus'][_0x223850(0x16a)](_0x223850(0x17e))===LLM_CONSTANTS['SERVICE_STATUS'][_0x223850(0x19b)])return'server';return this['_selectAvailableService'](_0x586a02);}[a0_0x246453(0x11b)](_0x5a544b=[]){const _0x2bfcd2=a0_0x246453,_0x1b1d66=Array[_0x2bfcd2(0x18a)](this['serviceInstances'][_0x2bfcd2(0x152)]())['filter'](_0x3ab805=>!_0x5a544b['includes'](_0x3ab805)&&this[_0x2bfcd2(0x10a)][_0x2bfcd2(0x16a)](_0x3ab805)!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']);if(_0x1b1d66[_0x2bfcd2(0x165)]===0x0)return null;const _0x14234b=this['config']['llmStrategy']||LLM_CONSTANTS['STRATEGY']['BALANCED'];switch(_0x14234b){case LLM_CONSTANTS[_0x2bfcd2(0x117)][_0x2bfcd2(0x184)]:return this['_selectFastestService'](_0x1b1d66);case LLM_CONSTANTS['STRATEGY'][_0x2bfcd2(0x122)]:return this[_0x2bfcd2(0x133)](_0x1b1d66);case LLM_CONSTANTS['STRATEGY']['CONTEXT']:return this[_0x2bfcd2(0x12e)](_0x1b1d66);case LLM_CONSTANTS['STRATEGY']['BALANCED']:default:return this[_0x2bfcd2(0x147)](_0x1b1d66);}}[a0_0x246453(0x143)](_0x2378df){const _0x44e38f=a0_0x246453,_0x515381=Array['from'](this['serviceInstances'][_0x44e38f(0x152)]())[_0x44e38f(0x175)](_0x200e6b=>_0x200e6b!==_0x2378df&&this[_0x44e38f(0x10a)]['get'](_0x200e6b)!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']);if(_0x515381['length']===0x0)return null;if(_0x2378df!=='anthropic'&&_0x515381[_0x44e38f(0x112)](_0x44e38f(0x123)))return'anthropic';return _0x515381[0x0];}[a0_0x246453(0x154)](_0x1f37b1=[]){const _0x5532b3=a0_0x246453,_0x262b20=[_0x5532b3(0x123),'openai','google'],_0x509bd0=_0x262b20[_0x5532b3(0x175)](_0x122d72=>!_0x1f37b1['includes'](_0x122d72)&&this['serviceInstances'][_0x5532b3(0x164)](_0x122d72)&&this['serviceStatus']['get'](_0x122d72)!==LLM_CONSTANTS[_0x5532b3(0x12c)]['UNAVAILABLE']);if(_0x509bd0['length']===0x0)return null;const _0x339006=[_0x5532b3(0x123),_0x5532b3(0x10e),'google'];for(const _0x49cf14 of _0x339006){if(_0x509bd0['includes'](_0x49cf14))return _0x49cf14;}return _0x509bd0[0x0];}['_selectFastestService'](_0x5587fe){const _0x7e319=a0_0x246453;return this[_0x7e319(0x191)](_0x5587fe,LLM_CONSTANTS[_0x7e319(0x158)][_0x7e319(0x184)]);}[a0_0x246453(0x133)](_0x23a489){const _0x2ac6bb=a0_0x246453;return this['_selectServiceByPreferenceOrder'](_0x23a489,LLM_CONSTANTS[_0x2ac6bb(0x158)][_0x2ac6bb(0x122)]);}['_selectLargestContextService'](_0x54d4f9){const _0x4b1195=a0_0x246453;let _0xa19b30=null,_0x3c27d6=0x0;for(const _0x599fef of _0x54d4f9){const _0x5557d5=this['serviceInstances']['get'](_0x599fef);if(!_0x5557d5||typeof _0x5557d5[_0x4b1195(0x178)]!==_0x4b1195(0x187))continue;const _0x59be08=_0x5557d5['getMaxContextSize']();_0x59be08>_0x3c27d6&&(_0x3c27d6=_0x59be08,_0xa19b30=_0x599fef);}return _0xa19b30||_0x54d4f9[0x0];}[a0_0x246453(0x147)](_0x409b01){const _0x1ea15b=a0_0x246453;return this[_0x1ea15b(0x191)](_0x409b01,LLM_CONSTANTS[_0x1ea15b(0x158)]['BALANCED']);}['_selectServiceByPreferenceOrder'](_0x2b867b,_0x18d111){const _0x5bd7f7=a0_0x246453,_0x388a64={'anthropic':[_0x5bd7f7(0x1bb),_0x5bd7f7(0x1a7),'anthropic-haiku'],'openai':['azure-openai-gpt4',_0x5bd7f7(0x153)],'google':[_0x5bd7f7(0xfd)],'server':[]};for(const _0x241972 of _0x18d111){for(const _0xfbc82 of _0x2b867b){if(_0xfbc82==='server')return _0xfbc82;const _0x50c04e=_0x388a64[_0xfbc82]||[];if(_0x50c04e[_0x5bd7f7(0x112)](_0x241972))return _0xfbc82;}}return _0x2b867b[0x0];}['_getServiceModelId'](_0x5425d5){const _0x1ee9f5=a0_0x246453,_0x599d01={'anthropic':'anthropic-sonnet','openai':_0x1ee9f5(0xfc),'google':'google-gemini','server':_0x1ee9f5(0x16c)};return _0x599d01[_0x5425d5]||_0x5425d5;}[a0_0x246453(0x13c)](_0x276067){return this['_getServiceModelId'](_0x276067);}[a0_0x246453(0x17b)](_0x5c0198){const _0x2917fd=a0_0x246453,_0x40a1d3=this[_0x2917fd(0x12a)][_0x2917fd(0x121)]?.[_0x2917fd(0x1b9)]||LLM_CONSTANTS[_0x2917fd(0x13b)],_0x5da877=this['config']['retries']?.['delayMultiplier']||LLM_CONSTANTS['DEFAULT_RETRY_MULTIPLIER'];return _0x40a1d3*Math[_0x2917fd(0x157)](_0x5da877,_0x5c0198);}['_delay'](_0x1eaf00){return new Promise(_0x9b82bd=>setTimeout(_0x9b82bd,_0x1eaf00));}[a0_0x246453(0x17c)](_0x553445){const _0x42d0fc=a0_0x246453,_0x1953c8=['rate\x20limit',_0x42d0fc(0x161),'quota\x20exceeded',_0x42d0fc(0x195),'429',_0x42d0fc(0x17a)],_0x59dc53=_0x553445[_0x42d0fc(0x16f)]?.['toLowerCase']()||'';return _0x1953c8['some'](_0x22ced9=>_0x59dc53[_0x42d0fc(0x112)](_0x22ced9));}['_isNonRetryableError'](_0x47c74a){const _0x976f76=a0_0x246453,_0x3975f5=[_0x976f76(0x14e),_0x976f76(0x11a),_0x976f76(0x19f),'model\x20not\x20found',_0x976f76(0x19d),_0x976f76(0x110)],_0x232bec=_0x47c74a[_0x976f76(0x16f)]?.['toLowerCase']()||'';return _0x3975f5[_0x976f76(0x118)](_0x11f4c7=>_0x232bec['includes'](_0x11f4c7));}[a0_0x246453(0x104)](_0xf6a09a){const _0x3f58d6=a0_0x246453,_0x4a2542=_0xf6a09a[_0x3f58d6(0x16f)]?.[_0x3f58d6(0x10c)]()||'',_0x30d385=_0xf6a09a['toString']?.()?.[_0x3f58d6(0x10c)]()||'';return(_0x4a2542['includes'](_0x3f58d6(0x18d))||_0x30d385[_0x3f58d6(0x112)](_0x3f58d6(0x18d)))&&(_0xf6a09a[_0x3f58d6(0x193)]===0x190||_0x4a2542['includes']('400')||_0x30d385[_0x3f58d6(0x112)]('400'));}[a0_0x246453(0x15e)](_0x126404){const _0x192bad=a0_0x246453,_0x221217=_0x126404[_0x192bad(0x16f)]?.['toLowerCase']()||'',_0x550fcc=_0x126404['status']||_0x126404['originalError']?.[_0x192bad(0x193)];return _0x550fcc===0x19d||_0x221217[_0x192bad(0x112)](_0x192bad(0x131))||_0x221217[_0x192bad(0x112)](_0x192bad(0x1af))||_0x221217[_0x192bad(0x112)](_0x192bad(0x1ac));}async[a0_0x246453(0x1ad)](_0x4bc50a){const _0x1c0a47=a0_0x246453;this['logger']['warn']('🚨\x20Request\x20too\x20large\x20detected\x20for\x20'+_0x4bc50a+'\x20-\x20performing\x20emergency\x20compactization');if(this['onPromptTooLong'])try{await this[_0x1c0a47(0x129)](_0x4bc50a),this[_0x1c0a47(0x114)][_0x1c0a47(0x116)]('✅\x20Emergency\x20compactization\x20completed\x20for\x20'+_0x4bc50a);}catch(_0xaec930){this[_0x1c0a47(0x114)]['error']('Emergency\x20compactization\x20failed:',_0xaec930);throw _0xaec930;}else throw new Error('Request\x20too\x20large\x20and\x20no\x20compactization\x20handler\x20available');}['_isServerError'](_0x58f959){const _0x62569e=a0_0x246453,_0x460649=[_0x62569e(0x130),'403',_0x62569e(0x16d),_0x62569e(0x1aa),_0x62569e(0x113),'504',_0x62569e(0x17f),'connection\x20refused','network',_0x62569e(0x186),'service\x20unavailable'],_0x5d8172=_0x58f959['message']?.[_0x62569e(0x10c)]()||'';return _0x460649[_0x62569e(0x118)](_0x52c10c=>_0x5d8172[_0x62569e(0x112)](_0x52c10c));}}export{LLM_CONSTANTS};