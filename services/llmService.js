function a0_0x4f2f(){const _0x7e8e9c=['yxP1CMuTB3bLBMfPlwDWDdq','mZqXnJfIAxbwAwu','CMf0zuXPBwL0u2vYDMLJzq','DxbKyxrLq29UDMvYC2f0Aw9U','ig5VDcbHDMfPBgfIBgu','rMfPBgvKihrVigLUAxrPywXPEMuGteXnihnLCNzPy2vZigLUignVBNn0CNvJDg9YoG','uhjVBxb0ihrVBYbSB25NigvYCM9YigrLDgvJDgvKic0GCMvXDwvZDgLUzYbJB21Wywn0AxPHDgLVBG','CgvYzM9YBwfUy2vnzxrYAwnZ','Aw5JBhvKzxm','rMfPBgvKihrVihvWzgf0zsbJB252zxjZyxrPB24G','z2v0qNvKz2v0vxnHz2u','Aw52ywXPzcbYzxf1zxn0igzVCM1HDa','vu5bvKfjtefcteu','C2vUze1LC3nHz2u','rMfPBgvKihrVigLUAxrPywXPEMuGteXnihnLCNzPy2vZoG','uMvXDwvZDcbMywLSzwqGkgf0DgvTChqG','8j+AQcbszxf1zxn0ihrVBYbSyxjNzsbKzxrLy3rLzcbMB3iG','sw1Hz2uGz2vUzxjHDgLVBIbYzxf1AxjLCYbZzxj2zxiGC2vYDMLJzs4GugXLyxnLignOzwnRihLVDxiGy29UBMvJDgLVBIbHBMqGqvbjigTLEs4','z2v0tgfZDe91Dhb1DfrVA2vUq291BNq','Dg90ywXszxf1zxn0CW','z2v0uhjPy2LUz0rHDge','x3nLBMrnzxnZywDLv2L0AfjLDhj5','x2LZtM9UuMv0CNLHyMXLrxjYB3i','z2vUzxjHDgvjBwfNzq','u0vsvKLdrv9tvefuvvm','B3zLCMfSBa','Dg9mB3DLCKnHC2u','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','Dg9tDhjPBMC','tM8GteXnihnLCNzPy2vZigfYzsbHDMfPBgfIBgu','vw5RBM93BIbLCNjVCG','yMfZzurLBgf5txm','u1bfruq','Cgf5Bg9Hzcb0B28GBgfYz2u','Bg9Nz2vY','z2v0','Aw5MBW','x2LZuMf0zuXPBwL0rxjYB3i','x2nHBgn1Bgf0zvjLDhj5rgvSyxK','x2HHBMrSzvbYB21WDfrVB0XVBMDfCNjVCG','uMf0zsbSAw1PDcbLCNjVCIbKzxrLy3rLzcWGD2fPDgLUzYbHBMqGCMv0CNLPBMCUlI4GkhjHDguGBgLTAxqGyxr0zw1WDca','AgvHBhrOEq','mZe0ntu0nvHtBwDSyG','C2H1DgrVD24','ihDPDgGGzMfSBgjHy2SGC2vYDMLJzsa','qKfmqu5druq','DxbKyxrLuhjPy2LUz0zYB21tzxj2zxi','qvzbsuXbqKXf','su5uruXmsuDftKnf','Dg9VigXVBMC','y2XLyxi','zMfPBgvKuMvXDwvZDhm','z2v0ugvYzM9YBwfUy2vnzxrYAwnZ','Dg90ywXmyxrLBMn5','x2LUAxrPywXPEMvcDwrNzxrtzxj2AwnL','x3nLBgvJDfnLCNzPy2vgB3jdB252zxjZyxrPB24','BgXTu3rYyxrLz3K','uMf0zsbSAw1PDcbYzxrYEsb0AhjLC2HVBgqGzxHJzwvKzwqGka','Bwf4uMf0zuXPBwL0uMv0CMLLCW','u2vYDMvYihzPC2LVBIbZzxj2AwnLigzHAwXLzcWGDhj5Aw5NigzHBgXIywnRoG','y29UDgvUDcbWB2XPy3K','x3nLBgvJDejHBgfUy2vKu2vYDMLJzq','rMfPBgvKihrVigLUAxrPywXPEMuGC2vYDMvYieXmtsbZzxj2AwnLoG','mty0zLvzsvLV','x3jLy29YzfvZywDLqw5Ktwv0CMLJCW','qwrKAw5Nia','z2v0u3vTBwfYEq','rw1LCMDLBMn5ignVBxbHy3rPEMf0Aw9UigzHAwXLzdO','Aw50zwXSAwDLBMnL','zxHJzwvKCYbJB250zxH0ihDPBMrVDW','tu9eruXFufjfrKvsru5drq','zMLSDgvY','AxnjBML0AwfSAxPLza','x3nLBgvJDfnLCNzPy2vcEvbYzwzLCMvUy2vpCMrLCG','CMvXDwvZDcb0B28GBgfYz2u','n3L3AM5ctW','rMfPBgvKihrVihjLz2LZDgvYignVBNzLCNnHDgLVBIa','x3nLBgvJDef2ywLSywjSzvnLCNzPy2u','z2v0sgvHBhrOu3rHDhvZ','yxP1CMuTywKTz3jVAZm','mZG5ntfxtgLyzvy','C2vYDMvYigvYCM9Y','C2vYDMLJzxm','Bwf4uMv0CMLLCW','x3nLBgvJDfnTyxj0zxn0u2vYDMLJzq','u1rsqvrfr1K','z2v0uhjPy2LUz0LUzM8','B25qCM9TChruB29mB25N','4PYfievTzxjNzw5JEsbJB21Wywn0AxPHDgLVBIbJB21WBgv0zwqGzM9Yia','yw50AhjVCgLJ','yxzHAwXHyMXL','rMfSBgjHy2SGC2vYDMLJzsbHBhnVigzHAwXLzdOG','yw50AhjVCgLJlwHHAwT1','tM8GDMLZAw9UlwnHCgfIBguGC2vYDMLJzxmGyxzHAwXHyMXL','x2LZu2vYDMvYrxjYB3i','ChvZAa','yw50AhjVCgLJlxnVBM5LDa','sw5PDgLHBgL6Aw5NihnLCNzLCI1IyxnLzcbmte0GC2vYDMLJzs4UlG','ChjPBwfYEvnLCNzPy2u','z2v0qxzHAwXHyMXLtw9KzwXZ','x3nLBgvJDezHBgXIywnRu2vYDMLJzq','uhjVBxb0ihrVBYbSB25NigfUzcbUBYbJB21Wywn0AxPHDgLVBIbOyw5KBgvYigf2ywLSywjSzq','x2rLBgf5','r2v0DgLUzYbZDw1Tyxj5igzVCIbJB252zxjZyxrPB246ia','ChjPy2LUzW','C2vYDMvYteXnu2vYDMLJzq','AgvHBhrOq2HLy2S','DxnHz2u','z29Vz2XLlwDLBwLUAq','CMvXDwvZDcbLBNrPDhKGDg9VigXHCMDL','C291CMnL','zw5ZDxjLsw5PDgLHBgL6zwq','C2v0qNvKz2v0tgLTAxq','mJq5mfDlz3ztuG','zNvUy3rPB24','ChjVBxb0x3rVB19SB25N','B3bLBMfP','x3nLBgvJDeXHCMDLC3rdB250zxH0u2vYDMLJzq','z2v0sw1Hz2vezxnJCMLWDgLVBG','zgvNCMfKzwq','ndaX','C2vYDMvY','z2v0twf4q29UDgv4DfnPEMu','x3nLBgvJDfzPC2LVBLnLCNzPy2u','CMvNAxn0zxjdB252zxjZyxrPB24','D2fYBG','q09ovevyva','BgvUz3rO','D2fPDeLMtMvLzgvK','C2v0','A2v5CW','sw5PDgLHBgL6Aw5NieXmtsbZzxj2AwnLCYaOu2vYDMvYig1Vzgu6ia','yxP1CMuTB3bLBMfPlwDWDdm1','rxjYB3iGC2H1DhrPBMCGzg93BIbZzxj2AwnLia','revgqvvmvf9nqvHFuKvuuKLfuW','C2vYDMLJzsb1BMf2ywLSywjSzq','u2vYDMvYigLTywDLigDLBMvYyxrPB24GzMfPBgvKoG','u2H1DhrPBMCGzg93BIbmte0GC2vYDMLJzq','uMvNAxn0zxjLzcbJB252zxjZyxrPB24G','ihDPDgGGC2vYDMLJzsa','q29UDMvYC2f0Aw9Uia','yNvKz2v0u2vYDMLJzq','C3rYAw5NAwz5','mtmWnJmWmLD3zLPRsW','C2L6zq','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','ig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','BwvZC2fNzq','Dg90ywXnB2rLBhm','yxv0AgvUDgLJyxrPB24','CxvVDgeGzxHJzwvKzwq','x2DLDerLzMf1BhrnB2rLBezVCLnLCNzPy2u','BxmGzgvSyxKGywz0zxiGy29TCgfJDgL6yxrPB24','yxP1CMuTB3bLBMfPlwrHBgXLmW','mtCXnJy5Cw5XAurd','q2fUBM90igDLDcbZDw1Tyxj5oIbJB252zxjZyxrPB24G','r2v0DgLUzYbPBwfNzsbKzxnJCMLWDgLVBIb1C2LUzYb2AxnPB24Ty2fWywjSzsbTB2rLBa','CMvZzxrsyxrLtgLTAxriAxrZ','CMvJB3jKvxnHz2u','y29UBMvJDgLVBIbYzwz1C2vK','ndi5','x2LUAxrPywXPEMvtzxj2zxjtzxj2AwnL','C3rHDhvZ','x3nLBgvJDezHC3rLC3rtzxj2AwnL','ihDPDgGGyw55ihnLCNzPy2u','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','DgHYB3r0Bgu','BgfZDfvWzgf0zq','Bw9KzwW','z2v0q29ZDevZDgLTyxrL','DxnLu2vYDMvYteXn','Aw5PDgLHBgL6zq','u2vYDMLJzsa','zxn0Aw1HDgvuB2TLBKnVDw50','revhuKferuq','nZi3mJaWBgPcwgXl','ic0GCgvYzM9YBwLUzYbLBwvYz2vUy3KGy29TCgfJDgL6yxrPB24','zw50CMLLCW','CMv0CMLLCW','Dg9Vig1HBNKGCMvXDwvZDhm','u2vUzcbTzxnZywDLigzHAwXLzcbMB3iGy29UDMvYC2f0Aw9Uia','yNvKz2v0','zNjVBq','ig5VDcbMB3vUzcbMB3iGy29UDMvYC2f0Aw9Uia','x2DLDfnLCNzPy2vnB2rLBeLK','C2vYDMLJzvn0yxr1CW','ywXSu2v0DgXLza','AgfUzgXLuMf0zuXPBwL0sgL0','ndaW','C29Tzq','C3LZDgvTuhjVBxb0','y29UzMLN','mNDqyM5dzG','q29TCgfJDgL6yxrPB24GzMfPBgvKoG','C2vYDMLJzuLUC3rHBMnLCW','Aw5WDxrFDg9Rzw5Z','zxjYB3i','mty1odi1CM5RBhDY','rMfPBgvKihrVigDLDcbZDw1Tyxj5ihvZAw5NihnHBwuGC2vYDMLJzsa','CMf0zsbSAw1PDa'];a0_0x4f2f=function(){return _0x7e8e9c;};return a0_0x4f2f();}const a0_0x4bfdff=a0_0x4f42;(function(_0x1adfd9,_0x3a333d){const _0x4033eb=a0_0x4f42,_0x522e56=_0x1adfd9();while(!![]){try{const _0x17919a=parseInt(_0x4033eb(0x17b))/0x1*(-parseInt(_0x4033eb(0x1a1))/0x2)+parseInt(_0x4033eb(0x1aa))/0x3*(parseInt(_0x4033eb(0x1e8))/0x4)+parseInt(_0x4033eb(0x1d3))/0x5+-parseInt(_0x4033eb(0x170))/0x6*(-parseInt(_0x4033eb(0x1f4))/0x7)+parseInt(_0x4033eb(0x190))/0x8+-parseInt(_0x4033eb(0x1a6))/0x9+-parseInt(_0x4033eb(0x21a))/0xa*(parseInt(_0x4033eb(0x1f9))/0xb);if(_0x17919a===_0x3a333d)break;else _0x522e56['push'](_0x522e56['shift']());}catch(_0x269ddf){_0x522e56['push'](_0x522e56['shift']());}}}(a0_0x4f2f,0x513f6));function a0_0x4f42(_0x2da9d5,_0x4e9a7d){const _0x4f2f6f=a0_0x4f2f();return a0_0x4f42=function(_0x4f42e6,_0x45340a){_0x4f42e6=_0x4f42e6-0x166;let _0x2b718e=_0x4f2f6f[_0x4f42e6];if(a0_0x4f42['cpwbIn']===undefined){var _0x287941=function(_0x29114d){const _0x33c3b4='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3942aa='',_0xdd0006='';for(let _0x113ee8=0x0,_0x2f1f0a,_0x31634b,_0x56630d=0x0;_0x31634b=_0x29114d['charAt'](_0x56630d++);~_0x31634b&&(_0x2f1f0a=_0x113ee8%0x4?_0x2f1f0a*0x40+_0x31634b:_0x31634b,_0x113ee8++%0x4)?_0x3942aa+=String['fromCharCode'](0xff&_0x2f1f0a>>(-0x2*_0x113ee8&0x6)):0x0){_0x31634b=_0x33c3b4['indexOf'](_0x31634b);}for(let _0x33863c=0x0,_0x298a85=_0x3942aa['length'];_0x33863c<_0x298a85;_0x33863c++){_0xdd0006+='%'+('00'+_0x3942aa['charCodeAt'](_0x33863c)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xdd0006);};a0_0x4f42['VwYeuj']=_0x287941,_0x2da9d5=arguments,a0_0x4f42['cpwbIn']=!![];}const _0x18b3a2=_0x4f2f6f[0x0],_0x2de912=_0x4f42e6+_0x18b3a2,_0x18ea8d=_0x2da9d5[_0x2de912];return!_0x18ea8d?(_0x2b718e=a0_0x4f42['VwYeuj'](_0x2b718e),_0x2da9d5[_0x2de912]=_0x2b718e):_0x2b718e=_0x18ea8d,_0x2b718e;},a0_0x4f42(_0x2da9d5,_0x4e9a7d);}import{ServerLLMService}from'./serverLLMService.js';import{BudgetService}from'./budgetService.js';import{RateLimitService}from'./rateLimitService.js';const HTTP_STATUS_CODES={'REQUEST_ENTITY_TOO_LARGE':0x19d,'BAD_REQUEST':0x190,'UNAUTHORIZED':0x191,'FORBIDDEN':0x193,'NOT_FOUND':0x194,'TOO_MANY_REQUESTS':0x1ad,'INTERNAL_SERVER_ERROR':0x1f4},REQUEST_SIZE_ERROR_PATTERNS=[a0_0x4bfdff(0x216),a0_0x4bfdff(0x1ca),'request\x20too\x20large','message\x20too\x20long','content\x20length\x20exceeds\x20limit'],LLM_CONSTANTS={'HTTP_STATUS':HTTP_STATUS_CODES,'ERROR_PATTERNS':{'REQUEST_TOO_LARGE':REQUEST_SIZE_ERROR_PATTERNS,'PROMPT_TOO_LONG':[a0_0x4bfdff(0x1da),a0_0x4bfdff(0x1ee),'context\x20length\x20exceeded','maximum\x20context\x20length'],'RATE_LIMIT':[a0_0x4bfdff(0x1a8),a0_0x4bfdff(0x194),'quota\x20exceeded',a0_0x4bfdff(0x187)]},'STRATEGY':{'SPEED':'speed','INTELLIGENCE':a0_0x4bfdff(0x1ed),'CONTEXT':'context','BALANCED':'balanced'},'DEFAULT_MAX_RETRIES':0x3,'DEFAULT_RETRY_DELAY_MS':0x3e8,'DEFAULT_RETRY_MULTIPLIER':0x2,'DEFAULT_SUMMARY_SERVICE':a0_0x4bfdff(0x222),'SERVICE_STATUS':{'AVAILABLE':a0_0x4bfdff(0x203),'DEGRADED':'degraded','UNAVAILABLE':'unavailable'},'MODEL_PREFERENCE':{'SPEED':[a0_0x4bfdff(0x205),'azure-ai-phi4',a0_0x4bfdff(0x22d),'google-gemini',a0_0x4bfdff(0x209),'azure-openai-gpt4','anthropic-opus'],'INTELLIGENCE':['anthropic-opus','azure-openai-gpt4',a0_0x4bfdff(0x1f8),'anthropic-sonnet','google-gemini','azure-openai-gpt35',a0_0x4bfdff(0x205)],'BALANCED':['anthropic-sonnet','azure-openai-gpt4',a0_0x4bfdff(0x1f8),a0_0x4bfdff(0x215),'anthropic-opus','azure-openai-gpt35',a0_0x4bfdff(0x205)]},'ERROR_TYPES':{'PROMPT_TOO_LONG':a0_0x4bfdff(0x21c),'RATE_LIMIT':'rate_limit','AUTHENTICATION':a0_0x4bfdff(0x176),'NETWORK':'network','SERVER':a0_0x4bfdff(0x222),'VALIDATION':'validation'}};export class LLMService{constructor(_0x29114d,_0x33c3b4){const _0x333fdd=a0_0x4bfdff;this['config']=_0x29114d,this[_0x333fdd(0x1cb)]=_0x33c3b4,this[_0x333fdd(0x1a3)]=new Map(),this[_0x333fdd(0x1c4)]=new Map(),this[_0x333fdd(0x19a)]=new Map(),this['useServerLLM']=_0x29114d[_0x333fdd(0x18b)]!==![],this['primaryService']=null,this['serverLLMService']=null,this['isInitialized']=![],this[_0x333fdd(0x1ab)]=new RateLimitService(_0x33c3b4),this[_0x333fdd(0x16e)]=null,this[_0x333fdd(0x200)]=null,this['performanceMetrics']={'totalRequests':0x0,'successfulRequests':0x0,'failedRequests':0x0,'totalLatency':0x0,'averageLatency':0x0},this[_0x333fdd(0x1cb)][_0x333fdd(0x1cd)]('LLM\x20service\x20initialized',{'useServerLLM':this[_0x333fdd(0x18b)],'strategy':_0x29114d[_0x333fdd(0x1e1)]||LLM_CONSTANTS[_0x333fdd(0x1fe)][_0x333fdd(0x1d6)]}),this[_0x333fdd(0x18c)]()['catch'](_0x3942aa=>{const _0x5f58de=_0x333fdd;this[_0x5f58de(0x1cb)]['error'](_0x5f58de(0x1ae),_0x3942aa);});}async[a0_0x4bfdff(0x18c)](){const _0x37ce01=a0_0x4bfdff;if(this['isInitialized'])return;this['logger']['info'](_0x37ce01(0x22c)+this[_0x37ce01(0x18b)]+')');try{this[_0x37ce01(0x18b)]&&await this['_initializeServerService']();this[_0x37ce01(0x1df)]();if(this[_0x37ce01(0x1a3)][_0x37ce01(0x171)]===0x0)throw new Error(_0x37ce01(0x1c6));this['isInitialized']=!![],this['logger']['info']('Initialized\x20'+this['serviceInstances']['size']+'\x20LLM\x20services',{'primary':this[_0x37ce01(0x20b)],'services':Array[_0x37ce01(0x197)](this[_0x37ce01(0x1a3)][_0x37ce01(0x22b)]())});}catch(_0xdd0006){this['logger'][_0x37ce01(0x1a5)](_0x37ce01(0x1b7),_0xdd0006);if(this['isInitialized']===![])this['logger']['warn']('LLM\x20service\x20initialization\x20failed,\x20but\x20continuing\x20with\x20limited\x20functionality');else throw _0xdd0006;}}async[a0_0x4bfdff(0x182)](){const _0x13909a=a0_0x4bfdff;try{this['logger']['info'](_0x13909a(0x20a)),this[_0x13909a(0x212)]=new ServerLLMService(this[_0x13909a(0x1a0)],this[_0x13909a(0x1cb)]),await this[_0x13909a(0x212)][_0x13909a(0x18c)](),this['serviceInstances'][_0x13909a(0x22a)]('server',this[_0x13909a(0x212)]),this[_0x13909a(0x19a)]['set'](_0x13909a(0x222),LLM_CONSTANTS[_0x13909a(0x1c1)][_0x13909a(0x1d8)]),this[_0x13909a(0x20b)]=_0x13909a(0x222);const _0x113ee8=await this['serverLLMService']['getAvailableModels']()||[];this['logger']['info']('Server-based\x20LLM\x20service\x20initialized\x20successfully',{'modelsAvailable':this[_0x13909a(0x212)][_0x13909a(0x20c)]()[_0x13909a(0x228)]});}catch(_0x2f1f0a){this[_0x13909a(0x1cb)]['error'](_0x13909a(0x1e7),_0x2f1f0a),this[_0x13909a(0x18b)]=![],this[_0x13909a(0x20b)]=null,this['serverLLMService']=null,this[_0x13909a(0x1cb)][_0x13909a(0x226)]('Falling\x20back\x20to\x20local\x20LLM\x20services');}}[a0_0x4bfdff(0x1df)](){const _0x3b7b9e=a0_0x4bfdff;this['budgetService']=new BudgetService(this[_0x3b7b9e(0x1a0)],this['logger'],this['serverLLMService']),this[_0x3b7b9e(0x1cb)][_0x3b7b9e(0x1cd)]('Budget\x20service\x20initialized\x20with\x20dynamic\x20pricing\x20support');}async['ensureInitialized'](){const _0x303687=a0_0x4bfdff;!this[_0x303687(0x1f1)]&&await this['initialize']();}async['getAvailableModels'](){const _0x16165d=a0_0x4bfdff;await this[_0x16165d(0x218)]();const _0x31634b=[];if(this['serverLLMService']&&this['isInitialized'])try{let _0x56630d=await this[_0x16165d(0x212)]['getAvailableModels']();_0x31634b[_0x16165d(0x208)](..._0x56630d);}catch(_0x33863c){this['logger']['warn']('Failed to get models from server service:',_0x33863c);}return _0x31634b;}async[a0_0x4bfdff(0x1bd)](){const _0x49c1bc=a0_0x4bfdff;return this[_0x49c1bc(0x16e)]?await this[_0x49c1bc(0x16e)]['getAllPricing']():new Map();}async['registerConversation'](_0x298a85,_0x39fed6,_0xfa9571){const _0x5cfd7c=a0_0x4bfdff;await this[_0x5cfd7c(0x218)](),this[_0x5cfd7c(0x1cb)][_0x5cfd7c(0x1cd)]('Registering\x20conversation:\x20'+_0x298a85);const _0x46095d=this[_0x5cfd7c(0x1e0)](_0x298a85);if(!_0x46095d){const _0x3bfa9b={'useServerLLM':this['useServerLLM'],'serviceInstancesCount':this['serviceInstances']['size'],'serviceInstances':Array[_0x5cfd7c(0x197)](this['serviceInstances'][_0x5cfd7c(0x22b)]()),'serviceStatusCount':this[_0x5cfd7c(0x19a)]['size'],'serviceStatus':Object['fromEntries'](this[_0x5cfd7c(0x19a)]['entries']()),'isInitialized':this[_0x5cfd7c(0x1f1)]};this['logger'][_0x5cfd7c(0x1a5)]('No\x20suitable\x20LLM\x20service\x20available\x20-\x20Debug\x20info:',_0x3bfa9b);throw new Error('No\x20suitable\x20LLM\x20service\x20available\x20for\x20this\x20conversation.\x20Debug:\x20'+JSON[_0x5cfd7c(0x16f)](_0x3bfa9b));}const _0x2b324e=this['serviceInstances']['get'](_0x46095d);try{await _0x2b324e[_0x5cfd7c(0x225)](_0x298a85,_0x39fed6,_0xfa9571),this['conversationServices']['set'](_0x298a85,_0x46095d),this[_0x5cfd7c(0x1cb)][_0x5cfd7c(0x1cd)]('Registered\x20conversation\x20'+_0x298a85+_0x5cfd7c(0x16c)+_0x46095d);}catch(_0x111300){this[_0x5cfd7c(0x1cb)]['error'](_0x5cfd7c(0x1f5)+_0x298a85+':',_0x111300);const _0x14ee5d=this[_0x5cfd7c(0x20d)](_0x46095d);if(_0x14ee5d){const _0x105132=this['serviceInstances']['get'](_0x14ee5d);await _0x105132[_0x5cfd7c(0x225)](_0x298a85,_0x39fed6,_0xfa9571),this['conversationServices']['set'](_0x298a85,_0x14ee5d),this[_0x5cfd7c(0x1cb)][_0x5cfd7c(0x1cd)](_0x5cfd7c(0x16b)+_0x298a85+_0x5cfd7c(0x1d5)+_0x14ee5d);}else throw new Error('Failed\x20to\x20register\x20conversation\x20'+_0x298a85+_0x5cfd7c(0x185));}}async[a0_0x4bfdff(0x1b6)](_0x34035a,_0x2cbb3a,_0x1d42fc){const _0x366a73=a0_0x4bfdff,_0x165061=Date['now']();this['performanceMetrics'][_0x366a73(0x1bc)]++;try{const _0x5a4985=this[_0x366a73(0x1c4)][_0x366a73(0x1cc)](_0x34035a);if(!_0x5a4985)throw new Error(_0x366a73(0x16d)+_0x34035a+'\x20is\x20not\x20registered\x20with\x20any\x20service');const _0x3dd779=this['serviceInstances']['get'](_0x5a4985);if(!_0x3dd779)throw new Error('Service\x20'+_0x5a4985+_0x366a73(0x198)+_0x34035a);const _0x1c1676=this[_0x366a73(0x199)](_0x5a4985);await this['rateLimitService']['waitIfNeeded'](_0x1c1676);const _0x5ab1be=await this[_0x366a73(0x1be)](_0x3dd779,_0x5a4985,_0x34035a,_0x2cbb3a,_0x1d42fc);return await this['_recordUsageAndMetrics'](_0x3dd779,_0x5a4985,_0x165061,!![]),_0x5ab1be;}catch(_0x292828){this[_0x366a73(0x1b0)][_0x366a73(0x1dc)]++,this['logger']['error'](_0x366a73(0x195)+_0x34035a+':',_0x292828);throw _0x292828;}}async['_sendMessageWithRetry'](_0x2a414f,_0xcc114c,_0x4014eb,_0x497357,_0x311a29){const _0x571d4b=a0_0x4bfdff,_0x3bc5a4=this['config'][_0x571d4b(0x193)]?.[_0x571d4b(0x1fc)]||LLM_CONSTANTS['DEFAULT_MAX_RETRIES'],_0x2e888a=this['config']['retries']?.[_0x571d4b(0x1e3)]||0x5,_0x1b2166=this[_0x571d4b(0x1a0)]['retries']?.['compactizationDelayMs']||0x7d0;let _0x9a5231=0x0,_0x108e56=0x0,_0x3b6ffa=null;while(_0x9a5231<=_0x3bc5a4){try{const _0x47918e=await _0x2a414f['sendMessage'](_0x4014eb,_0x497357,_0x311a29);if(_0xcc114c!=='server'){const _0x49a39f=this['_getServiceModelId'](_0xcc114c);this['rateLimitService'][_0x571d4b(0x17e)](_0x49a39f);}return this[_0x571d4b(0x19a)]['get'](_0xcc114c)===LLM_CONSTANTS['SERVICE_STATUS'][_0x571d4b(0x18f)]&&this[_0x571d4b(0x19a)]['set'](_0xcc114c,LLM_CONSTANTS[_0x571d4b(0x1c1)][_0x571d4b(0x1d8)]),_0x47918e;}catch(_0x39a901){_0x3b6ffa=_0x39a901,this['logger']['error'](_0x571d4b(0x1b8)+(_0x9a5231+0x1)+'/'+(_0x3bc5a4+0x1)+'):',_0x39a901);if(this['_isPromptTooLongError'](_0x39a901)){await this[_0x571d4b(0x1d0)](_0x4014eb);const _0x32d19f=this[_0x571d4b(0x199)](_0xcc114c);this['logger'][_0x571d4b(0x1cd)](_0x571d4b(0x1ea)+_0x1b2166+_0x571d4b(0x179)),await this[_0x571d4b(0x20f)](_0x1b2166),await this['rateLimitService']['waitIfNeeded'](_0x32d19f);continue;}if(this['_isRequestTooLargeError'](_0x39a901)){await this['_handleRequestTooLargeError'](_0x4014eb);const _0x2c97ec=this[_0x571d4b(0x199)](_0xcc114c);this['logger']['info']('Adding\x20'+_0x1b2166+'ms\x20delay\x20after\x20emergency\x20compactization'),await this[_0x571d4b(0x20f)](_0x1b2166),await this[_0x571d4b(0x1ab)]['waitIfNeeded'](_0x2c97ec);continue;}if(_0xcc114c!==_0x571d4b(0x222)&&this[_0x571d4b(0x1ce)](_0x39a901)){const _0x4b3cfb=this[_0x571d4b(0x199)](_0xcc114c);_0x108e56++;if(_0x108e56>_0x2e888a)throw new Error(_0x571d4b(0x1e2)+_0x2e888a+'):\x20'+_0x39a901[_0x571d4b(0x174)]);this[_0x571d4b(0x1ab)]['handleRateLimitHit'](_0x4b3cfb);if(_0x9a5231<_0x3bc5a4){this[_0x571d4b(0x1cb)][_0x571d4b(0x1cd)](_0x571d4b(0x1d1)+_0x108e56+'/'+_0x2e888a+')'),await this[_0x571d4b(0x1ab)]['waitIfNeeded'](_0x4b3cfb);continue;}}if(_0xcc114c===_0x571d4b(0x222)&&this[_0x571d4b(0x207)](_0x39a901)){const _0x22add2=await this['_tryFallbackService'](_0x4014eb,_0x497357,_0x311a29);if(_0x22add2)return _0x22add2;}if(this['_isNonRetryableError'](_0x39a901))break;if(_0x9a5231>=_0x3bc5a4)break;this[_0x571d4b(0x19a)][_0x571d4b(0x22a)](_0xcc114c,LLM_CONSTANTS[_0x571d4b(0x1c1)]['DEGRADED']);const _0x537cbf=this['_calculateRetryDelay'](_0x9a5231);await this['_delay'](_0x537cbf),_0x9a5231++;}}throw new Error('All\x20retry\x20attempts\x20failed:\x20'+(_0x3b6ffa?.['message']||_0x571d4b(0x1c7)));}async['_tryFallbackService'](_0x5032db,_0xb264d1,_0x459ea5){const _0x233984=a0_0x4bfdff,_0x355a54=this['_selectFallbackService']('server');if(!_0x355a54)return null;try{this[_0x233984(0x1cb)]['info']('Switching\x20to\x20fallback\x20service:\x20'+_0x355a54);const _0x2c95fe=this['serviceInstances'][_0x233984(0x1cc)](_0x355a54);return await _0x2c95fe[_0x233984(0x225)](_0x5032db,_0x459ea5[_0x233984(0x19f)]||'Conversation\x20resumed'),this['conversationServices']['set'](_0x5032db,_0x355a54),await _0x2c95fe['sendMessage'](_0x5032db,_0xb264d1,_0x459ea5);}catch(_0x50504d){return this['logger']['error'](_0x233984(0x204)+_0x50504d[_0x233984(0x174)]),null;}}async[a0_0x4bfdff(0x1e9)](_0x1b5044,_0x494040,_0x47ccec,_0x61acf8){const _0x26ed51=a0_0x4bfdff,_0x351f56=Date['now']()-_0x47ccec;this['performanceMetrics'][_0x26ed51(0x1de)]+=_0x351f56,this['performanceMetrics']['averageLatency']=this[_0x26ed51(0x1b0)][_0x26ed51(0x1de)]/this[_0x26ed51(0x1b0)][_0x26ed51(0x1bc)];_0x61acf8&&this['performanceMetrics']['successfulRequests']++;if(this[_0x26ed51(0x16e)]&&_0x494040!==_0x26ed51(0x222))try{const _0x46f637=_0x1b5044['getLastInputTokenCount'](),_0x9853a5=_0x1b5044[_0x26ed51(0x1bb)](),_0x167d69=this['_getDefaultModelForService'](_0x494040);await this[_0x26ed51(0x16e)]['recordUsage'](_0x494040,_0x167d69,_0x46f637,_0x9853a5);}catch(_0x3587dc){this[_0x26ed51(0x1cb)][_0x26ed51(0x226)]('Failed\x20to\x20record\x20usage\x20for\x20budget\x20tracking:',_0x3587dc);}}async['_handlePromptTooLongError'](_0x1e2024){const _0x3ac3c7=a0_0x4bfdff;this[_0x3ac3c7(0x1cb)]['warn'](_0x3ac3c7(0x1af));if(this[_0x3ac3c7(0x200)])try{await this['onPromptTooLong'](_0x1e2024),this['logger'][_0x3ac3c7(0x1cd)]('Compactization\x20completed,\x20retrying\x20request');}catch(_0x1ef6bf){this[_0x3ac3c7(0x1cb)][_0x3ac3c7(0x1a5)](_0x3ac3c7(0x1a2),_0x1ef6bf);throw _0x1ef6bf;}else throw new Error(_0x3ac3c7(0x20e));}async[a0_0x4bfdff(0x1ac)](_0x594e2a,_0x3e9bb8){const _0x253abc=a0_0x4bfdff;this[_0x253abc(0x1cb)]['info']('Updating\x20conversation:\x20'+_0x594e2a);const _0x2bc74b=this[_0x253abc(0x1c4)]['get'](_0x594e2a);if(!_0x2bc74b)throw new Error(_0x253abc(0x16d)+_0x594e2a+'\x20is\x20not\x20registered\x20with\x20any\x20service');const _0x312939=this['serviceInstances'][_0x253abc(0x1cc)](_0x2bc74b);if(!_0x312939)throw new Error(_0x253abc(0x18d)+_0x2bc74b+_0x253abc(0x198)+_0x594e2a);try{await _0x312939['updateConversation'](_0x594e2a,_0x3e9bb8);}catch(_0x1af670){this[_0x253abc(0x1cb)]['error'](_0x253abc(0x1b2)+_0x594e2a+':',_0x1af670);throw _0x1af670;}}async[a0_0x4bfdff(0x1eb)](_0x50dd36,_0x24997c){const _0x3c63af=a0_0x4bfdff;this[_0x3c63af(0x1cb)][_0x3c63af(0x1cd)](_0x3c63af(0x210)+_0x50dd36);const _0x10a3b6=this['conversationServices'][_0x3c63af(0x1cc)](_0x50dd36);if(!_0x10a3b6)throw new Error(_0x3c63af(0x17c)+_0x50dd36+_0x3c63af(0x173));const _0x1904c5=this['serviceInstances']['get'](_0x10a3b6);if(!_0x1904c5)throw new Error('Cannot\x20get\x20summary:\x20service\x20'+_0x10a3b6+_0x3c63af(0x1ad));this[_0x3c63af(0x1cb)]['info']('Using\x20same\x20service\x20for\x20summary:\x20'+_0x10a3b6);try{const _0x3fece9=await _0x1904c5['getSummary'](_0x24997c,_0x50dd36);if(this['budgetService']&&_0x10a3b6!==_0x3c63af(0x222)){const _0x44a516=this[_0x3c63af(0x178)](_0x10a3b6);await this[_0x3c63af(0x16e)][_0x3c63af(0x17f)](_0x10a3b6,_0x44a516,_0x1904c5[_0x3c63af(0x186)](),_0x1904c5['getLastOutputTokenCount']());}return _0x3fece9;}catch(_0x1be9e2){this[_0x3c63af(0x1cb)][_0x3c63af(0x1a5)](_0x3c63af(0x1a7)+_0x10a3b6+':',_0x1be9e2);throw _0x1be9e2;}}async[a0_0x4bfdff(0x21f)](_0x111a54,_0x5d81c3,_0x51f194={}){const _0x3e69d4=a0_0x4bfdff;this['logger']['info'](_0x3e69d4(0x17d));if(this[_0x3e69d4(0x18b)]&&this['serviceInstances']['has'](_0x3e69d4(0x222)))try{const _0x6c4117=this[_0x3e69d4(0x1a3)][_0x3e69d4(0x1cc)](_0x3e69d4(0x222));return await _0x6c4117[_0x3e69d4(0x21f)](_0x111a54,_0x5d81c3,_0x51f194);}catch(_0x4d2248){this['logger'][_0x3e69d4(0x226)](_0x3e69d4(0x1e4),_0x4d2248);}const _0x1e47ef=this[_0x3e69d4(0x224)]();if(!_0x1e47ef)throw new Error(_0x3e69d4(0x206));const _0x40209d=this['serviceInstances']['get'](_0x1e47ef),_0xc11fe3=this['_getServiceModelId'](_0x1e47ef);await this['rateLimitService'][_0x3e69d4(0x229)](_0xc11fe3);const _0x378055=this[_0x3e69d4(0x1a0)][_0x3e69d4(0x193)]?.[_0x3e69d4(0x1fc)]||LLM_CONSTANTS[_0x3e69d4(0x167)];let _0x275bdc=0x0,_0x226ba0=null;while(_0x275bdc<=_0x378055){try{const _0x3beacb=await _0x40209d['getImageDescription'](_0x111a54,_0x5d81c3,_0x51f194);this['rateLimitService']['resetRateLimitHits'](_0xc11fe3);if(this[_0x3e69d4(0x16e)]){const _0x102f38=this[_0x3e69d4(0x178)](_0x1e47ef);await this['budgetService']['recordUsage'](_0x1e47ef,_0x102f38,_0x40209d[_0x3e69d4(0x186)](),_0x40209d[_0x3e69d4(0x1bb)]());}return _0x3beacb;}catch(_0x505022){_0x226ba0=_0x505022,this[_0x3e69d4(0x1cb)][_0x3e69d4(0x1a5)]('Vision\x20request\x20failed\x20(attempt\x20'+(_0x275bdc+0x1)+'/'+(_0x378055+0x1)+'):',_0x505022);if(this[_0x3e69d4(0x1ce)](_0x505022)){this[_0x3e69d4(0x1ab)][_0x3e69d4(0x19c)](_0xc11fe3);if(_0x275bdc<_0x378055){await this['rateLimitService'][_0x3e69d4(0x229)](_0xc11fe3);continue;}}if(this[_0x3e69d4(0x1bf)](_0x505022))throw _0x505022;if(_0x275bdc>=_0x378055)break;const _0x150875=this[_0x3e69d4(0x1cf)](_0x275bdc);await this['_delay'](_0x150875),_0x275bdc++;}}throw new Error('All\x20vision\x20retry\x20attempts\x20failed:\x20'+(_0x226ba0?.['message']||_0x3e69d4(0x1c7)));}async[a0_0x4bfdff(0x1c0)](_0x1e547c,_0xab360={}){const _0x2ea385=a0_0x4bfdff;this['logger']['info']('Generating\x20image\x20using\x20server-based\x20image\x20generation');const _0x35844f=this[_0x2ea385(0x1a3)][_0x2ea385(0x1cc)](_0x2ea385(0x222));if(_0x35844f)try{const _0x493a62=await _0x35844f['generateImage'](_0x1e547c,_0xab360);return this[_0x2ea385(0x16e)]&&_0x493a62[_0x2ea385(0x214)]&&await this[_0x2ea385(0x16e)]['recordUsage']('server',_0xab360[_0x2ea385(0x189)]||_0x2ea385(0x17a),_0x493a62['usage'][_0x2ea385(0x1a4)]||0x0,_0x493a62['usage']['output_tokens']||0x0),_0x493a62;}catch(_0x1ce392){this[_0x2ea385(0x1cb)][_0x2ea385(0x226)](_0x2ea385(0x169),_0x1ce392);throw _0x1ce392;}throw new Error(_0x2ea385(0x1ba));}async['estimateTokenCount'](_0x2ba64b){const _0xbcad4e=a0_0x4bfdff,_0x459546=this['conversationServices'][_0xbcad4e(0x1cc)](_0x2ba64b);if(!_0x459546)throw new Error('Conversation\x20'+_0x2ba64b+_0xbcad4e(0x172));const _0x231cbc=this['serviceInstances']['get'](_0x459546);if(!_0x231cbc)throw new Error('Service\x20'+_0x459546+_0xbcad4e(0x198)+_0x2ba64b);try{return await _0x231cbc[_0xbcad4e(0x18e)](_0x2ba64b);}catch(_0x2e2f02){return this[_0xbcad4e(0x1cb)][_0xbcad4e(0x1a5)]('Failed\x20to\x20estimate\x20token\x20count\x20for\x20conversation\x20'+_0x2ba64b+':',_0x2e2f02),0x0;}}['getCostEstimate'](_0x4f857d,_0x132fbb,_0x131e32){const _0x293c1e=a0_0x4bfdff;if(!this[_0x293c1e(0x16e)])return null;return this['budgetService'][_0x293c1e(0x18a)](_0x4f857d,_0x132fbb,_0x131e32);}['checkBudgetForOperation'](_0x37129f,_0x492d17,_0x39f2b2){const _0x2faa98=a0_0x4bfdff;if(!this['budgetService'])return null;return this[_0x2faa98(0x16e)]['checkBudgetForOperation'](_0x37129f,_0x492d17,_0x39f2b2);}async['getBudgetUsage'](){const _0x5745e7=a0_0x4bfdff;if(!this[_0x5745e7(0x16e)])return null;return await this['budgetService'][_0x5745e7(0x1b3)]();}async[a0_0x4bfdff(0x219)](_0x56c6d0){const _0x3b6dd5=a0_0x4bfdff;if(!this['budgetService'])throw new Error('Budget\x20service\x20not\x20available');await this['budgetService'][_0x3b6dd5(0x219)](_0x56c6d0);}async['refreshPricingData'](){const _0xd1340c=a0_0x4bfdff;if(!this['budgetService'])return![];return await this['budgetService'][_0xd1340c(0x1d7)]();}['getServiceStatus'](){const _0x1fe4c9=a0_0x4bfdff,_0x25b12c={};for(const [_0x410648,_0x26a0f0]of this['serviceStatus'][_0x1fe4c9(0x192)]()){_0x25b12c[_0x410648]={'status':_0x26a0f0,'available':_0x26a0f0!==LLM_CONSTANTS[_0x1fe4c9(0x1c1)][_0x1fe4c9(0x1b5)],'isPrimary':_0x410648===this[_0x1fe4c9(0x20b)]};}return _0x25b12c;}[a0_0x4bfdff(0x1dd)](){const _0x125500=a0_0x4bfdff;return{...this[_0x125500(0x1b0)],'successRate':this['performanceMetrics'][_0x125500(0x1bc)]>0x0?this[_0x125500(0x1b0)]['successfulRequests']/this['performanceMetrics'][_0x125500(0x1bc)]*0x64:0x0};}['getRateLimitingStatus'](){return this['rateLimitService']['getAllStatus']();}['registerPromptTooLongHandler'](_0x144111){const _0x191d03=a0_0x4bfdff;this[_0x191d03(0x200)]=_0x144111,this[_0x191d03(0x1cb)][_0x191d03(0x1cd)]('Prompt\x20too\x20long\x20handler\x20registered');}async[a0_0x4bfdff(0x1f7)](){const _0x3c8563=a0_0x4bfdff,_0x37861a={'overall':_0x3c8563(0x1d2),'services':{},'budget':null,'performance':this[_0x3c8563(0x1dd)](),'pricing':{'available':![],'modelsWithPricing':0x0,'lastUpdate':null}};for(const [_0x5e652d,_0x28022a]of this['serviceStatus']['entries']()){_0x37861a['services'][_0x5e652d]={'status':_0x28022a,'available':_0x28022a!==LLM_CONSTANTS[_0x3c8563(0x1c1)][_0x3c8563(0x1b5)]},_0x28022a===LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']&&(_0x37861a[_0x3c8563(0x1c2)]='degraded');}if(this['serverLLMService'])try{const _0x1ae88d=await this['serverLLMService']['getServerHealth']();_0x37861a['services'][_0x3c8563(0x222)]['serverHealth']=_0x1ae88d,_0x1ae88d['status']!=='healthy'&&(_0x37861a[_0x3c8563(0x1c2)]='degraded');}catch(_0x2fec6c){_0x37861a[_0x3c8563(0x1fb)]['server']['serverHealth']={'status':'error','error':_0x2fec6c[_0x3c8563(0x174)]},_0x37861a['overall']='degraded';}if(this[_0x3c8563(0x16e)])try{_0x37861a['budget']=await this['budgetService'][_0x3c8563(0x213)](),_0x37861a[_0x3c8563(0x196)][_0x3c8563(0x183)]!=='healthy'&&(_0x37861a[_0x3c8563(0x1c2)]=_0x3c8563(0x220));}catch(_0x3c164b){_0x37861a['budget']={'status':_0x3c8563(0x1a5),'error':_0x3c164b['message']},_0x37861a[_0x3c8563(0x1c2)]='degraded';}if(this['budgetService']){const _0x355128=this['budgetService'][_0x3c8563(0x1ff)]();_0x37861a[_0x3c8563(0x211)]={'available':_0x355128[_0x3c8563(0x175)]>0x0,'modelsWithPricing':_0x355128[_0x3c8563(0x175)],'lastUpdate':_0x355128[_0x3c8563(0x188)],'source':_0x355128[_0x3c8563(0x217)]};}return _0x37861a;}async['shutdown'](){const _0x6f98b9=a0_0x4bfdff;this['logger']['info'](_0x6f98b9(0x16a));const _0x53b8f9=[];for(const [_0x501b1f,_0x50ca16]of this[_0x6f98b9(0x1a3)][_0x6f98b9(0x192)]()){typeof _0x50ca16['shutdown']===_0x6f98b9(0x21b)&&(this[_0x6f98b9(0x1cb)][_0x6f98b9(0x1cd)]('Shutting\x20down\x20service:\x20'+_0x501b1f),_0x53b8f9['push'](_0x50ca16[_0x6f98b9(0x1d4)]()['catch'](_0xa14161=>{const _0x2ed95e=_0x6f98b9;this[_0x2ed95e(0x1cb)]['error'](_0x2ed95e(0x166)+_0x501b1f+':',_0xa14161);})));}this['budgetService']&&typeof this['budgetService'][_0x6f98b9(0x1d4)]===_0x6f98b9(0x21b)&&_0x53b8f9['push'](this['budgetService'][_0x6f98b9(0x1d4)]()['catch'](_0x42be8b=>{const _0x203a06=_0x6f98b9;this[_0x203a06(0x1cb)][_0x203a06(0x1a5)]('Error\x20shutting\x20down\x20budget\x20service:',_0x42be8b);})),await Promise[_0x6f98b9(0x19b)](_0x53b8f9),this['serviceInstances']['clear'](),this[_0x6f98b9(0x1c4)][_0x6f98b9(0x1db)](),this[_0x6f98b9(0x19a)]['clear'](),this['logger']['info']('All\x20LLM\x20services\x20shut\x20down');}[a0_0x4bfdff(0x1e0)](_0x3d789a,_0x267663=[]){const _0x2acd88=a0_0x4bfdff;if(this[_0x2acd88(0x18b)]&&this['serviceInstances']['has']('server')&&!_0x267663[_0x2acd88(0x1b1)](_0x2acd88(0x222))&&this[_0x2acd88(0x19a)][_0x2acd88(0x1cc)](_0x2acd88(0x222))===LLM_CONSTANTS[_0x2acd88(0x1c1)]['AVAILABLE'])return _0x2acd88(0x222);return this[_0x2acd88(0x1f6)](_0x267663);}['_selectAvailableService'](_0xdbd71d=[]){const _0x375eb3=a0_0x4bfdff,_0x2be6b8=Array[_0x375eb3(0x197)](this[_0x375eb3(0x1a3)]['keys']())[_0x375eb3(0x1f0)](_0x7370ae=>!_0xdbd71d[_0x375eb3(0x1b1)](_0x7370ae)&&this['serviceStatus'][_0x375eb3(0x1cc)](_0x7370ae)!==LLM_CONSTANTS['SERVICE_STATUS'][_0x375eb3(0x1b5)]);if(_0x2be6b8['length']===0x0)return null;const _0x8723cf=this[_0x375eb3(0x1a0)]['llmStrategy']||LLM_CONSTANTS[_0x375eb3(0x1fe)]['BALANCED'];switch(_0x8723cf){case LLM_CONSTANTS['STRATEGY'][_0x375eb3(0x1c9)]:return this[_0x375eb3(0x184)](_0x2be6b8);case LLM_CONSTANTS['STRATEGY'][_0x375eb3(0x1d9)]:return this[_0x375eb3(0x1fd)](_0x2be6b8);case LLM_CONSTANTS['STRATEGY'][_0x375eb3(0x227)]:return this[_0x375eb3(0x21e)](_0x2be6b8);case LLM_CONSTANTS[_0x375eb3(0x1fe)]['BALANCED']:default:return this[_0x375eb3(0x1e6)](_0x2be6b8);}}['_selectFallbackService'](_0x4253dc){const _0x54fab7=a0_0x4bfdff,_0x107421=Array[_0x54fab7(0x197)](this[_0x54fab7(0x1a3)]['keys']())[_0x54fab7(0x1f0)](_0x37c32a=>_0x37c32a!==_0x4253dc&&this['serviceStatus']['get'](_0x37c32a)!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']);if(_0x107421['length']===0x0)return null;if(_0x4253dc!=='anthropic'&&_0x107421[_0x54fab7(0x1b1)](_0x54fab7(0x202)))return _0x54fab7(0x202);return _0x107421[0x0];}[a0_0x4bfdff(0x224)](_0xf05f81=[]){const _0xb251ae=a0_0x4bfdff,_0x293462=['anthropic','openai','google'],_0xf8026f=_0x293462[_0xb251ae(0x1f0)](_0x457fcd=>!_0xf05f81[_0xb251ae(0x1b1)](_0x457fcd)&&this[_0xb251ae(0x1a3)]['has'](_0x457fcd)&&this['serviceStatus']['get'](_0x457fcd)!==LLM_CONSTANTS['SERVICE_STATUS'][_0xb251ae(0x1b5)]);if(_0xf8026f[_0xb251ae(0x228)]===0x0)return null;const _0x26775c=['anthropic',_0xb251ae(0x21d),'google'];for(const _0x5603b6 of _0x26775c){if(_0xf8026f[_0xb251ae(0x1b1)](_0x5603b6))return _0x5603b6;}return _0xf8026f[0x0];}[a0_0x4bfdff(0x184)](_0x332836){const _0xc78d40=a0_0x4bfdff;return this[_0xc78d40(0x1f2)](_0x332836,LLM_CONSTANTS['MODEL_PREFERENCE'][_0xc78d40(0x1c9)]);}['_selectSmartestService'](_0x352b61){const _0x4a0b73=a0_0x4bfdff;return this['_selectServiceByPreferenceOrder'](_0x352b61,LLM_CONSTANTS[_0x4a0b73(0x1ef)]['INTELLIGENCE']);}[a0_0x4bfdff(0x21e)](_0x13891d){const _0x3171d2=a0_0x4bfdff;let _0x537b3a=null,_0x501eee=0x0;for(const _0x4af6c4 of _0x13891d){const _0x55459f=this[_0x3171d2(0x1a3)][_0x3171d2(0x1cc)](_0x4af6c4);if(!_0x55459f||typeof _0x55459f[_0x3171d2(0x223)]!==_0x3171d2(0x21b))continue;const _0x3a89b6=_0x55459f[_0x3171d2(0x223)]();_0x3a89b6>_0x501eee&&(_0x501eee=_0x3a89b6,_0x537b3a=_0x4af6c4);}return _0x537b3a||_0x13891d[0x0];}['_selectBalancedService'](_0x386b78){const _0x102c50=a0_0x4bfdff;return this[_0x102c50(0x1f2)](_0x386b78,LLM_CONSTANTS['MODEL_PREFERENCE'][_0x102c50(0x1d6)]);}['_selectServiceByPreferenceOrder'](_0x4842c8,_0x255040){const _0x4c360f=a0_0x4bfdff,_0x2a3f8a={'anthropic':['anthropic-opus','anthropic-sonnet','anthropic-haiku'],'openai':['azure-openai-gpt4','azure-openai-gpt35'],'google':['google-gemini'],'server':[]};for(const _0x341459 of _0x255040){for(const _0x2a041e of _0x4842c8){if(_0x2a041e==='server')return _0x2a041e;const _0x284f55=_0x2a3f8a[_0x2a041e]||[];if(_0x284f55[_0x4c360f(0x1b1)](_0x341459))return _0x2a041e;}}return _0x4842c8[0x0];}['_getServiceModelId'](_0x48826a){const _0x1c5864=a0_0x4bfdff,_0x59b744={'anthropic':_0x1c5864(0x209),'openai':_0x1c5864(0x1a9),'google':'google-gemini','server':'server-llm'};return _0x59b744[_0x48826a]||_0x48826a;}['_getDefaultModelForService'](_0x3afa7d){const _0x9b27b3=a0_0x4bfdff;return this[_0x9b27b3(0x199)](_0x3afa7d);}[a0_0x4bfdff(0x1cf)](_0x341248){const _0x1843a4=a0_0x4bfdff,_0x144982=this['config'][_0x1843a4(0x193)]?.[_0x1843a4(0x1c8)]||LLM_CONSTANTS['DEFAULT_RETRY_DELAY_MS'],_0x1fdd75=this['config']['retries']?.['delayMultiplier']||LLM_CONSTANTS['DEFAULT_RETRY_MULTIPLIER'];return _0x144982*Math['pow'](_0x1fdd75,_0x341248);}[a0_0x4bfdff(0x20f)](_0x55ee0b){return new Promise(_0x5c32ac=>setTimeout(_0x5c32ac,_0x55ee0b));}['_isRateLimitError'](_0x834efb){const _0x2e0cf4=a0_0x4bfdff,_0x5e29ec=[_0x2e0cf4(0x1a8),'too\x20many\x20requests',_0x2e0cf4(0x177),'request\x20limit',_0x2e0cf4(0x181),_0x2e0cf4(0x187)],_0x41562c=_0x834efb['message']?.[_0x2e0cf4(0x1c3)]()||'';return _0x5e29ec[_0x2e0cf4(0x19e)](_0x31eb26=>_0x41562c['includes'](_0x31eb26));}[a0_0x4bfdff(0x1bf)](_0x5f03c3){const _0x270890=a0_0x4bfdff,_0x4a07ab=['invalid\x20api\x20key','authentication\x20failed','unauthorized','model\x20not\x20found',_0x270890(0x1b4),_0x270890(0x1e5)],_0x51695f=_0x5f03c3['message']?.['toLowerCase']()||'';return _0x4a07ab[_0x270890(0x19e)](_0x5a5328=>_0x51695f['includes'](_0x5a5328));}['_isPromptTooLongError'](_0x271af0){const _0x3544bb=a0_0x4bfdff,_0x457957=_0x271af0['message']?.['toLowerCase']()||'',_0x59baa7=_0x271af0[_0x3544bb(0x1c5)]?.()?.[_0x3544bb(0x1c3)]()||'';return(_0x457957['includes'](_0x3544bb(0x1da))||_0x59baa7[_0x3544bb(0x1b1)]('too\x20long'))&&(_0x271af0['status']===0x190||_0x457957[_0x3544bb(0x1b1)]('400')||_0x59baa7['includes'](_0x3544bb(0x19d)));}['_isRequestTooLargeError'](_0x531c94){const _0x59e08d=a0_0x4bfdff,_0x502abd=_0x531c94[_0x59e08d(0x174)]?.['toLowerCase']()||'',_0x5eeec2=_0x531c94['status']||_0x531c94['originalError']?.['status'];return _0x5eeec2===0x19d||_0x502abd[_0x59e08d(0x1b1)]('request\x20entity\x20too\x20large')||_0x502abd['includes']('payload\x20too\x20large')||_0x502abd['includes'](_0x59e08d(0x1f3));}async['_handleRequestTooLargeError'](_0x2c23da){const _0x4bc955=a0_0x4bfdff;this['logger']['warn'](_0x4bc955(0x1b9)+_0x2c23da+_0x4bc955(0x191));if(this['onPromptTooLong'])try{await this['onPromptTooLong'](_0x2c23da),this['logger'][_0x4bc955(0x1cd)](_0x4bc955(0x201)+_0x2c23da);}catch(_0x44dc5d){this['logger']['error'](_0x4bc955(0x1ec),_0x44dc5d);throw _0x44dc5d;}else throw new Error('Request\x20too\x20large\x20and\x20no\x20compactization\x20handler\x20available');}['_isServerError'](_0x3f833a){const _0x5397c1=a0_0x4bfdff,_0x24dd47=[_0x5397c1(0x221),'403','500','502','503','504','authentication',_0x5397c1(0x180),'network',_0x5397c1(0x1fa),_0x5397c1(0x168)],_0x5a3ff4=_0x3f833a[_0x5397c1(0x174)]?.[_0x5397c1(0x1c3)]()||'';return _0x24dd47[_0x5397c1(0x19e)](_0xf7087a=>_0x5a3ff4[_0x5397c1(0x1b1)](_0xf7087a));}}export{LLM_CONSTANTS};