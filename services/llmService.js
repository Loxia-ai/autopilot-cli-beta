const a0_0x48a441=a0_0x2c73;(function(_0x3b3d7e,_0x50fcfb){const _0xd2ed42=a0_0x2c73,_0x1a40e1=_0x3b3d7e();while(!![]){try{const _0x413e76=-parseInt(_0xd2ed42(0x8d))/0x1*(parseInt(_0xd2ed42(0xbc))/0x2)+-parseInt(_0xd2ed42(0x145))/0x3*(-parseInt(_0xd2ed42(0x11f))/0x4)+-parseInt(_0xd2ed42(0xdf))/0x5*(-parseInt(_0xd2ed42(0xd8))/0x6)+parseInt(_0xd2ed42(0xa7))/0x7*(-parseInt(_0xd2ed42(0xfb))/0x8)+parseInt(_0xd2ed42(0x92))/0x9+-parseInt(_0xd2ed42(0xc2))/0xa*(-parseInt(_0xd2ed42(0x135))/0xb)+parseInt(_0xd2ed42(0x103))/0xc*(-parseInt(_0xd2ed42(0x101))/0xd);if(_0x413e76===_0x50fcfb)break;else _0x1a40e1['push'](_0x1a40e1['shift']());}catch(_0x4e7305){_0x1a40e1['push'](_0x1a40e1['shift']());}}}(a0_0x55cd,0x58390));function a0_0x2c73(_0x1c7014,_0xf7b40c){const _0x55cd55=a0_0x55cd();return a0_0x2c73=function(_0x2c7313,_0x238ad5){_0x2c7313=_0x2c7313-0x87;let _0x56bf78=_0x55cd55[_0x2c7313];if(a0_0x2c73['iylAgp']===undefined){var _0x2c2e86=function(_0x15ac0e){const _0x54ffef='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3043e0='',_0x34dc47='';for(let _0x3bce99=0x0,_0xf8aa3b,_0x3487f2,_0x5a440f=0x0;_0x3487f2=_0x15ac0e['charAt'](_0x5a440f++);~_0x3487f2&&(_0xf8aa3b=_0x3bce99%0x4?_0xf8aa3b*0x40+_0x3487f2:_0x3487f2,_0x3bce99++%0x4)?_0x3043e0+=String['fromCharCode'](0xff&_0xf8aa3b>>(-0x2*_0x3bce99&0x6)):0x0){_0x3487f2=_0x54ffef['indexOf'](_0x3487f2);}for(let _0x3c3d47=0x0,_0x10b7d1=_0x3043e0['length'];_0x3c3d47<_0x10b7d1;_0x3c3d47++){_0x34dc47+='%'+('00'+_0x3043e0['charCodeAt'](_0x3c3d47)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x34dc47);};a0_0x2c73['zUQcnY']=_0x2c2e86,_0x1c7014=arguments,a0_0x2c73['iylAgp']=!![];}const _0x32a9e3=_0x55cd55[0x0],_0x103432=_0x2c7313+_0x32a9e3,_0x4333b1=_0x1c7014[_0x103432];return!_0x4333b1?(_0x56bf78=a0_0x2c73['zUQcnY'](_0x56bf78),_0x1c7014[_0x103432]=_0x56bf78):_0x56bf78=_0x4333b1,_0x56bf78;},a0_0x2c73(_0x1c7014,_0xf7b40c);}import{ServerLLMService}from'./serverLLMService.js';import{BudgetService}from'./budgetService.js';function a0_0x55cd(){const _0x35d2fa=['CMv0CMLLCW','CMvZzxrsyxrLtgLTAxriAxrZ','u2vYDMvYigLTywDLigDLBMvYyxrPB24GzMfPBgvKoG','ndrKuLrJv0S','r2vUzxjHDgLUzYbPBwfNzsb1C2LUzYbZzxj2zxiTyMfZzwqGAw1Hz2uGz2vUzxjHDgLVBG','uhjVBxb0ihrVBYbSB25NigHHBMrSzxiGCMvNAxn0zxjLza','CMf0zuXPBwL0u2vYDMLJzq','z29Vz2XL','mtq4odq2nvjUvMHlsa','BgXTu3rYyxrLz3K','B25qCM9TChruB29mB25N','AgvHBhrOq2HLy2S','sw5PDgLHBgL6zwqG','yxP1CMuTB3bLBMfPlwDWDdm1','revhuKferuq','ChjVBxb0x3rVB19SB25N','u0vsvKLdrv9tvefuvvm','tu9eruXFufjfrKvsru5drq','BM93','ndaZ','C291CMnL','y29UDgv4DcbSzw5NDgGGzxHJzwvKzwq','CMvNAxn0zxjqCM9TChruB29mB25NsgfUzgXLCG','x3nLBgvJDezHBgXIywnRu2vYDMLJzq','Aw5WDxrFDg9Rzw5Z','qNvKz2v0ihnLCNzPy2uGBM90igf2ywLSywjSzq','Bg9Nz2vY','u1bfruq','teXnihnLCNzPy2uGAw5PDgLHBgL6yxrPB24GzMfPBgvKlcbIDxqGy29UDgLUDwLUzYb3AxrOigXPBwL0zwqGzNvUy3rPB25HBgL0Eq','n2nAsuzdzW','tM8GC3vPDgfIBguGteXnihnLCNzPy2uGyxzHAwXHyMXLic0GrgvIDwCGAw5MBZO','ig5VDcbMB3vUzcbMB3iGy29UDMvYC2f0Aw9Uia','x2LUAxrPywXPEMvtzxj2zxjtzxj2AwnL','zMLSDgvY','C3rHDhvZ','rMfPBgvKihrVihjLy29Yzcb1C2fNzsbMB3iGyNvKz2v0ihrYywnRAw5NoG','revgqvvmvf9srvrswv9nvuXusvbmsuvs','yxP1CMuTB3bLBMfPlwrHBgXLmW','teXnihnLCNzPy2uGAw5PDgLHBgL6zwq','C2vYDMLJzuLUC3rHBMnLCW','x2LZtM9UuMv0CNLHyMXLrxjYB3i','uhjVBxb0ihrVBYbSB25NigvYCM9YigrLDgvJDgvKic0GCMvXDwvZDgLUzYbJB21Wywn0AxPHDgLVBG','z2v0u2vYDMLJzvn0yxr1CW','u2vUzcbTzxnZywDLigzHAwXLzcbMB3iGy29UDMvYC2f0Aw9Uia','yNvKz2v0u2vYDMLJzq','C2v0','Cg93','yxv0AgvUDgLJyxrPB24','Aw52ywXPzcbHCgKGA2v5','ywXSu2v0DgXLza','mJq1odjPEKnqA1a','B3zLCMfSBa','C3rYAw5NAwz5','ntaY','u2vYDMvYihzPC2LVBIbZzxj2AwnLigzHAwXLzcWGDhj5Aw5NigzHBgXIywnRoG','C29Tzq','mtiWz2PiueTz','DMfSAwrHDgLVBG','qwrKAw5Nia','zNjVBuvUDhjPzxm','y29UDgv4Da','uMvNAxn0zxjLzcbJB252zxjZyxrPB24G','C2H1DgrVD24','x2LUAxrPywXPEMvcDwrNzxrtzxj2AwnL','x2DLDerLzMf1BhrnB2rLBezVCLnLCNzPy2u','q29UDMvYC2f0Aw9UihjLC3vTzwq','CMvMCMvZAfbYAwnPBMDeyxrH','x2LZuMvXDwvZDfrVB0XHCMDLrxjYB3i','ndi5','zNvUy3rPB24','Dg9tDhjPBMC','z2v0qwXSuhjPy2LUzW','q09ovevyva','sw5PDgLHBgL6Aw5NieXmtsbZzxj2AwnLCYaOu2vYDMvYig1Vzgu6ia','x3rYEuzHBgXIywnRu2vYDMLJzq','CMvXDwvZDcbLBNrPDhKGDg9VigXHCMDL','ChjPy2LUzW','x3nLBgvJDfnLCNzPy2vcEvbYzwzLCMvUy2vpCMrLCG','mJu4B09Lt3De','C2v0qNvKz2v0tgLTAxq','ndaW','CgvYzM9YBwfUy2vnzxrYAwnZ','x3jLy29YzfvZywDLqw5Ktwv0CMLJCW','yw50AhjVCgLJ','y2f0y2G','nJGXnJvnDuzosfa','D2fYBG','uhjVBxb0ihrVBYbSB25NigfUzcbUBYbJB21Wywn0AxPHDgLVBIbOyw5KBgvYigf2ywLSywjSzq','x2HHBMrSzvjLCxvLC3ruB29myxjNzuvYCM9Y','CMvJB3jKvxnHz2u','qvzbsuXbqKXf','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','rMfPBgvKihrVihjLz2LZDgvYignVBNzLCNnHDgLVBIa','zw50CMLLCW','yxP1CMuTywKTCgHPna','DxnLu2vYDMvYteXn','AxnjBML0AwfSAxPLza','u1rsqvrfr1K','vu5bvKfjtefcteu','y29UzMLN','z2v0sw1Hz2vezxnJCMLWDgLVBG','x2DLDfnLCNzPy2vnB2rLBeLK','Aw5PDgLHBgL6zq','x3nLBgvJDfnTyxj0zxn0u2vYDMLJzq','u2H1DhrPBMCGzg93BIbZzxj2AwnLoIa','ihDPDgGGyw55ihnLCNzPy2u','qwXSihzPC2LVBIbYzxrYEsbHDhrLBxb0CYbMywLSzwq6ia','su5uruXmsuDftKnf','Dg90ywXszxf1zxn0CW','u2vYDMLJzsa','z2v0qxzHAwXHyMXLtw9KzwXZ','Bwf4uMv0CMLLCW','zNjVBq','mti2ody3mKXPtgHbAW','yxzHAwXHyMXL','uMf0zsbSAw1PDcbLCNjVCIbKzxrLy3rLzcWGD2fPDgLUzYbHBMqGCMv0CNLPBMCUlI4GkhjHDguGBgLTAxqGyxr0zw1WDca','tM8GC3vPDgfIBguGteXnihnLCNzPy2uGyxzHAwXHyMXLigzVCIb0AgLZignVBNzLCNnHDgLVBI4GrgvIDwC6ia','ChvZAa','x2HHBMrSzvbYB21WDfrVB0XVBMDfCNjVCG','mtnAq0DmquS','ChjPBwfYEvnLCNzPy2u','nJG1ntm3mMT6BKTwEa','q29UDMvYC2f0Aw9Uia','Dg9VigXVBMC','DgHYB3r0Bgu','x2LZuMf0zuXPBwL0rxjYB3i','Bwf4Aw11BsbJB250zxH0igXLBMD0Aa','B3bLBMfP','x3nLBgvJDeXHCMDLC3rdB250zxH0u2vYDMLJzq','D2fPDeLMtMvLzgvK','AgvHBhrOEq','ieXmtsbZzxj2AwnLCW','C2vYDMvY','C3bLzwq','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','CMf0zsbSAw1PDa','8j+AQcbszxf1zxn0ihrVBYbSyxjNzsbKzxrLy3rLzcbMB3iG','u2H1DhrPBMCGzg93BIbmte0GC2vYDMLJzq','z2v0uMf0zuXPBwL0Aw5Nu3rHDhvZ','z2v0sgvHBhrOu3rHDhvZ','y2HLy2TcDwrNzxrgB3jpCgvYyxrPB24','yw50AhjVCgLJlwHHAwT1','DxnHz2u','zgvNCMfKzwq','yxP1CMuTywKTz3jVAZm','Bw9KzwWGBM90igzVDw5K','z2v0ugvYzM9YBwfUy2vnzxrYAwnZ','Dg9Vig1HBNKGCMvXDwvZDhm','yxP1CMuTB3bLBMfPlwDWDdq','mJy1mduYyw5nvu1j','C2vYDMvYteXnu2vYDMLJzq','Aw5JBhvKzxm','qKfmqu5druq','Cgf5Bg9Hzcb0B28GBgfYz2u','uMf0zsbSAw1PDcbYzxrYEsb0AhjLC2HVBgqGzxHJzwvKzwqGka','Dg9mB3DLCKnHC2u','B3jPz2LUywXfCNjVCG','z29Vz2XLlwDLBwLUAq','A2v5CW','CMvNAxn0zxjdB252zxjZyxrPB24','yw50AhjVCgLJlw9WDxm','CMvXDwvZDcbSAw1PDa','z2v0qNvKz2v0vxnHz2u','z2v0q29ZDevZDgLTyxrL','z2v0uhjPy2LUz0rHDge','AgfZ','B3v0Chv0x3rVA2vUCW','yw50AhjVCgLJlxnVBM5LDa','x2LZuhjVBxb0vg9Vtg9Uz0vYCM9Y','C2L6zq','zxjYB3i','nJi0odmZzgHrrw1b','ihDPDgGGzMfSBgjHy2SGC2vYDMLJzsa','u2vYDMvYlwjHC2vKieXmtsbZzxj2AwnLigLUAxrPywXPEMvKihn1y2nLC3nMDwXSEq','C2vUze1LC3nHz2u','BwvZC2fNzq','z2v0twf4q29UDgv4DfnPEMu','C2vYDMLJzvn0yxr1CW','x3nLBgvJDejHBgfUy2vKu2vYDMLJzq','zw5ZDxjLsw5PDgLHBgL6zwq','rMfSBgLUzYbIywnRihrVigXVy2fSieXmtsbZzxj2AwnLCW','y2XLyxi','x2rLBgf5','Aw5MBW','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','vxnPBMCGC2fTzsbZzxj2AwnLigzVCIbZDw1Tyxj5oIa','qwXSihjLDhj5igf0DgvTChrZigzHAwXLzdOG','owPNCw10sq','z2v0','yxzLCMfNzuXHDgvUy3K','CxvVDgeGzxHJzwvKzwq','revgqvvmvf9nqvHFuKvuuKLfuW'];a0_0x55cd=function(){return _0x35d2fa;};return a0_0x55cd();}import{RateLimitService}from'./rateLimitService.js';const HTTP_STATUS_CODES={'REQUEST_ENTITY_TOO_LARGE':0x19d,'BAD_REQUEST':0x190,'UNAUTHORIZED':0x191,'FORBIDDEN':0x193,'NOT_FOUND':0x194,'TOO_MANY_REQUESTS':0x1ad,'INTERNAL_SERVER_ERROR':0x1f4},REQUEST_SIZE_ERROR_PATTERNS=['request\x20entity\x20too\x20large','payload\x20too\x20large','request\x20too\x20large','message\x20too\x20long','content\x20length\x20exceeds\x20limit'],LLM_CONSTANTS={'HTTP_STATUS':HTTP_STATUS_CODES,'ERROR_PATTERNS':{'REQUEST_TOO_LARGE':REQUEST_SIZE_ERROR_PATTERNS,'PROMPT_TOO_LONG':['too\x20long','exceeds\x20context\x20window',a0_0x48a441(0x9f),a0_0x48a441(0x108)],'RATE_LIMIT':[a0_0x48a441(0x111),a0_0x48a441(0x11d),a0_0x48a441(0x88),a0_0x48a441(0x106)]},'STRATEGY':{'SPEED':a0_0x48a441(0x10f),'INTELLIGENCE':'intelligence','CONTEXT':a0_0x48a441(0xc6),'BALANCED':'balanced'},'DEFAULT_MAX_RETRIES':0x3,'DEFAULT_RETRY_DELAY_MS':0x3e8,'DEFAULT_RETRY_MULTIPLIER':0x2,'DEFAULT_SUMMARY_SERVICE':'server','SERVICE_STATUS':{'AVAILABLE':a0_0x48a441(0xfc),'DEGRADED':'degraded','UNAVAILABLE':'unavailable'},'MODEL_PREFERENCE':{'SPEED':['anthropic-haiku',a0_0x48a441(0xe8),a0_0x48a441(0x97),a0_0x48a441(0x127),'anthropic-sonnet',a0_0x48a441(0x11e),a0_0x48a441(0x12a)],'INTELLIGENCE':['anthropic-opus','azure-openai-gpt4',a0_0x48a441(0x11a),a0_0x48a441(0x131),a0_0x48a441(0x127),'azure-openai-gpt35','anthropic-haiku'],'BALANCED':[a0_0x48a441(0x131),a0_0x48a441(0x11e),'azure-ai-grok3',a0_0x48a441(0x127),a0_0x48a441(0x12a),'azure-openai-gpt35',a0_0x48a441(0x117)]},'ERROR_TYPES':{'PROMPT_TOO_LONG':a0_0x48a441(0x99),'RATE_LIMIT':'rate_limit','AUTHENTICATION':a0_0x48a441(0xb9),'NETWORK':'network','SERVER':a0_0x48a441(0x10e),'VALIDATION':a0_0x48a441(0xc3)}};export class LLMService{constructor(_0x15ac0e,_0x54ffef){const _0x3685c4=a0_0x48a441;this['config']=_0x15ac0e,this['logger']=_0x54ffef,this[_0x3685c4(0xb1)]=new Map(),this['conversationServices']=new Map(),this[_0x3685c4(0x13b)]=new Map(),this[_0x3685c4(0xe9)]=_0x15ac0e['useServerLLM']!==![],this[_0x3685c4(0x102)]=null,this[_0x3685c4(0x120)]=null,this[_0x3685c4(0xea)]=![],this[_0x3685c4(0x90)]=new RateLimitService(_0x54ffef),this['budgetService']=null,this['onPromptTooLong']=null,this[_0x3685c4(0xdb)]={'totalRequests':0x0,'successfulRequests':0x0,'failedRequests':0x0,'totalLatency':0x0,'averageLatency':0x0},this[_0x3685c4(0xa4)][_0x3685c4(0x141)](_0x3685c4(0xb0),{'useServerLLM':this['useServerLLM'],'strategy':_0x15ac0e[_0x3685c4(0x93)]||LLM_CONSTANTS['STRATEGY'][_0x3685c4(0x122)]}),this[_0x3685c4(0xf0)]()[_0x3685c4(0xde)](_0x3043e0=>{const _0x5a6d72=_0x3685c4;this[_0x5a6d72(0xa4)]['error']('Failed\x20to\x20initialize\x20LLM\x20services\x20in\x20constructor:',_0x3043e0);});}async['initialize'](){const _0x14961f=a0_0x48a441;if(this[_0x14961f(0xea)])return;this['logger']['info'](_0x14961f(0xd3)+this[_0x14961f(0xe9)]+')');try{this['useServerLLM']&&await this[_0x14961f(0xaa)]();this['_initializeBudgetService']();if(this['serviceInstances']['size']===0x0)throw new Error('No\x20LLM\x20services\x20are\x20available');this['isInitialized']=!![],this['logger'][_0x14961f(0x141)](_0x14961f(0x96)+this['serviceInstances'][_0x14961f(0x133)]+_0x14961f(0x10d),{'primary':this['primaryService'],'services':Array[_0x14961f(0xfa)](this[_0x14961f(0xb1)][_0x14961f(0x128)]())});}catch(_0x34dc47){this[_0x14961f(0xa4)]['error']('Failed\x20to\x20initialize\x20LLM\x20services:',_0x34dc47);if(this['isInitialized']===![])this[_0x14961f(0xa4)][_0x14961f(0xe0)](_0x14961f(0xa6));else throw _0x34dc47;}}async['_initializeServerService'](){const _0x35e232=a0_0x48a441;try{this[_0x35e232(0xa4)]['info']('Initializing\x20server-based\x20LLM\x20service...'),this['serverLLMService']=new ServerLLMService(this[_0x35e232(0xed)],this[_0x35e232(0xa4)]),await this['serverLLMService']['initialize'](),this['serviceInstances'][_0x35e232(0xb7)]('server',this['serverLLMService']),this[_0x35e232(0x13b)]['set'](_0x35e232(0x10e),LLM_CONSTANTS['SERVICE_STATUS']['AVAILABLE']),this['primaryService']='server';const _0x3bce99=await this[_0x35e232(0x120)]['getAvailableModels']()||[];this[_0x35e232(0xa4)][_0x35e232(0x141)](_0x35e232(0x137),{'modelsAvailable':this[_0x35e232(0x120)][_0x35e232(0xf8)]()['length']});}catch(_0xf8aa3b){this[_0x35e232(0xa4)][_0x35e232(0x134)]('Failed\x20to\x20initialize\x20server\x20LLM\x20service:',_0xf8aa3b),this['useServerLLM']=![],this[_0x35e232(0x102)]=null,this[_0x35e232(0x120)]=null,this['logger']['warn'](_0x35e232(0x13e));}}[a0_0x48a441(0xc9)](){const _0x33addc=a0_0x48a441;this['budgetService']=new BudgetService(this['config'],this[_0x33addc(0xa4)],this['serverLLMService']),this[_0x33addc(0xa4)][_0x33addc(0x141)]('Budget\x20service\x20initialized\x20with\x20dynamic\x20pricing\x20support');}async[a0_0x48a441(0x13d)](){const _0x452d8e=a0_0x48a441;!this[_0x452d8e(0xea)]&&await this['initialize']();}async['getAvailableModels'](){const _0x5918b5=a0_0x48a441;await this[_0x5918b5(0x13d)]();const _0x3487f2=[];if(this[_0x5918b5(0x120)]&&this[_0x5918b5(0xea)])try{let _0x5a440f=await this['serverLLMService'][_0x5918b5(0xf8)]();_0x3487f2[_0x5918b5(0xff)](..._0x5a440f);}catch(_0x3c3d47){this['logger'][_0x5918b5(0xe0)]('Failed to get models from server service:',_0x3c3d47);}return _0x3487f2;}async[a0_0x48a441(0x12e)](){const _0x44e90c=a0_0x48a441;return this[_0x44e90c(0xb6)]?await this['budgetService'][_0x44e90c(0xd1)]():new Map();}async[a0_0x48a441(0x129)](_0x10b7d1,_0x2e825f,_0x295f8f){const _0x56ed83=a0_0x48a441;await this['ensureInitialized'](),this['logger']['info']('Registering\x20conversation:\x20'+_0x10b7d1);const _0x171330=this['_selectServiceForConversation'](_0x10b7d1);if(!_0x171330){const _0x465b44={'useServerLLM':this['useServerLLM'],'serviceInstancesCount':this['serviceInstances']['size'],'serviceInstances':Array['from'](this[_0x56ed83(0xb1)]['keys']()),'serviceStatusCount':this[_0x56ed83(0x13b)][_0x56ed83(0x133)],'serviceStatus':Object[_0x56ed83(0xc5)](this[_0x56ed83(0x13b)]['entries']()),'isInitialized':this[_0x56ed83(0xea)]};this[_0x56ed83(0xa4)][_0x56ed83(0x134)](_0x56ed83(0xa8),_0x465b44);throw new Error(_0x56ed83(0xfe)+JSON[_0x56ed83(0xbe)](_0x465b44));}const _0x1a152b=this[_0x56ed83(0xb1)]['get'](_0x171330);try{await _0x1a152b['registerConversation'](_0x10b7d1,_0x2e825f,_0x295f8f),this[_0x56ed83(0xe5)][_0x56ed83(0xb7)](_0x10b7d1,_0x171330),this['logger']['info'](_0x56ed83(0xc7)+_0x10b7d1+'\x20with\x20service\x20'+_0x171330);}catch(_0x236ae6){this[_0x56ed83(0xa4)]['error'](_0x56ed83(0xe6)+_0x10b7d1+':',_0x236ae6);const _0x298468=this['_selectFallbackService'](_0x171330);if(_0x298468){const _0x1374e4=this['serviceInstances'][_0x56ed83(0x146)](_0x298468);await _0x1374e4[_0x56ed83(0x129)](_0x10b7d1,_0x2e825f,_0x295f8f),this['conversationServices'][_0x56ed83(0xb7)](_0x10b7d1,_0x298468),this[_0x56ed83(0xa4)][_0x56ed83(0x141)](_0x56ed83(0xc7)+_0x10b7d1+_0x56ed83(0x136)+_0x298468);}else throw new Error(_0x56ed83(0xe6)+_0x10b7d1+_0x56ed83(0xf3));}}async[a0_0x48a441(0x138)](_0x182ccd,_0x392de9,_0x128f45){const _0x4086e4=a0_0x48a441,_0x459adf=Date[_0x4086e4(0x9c)]();this['performanceMetrics']['totalRequests']++;try{const _0x1fbdf9=this[_0x4086e4(0xe5)][_0x4086e4(0x146)](_0x182ccd);if(!_0x1fbdf9)throw new Error('Conversation\x20'+_0x182ccd+'\x20is\x20not\x20registered\x20with\x20any\x20service');const _0x460abd=this[_0x4086e4(0xb1)]['get'](_0x1fbdf9);if(!_0x460abd)throw new Error('Service\x20'+_0x1fbdf9+_0x4086e4(0xa9)+_0x182ccd);const _0x5ba2db=this['_getServiceModelId'](_0x1fbdf9);await this[_0x4086e4(0x90)]['waitIfNeeded'](_0x5ba2db);const _0x3ea75a=await this['_sendMessageWithRetry'](_0x460abd,_0x1fbdf9,_0x182ccd,_0x392de9,_0x128f45);return await this['_recordUsageAndMetrics'](_0x460abd,_0x1fbdf9,_0x459adf,!![]),_0x3ea75a;}catch(_0x4f072d){this['performanceMetrics']['failedRequests']++,this[_0x4086e4(0xa4)]['error'](_0x4086e4(0xb5)+_0x182ccd+':',_0x4f072d);throw _0x4f072d;}}async['_sendMessageWithRetry'](_0x1ad7dd,_0x168cb5,_0x327dd2,_0x277db7,_0x29673f){const _0x1826bb=a0_0x48a441,_0x1b1fcb=this[_0x1826bb(0xed)]['retries']?.[_0x1826bb(0xf9)]||LLM_CONSTANTS[_0x1826bb(0x89)],_0x385b3f=this[_0x1826bb(0xed)][_0x1826bb(0x8a)]?.['maxRateLimitRetries']||0x5,_0x490046=this['config']['retries']?.['compactizationDelayMs']||0x7d0;let _0x53076a=0x0,_0x4f2bb3=0x0,_0x54ca5d=null;while(_0x53076a<=_0x1b1fcb){try{const _0x22f56a=await _0x1ad7dd[_0x1826bb(0x138)](_0x327dd2,_0x277db7,_0x29673f);if(_0x168cb5!==_0x1826bb(0x10e)){const _0x473ccb=this['_getServiceModelId'](_0x168cb5);this['rateLimitService'][_0x1826bb(0x8b)](_0x473ccb);}return this[_0x1826bb(0x13b)][_0x1826bb(0x146)](_0x168cb5)===LLM_CONSTANTS['SERVICE_STATUS'][_0x1826bb(0x98)]&&this[_0x1826bb(0x13b)]['set'](_0x168cb5,LLM_CONSTANTS['SERVICE_STATUS'][_0x1826bb(0xe4)]),_0x22f56a;}catch(_0x4d17f9){_0x54ca5d=_0x4d17f9,this['logger']['error']('Request\x20failed\x20(attempt\x20'+(_0x53076a+0x1)+'/'+(_0x1b1fcb+0x1)+'):',_0x4d17f9);if(this[_0x1826bb(0x132)](_0x4d17f9)){await this[_0x1826bb(0x100)](_0x327dd2);const _0x1e60e8=this[_0x1826bb(0xef)](_0x168cb5);this['logger']['info'](_0x1826bb(0xc4)+_0x490046+'ms\x20delay\x20after\x20compactization'),await this['_delay'](_0x490046),await this['rateLimitService']['waitIfNeeded'](_0x1e60e8);continue;}if(this[_0x1826bb(0xcd)](_0x4d17f9)){await this[_0x1826bb(0xe2)](_0x327dd2);const _0xd86189=this['_getServiceModelId'](_0x168cb5);this[_0x1826bb(0xa4)][_0x1826bb(0x141)]('Adding\x20'+_0x490046+'ms\x20delay\x20after\x20emergency\x20compactization'),await this[_0x1826bb(0x140)](_0x490046),await this['rateLimitService']['waitIfNeeded'](_0xd86189);continue;}if(_0x168cb5!=='server'&&this['_isRateLimitError'](_0x4d17f9)){const _0x2259d2=this[_0x1826bb(0xef)](_0x168cb5);_0x4f2bb3++;if(_0x4f2bb3>_0x385b3f)throw new Error(_0x1826bb(0x124)+_0x385b3f+'):\x20'+_0x4d17f9[_0x1826bb(0x139)]);this[_0x1826bb(0x90)]['handleRateLimitHit'](_0x2259d2);if(_0x53076a<_0x1b1fcb){this[_0x1826bb(0xa4)]['info'](_0x1826bb(0xfd)+_0x4f2bb3+'/'+_0x385b3f+')'),await this[_0x1826bb(0x90)]['waitIfNeeded'](_0x2259d2);continue;}}if(_0x168cb5===_0x1826bb(0x10e)&&this['_isServerError'](_0x4d17f9)){const _0x378721=await this['_tryFallbackService'](_0x327dd2,_0x277db7,_0x29673f);if(_0x378721)return _0x378721;}if(this[_0x1826bb(0xb2)](_0x4d17f9))break;if(_0x53076a>=_0x1b1fcb)break;this['serviceStatus']['set'](_0x168cb5,LLM_CONSTANTS[_0x1826bb(0x9a)][_0x1826bb(0x98)]);const _0x13e9a8=this['_calculateRetryDelay'](_0x53076a);await this['_delay'](_0x13e9a8),_0x53076a++;}}throw new Error(_0x1826bb(0x144)+(_0x54ca5d?.['message']||'Unknown\x20error'));}async[a0_0x48a441(0xd4)](_0x5139b2,_0x18f4d1,_0x587bec){const _0x2b31f2=a0_0x48a441,_0x238d40=this['_selectFallbackService'](_0x2b31f2(0x10e));if(!_0x238d40)return null;try{this['logger'][_0x2b31f2(0x141)]('Switching\x20to\x20fallback\x20service:\x20'+_0x238d40);const _0x433f63=this['serviceInstances'][_0x2b31f2(0x146)](_0x238d40);return await _0x433f63[_0x2b31f2(0x129)](_0x5139b2,_0x587bec['systemPrompt']||_0x2b31f2(0xcb)),this[_0x2b31f2(0xe5)]['set'](_0x5139b2,_0x238d40),await _0x433f63['sendMessage'](_0x5139b2,_0x18f4d1,_0x587bec);}catch(_0x2ef1a9){return this['logger']['error']('Fallback\x20service\x20also\x20failed:\x20'+_0x2ef1a9['message']),null;}}async[a0_0x48a441(0xdc)](_0x5efdef,_0xf025be,_0x2b3d8b,_0x27cbbc){const _0x5e98ec=a0_0x48a441,_0x4f0162=Date[_0x5e98ec(0x9c)]()-_0x2b3d8b;this[_0x5e98ec(0xdb)]['totalLatency']+=_0x4f0162,this[_0x5e98ec(0xdb)][_0x5e98ec(0x87)]=this['performanceMetrics']['totalLatency']/this['performanceMetrics'][_0x5e98ec(0xf6)];_0x27cbbc&&this['performanceMetrics']['successfulRequests']++;if(this['budgetService']&&_0xf025be!==_0x5e98ec(0x10e))try{const _0x374e43=_0x5efdef[_0x5e98ec(0x110)](),_0x575698=_0x5efdef['getLastOutputTokenCount'](),_0x209d82=this['_getDefaultModelForService'](_0xf025be);await this['budgetService']['recordUsage'](_0xf025be,_0x209d82,_0x374e43,_0x575698);}catch(_0x112bf7){this[_0x5e98ec(0xa4)]['warn'](_0x5e98ec(0xad),_0x112bf7);}}async[a0_0x48a441(0x100)](_0x11c92b){const _0x43c0e0=a0_0x48a441;this['logger'][_0x43c0e0(0xe0)](_0x43c0e0(0xb3));if(this[_0x43c0e0(0x94)])try{await this['onPromptTooLong'](_0x11c92b),this[_0x43c0e0(0xa4)][_0x43c0e0(0x141)]('Compactization\x20completed,\x20retrying\x20request');}catch(_0x48583b){this['logger']['error']('Compactization\x20failed:',_0x48583b);throw _0x48583b;}else throw new Error(_0x43c0e0(0xe1));}async['updateConversation'](_0x4f3a18,_0x1b1bde){const _0x1a9644=a0_0x48a441;this['logger']['info']('Updating\x20conversation:\x20'+_0x4f3a18);const _0x4129f3=this['conversationServices']['get'](_0x4f3a18);if(!_0x4129f3)throw new Error(_0x1a9644(0x104)+_0x4f3a18+'\x20is\x20not\x20registered\x20with\x20any\x20service');const _0x2be9d2=this['serviceInstances'][_0x1a9644(0x146)](_0x4129f3);if(!_0x2be9d2)throw new Error(_0x1a9644(0xf7)+_0x4129f3+_0x1a9644(0xa9)+_0x4f3a18);try{await _0x2be9d2['updateConversation'](_0x4f3a18,_0x1b1bde);}catch(_0x39f1bc){this[_0x1a9644(0xa4)][_0x1a9644(0x134)]('Failed\x20to\x20update\x20conversation\x20'+_0x4f3a18+':',_0x39f1bc);throw _0x39f1bc;}}async['getSummary'](_0x252aea,_0x398d59){const _0x116626=a0_0x48a441;this['logger'][_0x116626(0x141)]('Getting\x20summary\x20for\x20conversation:\x20'+_0x252aea);const _0x447317=this['conversationServices']['get'](_0x252aea);if(!_0x447317)throw new Error('Cannot\x20get\x20summary:\x20conversation\x20'+_0x252aea+'\x20not\x20registered\x20with\x20any\x20service');const _0x7ba2ba=this[_0x116626(0xb1)][_0x116626(0x146)](_0x447317);if(!_0x7ba2ba)throw new Error('Cannot\x20get\x20summary:\x20service\x20'+_0x447317+'\x20not\x20available');this[_0x116626(0xa4)]['info'](_0x116626(0x143)+_0x447317);try{const _0x482f18=await _0x7ba2ba['getSummary'](_0x398d59,_0x252aea);if(this[_0x116626(0xb6)]&&_0x447317!=='server'){const _0x1839cc=this['_getDefaultModelForService'](_0x447317);await this['budgetService']['recordUsage'](_0x447317,_0x1839cc,_0x7ba2ba[_0x116626(0x110)](),_0x7ba2ba['getLastOutputTokenCount']());}return _0x482f18;}catch(_0x472552){this[_0x116626(0xa4)][_0x116626(0x134)]('Failed\x20to\x20get\x20summary\x20using\x20same\x20service\x20'+_0x447317+':',_0x472552);throw _0x472552;}}async['getImageDescription'](_0x11a6de,_0x3a04eb,_0x3475f6={}){const _0x45fb0e=a0_0x48a441;this[_0x45fb0e(0xa4)]['info']('Getting\x20image\x20description\x20using\x20vision-capable\x20model');if(this['useServerLLM']&&this['serviceInstances'][_0x45fb0e(0x12f)]('server'))try{const _0x11426f=this['serviceInstances']['get']('server');return await _0x11426f['getImageDescription'](_0x11a6de,_0x3a04eb,_0x3475f6);}catch(_0x5d84ff){this[_0x45fb0e(0xa4)][_0x45fb0e(0xe0)](_0x45fb0e(0xc0),_0x5d84ff);}const _0x2d751c=this['_selectVisionService']();if(!_0x2d751c)throw new Error('No\x20vision-capable\x20services\x20available');const _0x5273fa=this[_0x45fb0e(0xb1)]['get'](_0x2d751c),_0x3208f4=this['_getServiceModelId'](_0x2d751c);await this[_0x45fb0e(0x90)][_0x45fb0e(0x10b)](_0x3208f4);const _0x712228=this[_0x45fb0e(0xed)]['retries']?.[_0x45fb0e(0xf9)]||LLM_CONSTANTS[_0x45fb0e(0x89)];let _0x22d627=0x0,_0x55e2f2=null;while(_0x22d627<=_0x712228){try{const _0x3b7a66=await _0x5273fa[_0x45fb0e(0xee)](_0x11a6de,_0x3a04eb,_0x3475f6);this['rateLimitService'][_0x45fb0e(0x8b)](_0x3208f4);if(this['budgetService']){const _0x136a61=this['_getDefaultModelForService'](_0x2d751c);await this[_0x45fb0e(0xb6)][_0x45fb0e(0xe3)](_0x2d751c,_0x136a61,_0x5273fa[_0x45fb0e(0x110)](),_0x5273fa['getLastOutputTokenCount']());}return _0x3b7a66;}catch(_0x4da48f){_0x55e2f2=_0x4da48f,this[_0x45fb0e(0xa4)]['error']('Vision\x20request\x20failed\x20(attempt\x20'+(_0x22d627+0x1)+'/'+(_0x712228+0x1)+'):',_0x4da48f);if(this[_0x45fb0e(0x107)](_0x4da48f)){this['rateLimitService']['handleRateLimitHit'](_0x3208f4);if(_0x22d627<_0x712228){await this['rateLimitService'][_0x45fb0e(0x10b)](_0x3208f4);continue;}}if(this[_0x45fb0e(0xb2)](_0x4da48f))throw _0x4da48f;if(_0x22d627>=_0x712228)break;const _0x4b74ac=this['_calculateRetryDelay'](_0x22d627);await this[_0x45fb0e(0x140)](_0x4b74ac),_0x22d627++;}}throw new Error(_0x45fb0e(0xf4)+(_0x55e2f2?.['message']||'Unknown\x20error'));}async['generateImage'](_0x340df3,_0x99b49c={}){const _0x19c69b=a0_0x48a441;this[_0x19c69b(0xa4)]['info'](_0x19c69b(0x8e));const _0x2a0517=this['serviceInstances'][_0x19c69b(0x146)](_0x19c69b(0x10e));if(_0x2a0517)try{const _0x43dd78=await _0x2a0517['generateImage'](_0x340df3,_0x99b49c);return this[_0x19c69b(0xb6)]&&_0x43dd78[_0x19c69b(0x118)]&&await this[_0x19c69b(0xb6)]['recordUsage']('server',_0x99b49c['model']||_0x19c69b(0xaf),_0x43dd78['usage'][_0x19c69b(0xa2)]||0x0,_0x43dd78['usage'][_0x19c69b(0x130)]||0x0),_0x43dd78;}catch(_0x3bc22e){this[_0x19c69b(0xa4)][_0x19c69b(0xe0)](_0x19c69b(0x8c),_0x3bc22e);throw _0x3bc22e;}throw new Error('Image\x20generation\x20requires\x20server\x20service.\x20Please\x20check\x20your\x20connection\x20and\x20API\x20key.');}async['estimateTokenCount'](_0x37132a){const _0x39d02e=a0_0x48a441,_0x5ab372=this[_0x39d02e(0xe5)][_0x39d02e(0x146)](_0x37132a);if(!_0x5ab372)throw new Error(_0x39d02e(0x104)+_0x37132a+_0x39d02e(0x142));const _0x24edfb=this[_0x39d02e(0xb1)][_0x39d02e(0x146)](_0x5ab372);if(!_0x24edfb)throw new Error(_0x39d02e(0xf7)+_0x5ab372+_0x39d02e(0xa9)+_0x37132a);try{return await _0x24edfb['estimateTokenCount'](_0x37132a);}catch(_0x57c9f6){return this['logger']['error']('Failed\x20to\x20estimate\x20token\x20count\x20for\x20conversation\x20'+_0x37132a+':',_0x57c9f6),0x0;}}[a0_0x48a441(0x12d)](_0x4f11e0,_0x3a49f2,_0x229031){const _0x9399e6=a0_0x48a441;if(!this[_0x9399e6(0xb6)])return null;return this[_0x9399e6(0xb6)][_0x9399e6(0x12d)](_0x4f11e0,_0x3a49f2,_0x229031);}[a0_0x48a441(0x116)](_0x1202bb,_0x36a303,_0x4f6a90){const _0x54ff40=a0_0x48a441;if(!this['budgetService'])return null;return this['budgetService'][_0x54ff40(0x116)](_0x1202bb,_0x36a303,_0x4f6a90);}async['getBudgetUsage'](){const _0x35785c=a0_0x48a441;if(!this[_0x35785c(0xb6)])return null;return await this[_0x35785c(0xb6)][_0x35785c(0x12c)]();}async[a0_0x48a441(0xd9)](_0x233e65){const _0x2d8938=a0_0x48a441;if(!this[_0x2d8938(0xb6)])throw new Error(_0x2d8938(0xa3));await this['budgetService'][_0x2d8938(0xd9)](_0x233e65);}async[a0_0x48a441(0xcc)](){if(!this['budgetService'])return![];return await this['budgetService']['updatePricingFromServer']();}[a0_0x48a441(0xb4)](){const _0x26dab2=a0_0x48a441,_0x27bbec={};for(const [_0x5ab8d8,_0x49e270]of this['serviceStatus'][_0x26dab2(0xe7)]()){_0x27bbec[_0x5ab8d8]={'status':_0x49e270,'available':_0x49e270!==LLM_CONSTANTS['SERVICE_STATUS'][_0x26dab2(0xec)],'isPrimary':_0x5ab8d8===this['primaryService']};}return _0x27bbec;}[a0_0x48a441(0x11c)](){const _0x2cd547=a0_0x48a441;return{...this[_0x2cd547(0xdb)],'successRate':this[_0x2cd547(0xdb)][_0x2cd547(0xf6)]>0x0?this['performanceMetrics']['successfulRequests']/this['performanceMetrics']['totalRequests']*0x64:0x0};}[a0_0x48a441(0x114)](){const _0x5e4960=a0_0x48a441;return this[_0x5e4960(0x90)]['getAllStatus']();}[a0_0x48a441(0xa0)](_0x440150){const _0x13e1af=a0_0x48a441;this[_0x13e1af(0x94)]=_0x440150,this['logger']['info'](_0x13e1af(0x8f));}async[a0_0x48a441(0x115)](){const _0x23ca72=a0_0x48a441,_0x22ee08={'overall':_0x23ca72(0x10c),'services':{},'budget':null,'performance':this[_0x23ca72(0x11c)](),'pricing':{'available':![],'modelsWithPricing':0x0,'lastUpdate':null}};for(const [_0x5297b5,_0x2917cd]of this[_0x23ca72(0x13b)]['entries']()){_0x22ee08['services'][_0x5297b5]={'status':_0x2917cd,'available':_0x2917cd!==LLM_CONSTANTS[_0x23ca72(0x9a)][_0x23ca72(0xec)]},_0x2917cd===LLM_CONSTANTS[_0x23ca72(0x9a)][_0x23ca72(0xec)]&&(_0x22ee08[_0x23ca72(0xbd)]=_0x23ca72(0x119));}if(this['serverLLMService'])try{const _0x5e1f10=await this[_0x23ca72(0x120)]['getServerHealth']();_0x22ee08['services']['server']['serverHealth']=_0x5e1f10,_0x5e1f10['status']!=='healthy'&&(_0x22ee08[_0x23ca72(0xbd)]='degraded');}catch(_0x5b0ae5){_0x22ee08['services']['server']['serverHealth']={'status':_0x23ca72(0x134),'error':_0x5b0ae5[_0x23ca72(0x139)]},_0x22ee08[_0x23ca72(0xbd)]='degraded';}if(this[_0x23ca72(0xb6)])try{_0x22ee08['budget']=await this[_0x23ca72(0xb6)][_0x23ca72(0x95)](),_0x22ee08['budget']['status']!=='healthy'&&(_0x22ee08['overall']='degraded');}catch(_0x40b368){_0x22ee08['budget']={'status':'error','error':_0x40b368['message']},_0x22ee08['overall']=_0x23ca72(0x119);}if(this[_0x23ca72(0xb6)]){const _0x275c18=this['budgetService']['getPricingInfo']();_0x22ee08[_0x23ca72(0xd6)]={'available':_0x275c18['totalModels']>0x0,'modelsWithPricing':_0x275c18['totalModels'],'lastUpdate':_0x275c18['lastUpdate'],'source':_0x275c18[_0x23ca72(0x9e)]};}return _0x22ee08;}async[a0_0x48a441(0xc8)](){const _0x229893=a0_0x48a441;this[_0x229893(0xa4)][_0x229893(0x141)](_0x229893(0x113));const _0x5efa01=[];for(const [_0x42e481,_0x3ba297]of this[_0x229893(0xb1)]['entries']()){typeof _0x3ba297['shutdown']===_0x229893(0xcf)&&(this[_0x229893(0xa4)]['info'](_0x229893(0xf2)+_0x42e481),_0x5efa01['push'](_0x3ba297[_0x229893(0xc8)]()[_0x229893(0xde)](_0x39818e=>{const _0x5e17a0=_0x229893;this[_0x5e17a0(0xa4)]['error']('Error\x20shutting\x20down\x20service\x20'+_0x42e481+':',_0x39818e);})));}this['budgetService']&&typeof this[_0x229893(0xb6)][_0x229893(0xc8)]===_0x229893(0xcf)&&_0x5efa01[_0x229893(0xff)](this[_0x229893(0xb6)]['shutdown']()[_0x229893(0xde)](_0x489ccd=>{const _0x336090=_0x229893;this['logger'][_0x336090(0x134)]('Error\x20shutting\x20down\x20budget\x20service:',_0x489ccd);})),await Promise[_0x229893(0xbb)](_0x5efa01),this['serviceInstances']['clear'](),this[_0x229893(0xe5)]['clear'](),this['serviceStatus'][_0x229893(0x13f)](),this[_0x229893(0xa4)]['info']('All\x20LLM\x20services\x20shut\x20down');}['_selectServiceForConversation'](_0x5e22b4,_0x2179eb=[]){const _0x3deed9=a0_0x48a441;if(this[_0x3deed9(0xe9)]&&this['serviceInstances']['has']('server')&&!_0x2179eb[_0x3deed9(0x121)](_0x3deed9(0x10e))&&this[_0x3deed9(0x13b)][_0x3deed9(0x146)](_0x3deed9(0x10e))===LLM_CONSTANTS['SERVICE_STATUS'][_0x3deed9(0xe4)])return _0x3deed9(0x10e);return this['_selectAvailableService'](_0x2179eb);}['_selectAvailableService'](_0x3fc765=[]){const _0xf4791d=a0_0x48a441,_0x903ae0=Array['from'](this['serviceInstances']['keys']())[_0xf4791d(0xab)](_0x28007d=>!_0x3fc765[_0xf4791d(0x121)](_0x28007d)&&this[_0xf4791d(0x13b)]['get'](_0x28007d)!==LLM_CONSTANTS['SERVICE_STATUS'][_0xf4791d(0xec)]);if(_0x903ae0['length']===0x0)return null;const _0x4e9613=this['config']['llmStrategy']||LLM_CONSTANTS['STRATEGY'][_0xf4791d(0x122)];switch(_0x4e9613){case LLM_CONSTANTS[_0xf4791d(0xeb)]['SPEED']:return this['_selectFastestService'](_0x903ae0);case LLM_CONSTANTS['STRATEGY'][_0xf4791d(0xf5)]:return this[_0xf4791d(0xf1)](_0x903ae0);case LLM_CONSTANTS['STRATEGY'][_0xf4791d(0xd2)]:return this['_selectLargestContextService'](_0x903ae0);case LLM_CONSTANTS['STRATEGY']['BALANCED']:default:return this[_0xf4791d(0x13c)](_0x903ae0);}}[a0_0x48a441(0xa1)](_0x50e0a9){const _0x3dd9c6=a0_0x48a441,_0x2c08ce=Array['from'](this[_0x3dd9c6(0xb1)]['keys']())[_0x3dd9c6(0xab)](_0x739982=>_0x739982!==_0x50e0a9&&this[_0x3dd9c6(0x13b)]['get'](_0x739982)!==LLM_CONSTANTS[_0x3dd9c6(0x9a)]['UNAVAILABLE']);if(_0x2c08ce['length']===0x0)return null;if(_0x50e0a9!==_0x3dd9c6(0xdd)&&_0x2c08ce[_0x3dd9c6(0x121)](_0x3dd9c6(0xdd)))return'anthropic';return _0x2c08ce[0x0];}['_selectVisionService'](_0x437558=[]){const _0x3302f2=a0_0x48a441,_0x37c375=[_0x3302f2(0xdd),_0x3302f2(0x109),'google'],_0x27f5db=_0x37c375['filter'](_0x51626c=>!_0x437558['includes'](_0x51626c)&&this[_0x3302f2(0xb1)]['has'](_0x51626c)&&this['serviceStatus'][_0x3302f2(0x146)](_0x51626c)!==LLM_CONSTANTS[_0x3302f2(0x9a)]['UNAVAILABLE']);if(_0x27f5db['length']===0x0)return null;const _0x47e31f=['anthropic',_0x3302f2(0x109),_0x3302f2(0x91)];for(const _0x8aec86 of _0x47e31f){if(_0x27f5db[_0x3302f2(0x121)](_0x8aec86))return _0x8aec86;}return _0x27f5db[0x0];}['_selectFastestService'](_0x469cc2){const _0x25c588=a0_0x48a441;return this[_0x25c588(0xd7)](_0x469cc2,LLM_CONSTANTS['MODEL_PREFERENCE'][_0x25c588(0xa5)]);}[a0_0x48a441(0xf1)](_0x52f2e2){return this['_selectServiceByPreferenceOrder'](_0x52f2e2,LLM_CONSTANTS['MODEL_PREFERENCE']['INTELLIGENCE']);}[a0_0x48a441(0x10a)](_0x58cdd9){const _0x3c8ee7=a0_0x48a441;let _0x4332c9=null,_0x43a864=0x0;for(const _0x215d17 of _0x58cdd9){const _0x4b2248=this[_0x3c8ee7(0xb1)][_0x3c8ee7(0x146)](_0x215d17);if(!_0x4b2248||typeof _0x4b2248['getMaxContextSize']!==_0x3c8ee7(0xcf))continue;const _0xc3d31b=_0x4b2248[_0x3c8ee7(0x13a)]();_0xc3d31b>_0x43a864&&(_0x43a864=_0xc3d31b,_0x4332c9=_0x215d17);}return _0x4332c9||_0x58cdd9[0x0];}['_selectBalancedService'](_0x4bfc67){const _0x40442f=a0_0x48a441;return this[_0x40442f(0xd7)](_0x4bfc67,LLM_CONSTANTS[_0x40442f(0x9b)]['BALANCED']);}['_selectServiceByPreferenceOrder'](_0x3a1b3c,_0x9ed317){const _0x243c08=a0_0x48a441,_0x5c5e87={'anthropic':['anthropic-opus',_0x243c08(0x131),_0x243c08(0x117)],'openai':[_0x243c08(0x11e),'azure-openai-gpt35'],'google':[_0x243c08(0x127)],'server':[]};for(const _0x8dafc0 of _0x9ed317){for(const _0x5a737f of _0x3a1b3c){if(_0x5a737f===_0x243c08(0x10e))return _0x5a737f;const _0x491a6e=_0x5c5e87[_0x5a737f]||[];if(_0x491a6e['includes'](_0x8dafc0))return _0x5a737f;}}return _0x3a1b3c[0x0];}['_getServiceModelId'](_0x1c5f86){const _0x431923=a0_0x48a441,_0x10c7da={'anthropic':_0x431923(0x131),'openai':_0x431923(0x11e),'google':_0x431923(0x127),'server':'server-llm'};return _0x10c7da[_0x1c5f86]||_0x1c5f86;}[a0_0x48a441(0xca)](_0x19f4b7){const _0x311f50=a0_0x48a441;return this[_0x311f50(0xef)](_0x19f4b7);}['_calculateRetryDelay'](_0x2c5be5){const _0x2f295b=a0_0x48a441,_0x3b88bb=this['config']['retries']?.['baseDelayMs']||LLM_CONSTANTS['DEFAULT_RETRY_DELAY_MS'],_0x4f1db5=this['config'][_0x2f295b(0x8a)]?.['delayMultiplier']||LLM_CONSTANTS[_0x2f295b(0xae)];return _0x3b88bb*Math[_0x2f295b(0xb8)](_0x4f1db5,_0x2c5be5);}[a0_0x48a441(0x140)](_0x43de7f){return new Promise(_0x48379b=>setTimeout(_0x48379b,_0x43de7f));}['_isRateLimitError'](_0x783d8c){const _0xb38397=a0_0x48a441,_0x4c6293=['rate\x20limit',_0xb38397(0x11d),'quota\x20exceeded',_0xb38397(0x12b),_0xb38397(0xce),'throttle'],_0x11f493=_0x783d8c['message']?.[_0xb38397(0x125)]()||'';return _0x4c6293[_0xb38397(0xc1)](_0x2071d9=>_0x11f493['includes'](_0x2071d9));}[a0_0x48a441(0xb2)](_0x341bae){const _0xdea01e=a0_0x48a441,_0x19a96e=[_0xdea01e(0xba),'authentication\x20failed','unauthorized',_0xdea01e(0x11b),'invalid\x20request\x20format','content\x20policy'],_0x49bdf7=_0x341bae[_0xdea01e(0x139)]?.['toLowerCase']()||'';return _0x19a96e['some'](_0x5d6f79=>_0x49bdf7['includes'](_0x5d6f79));}[a0_0x48a441(0x132)](_0x5eb906){const _0x3cbfe3=a0_0x48a441,_0x2143eb=_0x5eb906[_0x3cbfe3(0x139)]?.[_0x3cbfe3(0x125)]()||'',_0x1dfd9e=_0x5eb906[_0x3cbfe3(0xd0)]?.()?.[_0x3cbfe3(0x125)]()||'';return(_0x2143eb['includes']('too\x20long')||_0x1dfd9e['includes'](_0x3cbfe3(0x105)))&&(_0x5eb906[_0x3cbfe3(0xac)]===0x190||_0x2143eb[_0x3cbfe3(0x121)]('400')||_0x1dfd9e['includes'](_0x3cbfe3(0xda)));}['_isRequestTooLargeError'](_0x5488e7){const _0xc2005f=a0_0x48a441,_0x54a3ad=_0x5488e7['message']?.['toLowerCase']()||'',_0x409f65=_0x5488e7['status']||_0x5488e7[_0xc2005f(0x126)]?.[_0xc2005f(0xac)];return _0x409f65===0x19d||_0x54a3ad['includes'](_0xc2005f(0xd5))||_0x54a3ad['includes'](_0xc2005f(0x123))||_0x54a3ad[_0xc2005f(0x121)]('request\x20too\x20large');}async['_handleRequestTooLargeError'](_0x183f5f){const _0x381f53=a0_0x48a441;this[_0x381f53(0xa4)]['warn'](_0x381f53(0x112)+_0x183f5f+'\x20-\x20performing\x20emergency\x20compactization');if(this[_0x381f53(0x94)])try{await this[_0x381f53(0x94)](_0x183f5f),this[_0x381f53(0xa4)][_0x381f53(0x141)]('âœ…\x20Emergency\x20compactization\x20completed\x20for\x20'+_0x183f5f);}catch(_0xd4e434){this[_0x381f53(0xa4)][_0x381f53(0x134)]('Emergency\x20compactization\x20failed:',_0xd4e434);throw _0xd4e434;}else throw new Error('Request\x20too\x20large\x20and\x20no\x20compactization\x20handler\x20available');}['_isServerError'](_0x4621e8){const _0x1c4baf=a0_0x48a441,_0x50d268=['401',_0x1c4baf(0x9d),'500',_0x1c4baf(0xbf),'503','504',_0x1c4baf(0xb9),'connection\x20refused','network','server\x20error','service\x20unavailable'],_0x2ec4b2=_0x4621e8['message']?.['toLowerCase']()||'';return _0x50d268[_0x1c4baf(0xc1)](_0x3bb29b=>_0x2ec4b2['includes'](_0x3bb29b));}}export{LLM_CONSTANTS};