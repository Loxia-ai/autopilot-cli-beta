function a0_0x414e(){const _0x1c7ab9=['y2HLy2TcDwrNzxrgB3jpCgvYyxrPB24','8j+AQcbszxf1zxn0ihrVBYbSyxjNzsbKzxrLy3rLzcbMB3iG','z2vUzxjHDgvjBwfNzq','vxnPBMCGC2fTzsbZzxj2AwnLigzVCIbZDw1Tyxj5oIa','4PYfievTzxjNzw5JEsbJB21Wywn0AxPHDgLVBIbJB21WBgv0zwqGzM9Yia','tM8GC3vPDgfIBguGteXnihnLCNzPy2uGyxzHAwXHyMXLic0GrgvIDwCGAw5MBZO','uhjVBxb0ihrVBYbSB25NigfUzcbUBYbJB21Wywn0AxPHDgLVBIbOyw5KBgvYigf2ywLSywjSzq','yw50AhjVCgLJ','ChvZAa','ndqYotKWmKTLtLjHCa','BxmGzgvSyxKGywz0zxiGzw1LCMDLBMn5ignVBxbHy3rPEMf0Aw9U','C29Tzq','DxbKyxrLuhjPy2LUz0zYB21tzxj2zxi','tM8GDMLZAw9UlwnHCgfIBguGC2vYDMLJzxmGyxzHAwXHyMXL','B3zLCMfSBa','u2vUzcbTzxnZywDLigzHAwXLzcbMB3iGy29UDMvYC2f0Aw9Uia','Aw5MBW','q09ovevyva','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','x2LZtM9UuMv0CNLHyMXLrxjYB3i','tM8GteXnihnLCNzPy2vZigfYzsbHDMfPBgfIBgu','x3nLBgvJDezHC3rLC3rtzxj2AwnL','ndyWog5QCLrkqW','ig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','BwvZC2fNzq','mJa5mJeWnfDOtgvcra','C291CMnL','Aw52ywXPzcbHCgKGA2v5','mtbmtwPMA3m','yNvKz2v0','uMf0zsbSAw1PDcbYzxrYEsb0AhjLC2HVBgqGzxHJzwvKzwqGka','z2v0qxzHAwXHyMXLtw9KzwXZ','u2vYDMLJzsa','r2vUzxjHDgLUzYbPBwfNzsb1C2LUzYbZzxj2zxiTyMfZzwqGAw1Hz2uGz2vUzxjHDgLVBG','x3nLBgvJDezHBgXIywnRu2vYDMLJzq','rMfPBgvKihrVihvWzgf0zsbJB252zxjZyxrPB24G','C2vYDMLJzxm','C2vYDMvYsgvHBhrO','x3rYEuzHBgXIywnRu2vYDMLJzq','ihDPDgGGyw55ihnLCNzPy2u','ktOG','zNjVBq','y2f0y2G','z2v0sw1Hz2vezxnJCMLWDgLVBG','qwXSieXmtsbZzxj2AwnLCYbZAhv0igrVD24','C2H1DgrVD24','mtyWntqXDMf4zNLl','DgHYB3r0Bgu','tu9eruXFufjfrKvsru5drq','CMvZzxrsyxrLtgLTAxriAxrZ','nty1ywrxs0nR','CMf0zuXPBwL0u2vYDMLJzq','AgvHBhrOq2HLy2S','ieXmtsbZzxj2AwnLCW','x3nLBgvJDfnTyxj0zxn0u2vYDMLJzq','x2LZuMf0zuXPBwL0rxjYB3i','CgvYzM9YBwfUy2vnzxrYAwnZ','DxnHz2u','ntaZ','ChjVBxb0x3rVB19SB25N','C2v0','DxbKyxrLq29UDMvYC2f0Aw9U','u2vYDMvYlwjHC2vKieXmtsbZzxj2AwnLigLUAxrPywXPEMvKihn1y2nLC3nMDwXSEq','yNvKz2v0u2vYDMLJzq','DxnLu2vYDMvYteXn','Cg93','y29UzMLN','zw5ZDxjLsw5PDgLHBgL6zwq','qKfmqu5druq','ig5VDcbHDMfPBgfIBgu','vu5bvKfjtefcteu','C2vYDMLJzvn0yxr1CW','AgfUzgXLuMf0zuXPBwL0sgL0','x3nLBgvJDfnLCNzPy2vcEvbYzwzLCMvUy2vpCMrLCG','C2vYDMvYteXnu2vYDMLJzq','z2v0u2vYDMvYsgvHBhrO','D2fPDeLMtMvLzgvK','Bwf4Aw11BsbJB250zxH0igXLBMD0Aa','C3rHDhvZ','revhuKferuq','zgvNCMfKzwq','ChjPy2LUzW','B3bLBMfP','mJGYndvJBLzVEw8','r2v0DgLUzYbZDw1Tyxj5igzVCIbJB252zxjZyxrPB246ia','yxP1CMuTB3bLBMfPlwrHBgXLmW','y29UDgvUDcbWB2XPy3K','z2v0qNvKz2v0vxnHz2u','vw5RBM93BIbLCNjVCG','CMvJB3jKvxnHz2u','Bwf4uMf0zuXPBwL0uMv0CMLLCW','Dg90ywXmyxrLBMn5','A2v5CW','qNvKz2v0ihnLCNzPy2uGBM90igf2ywLSywjSzq','Bw9KzwW','y2XLyxi','C2vYDMLJzsb1BMf2ywLSywjSzq','u2vYDMvYihzPC2LVBIbZzxj2AwnLigzHAwXLzcWGDhj5Aw5NigzHBgXIywnRoG','AgfZ','zMLSDgvY','AgvHBhrOEq','y29UDgv4DcbSzw5NDgGGzxHJzwvKzwq','CxvVDgeGzxHJzwvKzwq','x3nLBgvJDef2ywLSywjSzvnLCNzPy2u','yw50AhjVCgLJlw9WDxm','C3bLzwq','Dw5HDMfPBgfIBgu','qvzbsuXbqKXf','su5uruXmsuDftKnf','mZi2mZiWtxjHwLDi','u0vsvKLdrv9tvefuvvm','zNvUy3rPB24','x3nLBgvJDejHBgfUy2vKu2vYDMLJzq','q29TCgfJDgL6yxrPB24Gy29TCgXLDgvKlcbYzxrYEwLUzYbYzxf1zxn0','z29Vz2XLlwDLBwLUAq','u1rsqvrfr1K','BgXTu3rYyxrLz3K','zw50CMLLCW','zxHJzwvKCYbJB250zxH0ihDPBMrVDW','CMvXDwvZDcbSAw1PDa','yxv0AgvUDgLJyxrPB24','ChjPBwfYEvnLCNzPy2u','z2v0qwXSu3rHDhvZ','ndi5','Dg9mB3DLCKnHC2u','zgvSyxLnDwX0AxbSAwvY','x2DLDfnLCNzPy2vnB2rLBeLK','yMfZzurLBgf5txm','C2vYDMvYigvYCM9Y','yxP1CMuTywKTz3jVAZm','vxbKyxrPBMCGy29UDMvYC2f0Aw9UoIa','mtmYAgngBw1e','q29UDMvYC2f0Aw9Uia','sw5PDgLHBgL6zwqG','yxP1CMuTB3bLBMfPlwDWDdm1','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','x2LUAxrPywXPEMvtzxj2zxjtzxj2AwnL','teXnihnLCNzPy2uGAw5PDgLHBgL6yxrPB24GzMfPBgvKlcbIDxqGy29UDgLUDwLUzYb3AxrOigXPBwL0zwqGzNvUy3rPB25HBgL0Eq','x2LZuhjVBxb0vg9Vtg9Uz0vYCM9Y','Bg9Nz2vY','mta1nLv5EfzVtG','Aw5JBhvKzxm','BMv0D29YAW','x2DLDerLzMf1BhrnB2rLBezVCLnLCNzPy2u','C2L6zq','Dg9tDhjPBMC','ndaX','C3vJy2vZC2z1BfjLCxvLC3rZ','zxn0Aw1HDgvuB2TLBKnVDw50','x3nLBgvJDeXHCMDLC3rdB250zxH0u2vYDMLJzq','revgqvvmvf9srvrswv9nvuXusvbmsuvs','rMfSBgjHy2SGC2vYDMLJzsbHBhnVigzHAwXLzdOG','yxP1CMuTB3bLBMfPlwDWDdq','q29TCgfJDgL6yxrPB24GzMfPBgvKoG','Cgf5Bg9Hzcb0B28GBgfYz2u','zMfPBgvKuMvXDwvZDhm','Dg9VigXVBMC','z2v0u2vYDMLJzvn0yxr1CW','x3nLBgvJDfzPC2LVBLnLCNzPy2u','z2v0q29ZDevZDgLTyxrL','qNvKz2v0ihnLCNzPy2uGAw5PDgLHBgL6zwqGD2L0AcbKEw5HBwLJihbYAwnPBMCGC3vWCg9YDa','x2rLBgf5','CMv0CMLLCW','sw5PDgLHBgL6Aw5NieXmtsbZzxj2AwnLCYaOu2vYDMvYig1Vzgu6ia','AxnjBML0AwfSAxPLza','x3jLy29YzfvZywDLqw5Ktwv0CMLJCW','vMLZAw9UihjLCxvLC3qGzMfPBgvKicHHDhrLBxb0ia','ndaW','y29UDgv4Da','C2vYDMvY','B25qCM9TChruB29mB25N','z2v0uMf0zuXPBwL0Aw5Nu3rHDhvZ','zxjYB3i','teXnihnLCNzPy2uGAw5PDgLHBgL6zwq','x2LUAxrPywXPEMvcDwrNzxrtzxj2AwnL','ndyWmJu3CNDWCuz6','uMvXDwvZDcbMywLSzwqGkgf0DgvTChqG','BM93','x2HHBMrSzvjLCxvLC3ruB29myxjNzuvYCM9Y','yw50AhjVCgLJlwHHAwT1','Dg9Vig1HBNKGCMvXDwvZDhm','rMfPBgvKihrVihjLz2LZDgvYignVBNzLCNnHDgLVBIa','C2vYDMLJzuLUC3rHBMnLCW','CMf0zsbSAw1PDa','qwXSihzPC2LVBIbYzxrYEsbHDhrLBxb0CYbMywLSzwq6ia','z2v0','ic0GCgvYzM9YBwLUzYbLBwvYz2vUy3KGy29TCgfJDgL6yxrPB24','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','uMvNAxn0zxjPBMCGy29UDMvYC2f0Aw9UoIa','qwrKAw5Nia','Aw5PDgLHBgL6zq','z2v0twf4q29UDgv4DfnPEMu','CMf0zv9SAw1PDa','Aw52ywXPzcbYzxf1zxn0igzVCM1HDa','z2v0sgvHBhrOu3rHDhvZ','yw50AhjVCgLJlxnVBM5LDa','D2fYBG'];a0_0x414e=function(){return _0x1c7ab9;};return a0_0x414e();}const a0_0x5df018=a0_0x5df2;(function(_0x50f285,_0x3114a9){const _0x3f0fba=a0_0x5df2,_0x60ed39=_0x50f285();while(!![]){try{const _0x5525d8=-parseInt(_0x3f0fba(0x1b5))/0x1*(-parseInt(_0x3f0fba(0x1a3))/0x2)+-parseInt(_0x3f0fba(0x171))/0x3+-parseInt(_0x3f0fba(0x19d))/0x4*(-parseInt(_0x3f0fba(0x1b9))/0x5)+-parseInt(_0x3f0fba(0x190))/0x6+parseInt(_0x3f0fba(0x115))/0x7*(parseInt(_0x3f0fba(0x14e))/0x8)+parseInt(_0x3f0fba(0x1a0))/0x9+parseInt(_0x3f0fba(0x12f))/0xa*(-parseInt(_0x3f0fba(0x145))/0xb);if(_0x5525d8===_0x3114a9)break;else _0x60ed39['push'](_0x60ed39['shift']());}catch(_0x3b046d){_0x60ed39['push'](_0x60ed39['shift']());}}}(a0_0x414e,0x653ad));import{ServerLLMService}from'./serverLLMService.js';function a0_0x5df2(_0x3a57e8,_0x32ac05){const _0x414e18=a0_0x414e();return a0_0x5df2=function(_0x5df22a,_0x10a02e){_0x5df22a=_0x5df22a-0x110;let _0x35ab46=_0x414e18[_0x5df22a];if(a0_0x5df2['bAzVky']===undefined){var _0x4ea547=function(_0x2703fd){const _0x5543ed='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3ba5e0='',_0x22e7e7='';for(let _0x39f033=0x0,_0x1ced02,_0x2ec30b,_0x96a317=0x0;_0x2ec30b=_0x2703fd['charAt'](_0x96a317++);~_0x2ec30b&&(_0x1ced02=_0x39f033%0x4?_0x1ced02*0x40+_0x2ec30b:_0x2ec30b,_0x39f033++%0x4)?_0x3ba5e0+=String['fromCharCode'](0xff&_0x1ced02>>(-0x2*_0x39f033&0x6)):0x0){_0x2ec30b=_0x5543ed['indexOf'](_0x2ec30b);}for(let _0x2546a9=0x0,_0x40c49a=_0x3ba5e0['length'];_0x2546a9<_0x40c49a;_0x2546a9++){_0x22e7e7+='%'+('00'+_0x3ba5e0['charCodeAt'](_0x2546a9)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x22e7e7);};a0_0x5df2['zKsutj']=_0x4ea547,_0x3a57e8=arguments,a0_0x5df2['bAzVky']=!![];}const _0x33d38e=_0x414e18[0x0],_0x3b42f0=_0x5df22a+_0x33d38e,_0x2b7748=_0x3a57e8[_0x3b42f0];return!_0x2b7748?(_0x35ab46=a0_0x5df2['zKsutj'](_0x35ab46),_0x3a57e8[_0x3b42f0]=_0x35ab46):_0x35ab46=_0x2b7748,_0x35ab46;},a0_0x5df2(_0x3a57e8,_0x32ac05);}import{BudgetService}from'./budgetService.js';import{RateLimitService}from'./rateLimitService.js';const HTTP_STATUS_CODES={'REQUEST_ENTITY_TOO_LARGE':0x19d,'BAD_REQUEST':0x190,'UNAUTHORIZED':0x191,'FORBIDDEN':0x193,'NOT_FOUND':0x194,'TOO_MANY_REQUESTS':0x1ad,'INTERNAL_SERVER_ERROR':0x1f4},REQUEST_SIZE_ERROR_PATTERNS=['request\x20entity\x20too\x20large',a0_0x5df018(0x15c),'request\x20too\x20large','message\x20too\x20long','content\x20length\x20exceeds\x20limit'],LLM_CONSTANTS={'HTTP_STATUS':HTTP_STATUS_CODES,'ERROR_PATTERNS':{'REQUEST_TOO_LARGE':REQUEST_SIZE_ERROR_PATTERNS,'PROMPT_TOO_LONG':['too\x20long',a0_0x5df018(0x138),a0_0x5df018(0x127),a0_0x5df018(0x1d4)],'RATE_LIMIT':['rate\x20limit',a0_0x5df018(0x176),a0_0x5df018(0x128),a0_0x5df018(0x1b6)]},'STRATEGY':{'SPEED':a0_0x5df018(0x12b),'INTELLIGENCE':'intelligence','CONTEXT':a0_0x5df018(0x16a),'BALANCED':'balanced'},'DEFAULT_MAX_RETRIES':0x3,'DEFAULT_RETRY_DELAY_MS':0x3e8,'DEFAULT_RETRY_MULTIPLIER':0x2,'DEFAULT_SUMMARY_SERVICE':a0_0x5df018(0x16b),'SERVICE_STATUS':{'AVAILABLE':'available','DEGRADED':a0_0x5df018(0x112),'UNAVAILABLE':a0_0x5df018(0x12c)},'MODEL_PREFERENCE':{'SPEED':[a0_0x5df018(0x175),'azure-ai-phi4','azure-openai-gpt35','google-gemini','anthropic-sonnet','azure-openai-gpt4','anthropic-opus'],'INTELLIGENCE':['anthropic-opus',a0_0x5df018(0x15a),a0_0x5df018(0x143),a0_0x5df018(0x185),'google-gemini',a0_0x5df018(0x148),'anthropic-haiku'],'BALANCED':['anthropic-sonnet',a0_0x5df018(0x15a),a0_0x5df018(0x143),a0_0x5df018(0x134),a0_0x5df018(0x12a),'azure-openai-gpt35','anthropic-haiku']},'ERROR_TYPES':{'PROMPT_TOO_LONG':a0_0x5df018(0x1c2),'RATE_LIMIT':a0_0x5df018(0x182),'AUTHENTICATION':a0_0x5df018(0x13a),'NETWORK':a0_0x5df018(0x150),'SERVER':a0_0x5df018(0x16b),'VALIDATION':'validation'}};export class LLMService{constructor(_0x2703fd,_0x5543ed){const _0x48636b=a0_0x5df018;this[_0x48636b(0x1c9)]=_0x2703fd,this['logger']=_0x5543ed,this['serviceInstances']=new Map(),this['conversationServices']=new Map(),this[_0x48636b(0x1ce)]=new Map(),this[_0x48636b(0x1c7)]=_0x2703fd[_0x48636b(0x1c7)]!==![],this['primaryService']=null,this['serverLLMService']=null,this[_0x48636b(0x166)]=![],this['rateLimitService']=new RateLimitService(_0x5543ed),this['budgetService']=null,this[_0x48636b(0x16c)]=null,this['performanceMetrics']={'totalRequests':0x0,'successfulRequests':0x0,'failedRequests':0x0,'totalLatency':0x0,'averageLatency':0x0},this[_0x48636b(0x14d)][_0x48636b(0x197)](_0x48636b(0x16f),{'useServerLLM':this[_0x48636b(0x1c7)],'strategy':_0x2703fd[_0x48636b(0x136)]||LLM_CONSTANTS[_0x48636b(0x135)]['BALANCED']}),this[_0x48636b(0x180)]()['catch'](_0x3ba5e0=>{const _0x9d9bac=_0x48636b;this[_0x9d9bac(0x14d)][_0x9d9bac(0x16e)]('Failed\x20to\x20initialize\x20LLM\x20services\x20in\x20constructor:',_0x3ba5e0);});}async['initialize'](){const _0x6d8d6f=a0_0x5df018;if(this[_0x6d8d6f(0x166)])return;this['logger'][_0x6d8d6f(0x197)](_0x6d8d6f(0x165)+this[_0x6d8d6f(0x1c7)]+')');try{this['useServerLLM']&&await this[_0x6d8d6f(0x14a)]();this['_initializeBudgetService']();if(this[_0x6d8d6f(0x178)][_0x6d8d6f(0x152)]===0x0)throw new Error(_0x6d8d6f(0x19b));this['isInitialized']=!![],this['logger'][_0x6d8d6f(0x197)](_0x6d8d6f(0x147)+this['serviceInstances']['size']+_0x6d8d6f(0x1bc),{'primary':this[_0x6d8d6f(0x13b)],'services':Array[_0x6d8d6f(0x1b0)](this['serviceInstances']['keys']())});}catch(_0x22e7e7){this['logger'][_0x6d8d6f(0x16e)]('Failed\x20to\x20initialize\x20LLM\x20services:',_0x22e7e7);if(this[_0x6d8d6f(0x166)]===![])this[_0x6d8d6f(0x14d)][_0x6d8d6f(0x186)](_0x6d8d6f(0x14b));else throw _0x22e7e7;}}async[a0_0x5df018(0x14a)](){const _0x39638c=a0_0x5df018;try{this['logger']['info']('Initializing\x20server-based\x20LLM\x20service...'),this['serverLLMService']=new ServerLLMService(this[_0x39638c(0x1c9)],this[_0x39638c(0x14d)]),await this[_0x39638c(0x1d1)]['initialize'](),this['serviceInstances'][_0x39638c(0x1c3)](_0x39638c(0x16b),this[_0x39638c(0x1d1)]),this[_0x39638c(0x1ce)]['set'](_0x39638c(0x16b),LLM_CONSTANTS[_0x39638c(0x130)]['AVAILABLE']),this['primaryService']=_0x39638c(0x16b);const _0x39f033=await this['serverLLMService'][_0x39638c(0x1a6)]()||[];this['logger'][_0x39638c(0x197)](_0x39638c(0x1c5),{'modelsAvailable':this['serverLLMService']['getAvailableModels']()['length']});}catch(_0x1ced02){this['logger'][_0x39638c(0x16e)]('Failed\x20to\x20initialize\x20server\x20LLM\x20service:',_0x1ced02),this['useServerLLM']=![],this['primaryService']=null,this['serverLLMService']=null,this[_0x39638c(0x14d)]['warn']('Falling\x20back\x20to\x20local\x20LLM\x20services');}}[a0_0x5df018(0x170)](){const _0x48f6d3=a0_0x5df018;this['budgetService']=new BudgetService(this[_0x48f6d3(0x1c9)],this[_0x48f6d3(0x14d)],this['serverLLMService']),this['logger']['info'](_0x48f6d3(0x162));}async['ensureInitialized'](){!this['isInitialized']&&await this['initialize']();}async['getAvailableModels'](){const _0x8dfd43=a0_0x5df018;await this[_0x8dfd43(0x1ca)]();const _0x2ec30b=[];if(this['serverLLMService']&&this[_0x8dfd43(0x166)])try{let _0x96a317=await this['serverLLMService'][_0x8dfd43(0x1a6)]();_0x2ec30b[_0x8dfd43(0x18f)](..._0x96a317);}catch(_0x2546a9){this[_0x8dfd43(0x14d)]['warn']('Failed to get models from server service:',_0x2546a9);}return _0x2ec30b;}async['getPricingData'](){const _0x501119=a0_0x5df018;return this['budgetService']?await this[_0x501119(0x1c6)]['getAllPricing']():new Map();}async['registerConversation'](_0x40c49a,_0x1d2a3e,_0x18d3d1){const _0x265d2a=a0_0x5df018;await this[_0x265d2a(0x1ca)](),this['logger'][_0x265d2a(0x197)](_0x265d2a(0x17e)+_0x40c49a);const _0x537950=this['_selectServiceForConversation'](_0x40c49a);if(!_0x537950){const _0x51e332={'useServerLLM':this['useServerLLM'],'serviceInstancesCount':this['serviceInstances']['size'],'serviceInstances':Array['from'](this['serviceInstances'][_0x265d2a(0x11e)]()),'serviceStatusCount':this['serviceStatus'][_0x265d2a(0x152)],'serviceStatus':Object['fromEntries'](this['serviceStatus'][_0x265d2a(0x137)]()),'isInitialized':this[_0x265d2a(0x166)]};this['logger']['error'](_0x265d2a(0x18c),_0x51e332);throw new Error('No\x20suitable\x20LLM\x20service\x20available\x20for\x20this\x20conversation.\x20Debug:\x20'+JSON['stringify'](_0x51e332));}const _0x590268=this[_0x265d2a(0x178)][_0x265d2a(0x17b)](_0x537950);try{await _0x590268['registerConversation'](_0x40c49a,_0x1d2a3e,_0x18d3d1),this['conversationServices']['set'](_0x40c49a,_0x537950),this[_0x265d2a(0x14d)][_0x265d2a(0x197)]('Registered\x20conversation\x20'+_0x40c49a+'\x20with\x20service\x20'+_0x537950);}catch(_0x4ce094){this[_0x265d2a(0x14d)][_0x265d2a(0x16e)]('Failed\x20to\x20register\x20conversation\x20'+_0x40c49a+':',_0x4ce094);const _0x492fc4=this[_0x265d2a(0x1a9)](_0x537950);if(_0x492fc4){const _0x2344ec=this['serviceInstances']['get'](_0x492fc4);await _0x2344ec['registerConversation'](_0x40c49a,_0x1d2a3e,_0x18d3d1),this['conversationServices']['set'](_0x40c49a,_0x492fc4),this[_0x265d2a(0x14d)]['info']('Registered\x20conversation\x20'+_0x40c49a+'\x20with\x20fallback\x20service\x20'+_0x492fc4);}else throw new Error(_0x265d2a(0x177)+_0x40c49a+_0x265d2a(0x1ae));}}async['sendMessage'](_0x2f98d9,_0x4de2de,_0x191e74){const _0x8e276=a0_0x5df018,_0x179960=Date[_0x8e276(0x173)]();this[_0x8e276(0x1bf)]['totalRequests']++;try{const _0x155f53=this['conversationServices']['get'](_0x2f98d9);if(!_0x155f53)throw new Error(_0x8e276(0x146)+_0x2f98d9+_0x8e276(0x149));const _0x49bc89=this[_0x8e276(0x178)]['get'](_0x155f53);if(!_0x49bc89)throw new Error('Service\x20'+_0x155f53+'\x20not\x20found\x20for\x20conversation\x20'+_0x2f98d9);const _0xb05f6e=this[_0x8e276(0x140)](_0x155f53);await this['rateLimitService']['waitIfNeeded'](_0xb05f6e);const _0x599c28=await this['_sendMessageWithRetry'](_0x49bc89,_0x155f53,_0x2f98d9,_0x4de2de,_0x191e74);return await this[_0x8e276(0x167)](_0x49bc89,_0x155f53,_0x179960,!![]),_0x599c28;}catch(_0x54ae6c){this['performanceMetrics'][_0x8e276(0x15d)]++,this['logger'][_0x8e276(0x16e)](_0x8e276(0x196)+_0x2f98d9+':',_0x54ae6c);throw _0x54ae6c;}}async['_sendMessageWithRetry'](_0x53c047,_0x145b39,_0x2557ff,_0x2c48e9,_0x1ecaab){const _0x25c08e=a0_0x5df018,_0x3daded=this[_0x25c08e(0x1c9)][_0x25c08e(0x164)]?.['maxRetries']||LLM_CONSTANTS['DEFAULT_MAX_RETRIES'],_0x3487de=this[_0x25c08e(0x1c9)]['retries']?.[_0x25c08e(0x11c)]||0x5,_0x4d28ba=this[_0x25c08e(0x1c9)][_0x25c08e(0x164)]?.['compactizationDelayMs']||0x7d0;let _0x4774df=0x0,_0x16fff7=0x0,_0x5a6d7e=null;while(_0x4774df<=_0x3daded){try{const _0x470ade=await _0x53c047['sendMessage'](_0x2557ff,_0x2c48e9,_0x1ecaab);if(_0x145b39!=='server'){const _0x4ba2e8=this['_getServiceModelId'](_0x145b39);this[_0x25c08e(0x1ba)]['resetRateLimitHits'](_0x4ba2e8);}return this[_0x25c08e(0x1ce)][_0x25c08e(0x17b)](_0x145b39)===LLM_CONSTANTS['SERVICE_STATUS']['DEGRADED']&&this[_0x25c08e(0x1ce)]['set'](_0x145b39,LLM_CONSTANTS[_0x25c08e(0x130)]['AVAILABLE']),_0x470ade;}catch(_0x27d129){_0x5a6d7e=_0x27d129,this[_0x25c08e(0x14d)]['error'](_0x25c08e(0x172)+(_0x4774df+0x1)+'/'+(_0x3daded+0x1)+'):',_0x27d129);if(this['_isPromptTooLongError'](_0x27d129)){await this['_handlePromptTooLongError'](_0x2557ff);const _0x5456ab=this[_0x25c08e(0x140)](_0x145b39);this['logger']['info']('Adding\x20'+_0x4d28ba+'ms\x20delay\x20after\x20compactization'),await this['_delay'](_0x4d28ba),await this[_0x25c08e(0x1ba)]['waitIfNeeded'](_0x5456ab);continue;}if(this['_isRequestTooLargeError'](_0x27d129)){await this[_0x25c08e(0x174)](_0x2557ff);const _0x45a2b9=this['_getServiceModelId'](_0x145b39);this[_0x25c08e(0x14d)][_0x25c08e(0x197)](_0x25c08e(0x17f)+_0x4d28ba+_0x25c08e(0x191)),await this['_delay'](_0x4d28ba),await this[_0x25c08e(0x1ba)]['waitIfNeeded'](_0x45a2b9);continue;}if(_0x145b39!=='server'&&this[_0x25c08e(0x1be)](_0x27d129)){const _0x4452c2=this[_0x25c08e(0x140)](_0x145b39);_0x16fff7++;if(_0x16fff7>_0x3487de)throw new Error(_0x25c08e(0x1a5)+_0x3487de+_0x25c08e(0x1af)+_0x27d129[_0x25c08e(0x19f)]);this['rateLimitService'][_0x25c08e(0x1cf)](_0x4452c2);if(_0x4774df<_0x3daded){this[_0x25c08e(0x14d)][_0x25c08e(0x197)]('Rate\x20limit\x20error\x20detected,\x20waiting\x20and\x20retrying...\x20(rate\x20limit\x20attempt\x20'+_0x16fff7+'/'+_0x3487de+')'),await this[_0x25c08e(0x1ba)]['waitIfNeeded'](_0x4452c2);continue;}}if(_0x145b39===_0x25c08e(0x16b)&&this['_isServerError'](_0x27d129)){const _0x3d6acc=await this[_0x25c08e(0x1ad)](_0x2557ff,_0x2c48e9,_0x1ecaab);if(_0x3d6acc)return _0x3d6acc;}if(this['_isNonRetryableError'](_0x27d129))break;if(_0x4774df>=_0x3daded)break;this['serviceStatus']['set'](_0x145b39,LLM_CONSTANTS['SERVICE_STATUS'][_0x25c08e(0x111)]);const _0x2242d7=this['_calculateRetryDelay'](_0x4774df);await this['_delay'](_0x2242d7),_0x4774df++;}}throw new Error('All\x20retry\x20attempts\x20failed:\x20'+(_0x5a6d7e?.['message']||_0x25c08e(0x11a)));}async['_tryFallbackService'](_0x1b0fcb,_0x27a9f3,_0x2f19fc){const _0x12eab5=a0_0x5df018,_0x24b8c7=this['_selectFallbackService'](_0x12eab5(0x16b));if(!_0x24b8c7)return null;try{this[_0x12eab5(0x14d)]['info']('Switching\x20to\x20fallback\x20service:\x20'+_0x24b8c7);const _0x29f817=this[_0x12eab5(0x178)]['get'](_0x24b8c7);return await _0x29f817['registerConversation'](_0x1b0fcb,_0x2f19fc['systemPrompt']||'Conversation\x20resumed'),this['conversationServices']['set'](_0x1b0fcb,_0x24b8c7),await _0x29f817['sendMessage'](_0x1b0fcb,_0x27a9f3,_0x2f19fc);}catch(_0x3f53ae){return this[_0x12eab5(0x14d)][_0x12eab5(0x16e)](_0x12eab5(0x159)+_0x3f53ae[_0x12eab5(0x19f)]),null;}}async[a0_0x5df018(0x167)](_0x3880e3,_0x1388ea,_0x2d9fb2,_0x24fd91){const _0x181760=a0_0x5df018,_0x2bfecb=Date[_0x181760(0x173)]()-_0x2d9fb2;this[_0x181760(0x1bf)][_0x181760(0x11d)]+=_0x2bfecb,this[_0x181760(0x1bf)]['averageLatency']=this[_0x181760(0x1bf)]['totalLatency']/this['performanceMetrics']['totalRequests'];_0x24fd91&&this[_0x181760(0x1bf)][_0x181760(0x155)]++;if(this[_0x181760(0x1c6)]&&_0x1388ea!==_0x181760(0x16b))try{const _0x307dba=_0x3880e3['getLastInputTokenCount'](),_0x52e9d7=_0x3880e3['getLastOutputTokenCount'](),_0x435b82=this['_getDefaultModelForService'](_0x1388ea);await this['budgetService']['recordUsage'](_0x1388ea,_0x435b82,_0x307dba,_0x52e9d7);}catch(_0x2837c7){this[_0x181760(0x14d)][_0x181760(0x186)]('Failed\x20to\x20record\x20usage\x20for\x20budget\x20tracking:',_0x2837c7);}}async['_handlePromptTooLongError'](_0x545ad4){const _0x5b251c=a0_0x5df018;this['logger'][_0x5b251c(0x186)]('Prompt\x20too\x20long\x20error\x20detected\x20-\x20requesting\x20compactization');if(this[_0x5b251c(0x16c)])try{await this['onPromptTooLong'](_0x545ad4),this['logger']['info'](_0x5b251c(0x133));}catch(_0x33d97c){this[_0x5b251c(0x14d)][_0x5b251c(0x16e)](_0x5b251c(0x15b),_0x33d97c);throw _0x33d97c;}else throw new Error(_0x5b251c(0x18d));}async[a0_0x5df018(0x1c4)](_0x126c9d,_0x554303){const _0xc08469=a0_0x5df018;this[_0xc08469(0x14d)]['info'](_0xc08469(0x144)+_0x126c9d);const _0x4ce89d=this[_0xc08469(0x17d)][_0xc08469(0x17b)](_0x126c9d);if(!_0x4ce89d)throw new Error('Conversation\x20'+_0x126c9d+'\x20is\x20not\x20registered\x20with\x20any\x20service');const _0x52b2c2=this['serviceInstances']['get'](_0x4ce89d);if(!_0x52b2c2)throw new Error('Service\x20'+_0x4ce89d+'\x20not\x20found\x20for\x20conversation\x20'+_0x126c9d);try{await _0x52b2c2[_0xc08469(0x1c4)](_0x126c9d,_0x554303);}catch(_0x5411cb){this['logger'][_0xc08469(0x16e)](_0xc08469(0x1aa)+_0x126c9d+':',_0x5411cb);throw _0x5411cb;}}async['getSummary'](_0x5e0c5e,_0xf17697){const _0x27d600=a0_0x5df018;this[_0x27d600(0x14d)][_0x27d600(0x197)](_0x27d600(0x116)+_0x5e0c5e);const _0x31ac76=this['conversationServices'][_0x27d600(0x17b)](_0x5e0c5e);if(!_0x31ac76)throw new Error('Cannot\x20get\x20summary:\x20conversation\x20'+_0x5e0c5e+_0x27d600(0x19e));const _0x59bd18=this[_0x27d600(0x178)][_0x27d600(0x17b)](_0x31ac76);if(!_0x59bd18)throw new Error('Cannot\x20get\x20summary:\x20service\x20'+_0x31ac76+_0x27d600(0x1cc));this['logger']['info'](_0x27d600(0x18a)+_0x31ac76);try{const _0x5a9275=await _0x59bd18['getSummary'](_0xf17697,_0x5e0c5e);if(this['budgetService']&&_0x31ac76!==_0x27d600(0x16b)){const _0x27ec59=this[_0x27d600(0x151)](_0x31ac76);await this['budgetService']['recordUsage'](_0x31ac76,_0x27ec59,_0x59bd18['getLastInputTokenCount'](),_0x59bd18['getLastOutputTokenCount']());}return _0x5a9275;}catch(_0x5e1df7){this[_0x27d600(0x14d)][_0x27d600(0x16e)]('Failed\x20to\x20get\x20summary\x20using\x20same\x20service\x20'+_0x31ac76+':',_0x5e1df7);throw _0x5e1df7;}}async['getImageDescription'](_0x101102,_0x4dfbe0,_0x5a2e98={}){const _0x3e11fe=a0_0x5df018;this[_0x3e11fe(0x14d)][_0x3e11fe(0x197)]('Getting\x20image\x20description\x20using\x20vision-capable\x20model');if(this[_0x3e11fe(0x1c7)]&&this['serviceInstances'][_0x3e11fe(0x124)]('server'))try{const _0x234a47=this[_0x3e11fe(0x178)][_0x3e11fe(0x17b)](_0x3e11fe(0x16b));return await _0x234a47['getImageDescription'](_0x101102,_0x4dfbe0,_0x5a2e98);}catch(_0x343c65){this['logger']['warn'](_0x3e11fe(0x123),_0x343c65);}const _0x5918e9=this['_selectVisionService']();if(!_0x5918e9)throw new Error(_0x3e11fe(0x194));const _0x5e1919=this['serviceInstances'][_0x3e11fe(0x17b)](_0x5918e9),_0x4957d4=this[_0x3e11fe(0x140)](_0x5918e9);await this[_0x3e11fe(0x1ba)][_0x3e11fe(0x1d3)](_0x4957d4);const _0x4b3348=this['config'][_0x3e11fe(0x164)]?.['maxRetries']||LLM_CONSTANTS['DEFAULT_MAX_RETRIES'];let _0x341055=0x0,_0x3a2ddf=null;while(_0x341055<=_0x4b3348){try{const _0x4b88c9=await _0x5e1919[_0x3e11fe(0x1b2)](_0x101102,_0x4dfbe0,_0x5a2e98);this['rateLimitService'][_0x3e11fe(0x1b8)](_0x4957d4);if(this[_0x3e11fe(0x1c6)]){const _0x133378=this['_getDefaultModelForService'](_0x5918e9);await this['budgetService'][_0x3e11fe(0x11b)](_0x5918e9,_0x133378,_0x5e1919[_0x3e11fe(0x199)](),_0x5e1919['getLastOutputTokenCount']());}return _0x4b88c9;}catch(_0x356390){_0x3a2ddf=_0x356390,this[_0x3e11fe(0x14d)][_0x3e11fe(0x16e)](_0x3e11fe(0x168)+(_0x341055+0x1)+'/'+(_0x4b3348+0x1)+'):',_0x356390);if(this[_0x3e11fe(0x1be)](_0x356390)){this[_0x3e11fe(0x1ba)]['handleRateLimitHit'](_0x4957d4);if(_0x341055<_0x4b3348){await this[_0x3e11fe(0x1ba)]['waitIfNeeded'](_0x4957d4);continue;}}if(this['_isNonRetryableError'](_0x356390))throw _0x356390;if(_0x341055>=_0x4b3348)break;const _0x20dfd7=this['_calculateRetryDelay'](_0x341055);await this[_0x3e11fe(0x163)](_0x20dfd7),_0x341055++;}}throw new Error(_0x3e11fe(0x17a)+(_0x3a2ddf?.['message']||'Unknown\x20error'));}async[a0_0x5df018(0x189)](_0x1dae7e,_0x23ed71={}){const _0x28fae6=a0_0x5df018;this[_0x28fae6(0x14d)][_0x28fae6(0x197)](_0x28fae6(0x1a8));const _0x8e9c9e=this[_0x28fae6(0x178)]['get']('server');if(_0x8e9c9e)try{const _0x3666c7=await _0x8e9c9e[_0x28fae6(0x189)](_0x1dae7e,_0x23ed71);return this['budgetService']&&_0x3666c7[_0x28fae6(0x1c0)]&&await this['budgetService']['recordUsage']('server',_0x23ed71[_0x28fae6(0x120)]||_0x28fae6(0x117),_0x3666c7[_0x28fae6(0x1c0)]['input_tokens']||0x0,_0x3666c7['usage']['output_tokens']||0x0),_0x3666c7;}catch(_0x23da70){this[_0x28fae6(0x14d)][_0x28fae6(0x186)]('Server\x20image\x20generation\x20failed:',_0x23da70);throw _0x23da70;}throw new Error('Image\x20generation\x20requires\x20server\x20service.\x20Please\x20check\x20your\x20connection\x20and\x20API\x20key.');}async[a0_0x5df018(0x156)](_0x1c4488){const _0x173adb=a0_0x5df018,_0x48addd=this['conversationServices'][_0x173adb(0x17b)](_0x1c4488);if(!_0x48addd)throw new Error(_0x173adb(0x146)+_0x1c4488+_0x173adb(0x149));const _0x2a4fa2=this[_0x173adb(0x178)]['get'](_0x48addd);if(!_0x2a4fa2)throw new Error(_0x173adb(0x1a7)+_0x48addd+'\x20not\x20found\x20for\x20conversation\x20'+_0x1c4488);try{return await _0x2a4fa2['estimateTokenCount'](_0x1c4488);}catch(_0x2a697e){return this['logger'][_0x173adb(0x16e)]('Failed\x20to\x20estimate\x20token\x20count\x20for\x20conversation\x20'+_0x1c4488+':',_0x2a697e),0x0;}}[a0_0x5df018(0x161)](_0x528d08,_0x5b40eb,_0xae9f8f){const _0x4fa47a=a0_0x5df018;if(!this[_0x4fa47a(0x1c6)])return null;return this[_0x4fa47a(0x1c6)][_0x4fa47a(0x161)](_0x528d08,_0x5b40eb,_0xae9f8f);}[a0_0x5df018(0x187)](_0x54de23,_0x3a3fa6,_0x35ac38){const _0x3ba298=a0_0x5df018;if(!this[_0x3ba298(0x1c6)])return null;return this[_0x3ba298(0x1c6)]['checkBudgetForOperation'](_0x54de23,_0x3a3fa6,_0x35ac38);}async[a0_0x5df018(0x119)](){const _0x29f260=a0_0x5df018;if(!this[_0x29f260(0x1c6)])return null;return await this['budgetService'][_0x29f260(0x119)]();}async['setBudgetLimit'](_0x2d0dca){const _0xf3b7ad=a0_0x5df018;if(!this['budgetService'])throw new Error(_0xf3b7ad(0x11f));await this['budgetService']['setBudgetLimit'](_0x2d0dca);}async['refreshPricingData'](){const _0x59c150=a0_0x5df018;if(!this[_0x59c150(0x1c6)])return![];return await this[_0x59c150(0x1c6)][_0x59c150(0x193)]();}[a0_0x5df018(0x15f)](){const _0x15fd22=a0_0x5df018,_0x644f20={};for(const [_0x48bfab,_0x4fb363]of this[_0x15fd22(0x1ce)]['entries']()){_0x644f20[_0x48bfab]={'status':_0x4fb363,'available':_0x4fb363!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE'],'isPrimary':_0x48bfab===this['primaryService']};}return _0x644f20;}['getPerformanceMetrics'](){const _0x29a2d9=a0_0x5df018;return{...this[_0x29a2d9(0x1bf)],'successRate':this[_0x29a2d9(0x1bf)]['totalRequests']>0x0?this['performanceMetrics']['successfulRequests']/this['performanceMetrics']['totalRequests']*0x64:0x0};}[a0_0x5df018(0x16d)](){const _0x321b1a=a0_0x5df018;return this[_0x321b1a(0x1ba)][_0x321b1a(0x13c)]();}['registerPromptTooLongHandler'](_0x1e7af1){const _0x59c67b=a0_0x5df018;this['onPromptTooLong']=_0x1e7af1,this[_0x59c67b(0x14d)][_0x59c67b(0x197)]('Prompt\x20too\x20long\x20handler\x20registered');}async[a0_0x5df018(0x184)](){const _0x30866f=a0_0x5df018,_0x3ad6e0={'overall':_0x30866f(0x126),'services':{},'budget':null,'performance':this['getPerformanceMetrics'](),'pricing':{'available':![],'modelsWithPricing':0x0,'lastUpdate':null}};for(const [_0x542091,_0x219114]of this['serviceStatus']['entries']()){_0x3ad6e0['services'][_0x542091]={'status':_0x219114,'available':_0x219114!==LLM_CONSTANTS[_0x30866f(0x130)]['UNAVAILABLE']},_0x219114===LLM_CONSTANTS[_0x30866f(0x130)][_0x30866f(0x1cd)]&&(_0x3ad6e0['overall']='degraded');}if(this[_0x30866f(0x1d1)])try{const _0x377ca9=await this[_0x30866f(0x1d1)][_0x30866f(0x1d2)]();_0x3ad6e0['services'][_0x30866f(0x16b)][_0x30866f(0x1ac)]=_0x377ca9,_0x377ca9[_0x30866f(0x110)]!=='healthy'&&(_0x3ad6e0['overall']='degraded');}catch(_0x43d7e9){_0x3ad6e0[_0x30866f(0x1ab)]['server'][_0x30866f(0x1ac)]={'status':_0x30866f(0x16e),'error':_0x43d7e9['message']},_0x3ad6e0[_0x30866f(0x195)]=_0x30866f(0x112);}if(this['budgetService'])try{_0x3ad6e0[_0x30866f(0x1a4)]=await this[_0x30866f(0x1c6)][_0x30866f(0x1bb)](),_0x3ad6e0['budget'][_0x30866f(0x110)]!==_0x30866f(0x126)&&(_0x3ad6e0[_0x30866f(0x195)]=_0x30866f(0x112));}catch(_0x700205){_0x3ad6e0[_0x30866f(0x1a4)]={'status':'error','error':_0x700205['message']},_0x3ad6e0['overall']=_0x30866f(0x112);}if(this['budgetService']){const _0x4c9b8f=this['budgetService']['getPricingInfo']();_0x3ad6e0[_0x30866f(0x113)]={'available':_0x4c9b8f['totalModels']>0x0,'modelsWithPricing':_0x4c9b8f['totalModels'],'lastUpdate':_0x4c9b8f['lastUpdate'],'source':_0x4c9b8f[_0x30866f(0x1a1)]};}return _0x3ad6e0;}async[a0_0x5df018(0x1b4)](){const _0xb34bd0=a0_0x5df018;this['logger']['info']('Shutting\x20down\x20LLM\x20service');const _0xd69a30=[];for(const [_0x49962a,_0x13fcac]of this['serviceInstances'][_0xb34bd0(0x137)]()){typeof _0x13fcac['shutdown']===_0xb34bd0(0x131)&&(this['logger']['info']('Shutting\x20down\x20service:\x20'+_0x49962a),_0xd69a30['push'](_0x13fcac[_0xb34bd0(0x1b4)]()[_0xb34bd0(0x1b1)](_0x4dc5f3=>{const _0x2b9384=_0xb34bd0;this['logger'][_0x2b9384(0x16e)]('Error\x20shutting\x20down\x20service\x20'+_0x49962a+':',_0x4dc5f3);})));}this['budgetService']&&typeof this['budgetService']['shutdown']==='function'&&_0xd69a30[_0xb34bd0(0x18f)](this[_0xb34bd0(0x1c6)][_0xb34bd0(0x1b4)]()[_0xb34bd0(0x1b1)](_0x5593f1=>{this['logger']['error']('Error\x20shutting\x20down\x20budget\x20service:',_0x5593f1);})),await Promise['allSettled'](_0xd69a30),this['serviceInstances']['clear'](),this[_0xb34bd0(0x17d)][_0xb34bd0(0x121)](),this['serviceStatus'][_0xb34bd0(0x121)](),this['logger'][_0xb34bd0(0x197)](_0xb34bd0(0x1b3));}['_selectServiceForConversation'](_0x5817a7,_0xcce91e=[]){const _0x5ad6a8=a0_0x5df018;if(this['useServerLLM']&&this['serviceInstances'][_0x5ad6a8(0x124)](_0x5ad6a8(0x16b))&&!_0xcce91e[_0x5ad6a8(0x14f)]('server')&&this[_0x5ad6a8(0x1ce)]['get'](_0x5ad6a8(0x16b))===LLM_CONSTANTS['SERVICE_STATUS'][_0x5ad6a8(0x12d)])return'server';return this['_selectAvailableService'](_0xcce91e);}[a0_0x5df018(0x129)](_0x224774=[]){const _0x154f28=a0_0x5df018,_0x4f4c8f=Array[_0x154f28(0x1b0)](this[_0x154f28(0x178)][_0x154f28(0x11e)]())[_0x154f28(0x125)](_0x382da8=>!_0x224774['includes'](_0x382da8)&&this['serviceStatus'][_0x154f28(0x17b)](_0x382da8)!==LLM_CONSTANTS[_0x154f28(0x130)][_0x154f28(0x1cd)]);if(_0x4f4c8f['length']===0x0)return null;const _0xa0e0e9=this[_0x154f28(0x1c9)]['llmStrategy']||LLM_CONSTANTS[_0x154f28(0x135)]['BALANCED'];switch(_0xa0e0e9){case LLM_CONSTANTS[_0x154f28(0x135)]['SPEED']:return this['_selectFastestService'](_0x4f4c8f);case LLM_CONSTANTS[_0x154f28(0x135)]['INTELLIGENCE']:return this[_0x154f28(0x1bd)](_0x4f4c8f);case LLM_CONSTANTS[_0x154f28(0x135)][_0x154f28(0x198)]:return this[_0x154f28(0x157)](_0x4f4c8f);case LLM_CONSTANTS['STRATEGY'][_0x154f28(0x1cb)]:default:return this[_0x154f28(0x132)](_0x4f4c8f);}}[a0_0x5df018(0x1a9)](_0x36643f){const _0x195b82=a0_0x5df018,_0xf12b69=Array[_0x195b82(0x1b0)](this['serviceInstances']['keys']())[_0x195b82(0x125)](_0x1d6cf8=>_0x1d6cf8!==_0x36643f&&this['serviceStatus'][_0x195b82(0x17b)](_0x1d6cf8)!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']);if(_0xf12b69['length']===0x0)return null;if(_0x36643f!==_0x195b82(0x18e)&&_0xf12b69['includes']('anthropic'))return'anthropic';return _0xf12b69[0x0];}[a0_0x5df018(0x160)](_0x1d0680=[]){const _0x55069e=a0_0x5df018,_0x15e3f4=[_0x55069e(0x18e),_0x55069e(0x114),'google'],_0x593138=_0x15e3f4[_0x55069e(0x125)](_0x2fba73=>!_0x1d0680['includes'](_0x2fba73)&&this['serviceInstances'][_0x55069e(0x124)](_0x2fba73)&&this[_0x55069e(0x1ce)]['get'](_0x2fba73)!==LLM_CONSTANTS['SERVICE_STATUS'][_0x55069e(0x1cd)]);if(_0x593138['length']===0x0)return null;const _0x3d7c03=[_0x55069e(0x18e),_0x55069e(0x114),'google'];for(const _0x3d562e of _0x3d7c03){if(_0x593138[_0x55069e(0x14f)](_0x3d562e))return _0x3d562e;}return _0x593138[0x0];}[a0_0x5df018(0x19c)](_0x28508b){const _0x326820=a0_0x5df018;return this[_0x326820(0x1d0)](_0x28508b,LLM_CONSTANTS['MODEL_PREFERENCE']['SPEED']);}[a0_0x5df018(0x1bd)](_0x2dd734){const _0x8ded72=a0_0x5df018;return this[_0x8ded72(0x1d0)](_0x2dd734,LLM_CONSTANTS[_0x8ded72(0x1b7)][_0x8ded72(0x12e)]);}['_selectLargestContextService'](_0x3c2ca6){const _0x114367=a0_0x5df018;let _0x191000=null,_0x29c130=0x0;for(const _0x23d6cc of _0x3c2ca6){const _0x58757a=this['serviceInstances'][_0x114367(0x17b)](_0x23d6cc);if(!_0x58757a||typeof _0x58757a[_0x114367(0x181)]!==_0x114367(0x131))continue;const _0x10254f=_0x58757a[_0x114367(0x181)]();_0x10254f>_0x29c130&&(_0x29c130=_0x10254f,_0x191000=_0x23d6cc);}return _0x191000||_0x3c2ca6[0x0];}['_selectBalancedService'](_0x26b108){return this['_selectServiceByPreferenceOrder'](_0x26b108,LLM_CONSTANTS['MODEL_PREFERENCE']['BALANCED']);}['_selectServiceByPreferenceOrder'](_0x2da7de,_0x366e4a){const _0x35be1b=a0_0x5df018,_0x41b3a1={'anthropic':['anthropic-opus','anthropic-sonnet',_0x35be1b(0x175)],'openai':['azure-openai-gpt4','azure-openai-gpt35'],'google':[_0x35be1b(0x134)],'server':[]};for(const _0x4f8f45 of _0x366e4a){for(const _0x2ad079 of _0x2da7de){if(_0x2ad079===_0x35be1b(0x16b))return _0x2ad079;const _0x6417bb=_0x41b3a1[_0x2ad079]||[];if(_0x6417bb['includes'](_0x4f8f45))return _0x2ad079;}}return _0x2da7de[0x0];}['_getServiceModelId'](_0x4b8531){const _0x2692ed=a0_0x5df018,_0x5a4cb4={'anthropic':'anthropic-sonnet','openai':_0x2692ed(0x15a),'google':_0x2692ed(0x134),'server':'server-llm'};return _0x5a4cb4[_0x4b8531]||_0x4b8531;}['_getDefaultModelForService'](_0x5eda8b){return this['_getServiceModelId'](_0x5eda8b);}['_calculateRetryDelay'](_0x422b57){const _0x308cbf=a0_0x5df018,_0x34aeb6=this['config']['retries']?.[_0x308cbf(0x141)]||LLM_CONSTANTS['DEFAULT_RETRY_DELAY_MS'],_0x576d04=this[_0x308cbf(0x1c9)]['retries']?.[_0x308cbf(0x13f)]||LLM_CONSTANTS[_0x308cbf(0x158)];return _0x34aeb6*Math[_0x308cbf(0x1c8)](_0x576d04,_0x422b57);}['_delay'](_0x111062){return new Promise(_0x2c2b3a=>setTimeout(_0x2c2b3a,_0x111062));}['_isRateLimitError'](_0x38ced8){const _0x34c067=a0_0x5df018,_0x1224d0=[_0x34c067(0x179),'too\x20many\x20requests','quota\x20exceeded',_0x34c067(0x139),_0x34c067(0x13d),_0x34c067(0x1b6)],_0xf1a598=_0x38ced8['message']?.[_0x34c067(0x13e)]()||'';return _0x1224d0[_0x34c067(0x192)](_0xc68dea=>_0xf1a598['includes'](_0xc68dea));}[a0_0x5df018(0x19a)](_0x327a8e){const _0x37680f=a0_0x5df018,_0x148a25=[_0x37680f(0x1a2),'authentication\x20failed','unauthorized','model\x20not\x20found',_0x37680f(0x183),_0x37680f(0x118)],_0x5b5783=_0x327a8e[_0x37680f(0x19f)]?.['toLowerCase']()||'';return _0x148a25['some'](_0xb005f5=>_0x5b5783['includes'](_0xb005f5));}[a0_0x5df018(0x14c)](_0x1cb7a4){const _0x2ca65c=a0_0x5df018,_0x1673e8=_0x1cb7a4[_0x2ca65c(0x19f)]?.[_0x2ca65c(0x13e)]()||'',_0x4cec94=_0x1cb7a4[_0x2ca65c(0x153)]?.()?.[_0x2ca65c(0x13e)]()||'';return(_0x1673e8[_0x2ca65c(0x14f)](_0x2ca65c(0x15e))||_0x4cec94[_0x2ca65c(0x14f)]('too\x20long'))&&(_0x1cb7a4['status']===0x190||_0x1673e8['includes'](_0x2ca65c(0x169))||_0x4cec94[_0x2ca65c(0x14f)]('400'));}['_isRequestTooLargeError'](_0x40e91a){const _0x1bd080=a0_0x5df018,_0x202ad3=_0x40e91a[_0x1bd080(0x19f)]?.['toLowerCase']()||'',_0x5233bf=_0x40e91a['status']||_0x40e91a['originalError']?.['status'];return _0x5233bf===0x19d||_0x202ad3['includes']('request\x20entity\x20too\x20large')||_0x202ad3['includes']('payload\x20too\x20large')||_0x202ad3[_0x1bd080(0x14f)]('request\x20too\x20large');}async[a0_0x5df018(0x174)](_0x1e908d){const _0x3a871a=a0_0x5df018;this[_0x3a871a(0x14d)]['warn'](_0x3a871a(0x188)+_0x1e908d+_0x3a871a(0x17c));if(this[_0x3a871a(0x16c)])try{await this['onPromptTooLong'](_0x1e908d),this[_0x3a871a(0x14d)]['info'](_0x3a871a(0x18b)+_0x1e908d);}catch(_0x13a877){this[_0x3a871a(0x14d)][_0x3a871a(0x16e)]('Emergency\x20compactization\x20failed:',_0x13a877);throw _0x13a877;}else throw new Error('Request\x20too\x20large\x20and\x20no\x20compactization\x20handler\x20available');}['_isServerError'](_0x952f37){const _0x144583=a0_0x5df018,_0xff1113=[_0x144583(0x154),'403','500','502',_0x144583(0x1c1),'504','authentication','connection\x20refused',_0x144583(0x150),_0x144583(0x142),_0x144583(0x122)],_0x16b69b=_0x952f37[_0x144583(0x19f)]?.[_0x144583(0x13e)]()||'';return _0xff1113['some'](_0x2d7c5e=>_0x16b69b[_0x144583(0x14f)](_0x2d7c5e));}}export{LLM_CONSTANTS};