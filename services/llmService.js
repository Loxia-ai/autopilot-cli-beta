const a0_0x13dbb7=a0_0x156d;function a0_0x3fe1(){const _0x15cf29=['B3v0Chv0x3rVA2vUCW','C2vYDMLJzvn0yxr1CW','uMvNAxn0zxjPBMCGy29UDMvYC2f0Aw9UoIa','revgqvvmvf9nqvHFuKvuuKLfuW','x3nLBgvJDfnLCNzPy2vcEvbYzwzLCMvUy2vpCMrLCG','yxP1CMuTywKTz3jVAZm','z2v0tgfZDe91Dhb1DfrVA2vUq291BNq','x3nLBgvJDejHBgfUy2vKu2vYDMLJzq','zw50CMLLCW','vu5bvKfjtefcteu','x3rYEuzHBgXIywnRu2vYDMLJzq','ndbKAvrLr0y','BwvZC2fNzq','mta2oduYmunZrhHyBq','su5uruXmsuDftKnf','tM8GteXnihnLCNzPy2vZigfYzsbHDMfPBgfIBgu','ChvZAa','z2v0ugvYzM9YBwfUy2vnzxrYAwnZ','teXnihnLCNzPy2uGAw5PDgLHBgL6zwq','ChjPBwfYEvnLCNzPy2u','r2vUzxjHDgLUzYbPBwfNzsb1C2LUzYbZzxj2zxiTyMfZzwqGAw1Hz2uGz2vUzxjHDgLVBG','BgXTu3rYyxrLz3K','CgvYzM9YBwfUy2vnzxrYAwnZ','CMf0zv9SAw1PDa','u2vYDMvYihzPC2LVBIbZzxj2AwnLigzHAwXLzcWGDhj5Aw5NigzHBgXIywnRoG','C3LZDgvTuhjVBxb0','C2H1DgrVD24','qKfmqu5druq','x3nLBgvJDezHBgXIywnRu2vYDMLJzq','y29UBMvJDgLVBIbYzwz1C2vK','C2L6zq','y2XLyxi','uhjVBxb0ihrVBYbSB25NigfUzcbUBYbJB21Wywn0AxPHDgLVBIbOyw5KBgvYigf2ywLSywjSzq','u2vUzcbTzxnZywDLigzHAwXLzcbMB3iGy29UDMvYC2f0Aw9Uia','DxbKyxrLq29UDMvYC2f0Aw9U','x2LZtM9UuMv0CNLHyMXLrxjYB3i','rMfPBgvKihrVigvZDgLTyxrLihrVA2vUignVDw50igzVCIbJB252zxjZyxrPB24G','CMvMCMvZAfbYAwnPBMDeyxrH','yw50AhjVCgLJlxnVBM5LDa','Aw5PDgLHBgL6zq','Dg9Vig1HBNKGCMvXDwvZDhm','C2v0','uhjVBxb0ihrVBYbSB25NigvYCM9YigrLDgvJDgvKic0GCMvXDwvZDgLUzYbJB21Wywn0AxPHDgLVBG','yxP1CMuTywKTCgHPna','uMvNAxn0zxjLzcbJB252zxjZyxrPB24G','Cg93','C2vYDMLJzuLUC3rHBMnLCW','z29Vz2XLlwDLBwLUAq','qNvKz2v0ihnLCNzPy2uGBM90igf2ywLSywjSzq','Aw52ywXPzcbYzxf1zxn0igzVCM1HDa','Aw52ywXPzcbHCgKGA2v5','q29UDMvYC2f0Aw9UihjLC3vTzwq','C291CMnL','A2v5CW','m1D0DMruzq','8j+AQcbszxf1zxn0ihrVBYbSyxjNzsbKzxrLy3rLzcbMB3iG','u1bfruq','zxjYB3i','C2v0qNvKz2v0tgLTAxq','x3nLBgvJDeXHCMDLC3rdB250zxH0u2vYDMLJzq','u1rsqvrfr1K','BgfZDfvWzgf0zq','z2v0','x2LZuMf0zuXPBwL0rxjYB3i','zw5ZDxjLsw5PDgLHBgL6zwq','ndaW','AxnjBML0AwfSAxPLza','rMfPBgvKihrVihjLy29Yzcb1C2fNzsbMB3iGyNvKz2v0ihrYywnRAw5NoG','x3nLBMrnzxnZywDLv2L0AfjLDhj5','zNjVBq','yw50AhjVCgLJlw9WDxm','BgvUz3rO','r2v0DgLUzYbPBwfNzsbKzxnJCMLWDgLVBIb1C2LUzYb2AxnPB24Ty2fWywjSzsbTB2rLBa','yNvKz2v0','CMv0CMLLCW','x3nLBgvJDfzPC2LVBLnLCNzPy2u','yxzLCMfNzuXHDgvUy3K','rMfSBgjHy2SGC2vYDMLJzsbHBhnVigzHAwXLzdOG','Dg90ywXnB2rLBhm','odq4mteZmLLcrKnwuq','vxnPBMCGC2fTzsbZzxj2AwnLigzVCIbZDw1Tyxj5oIa','x2rLBgf5','ic0GCgvYzM9YBwLUzYbLBwvYz2vUy3KGy29TCgfJDgL6yxrPB24','vxbKyxrPBMCGy29UDMvYC2f0Aw9UoIa','BMv0D29YAW','yxv0AgvUDgLJyxrPB24','u2vYDMvYigLTywDLigDLBMvYyxrPB24GzMfPBgvKoG','ihDPDgGGyw55ihnLCNzPy2u','y29UDgvUDcbWB2XPy3K','Dg9mB3DLCKnHC2u','D2fPDeLMtMvLzgvK','z2v0qNvKz2v0vxnHz2u','z2v0q29ZDevZDgLTyxrL','zgvNCMfKzwq','CMvXDwvZDcb0B28GBgfYz2u','x2DLDfnLCNzPy2vnB2rLBeLK','C2vYDMLJzxm','AgfUzgXLuMf0zuXPBwL0sgL0','Aw5JBhvKzxm','q29TCgfJDgL6yxrPB24Gy29TCgXLDgvKlcbYzxrYEwLUzYbYzxf1zxn0','yw50AhjVCgLJ','C3bLzwq','x3nLBgvJDef2ywLSywjSzvnLCNzPy2u','Bg9Nz2vY','tu9eruXFufjfrKvsru5drq','rMfPBgvKihrVigDLDcbZDw1Tyxj5ihvZAw5NihnHBwuGC2vYDMLJzsa','zNvUy3rPB24','yxv0AgvUDgLJyxrPB24GzMfPBgvK','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','x3jLy29YzfvZywDLqw5Ktwv0CMLJCW','Aw5MBW','z2v0qxzHAwXHyMXLtw9KzwXZ','ihDPDgGGzMfSBgjHy2SGC2vYDMLJzsa','rMfSBgLUzYbIywnRihrVigXVy2fSieXmtsbZzxj2AwnLCW','qwrKAw5Nia','uMvXDwvZDcb0B28GBgfYz2uGyw5Kig5VignVBxbHy3rPEMf0Aw9UigHHBMrSzxiGyxzHAwXHyMXL','BwvZC2fNzsb0B28GBg9UzW','CMvJB3jKvxnHz2u','CMvNAxn0zxjdB252zxjZyxrPB24','B3zLCMfSBa','rw1LCMDLBMn5ignVBxbHy3rPEMf0Aw9UigzHAwXLzdO','yxP1CMuTB3bLBMfPlwDWDdq','Dg9VigXVBMC','uMf0zsbSAw1PDcbYzxrYEsb0AhjLC2HVBgqGzxHJzwvKzwqGka','q29UDMvYC2f0Aw9Uia','uMvXDwvZDcbMywLSzwqGkgf0DgvTChqG','ntaY','qvzbsuXbqKXf','zMLSDgvY','z2v0u3vTBwfYEq','CMvXDwvZDcbLBNrPDhKGDg9VigXHCMDL','C2vYDMvYsgvHBhrO','y29TCgfJDgL6yxrPB25ezwXHEu1Z','CxvVDgeGzxHJzwvKzwq','ndyZodq2mg90qwzVAW','rMfPBgvKihrVihvWzgf0zsbJB252zxjZyxrPB24G','C2vYDMvY','ChjPy2LUzW','u0vsvKLdrv9tvefuvvm','x2LZu2vYDMvYrxjYB3i','C3rYAw5NAwz5','mtmYnJG1veD1EMPy','x2HHBMrSzvjLCxvLC3ruB29myxjNzuvYCM9Y','tM8GDMLZAw9UlwnHCgfIBguGC2vYDMLJzxmGyxzHAwXHyMXL','C2vYDMvYigvYCM9Y','z2v0uhjPy2LUz0LUzM8','Bw9KzwW','sw1Hz2uGz2vUzxjHDgLVBIbYzxf1AxjLCYbZzxj2zxiGC2vYDMLJzs4GugXLyxnLignOzwnRihLVDxiGy29UBMvJDgLVBIbHBMqGqvbjigTLEs4','D2fYBG','x2nHBgn1Bgf0zvjLDhj5rgvSyxK','DxnLu2vYDMvYteXn','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','z2v0sw1Hz2vezxnJCMLWDgLVBG','zxn0Aw1HDgvuB2TLBKnVDw50','yMfSyw5Jzwq','x2LZuMvXDwvZDfrVB0XHCMDLrxjYB3i','C2vYDMLJzsb1BMf2ywLSywjSzq','AgvHBhrOEq','ieXmtsbZzxj2AwnLCW','ig5VDcbHDMfPBgfIBgu','C29Tzq','u3DPDgnOAw5NihrVigzHBgXIywnRihnLCNzPy2u6ia','ig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','x2DLDerLzMf1BhrnB2rLBezVCLnLCNzPy2u','AgfZ','Dg90ywXszxf1zxn0CW','nta0','y29UDgv4Da','CMf0zsbSAw1PDa','ndaZmtaXndvYsvvWy0e','ndaX','uMf0zsbSAw1PDcbLCNjVCIbKzxrLy3rLzcWGD2fPDgLUzYbHBMqGCMv0CNLPBMCUlI4GkhjHDguGBgLTAxqGyxr0zw1WDca','Cgf5Bg9Hzcb0B28GBgfYz2u','C2vYDMvYteXnu2vYDMLJzq','y29UzMLN','CMf0zuXPBwL0u2vYDMLJzq','C3vJy2vZC2z1BfjLCxvLC3rZ','y2f0y2G','revgqvvmvf9srvrswv9eruXbwv9nuW','rMfPBgvKihrVigLUAxrPywXPEMuGteXnihnLCNzPy2vZigLUignVBNn0CNvJDg9YoG','z2v0sgvHBhrOu3rHDhvZ','nZqWnZa2mhDvCgHLEa','zMfPBgvKuMvXDwvZDhm','ig5VDcbMB3vUzcbMB3iGy29UDMvYC2f0Aw9Uia','u2H1DhrPBMCGzg93BIbZzxj2AwnLoIa','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','DgHYB3r0Bgu','B25qCM9TChruB29mB25N','C3rHDhvZ','qwXSihjLDhj5igf0DgvTChrZigzHAwXLzdOG','zgvSyxLnDwX0AxbSAwvY','revgqvvmvf9srvrswv9nvuXusvbmsuvs','Dg9tDhjPBMC','zNjVBuvUDhjPzxm','yxzHAwXHyMXL','Dg90ywXmyxrLBMn5','B3bLBMfP','ndaZ','yNvKz2v0u2vYDMLJzq','nJe4mZzQs2ncruG'];a0_0x3fe1=function(){return _0x15cf29;};return a0_0x3fe1();}(function(_0x4029d6,_0x236d3e){const _0x200fe3=a0_0x156d,_0x202ae1=_0x4029d6();while(!![]){try{const _0x1bcea0=parseInt(_0x200fe3(0x1cb))/0x1+parseInt(_0x200fe3(0x1bd))/0x2+parseInt(_0x200fe3(0x1f4))/0x3*(parseInt(_0x200fe3(0x244))/0x4)+parseInt(_0x200fe3(0x1ab))/0x5+parseInt(_0x200fe3(0x20d))/0x6+parseInt(_0x200fe3(0x183))/0x7*(parseInt(_0x200fe3(0x1c9))/0x8)+-parseInt(_0x200fe3(0x19f))/0x9;if(_0x1bcea0===_0x236d3e)break;else _0x202ae1['push'](_0x202ae1['shift']());}catch(_0x33471d){_0x202ae1['push'](_0x202ae1['shift']());}}}(a0_0x3fe1,0xbbf42));import{ServerLLMService}from'./serverLLMService.js';import{BudgetService}from'./budgetService.js';import{RateLimitService}from'./rateLimitService.js';const HTTP_STATUS_CODES={'REQUEST_ENTITY_TOO_LARGE':0x19d,'BAD_REQUEST':0x190,'UNAUTHORIZED':0x191,'FORBIDDEN':0x193,'NOT_FOUND':0x194,'TOO_MANY_REQUESTS':0x1ad,'INTERNAL_SERVER_ERROR':0x1f4},REQUEST_SIZE_ERROR_PATTERNS=[a0_0x13dbb7(0x240),a0_0x13dbb7(0x1a2),'request\x20too\x20large',a0_0x13dbb7(0x232),'content\x20length\x20exceeds\x20limit'],LLM_CONSTANTS={'HTTP_STATUS':HTTP_STATUS_CODES,'ERROR_PATTERNS':{'REQUEST_TOO_LARGE':REQUEST_SIZE_ERROR_PATTERNS,'PROMPT_TOO_LONG':['too\x20long','exceeds\x20context\x20window','context\x20length\x20exceeded','maximum\x20context\x20length'],'RATE_LIMIT':[a0_0x13dbb7(0x19e),'too\x20many\x20requests',a0_0x13dbb7(0x243),'throttle']},'STRATEGY':{'SPEED':a0_0x13dbb7(0x223),'INTELLIGENCE':'intelligence','CONTEXT':a0_0x13dbb7(0x19d),'BALANCED':a0_0x13dbb7(0x190)},'DEFAULT_MAX_RETRIES':0x3,'DEFAULT_RETRY_DELAY_MS':0x3e8,'DEFAULT_RETRY_MULTIPLIER':0x2,'DEFAULT_SUMMARY_SERVICE':'server','SERVICE_STATUS':{'AVAILABLE':a0_0x13dbb7(0x1b8),'DEGRADED':'degraded','UNAVAILABLE':'unavailable'},'MODEL_PREFERENCE':{'SPEED':['anthropic-haiku',a0_0x13dbb7(0x1e9),'azure-openai-gpt35',a0_0x13dbb7(0x1ed),a0_0x13dbb7(0x1e4),a0_0x13dbb7(0x237),'anthropic-opus'],'INTELLIGENCE':['anthropic-opus',a0_0x13dbb7(0x237),'azure-ai-grok3','anthropic-sonnet',a0_0x13dbb7(0x1ed),'azure-openai-gpt35','anthropic-haiku'],'BALANCED':[a0_0x13dbb7(0x1e4),a0_0x13dbb7(0x237),a0_0x13dbb7(0x1c3),a0_0x13dbb7(0x1ed),a0_0x13dbb7(0x204),'azure-openai-gpt35','anthropic-haiku']},'ERROR_TYPES':{'PROMPT_TOO_LONG':'prompt_too_long','RATE_LIMIT':a0_0x13dbb7(0x1d5),'AUTHENTICATION':a0_0x13dbb7(0x213),'NETWORK':'network','SERVER':'server','VALIDATION':'validation'}};export class LLMService{constructor(_0x71fbd0,_0x4e894b){const _0x541dc5=a0_0x13dbb7;this['config']=_0x71fbd0,this['logger']=_0x4e894b,this[_0x541dc5(0x1ec)]=new Map(),this[_0x541dc5(0x18d)]=new Map(),this[_0x541dc5(0x1bf)]=new Map(),this[_0x541dc5(0x18c)]=_0x71fbd0[_0x541dc5(0x18c)]!==![],this[_0x541dc5(0x1d1)]=null,this[_0x541dc5(0x1a3)]=null,this['isInitialized']=![],this['rateLimitService']=new RateLimitService(_0x4e894b),this['budgetService']=null,this['onPromptTooLong']=null,this[_0x541dc5(0x1d4)]={'totalRequests':0x0,'successfulRequests':0x0,'failedRequests':0x0,'totalLatency':0x0,'averageLatency':0x0},this['logger'][_0x541dc5(0x22c)](_0x541dc5(0x1d0),{'useServerLLM':this['useServerLLM'],'strategy':_0x71fbd0['llmStrategy']||LLM_CONSTANTS['STRATEGY'][_0x541dc5(0x1d9)]}),this[_0x541dc5(0x1e5)]()[_0x541dc5(0x1a7)](_0x2c3a1a=>{const _0x5f2548=_0x541dc5;this['logger']['error'](_0x5f2548(0x1a9),_0x2c3a1a);});}async['initialize'](){const _0x5762b0=a0_0x13dbb7;if(this[_0x5762b0(0x200)])return;this['logger'][_0x5762b0(0x22c)]('Initializing\x20LLM\x20services\x20(Server\x20mode:\x20'+this['useServerLLM']+')');try{this[_0x5762b0(0x18c)]&&await this['_initializeServerService']();this['_initializeBudgetService']();if(this['serviceInstances']['size']===0x0)throw new Error(_0x5762b0(0x1cd));this['isInitialized']=!![],this['logger'][_0x5762b0(0x22c)]('Initialized\x20'+this['serviceInstances'][_0x5762b0(0x1dc)]+_0x5762b0(0x194),{'primary':this[_0x5762b0(0x1d1)],'services':Array['from'](this[_0x5762b0(0x1ec)]['keys']())});}catch(_0x1f9cd5){this[_0x5762b0(0x225)]['error']('Failed\x20to\x20initialize\x20LLM\x20services:',_0x1f9cd5);if(this[_0x5762b0(0x200)]===![])this['logger'][_0x5762b0(0x18a)]('LLM\x20service\x20initialization\x20failed,\x20but\x20continuing\x20with\x20limited\x20functionality');else throw _0x1f9cd5;}}async['_initializeServerService'](){const _0x3974fe=a0_0x13dbb7;try{this['logger'][_0x3974fe(0x22c)]('Initializing\x20server-based\x20LLM\x20service...'),this['serverLLMService']=new ServerLLMService(this[_0x3974fe(0x1a4)],this[_0x3974fe(0x225)]),await this['serverLLMService'][_0x3974fe(0x1e5)](),this['serviceInstances'][_0x3974fe(0x1e7)](_0x3974fe(0x246),this['serverLLMService']),this[_0x3974fe(0x1bf)][_0x3974fe(0x1e7)]('server',LLM_CONSTANTS['SERVICE_STATUS'][_0x3974fe(0x23d)]),this['primaryService']='server';const _0x2af8f0=await this[_0x3974fe(0x1a3)][_0x3974fe(0x22d)]()||[];this['logger']['info']('Server-based\x20LLM\x20service\x20initialized\x20successfully',{'modelsAvailable':this[_0x3974fe(0x1a3)][_0x3974fe(0x22d)]()['length']});}catch(_0x3dfb58){this['logger']['error']('Failed\x20to\x20initialize\x20server\x20LLM\x20service:',_0x3dfb58),this['useServerLLM']=![],this['primaryService']=null,this[_0x3974fe(0x1a3)]=null,this[_0x3974fe(0x225)]['warn'](_0x3974fe(0x22f));}}['_initializeBudgetService'](){const _0x109d7=a0_0x13dbb7;this[_0x109d7(0x1bc)]=new BudgetService(this['config'],this[_0x109d7(0x225)],this[_0x109d7(0x1a3)]),this['logger']['info']('Budget\x20service\x20initialized\x20with\x20dynamic\x20pricing\x20support');}async['ensureInitialized'](){!this['isInitialized']&&await this['initialize']();}async['getAvailableModels'](){const _0x1839d2=a0_0x13dbb7;await this[_0x1839d2(0x1fe)]();const _0x7b784b=[];if(this[_0x1839d2(0x1a3)]&&this[_0x1839d2(0x200)])try{let _0x1525bf=await this[_0x1839d2(0x1a3)]['getAvailableModels']();_0x7b784b['push'](..._0x1525bf);}catch(_0x2fee4f){this['logger'][_0x1839d2(0x18a)]('Failed to get models from server service:',_0x2fee4f);}return _0x7b784b;}async['getPricingData'](){const _0x615af4=a0_0x13dbb7;return this[_0x615af4(0x1bc)]?await this['budgetService']['getAllPricing']():new Map();}async[a0_0x13dbb7(0x234)](_0x3d6197,_0x46f2fc,_0x1212d1){const _0x7f8a0b=a0_0x13dbb7;await this[_0x7f8a0b(0x1fe)](),this['logger'][_0x7f8a0b(0x22c)](_0x7f8a0b(0x1c0)+_0x3d6197);const _0x189165=this['_selectServiceForConversation'](_0x3d6197);if(!_0x189165){const _0x4a3612={'useServerLLM':this['useServerLLM'],'serviceInstancesCount':this['serviceInstances'][_0x7f8a0b(0x1dc)],'serviceInstances':Array[_0x7f8a0b(0x203)](this['serviceInstances']['keys']()),'serviceStatusCount':this['serviceStatus']['size'],'serviceStatus':Object[_0x7f8a0b(0x1b7)](this[_0x7f8a0b(0x1bf)][_0x7f8a0b(0x1c6)]()),'isInitialized':this['isInitialized']};this['logger'][_0x7f8a0b(0x1f7)]('No\x20suitable\x20LLM\x20service\x20available\x20-\x20Debug\x20info:',_0x4a3612);throw new Error('No\x20suitable\x20LLM\x20service\x20available\x20for\x20this\x20conversation.\x20Debug:\x20'+JSON[_0x7f8a0b(0x182)](_0x4a3612));}const _0x44899b=this['serviceInstances'][_0x7f8a0b(0x1fc)](_0x189165);try{await _0x44899b[_0x7f8a0b(0x234)](_0x3d6197,_0x46f2fc,_0x1212d1),this['conversationServices']['set'](_0x3d6197,_0x189165),this['logger'][_0x7f8a0b(0x22c)](_0x7f8a0b(0x1ea)+_0x3d6197+'\x20with\x20service\x20'+_0x189165);}catch(_0x4056e6){this['logger'][_0x7f8a0b(0x1f7)]('Failed\x20to\x20register\x20conversation\x20'+_0x3d6197+':',_0x4056e6);const _0x39012f=this[_0x7f8a0b(0x1da)](_0x189165);if(_0x39012f){const _0x4cca02=this['serviceInstances']['get'](_0x39012f);await _0x4cca02['registerConversation'](_0x3d6197,_0x46f2fc,_0x1212d1),this[_0x7f8a0b(0x18d)]['set'](_0x3d6197,_0x39012f),this[_0x7f8a0b(0x225)][_0x7f8a0b(0x22c)](_0x7f8a0b(0x1ea)+_0x3d6197+_0x7f8a0b(0x22e)+_0x39012f);}else throw new Error('Failed\x20to\x20register\x20conversation\x20'+_0x3d6197+_0x7f8a0b(0x215));}}async['sendMessage'](_0x3b233a,_0x489b21,_0x5e2b7b){const _0x4362c8=a0_0x13dbb7,_0x3959d2=Date['now']();this['performanceMetrics'][_0x4362c8(0x19b)]++;try{const _0x153623=this['conversationServices'][_0x4362c8(0x1fc)](_0x3b233a);if(!_0x153623)throw new Error('Conversation\x20'+_0x3b233a+'\x20is\x20not\x20registered\x20with\x20any\x20service');const _0x248527=this[_0x4362c8(0x1ec)]['get'](_0x153623);if(!_0x248527)throw new Error('Service\x20'+_0x153623+_0x4362c8(0x1ad)+_0x3b233a);const _0x2bf4ae=this['_getServiceModelId'](_0x153623);await this['rateLimitService'][_0x4362c8(0x218)](_0x2bf4ae);const _0x3a4199=await this[_0x4362c8(0x202)](_0x248527,_0x153623,_0x3b233a,_0x489b21,_0x5e2b7b);return await this[_0x4362c8(0x22b)](_0x248527,_0x153623,_0x3959d2,!![]),_0x3a4199;}catch(_0x1b2223){this[_0x4362c8(0x1d4)][_0x4362c8(0x1ac)]++,this['logger']['error'](_0x4362c8(0x1df)+_0x3b233a+':',_0x1b2223);throw _0x1b2223;}}async[a0_0x13dbb7(0x202)](_0x41d71c,_0x53796c,_0x41671b,_0x442b0c,_0x3cd299){const _0x335c34=a0_0x13dbb7,_0x30dafe=this['config'][_0x335c34(0x208)]?.['maxRetries']||LLM_CONSTANTS[_0x335c34(0x1c1)],_0xcbd4db=this['config']['retries']?.['maxRateLimitRetries']||0x5,_0x26c4f3=this['config'][_0x335c34(0x208)]?.[_0x335c34(0x242)]||0x7d0;let _0xe9d7e6=0x0,_0xd92c88=0x0,_0x5b44c7=null;while(_0xe9d7e6<=_0x30dafe){try{const _0x492492=await _0x41d71c['sendMessage'](_0x41671b,_0x442b0c,_0x3cd299);if(_0x53796c!=='server'){const _0x34eb94=this[_0x335c34(0x21d)](_0x53796c);this[_0x335c34(0x1a5)]['resetRateLimitHits'](_0x34eb94);}return this[_0x335c34(0x1bf)]['get'](_0x53796c)===LLM_CONSTANTS[_0x335c34(0x248)]['DEGRADED']&&this['serviceStatus'][_0x335c34(0x1e7)](_0x53796c,LLM_CONSTANTS[_0x335c34(0x248)][_0x335c34(0x23d)]),_0x492492;}catch(_0x1a8a63){_0x5b44c7=_0x1a8a63,this['logger'][_0x335c34(0x1f7)](_0x335c34(0x23b)+(_0xe9d7e6+0x1)+'/'+(_0x30dafe+0x1)+'):',_0x1a8a63);if(this['_isPromptTooLongError'](_0x1a8a63)){await this['_handlePromptTooLongError'](_0x41671b);const _0xa5c3aa=this['_getServiceModelId'](_0x53796c);this[_0x335c34(0x225)][_0x335c34(0x22c)]('Adding\x20'+_0x26c4f3+'ms\x20delay\x20after\x20compactization'),await this['_delay'](_0x26c4f3),await this[_0x335c34(0x1a5)]['waitIfNeeded'](_0xa5c3aa);continue;}if(this['_isRequestTooLargeError'](_0x1a8a63)){await this['_handleRequestTooLargeError'](_0x41671b);const _0x48537c=this['_getServiceModelId'](_0x53796c);this['logger'][_0x335c34(0x22c)](_0x335c34(0x230)+_0x26c4f3+'ms\x20delay\x20after\x20emergency\x20compactization'),await this['_delay'](_0x26c4f3),await this['rateLimitService']['waitIfNeeded'](_0x48537c);continue;}if(_0x53796c!=='server'&&this['_isRateLimitError'](_0x1a8a63)){const _0x310abf=this[_0x335c34(0x21d)](_0x53796c);_0xd92c88++;if(_0xd92c88>_0xcbd4db)throw new Error(_0x335c34(0x239)+_0xcbd4db+'):\x20'+_0x1a8a63['message']);this['rateLimitService']['handleRateLimitHit'](_0x310abf);if(_0xe9d7e6<_0x30dafe){this['logger']['info'](_0x335c34(0x1a1)+_0xd92c88+'/'+_0xcbd4db+')'),await this[_0x335c34(0x1a5)]['waitIfNeeded'](_0x310abf);continue;}}if(_0x53796c==='server'&&this[_0x335c34(0x181)](_0x1a8a63)){const _0x3986a0=await this[_0x335c34(0x1c8)](_0x41671b,_0x442b0c,_0x3cd299);if(_0x3986a0)return _0x3986a0;}if(this[_0x335c34(0x1e1)](_0x1a8a63))break;if(_0xe9d7e6>=_0x30dafe)break;this[_0x335c34(0x1bf)]['set'](_0x53796c,LLM_CONSTANTS['SERVICE_STATUS']['DEGRADED']);const _0x28157f=this[_0x335c34(0x18b)](_0xe9d7e6);await this['_delay'](_0x28157f),_0xe9d7e6++;}}throw new Error(_0x335c34(0x1b3)+(_0x5b44c7?.[_0x335c34(0x1ca)]||'Unknown\x20error'));}async['_tryFallbackService'](_0x3d165a,_0x2cc21f,_0x116e9b){const _0x4af809=a0_0x13dbb7,_0x4a35d2=this[_0x4af809(0x1da)](_0x4af809(0x246));if(!_0x4a35d2)return null;try{this['logger'][_0x4af809(0x22c)](_0x4af809(0x197)+_0x4a35d2);const _0x28f7c3=this['serviceInstances']['get'](_0x4a35d2);return await _0x28f7c3[_0x4af809(0x234)](_0x3d165a,_0x116e9b[_0x4af809(0x1d7)]||_0x4af809(0x1f1)),this['conversationServices']['set'](_0x3d165a,_0x4a35d2),await _0x28f7c3['sendMessage'](_0x3d165a,_0x2cc21f,_0x116e9b);}catch(_0x2c0bbb){return this['logger']['error'](_0x4af809(0x20b)+_0x2c0bbb['message']),null;}}async['_recordUsageAndMetrics'](_0x4b35f1,_0x487425,_0xa704af,_0x570232){const _0x16712d=a0_0x13dbb7,_0xe7142c=Date['now']()-_0xa704af;this['performanceMetrics']['totalLatency']+=_0xe7142c,this[_0x16712d(0x1d4)][_0x16712d(0x20a)]=this['performanceMetrics'][_0x16712d(0x1b9)]/this['performanceMetrics']['totalRequests'];_0x570232&&this[_0x16712d(0x1d4)][_0x16712d(0x1a6)]++;if(this['budgetService']&&_0x487425!=='server')try{const _0x5a8359=_0x4b35f1['getLastInputTokenCount'](),_0x3b38a6=_0x4b35f1['getLastOutputTokenCount'](),_0x432dd6=this[_0x16712d(0x199)](_0x487425);await this['budgetService'][_0x16712d(0x233)](_0x487425,_0x432dd6,_0x5a8359,_0x3b38a6);}catch(_0x164cb4){this[_0x16712d(0x225)]['warn'](_0x16712d(0x201),_0x164cb4);}}async['_handlePromptTooLongError'](_0x2045b7){const _0x278dde=a0_0x13dbb7;this[_0x278dde(0x225)]['warn'](_0x278dde(0x1e8));if(this['onPromptTooLong'])try{await this['onPromptTooLong'](_0x2045b7),this[_0x278dde(0x225)][_0x278dde(0x22c)](_0x278dde(0x221));}catch(_0x1b2ad6){this['logger'][_0x278dde(0x1f7)]('Compactization\x20failed:',_0x1b2ad6);throw _0x1b2ad6;}else throw new Error(_0x278dde(0x1de));}async[a0_0x13dbb7(0x1e0)](_0x3b9de8,_0x4b0c82){const _0x14ae41=a0_0x13dbb7;this['logger']['info'](_0x14ae41(0x211)+_0x3b9de8);const _0x37e2da=this['conversationServices'][_0x14ae41(0x1fc)](_0x3b9de8);if(!_0x37e2da)throw new Error(_0x14ae41(0x23a)+_0x3b9de8+_0x14ae41(0x22a));const _0x41707b=this['serviceInstances'][_0x14ae41(0x1fc)](_0x37e2da);if(!_0x41707b)throw new Error('Service\x20'+_0x37e2da+_0x14ae41(0x1ad)+_0x3b9de8);try{await _0x41707b[_0x14ae41(0x1e0)](_0x3b9de8,_0x4b0c82);}catch(_0x406106){this['logger']['error'](_0x14ae41(0x245)+_0x3b9de8+':',_0x406106);throw _0x406106;}}async[a0_0x13dbb7(0x23f)](_0xac712f,_0x5e3734){const _0x1759f7=a0_0x13dbb7;this[_0x1759f7(0x225)]['info']('Getting\x20summary\x20for\x20conversation:\x20'+_0xac712f);const _0x292e58=this[_0x1759f7(0x18d)][_0x1759f7(0x1fc)](_0xac712f);if(!_0x292e58)throw new Error('Cannot\x20get\x20summary:\x20conversation\x20'+_0xac712f+_0x1759f7(0x198));const _0x4e687b=this[_0x1759f7(0x1ec)][_0x1759f7(0x1fc)](_0x292e58);if(!_0x4e687b)throw new Error('Cannot\x20get\x20summary:\x20service\x20'+_0x292e58+_0x1759f7(0x195));this['logger']['info'](_0x1759f7(0x20e)+_0x292e58);try{const _0x1e0d44=await _0x4e687b['getSummary'](_0x5e3734,_0xac712f);if(this[_0x1759f7(0x1bc)]&&_0x292e58!==_0x1759f7(0x246)){const _0x556a17=this[_0x1759f7(0x199)](_0x292e58);await this[_0x1759f7(0x1bc)][_0x1759f7(0x233)](_0x292e58,_0x556a17,_0x4e687b[_0x1759f7(0x1af)](),_0x4e687b['getLastOutputTokenCount']());}return _0x1e0d44;}catch(_0x579436){this[_0x1759f7(0x225)]['error'](_0x1759f7(0x227)+_0x292e58+':',_0x579436);throw _0x579436;}}async['getImageDescription'](_0x246d37,_0x3816fd,_0x2531b4={}){const _0x2c5d40=a0_0x13dbb7;this['logger']['info'](_0x2c5d40(0x206));if(this['useServerLLM']&&this[_0x2c5d40(0x1ec)][_0x2c5d40(0x19a)]('server'))try{const _0x5779f1=this['serviceInstances']['get'](_0x2c5d40(0x246));return await _0x5779f1[_0x2c5d40(0x18e)](_0x246d37,_0x3816fd,_0x2531b4);}catch(_0x11b63d){this[_0x2c5d40(0x225)]['warn'](_0x2c5d40(0x1d6),_0x11b63d);}const _0x2a3ddf=this['_selectVisionService']();if(!_0x2a3ddf)throw new Error(_0x2c5d40(0x185));const _0x502c3d=this['serviceInstances'][_0x2c5d40(0x1fc)](_0x2a3ddf),_0x47a7dc=this[_0x2c5d40(0x21d)](_0x2a3ddf);await this[_0x2c5d40(0x1a5)]['waitIfNeeded'](_0x47a7dc);const _0x14062c=this['config'][_0x2c5d40(0x208)]?.['maxRetries']||LLM_CONSTANTS['DEFAULT_MAX_RETRIES'];let _0x5c26a1=0x0,_0x528f29=null;while(_0x5c26a1<=_0x14062c){try{const _0x22c24d=await _0x502c3d[_0x2c5d40(0x18e)](_0x246d37,_0x3816fd,_0x2531b4);this['rateLimitService']['resetRateLimitHits'](_0x47a7dc);if(this[_0x2c5d40(0x1bc)]){const _0x158df3=this[_0x2c5d40(0x199)](_0x2a3ddf);await this['budgetService']['recordUsage'](_0x2a3ddf,_0x158df3,_0x502c3d[_0x2c5d40(0x1af)](),_0x502c3d[_0x2c5d40(0x1c4)]());}return _0x22c24d;}catch(_0x4f47a4){_0x528f29=_0x4f47a4,this[_0x2c5d40(0x225)][_0x2c5d40(0x1f7)]('Vision\x20request\x20failed\x20(attempt\x20'+(_0x5c26a1+0x1)+'/'+(_0x14062c+0x1)+'):',_0x4f47a4);if(this[_0x2c5d40(0x1fd)](_0x4f47a4)){this[_0x2c5d40(0x1a5)][_0x2c5d40(0x21f)](_0x47a7dc);if(_0x5c26a1<_0x14062c){await this[_0x2c5d40(0x1a5)][_0x2c5d40(0x218)](_0x47a7dc);continue;}}if(this['_isNonRetryableError'](_0x4f47a4))throw _0x4f47a4;if(_0x5c26a1>=_0x14062c)break;const _0x11fcbb=this['_calculateRetryDelay'](_0x5c26a1);await this[_0x2c5d40(0x20f)](_0x11fcbb),_0x5c26a1++;}}throw new Error('All\x20vision\x20retry\x20attempts\x20failed:\x20'+(_0x528f29?.[_0x2c5d40(0x1ca)]||'Unknown\x20error'));}async['generateImage'](_0x3237d3,_0x14e2c2={}){const _0x5943ea=a0_0x13dbb7;this['logger'][_0x5943ea(0x22c)](_0x5943ea(0x1d2));const _0x4c6105=this['serviceInstances']['get']('server');if(_0x4c6105)try{const _0x23e0e4=await _0x4c6105['generateImage'](_0x3237d3,_0x14e2c2);return this[_0x5943ea(0x1bc)]&&_0x23e0e4['usage']&&await this[_0x5943ea(0x1bc)]['recordUsage']('server',_0x14e2c2[_0x5943ea(0x188)]||'azure-openai-dalle3',_0x23e0e4['usage']['input_tokens']||0x0,_0x23e0e4['usage'][_0x5943ea(0x1be)]||0x0),_0x23e0e4;}catch(_0x53a5a7){this['logger'][_0x5943ea(0x18a)](_0x5943ea(0x214),_0x53a5a7);throw _0x53a5a7;}throw new Error(_0x5943ea(0x189));}async[a0_0x13dbb7(0x18f)](_0x21ea8d){const _0x51dc7f=a0_0x13dbb7,_0xeebee3=this[_0x51dc7f(0x18d)]['get'](_0x21ea8d);if(!_0xeebee3)throw new Error('Conversation\x20'+_0x21ea8d+_0x51dc7f(0x22a));const _0x16ff9a=this[_0x51dc7f(0x1ec)][_0x51dc7f(0x1fc)](_0xeebee3);if(!_0x16ff9a)throw new Error('Service\x20'+_0xeebee3+'\x20not\x20found\x20for\x20conversation\x20'+_0x21ea8d);try{return await _0x16ff9a['estimateTokenCount'](_0x21ea8d);}catch(_0x1ea45c){return this[_0x51dc7f(0x225)][_0x51dc7f(0x1f7)](_0x51dc7f(0x1e2)+_0x21ea8d+':',_0x1ea45c),0x0;}}['getCostEstimate'](_0x378a45,_0x407b73,_0x223494){const _0x3e77a2=a0_0x13dbb7;if(!this[_0x3e77a2(0x1bc)])return null;return this[_0x3e77a2(0x1bc)][_0x3e77a2(0x21a)](_0x378a45,_0x407b73,_0x223494);}['checkBudgetForOperation'](_0x2a9157,_0x3fa44f,_0x5e3abc){const _0x40c822=a0_0x13dbb7;if(!this['budgetService'])return null;return this[_0x40c822(0x1bc)]['checkBudgetForOperation'](_0x2a9157,_0x3fa44f,_0x5e3abc);}async[a0_0x13dbb7(0x219)](){const _0x500f51=a0_0x13dbb7;if(!this['budgetService'])return null;return await this[_0x500f51(0x1bc)][_0x500f51(0x219)]();}async[a0_0x13dbb7(0x1f8)](_0x4c0d8a){const _0xbfec66=a0_0x13dbb7;if(!this[_0xbfec66(0x1bc)])throw new Error(_0xbfec66(0x1ee));await this['budgetService'][_0xbfec66(0x1f8)](_0x4c0d8a);}async[a0_0x13dbb7(0x1e3)](){const _0x344b36=a0_0x13dbb7;if(!this[_0x344b36(0x1bc)])return![];return await this[_0x344b36(0x1bc)]['updatePricingFromServer']();}['getServiceStatus'](){const _0x13b34b=a0_0x13dbb7,_0x133225={};for(const [_0xc91b48,_0x2dd13f]of this['serviceStatus'][_0x13b34b(0x1c6)]()){_0x133225[_0xc91b48]={'status':_0x2dd13f,'available':_0x2dd13f!==LLM_CONSTANTS[_0x13b34b(0x248)][_0x13b34b(0x1c7)],'isPrimary':_0xc91b48===this[_0x13b34b(0x1d1)]};}return _0x133225;}[a0_0x13dbb7(0x1cf)](){const _0x4cc036=a0_0x13dbb7;return{...this[_0x4cc036(0x1d4)],'successRate':this['performanceMetrics']['totalRequests']>0x0?this['performanceMetrics']['successfulRequests']/this[_0x4cc036(0x1d4)]['totalRequests']*0x64:0x0};}['getRateLimitingStatus'](){const _0x529212=a0_0x13dbb7;return this[_0x529212(0x1a5)]['getAllStatus']();}['registerPromptTooLongHandler'](_0x17c55b){const _0x2fbc1d=a0_0x13dbb7;this[_0x2fbc1d(0x1b1)]=_0x17c55b,this['logger']['info']('Prompt\x20too\x20long\x20handler\x20registered');}async[a0_0x13dbb7(0x1aa)](){const _0x4cbbeb=a0_0x13dbb7,_0x529e6e={'overall':_0x4cbbeb(0x193),'services':{},'budget':null,'performance':this['getPerformanceMetrics'](),'pricing':{'available':![],'modelsWithPricing':0x0,'lastUpdate':null}};for(const [_0x4ef3a0,_0x214779]of this['serviceStatus']['entries']()){_0x529e6e[_0x4cbbeb(0x21e)][_0x4ef3a0]={'status':_0x214779,'available':_0x214779!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']},_0x214779===LLM_CONSTANTS[_0x4cbbeb(0x248)][_0x4cbbeb(0x1c7)]&&(_0x529e6e[_0x4cbbeb(0x235)]='degraded');}if(this[_0x4cbbeb(0x1a3)])try{const _0x438391=await this[_0x4cbbeb(0x1a3)]['getServerHealth']();_0x529e6e[_0x4cbbeb(0x21e)]['server']['serverHealth']=_0x438391,_0x438391['status']!==_0x4cbbeb(0x193)&&(_0x529e6e[_0x4cbbeb(0x235)]=_0x4cbbeb(0x21b));}catch(_0x49ebf3){_0x529e6e['services']['server'][_0x4cbbeb(0x241)]={'status':_0x4cbbeb(0x1f7),'error':_0x49ebf3[_0x4cbbeb(0x1ca)]},_0x529e6e['overall']='degraded';}if(this['budgetService'])try{_0x529e6e[_0x4cbbeb(0x207)]=await this[_0x4cbbeb(0x1bc)]['healthCheck'](),_0x529e6e[_0x4cbbeb(0x207)][_0x4cbbeb(0x1b2)]!=='healthy'&&(_0x529e6e[_0x4cbbeb(0x235)]=_0x4cbbeb(0x21b));}catch(_0x47a48a){_0x529e6e['budget']={'status':'error','error':_0x47a48a['message']},_0x529e6e['overall']=_0x4cbbeb(0x21b);}if(this['budgetService']){const _0x24f346=this[_0x4cbbeb(0x1bc)][_0x4cbbeb(0x187)]();_0x529e6e[_0x4cbbeb(0x247)]={'available':_0x24f346[_0x4cbbeb(0x20c)]>0x0,'modelsWithPricing':_0x24f346['totalModels'],'lastUpdate':_0x24f346[_0x4cbbeb(0x1fb)],'source':_0x24f346[_0x4cbbeb(0x1f2)]};}return _0x529e6e;}async[a0_0x13dbb7(0x1d8)](){const _0xbcd3da=a0_0x13dbb7;this['logger']['info']('Shutting\x20down\x20LLM\x20service');const _0x2addc5=[];for(const [_0x8c39aa,_0xa09e91]of this[_0xbcd3da(0x1ec)]['entries']()){typeof _0xa09e91['shutdown']==='function'&&(this['logger']['info'](_0xbcd3da(0x1ae)+_0x8c39aa),_0x2addc5['push'](_0xa09e91[_0xbcd3da(0x1d8)]()['catch'](_0x37e5df=>{const _0xaff616=_0xbcd3da;this[_0xaff616(0x225)][_0xaff616(0x1f7)]('Error\x20shutting\x20down\x20service\x20'+_0x8c39aa+':',_0x37e5df);})));}this['budgetService']&&typeof this['budgetService'][_0xbcd3da(0x1d8)]===_0xbcd3da(0x228)&&_0x2addc5[_0xbcd3da(0x1ce)](this['budgetService']['shutdown']()[_0xbcd3da(0x1a7)](_0x2a222d=>{const _0x5aaa3d=_0xbcd3da;this[_0x5aaa3d(0x225)]['error']('Error\x20shutting\x20down\x20budget\x20service:',_0x2a222d);})),await Promise['allSettled'](_0x2addc5),this['serviceInstances']['clear'](),this[_0xbcd3da(0x18d)][_0xbcd3da(0x1dd)](),this[_0xbcd3da(0x1bf)][_0xbcd3da(0x1dd)](),this[_0xbcd3da(0x225)][_0xbcd3da(0x22c)]('All\x20LLM\x20services\x20shut\x20down');}['_selectServiceForConversation'](_0x5cdb71,_0x31dad4=[]){const _0x2a4de2=a0_0x13dbb7;if(this['useServerLLM']&&this[_0x2a4de2(0x1ec)][_0x2a4de2(0x19a)](_0x2a4de2(0x246))&&!_0x31dad4[_0x2a4de2(0x220)]('server')&&this[_0x2a4de2(0x1bf)]['get']('server')===LLM_CONSTANTS['SERVICE_STATUS']['AVAILABLE'])return'server';return this[_0x2a4de2(0x224)](_0x31dad4);}['_selectAvailableService'](_0x20a81d=[]){const _0x135d25=a0_0x13dbb7,_0x4292ba=Array[_0x135d25(0x203)](this['serviceInstances']['keys']())[_0x135d25(0x23e)](_0x5d9812=>!_0x20a81d['includes'](_0x5d9812)&&this['serviceStatus']['get'](_0x5d9812)!==LLM_CONSTANTS[_0x135d25(0x248)]['UNAVAILABLE']);if(_0x4292ba[_0x135d25(0x205)]===0x0)return null;const _0x2d2827=this[_0x135d25(0x1a4)][_0x135d25(0x1d3)]||LLM_CONSTANTS[_0x135d25(0x1fa)][_0x135d25(0x1d9)];switch(_0x2d2827){case LLM_CONSTANTS[_0x135d25(0x1fa)][_0x135d25(0x1f6)]:return this['_selectFastestService'](_0x4292ba);case LLM_CONSTANTS['STRATEGY'][_0x135d25(0x1cc)]:return this['_selectSmartestService'](_0x4292ba);case LLM_CONSTANTS['STRATEGY']['CONTEXT']:return this[_0x135d25(0x1f9)](_0x4292ba);case LLM_CONSTANTS[_0x135d25(0x1fa)]['BALANCED']:default:return this['_selectBalancedService'](_0x4292ba);}}[a0_0x13dbb7(0x1da)](_0x1d8fc3){const _0x4fed30=a0_0x13dbb7,_0x114b52=Array['from'](this[_0x4fed30(0x1ec)][_0x4fed30(0x1f3)]())['filter'](_0xf50f1d=>_0xf50f1d!==_0x1d8fc3&&this['serviceStatus'][_0x4fed30(0x1fc)](_0xf50f1d)!==LLM_CONSTANTS['SERVICE_STATUS'][_0x4fed30(0x1c7)]);if(_0x114b52[_0x4fed30(0x205)]===0x0)return null;if(_0x1d8fc3!==_0x4fed30(0x222)&&_0x114b52[_0x4fed30(0x220)]('anthropic'))return'anthropic';return _0x114b52[0x0];}[a0_0x13dbb7(0x209)](_0x291ce7=[]){const _0x11699a=a0_0x13dbb7,_0x3488ff=[_0x11699a(0x222),_0x11699a(0x1ba),'google'],_0x294ad9=_0x3488ff[_0x11699a(0x23e)](_0x503d8a=>!_0x291ce7[_0x11699a(0x220)](_0x503d8a)&&this[_0x11699a(0x1ec)]['has'](_0x503d8a)&&this[_0x11699a(0x1bf)][_0x11699a(0x1fc)](_0x503d8a)!==LLM_CONSTANTS['SERVICE_STATUS']['UNAVAILABLE']);if(_0x294ad9['length']===0x0)return null;const _0x166d24=[_0x11699a(0x222),'openai','google'];for(const _0x3e40ef of _0x166d24){if(_0x294ad9['includes'](_0x3e40ef))return _0x3e40ef;}return _0x294ad9[0x0];}['_selectFastestService'](_0x1e1ecc){const _0xc90249=a0_0x13dbb7;return this[_0xc90249(0x1c2)](_0x1e1ecc,LLM_CONSTANTS[_0xc90249(0x226)][_0xc90249(0x1f6)]);}['_selectSmartestService'](_0x4b942b){const _0x42f1c2=a0_0x13dbb7;return this['_selectServiceByPreferenceOrder'](_0x4b942b,LLM_CONSTANTS['MODEL_PREFERENCE'][_0x42f1c2(0x1cc)]);}['_selectLargestContextService'](_0x57b2de){let _0x8c44=null,_0x395243=0x0;for(const _0x503b50 of _0x57b2de){const _0x47cd13=this['serviceInstances']['get'](_0x503b50);if(!_0x47cd13||typeof _0x47cd13['getMaxContextSize']!=='function')continue;const _0x103b56=_0x47cd13['getMaxContextSize']();_0x103b56>_0x395243&&(_0x395243=_0x103b56,_0x8c44=_0x503b50);}return _0x8c44||_0x57b2de[0x0];}[a0_0x13dbb7(0x1c5)](_0x2fe37e){const _0x48ff00=a0_0x13dbb7;return this['_selectServiceByPreferenceOrder'](_0x2fe37e,LLM_CONSTANTS[_0x48ff00(0x226)]['BALANCED']);}['_selectServiceByPreferenceOrder'](_0x4b1d65,_0x39787c){const _0x3ce9a8=a0_0x13dbb7,_0x23acd9={'anthropic':[_0x3ce9a8(0x204),_0x3ce9a8(0x1e4),'anthropic-haiku'],'openai':[_0x3ce9a8(0x237),'azure-openai-gpt35'],'google':['google-gemini'],'server':[]};for(const _0x596623 of _0x39787c){for(const _0x8dffed of _0x4b1d65){if(_0x8dffed===_0x3ce9a8(0x246))return _0x8dffed;const _0x559458=_0x23acd9[_0x8dffed]||[];if(_0x559458[_0x3ce9a8(0x220)](_0x596623))return _0x8dffed;}}return _0x4b1d65[0x0];}[a0_0x13dbb7(0x21d)](_0x222999){const _0x5c2244=a0_0x13dbb7,_0x5a251f={'anthropic':_0x5c2244(0x1e4),'openai':'azure-openai-gpt4','google':_0x5c2244(0x1ed),'server':'server-llm'};return _0x5a251f[_0x222999]||_0x222999;}['_getDefaultModelForService'](_0x2b37b6){return this['_getServiceModelId'](_0x2b37b6);}['_calculateRetryDelay'](_0x18804c){const _0x45cac9=a0_0x13dbb7,_0x36e27d=this['config']['retries']?.['baseDelayMs']||LLM_CONSTANTS[_0x45cac9(0x1a8)],_0x3be0b6=this[_0x45cac9(0x1a4)]['retries']?.[_0x45cac9(0x1b4)]||LLM_CONSTANTS[_0x45cac9(0x1b5)];return _0x36e27d*Math[_0x45cac9(0x1eb)](_0x3be0b6,_0x18804c);}[a0_0x13dbb7(0x20f)](_0x46a353){return new Promise(_0x309140=>setTimeout(_0x309140,_0x46a353));}[a0_0x13dbb7(0x1fd)](_0x26b7ca){const _0x24ae9f=a0_0x13dbb7,_0x38b894=['rate\x20limit',_0x24ae9f(0x1e6),_0x24ae9f(0x243),'request\x20limit','429',_0x24ae9f(0x1b0)],_0x1e9917=_0x26b7ca['message']?.['toLowerCase']()||'';return _0x38b894['some'](_0x258efa=>_0x1e9917['includes'](_0x258efa));}['_isNonRetryableError'](_0x296862){const _0x3e63f1=a0_0x13dbb7,_0x374184=[_0x3e63f1(0x1f0),_0x3e63f1(0x229),'unauthorized','model\x20not\x20found',_0x3e63f1(0x1ef),_0x3e63f1(0x216)],_0x27989b=_0x296862['message']?.[_0x3e63f1(0x217)]()||'';return _0x374184['some'](_0x54f449=>_0x27989b['includes'](_0x54f449));}['_isPromptTooLongError'](_0x41e39b){const _0x183e9c=a0_0x13dbb7,_0x13d566=_0x41e39b[_0x183e9c(0x1ca)]?.[_0x183e9c(0x217)]()||'',_0x40683b=_0x41e39b[_0x183e9c(0x1b6)]?.()?.[_0x183e9c(0x217)]()||'';return(_0x13d566[_0x183e9c(0x220)]('too\x20long')||_0x40683b['includes'](_0x183e9c(0x238)))&&(_0x41e39b['status']===0x190||_0x13d566[_0x183e9c(0x220)](_0x183e9c(0x1ff))||_0x40683b[_0x183e9c(0x220)]('400'));}[a0_0x13dbb7(0x191)](_0x33d06c){const _0x381c84=a0_0x13dbb7,_0x414a21=_0x33d06c['message']?.['toLowerCase']()||'',_0x473904=_0x33d06c[_0x381c84(0x1b2)]||_0x33d06c['originalError']?.['status'];return _0x473904===0x19d||_0x414a21['includes'](_0x381c84(0x240))||_0x414a21[_0x381c84(0x220)](_0x381c84(0x1a2))||_0x414a21['includes'](_0x381c84(0x21c));}async[a0_0x13dbb7(0x184)](_0x147279){const _0x101548=a0_0x13dbb7;this['logger'][_0x101548(0x18a)](_0x101548(0x1f5)+_0x147279+_0x101548(0x210));if(this['onPromptTooLong'])try{await this['onPromptTooLong'](_0x147279),this['logger']['info']('âœ…\x20Emergency\x20compactization\x20completed\x20for\x20'+_0x147279);}catch(_0xf9f29){this['logger'][_0x101548(0x1f7)](_0x101548(0x236),_0xf9f29);throw _0xf9f29;}else throw new Error(_0x101548(0x231));}[a0_0x13dbb7(0x181)](_0x50bfe6){const _0x1c1c29=a0_0x13dbb7,_0x26f94c=[_0x1c1c29(0x1a0),_0x1c1c29(0x1bb),'500',_0x1c1c29(0x23c),'503',_0x1c1c29(0x19c),'authentication',_0x1c1c29(0x1db),_0x1c1c29(0x212),_0x1c1c29(0x186),_0x1c1c29(0x192)],_0xf6cf21=_0x50bfe6['message']?.['toLowerCase']()||'';return _0x26f94c[_0x1c1c29(0x196)](_0x4f5163=>_0xf6cf21[_0x1c1c29(0x220)](_0x4f5163));}}function a0_0x156d(_0xaf82d0,_0x59c9ff){const _0x3fe182=a0_0x3fe1();return a0_0x156d=function(_0x156d61,_0x10230f){_0x156d61=_0x156d61-0x181;let _0x2533ef=_0x3fe182[_0x156d61];if(a0_0x156d['XkiPed']===undefined){var _0x326e86=function(_0x71fbd0){const _0x4e894b='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2c3a1a='',_0x1f9cd5='';for(let _0x2af8f0=0x0,_0x3dfb58,_0x7b784b,_0x1525bf=0x0;_0x7b784b=_0x71fbd0['charAt'](_0x1525bf++);~_0x7b784b&&(_0x3dfb58=_0x2af8f0%0x4?_0x3dfb58*0x40+_0x7b784b:_0x7b784b,_0x2af8f0++%0x4)?_0x2c3a1a+=String['fromCharCode'](0xff&_0x3dfb58>>(-0x2*_0x2af8f0&0x6)):0x0){_0x7b784b=_0x4e894b['indexOf'](_0x7b784b);}for(let _0x2fee4f=0x0,_0x3d6197=_0x2c3a1a['length'];_0x2fee4f<_0x3d6197;_0x2fee4f++){_0x1f9cd5+='%'+('00'+_0x2c3a1a['charCodeAt'](_0x2fee4f)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x1f9cd5);};a0_0x156d['rXTDJn']=_0x326e86,_0xaf82d0=arguments,a0_0x156d['XkiPed']=!![];}const _0x3f7dcd=_0x3fe182[0x0],_0x4c84c7=_0x156d61+_0x3f7dcd,_0x52b073=_0xaf82d0[_0x4c84c7];return!_0x52b073?(_0x2533ef=a0_0x156d['rXTDJn'](_0x2533ef),_0xaf82d0[_0x4c84c7]=_0x2533ef):_0x2533ef=_0x52b073,_0x2533ef;},a0_0x156d(_0xaf82d0,_0x59c9ff);}export{LLM_CONSTANTS};