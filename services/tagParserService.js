const a0_0x1e69b5=a0_0x1376;function a0_0x1df1(){const _0x288b87=['mti2mZy5mhPLr3zhzG','mZiZnZyXnMTZAMr0Ea','Bg9Nz2vY','rxH0CMfJDgvKihrVB2WGy29TBwfUzdOG','mtuZnJG0mgLrzvbSrG','ntqWmJi4zfDoqMLg','mJu1otqYt0X6tvvO','CgfYC2vnzxnZywDL','BwvZC2fNzq','AM9IlwrVBMu','mZvNAgr3DKO','ig9WDgLVBNm','Aw5MBW','DhjPBq','yxr0CMLIDxrLCW','y29UDgvUDa','AM9Irg9Uzq','ugfYC2LUzYbTzxnZywDLihDPDgGGvgfNugfYC2vY','vxnLCIbqCM9TChq','CxvLCNK','CgfYC2vqCM9TChq','BgvUz3rO','Dg9VBenVBw1HBMrZ','mtK1nZmYmZbUvef2AeC','nZiWnJC5nwLfBLrPqq','muPNyvLMqq','CMvJAxbPzw50','oeLQBK9Sua','rxH0CMfJDgvKigrPCMvJDcb0B29SignVBw1HBMq6ia','Dg9VBa'];a0_0x1df1=function(){return _0x288b87;};return a0_0x1df1();}(function(_0x21561a,_0x1d1faf){const _0x5d65fd=a0_0x1376,_0x228dfa=_0x21561a();while(!![]){try{const _0x3c2981=parseInt(_0x5d65fd(0x14d))/0x1*(-parseInt(_0x5d65fd(0x158))/0x2)+-parseInt(_0x5d65fd(0x156))/0x3+-parseInt(_0x5d65fd(0x153))/0x4+parseInt(_0x5d65fd(0x152))/0x5+-parseInt(_0x5d65fd(0x157))/0x6*(-parseInt(_0x5d65fd(0x15c))/0x7)+-parseInt(_0x5d65fd(0x14f))/0x8*(parseInt(_0x5d65fd(0x14c))/0x9)+parseInt(_0x5d65fd(0x14b))/0xa;if(_0x3c2981===_0x1d1faf)break;else _0x228dfa['push'](_0x228dfa['shift']());}catch(_0x80003d){_0x228dfa['push'](_0x228dfa['shift']());}}}(a0_0x1df1,0x640f1));import{TagParser}from'../utilities/tagParser.js';function a0_0x1376(_0x1a31aa,_0x480a28){const _0x1df17c=a0_0x1df1();return a0_0x1376=function(_0x137640,_0x42a9db){_0x137640=_0x137640-0x146;let _0x438a01=_0x1df17c[_0x137640];if(a0_0x1376['zEEasq']===undefined){var _0x370a9b=function(_0x4b4c35){const _0x144034='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x101084='',_0x32024b='';for(let _0x458c08=0x0,_0x359e1d,_0x4c1404,_0x3d3625=0x0;_0x4c1404=_0x4b4c35['charAt'](_0x3d3625++);~_0x4c1404&&(_0x359e1d=_0x458c08%0x4?_0x359e1d*0x40+_0x4c1404:_0x4c1404,_0x458c08++%0x4)?_0x101084+=String['fromCharCode'](0xff&_0x359e1d>>(-0x2*_0x458c08&0x6)):0x0){_0x4c1404=_0x144034['indexOf'](_0x4c1404);}for(let _0x17e20b=0x0,_0x279fa6=_0x101084['length'];_0x17e20b<_0x279fa6;_0x17e20b++){_0x32024b+='%'+('00'+_0x101084['charCodeAt'](_0x17e20b)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x32024b);};a0_0x1376['qwACxR']=_0x370a9b,_0x1a31aa=arguments,a0_0x1376['zEEasq']=!![];}const _0x5484b6=_0x1df17c[0x0],_0x4103ba=_0x137640+_0x5484b6,_0x185e30=_0x1a31aa[_0x4103ba];return!_0x185e30?(_0x438a01=a0_0x1376['qwACxR'](_0x438a01),_0x1a31aa[_0x4103ba]=_0x438a01):_0x438a01=_0x185e30,_0x438a01;},a0_0x1376(_0x1a31aa,_0x480a28);}export class TagParserService{constructor(_0x4b4c35){this['logger']=_0x4b4c35;}[a0_0x1e69b5(0x159)](_0x144034){const _0x56c167=a0_0x1e69b5;this[_0x56c167(0x154)]['info'](_0x56c167(0x163));const _0x101084={'recipient':null,'content':_0x144034,'toolCommands':[],'prompt':null,'jobDone':null};try{const _0x32024b=TagParser['extractContent'](_0x144034,_0x56c167(0x15b));_0x32024b[_0x56c167(0x149)]>0x0&&(_0x101084[_0x56c167(0x162)]=_0x32024b[0x0]);const _0x458c08=TagParser[_0x56c167(0x147)](_0x144034,_0x56c167(0x15a));if(_0x458c08['length']>0x0){const _0x359e1d=_0x458c08[0x0];_0x101084[_0x56c167(0x14e)]=_0x359e1d[_0x56c167(0x160)]['to'],_0x101084['content']=_0x359e1d['content'],this['logger'][_0x56c167(0x15e)]('Message\x20to\x20recipient:\x20'+_0x101084['recipient']);}return this['parseToolCommands'](_0x144034,_0x101084),this[_0x56c167(0x148)](_0x144034,_0x101084),_0x101084;}catch(_0x4c1404){return this[_0x56c167(0x154)]['error']('Error\x20parsing\x20message\x20with\x20TagParser:',_0x4c1404),_0x101084;}}['parseToolCommands'](_0x3d3625,_0x17e20b){const _0x5d1feb=a0_0x1e69b5,_0x279fa6=TagParser['query'](_0x3d3625,'tools-commands');for(const _0x57f9c6 of _0x279fa6){const _0x25805d=_0x57f9c6['content'],_0x39e96d=TagParser[_0x5d1feb(0x147)](_0x25805d,_0x5d1feb(0x151));for(const _0x11abb6 of _0x39e96d){const _0x2e56a7=_0x11abb6[_0x5d1feb(0x160)]['id'];if(!_0x2e56a7)continue;const _0x123fe3=_0x11abb6['content'];_0x17e20b[_0x5d1feb(0x14a)]['push']({'toolId':_0x2e56a7,'content':_0x123fe3,'rawTag':_0x11abb6}),this[_0x5d1feb(0x154)]['info'](_0x5d1feb(0x155)+_0x2e56a7);}}if(_0x279fa6[_0x5d1feb(0x149)]===0x0&&_0x3d3625['includes']('[tool\x20id=')){const _0x14c2a1=TagParser['query'](_0x3d3625,'tool');for(const _0x1ec12b of _0x14c2a1){const _0x42398b=_0x1ec12b['attributes']['id'];if(!_0x42398b)continue;const _0x139e77=_0x1ec12b['content'];_0x17e20b[_0x5d1feb(0x14a)]['push']({'toolId':_0x42398b,'content':_0x139e77,'rawTag':_0x1ec12b}),this['logger']['info'](_0x5d1feb(0x150)+_0x42398b);}}}['parsePrompt'](_0x2fc0c9,_0x9b3fea){const _0x3ad3cf=a0_0x1e69b5,_0x3b92ca=TagParser[_0x3ad3cf(0x147)](_0x2fc0c9,'prompt');if(_0x3b92ca['length']>0x0){const _0x587626=_0x3b92ca[0x0],_0x37531a=_0x587626[_0x3ad3cf(0x160)]['name']||_0x3ad3cf(0x146),_0x4f7105=_0x587626[_0x3ad3cf(0x161)],_0x1a0707=TagParser['extractContent'](_0x4f7105,'option');_0x9b3fea['prompt']={'name':_0x37531a,'text':_0x4f7105['replace'](/\[option\](.*?)\[\/option\]/gs,'')[_0x3ad3cf(0x15f)](),'options':_0x1a0707},this['logger'][_0x3ad3cf(0x15e)]('Extracted\x20prompt:\x20'+_0x37531a+'\x20with\x20'+_0x1a0707[_0x3ad3cf(0x149)]+_0x3ad3cf(0x15d));}}}