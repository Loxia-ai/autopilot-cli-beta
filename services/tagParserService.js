const a0_0x429cfe=a0_0x1b75;function a0_0xaa0e(){const _0x19ae24=['BgvUz3rO','Dg9VBenVBw1HBMrZ','mti2mtG3mhPdvenHuq','mJrcrefYD2u','CgfYC2vqCM9TChq','otu2ntGXnxn4AeTtta','rxH0CMfJDgvKigrPCMvJDcb0B29SignVBw1HBMq6ia','ndC1nti0nxrSA3bpDq','y29UDgvUDa','BMfTzq','ChvZAa','mJGXmdGYC1PXDvnr','zxH0CMfJDenVBNrLBNq','Bg9Nz2vY','mteXnde1mKPHzNDQqW','ndi1mZa3u0zKAfjh','ugfYC2LUzYbTzxnZywDLihDPDgGGvgfNugfYC2vY','Aw5MBW','yxr0CMLIDxrLCW','mtu1ota3q0XYAKvI','CxvLCNK','ogThrKr0EG','rxH0CMfJDgvKihbYB21WDdOG','rxH0CMfJDgvKihrVB2WGy29TBwfUzdOG','zxjYB3i','B3b0Aw9U','twvZC2fNzsb0BYbYzwnPCgLLBNq6ia','ig9WDgLVBNm'];a0_0xaa0e=function(){return _0x19ae24;};return a0_0xaa0e();}(function(_0x23e8dc,_0x56c0f8){const _0x34eb10=a0_0x1b75,_0x1f1860=_0x23e8dc();while(!![]){try{const _0x571b23=parseInt(_0x34eb10(0x1c5))/0x1+parseInt(_0x34eb10(0x1b2))/0x2+parseInt(_0x34eb10(0x1b6))/0x3*(-parseInt(_0x34eb10(0x1bc))/0x4)+parseInt(_0x34eb10(0x1ae))/0x5+parseInt(_0x34eb10(0x1b5))/0x6+-parseInt(_0x34eb10(0x1c8))/0x7+parseInt(_0x34eb10(0x1c6))/0x8*(-parseInt(_0x34eb10(0x1ba))/0x9);if(_0x571b23===_0x56c0f8)break;else _0x1f1860['push'](_0x1f1860['shift']());}catch(_0x4d372f){_0x1f1860['push'](_0x1f1860['shift']());}}}(a0_0xaa0e,0xcc5ec));import{TagParser}from'../utilities/tagParser.js';function a0_0x1b75(_0xea7a6a,_0xecccae){const _0xaa0e32=a0_0xaa0e();return a0_0x1b75=function(_0x1b75f,_0xced54b){_0x1b75f=_0x1b75f-0x1ad;let _0x1542bd=_0xaa0e32[_0x1b75f];if(a0_0x1b75['eorPmK']===undefined){var _0x96b22e=function(_0x286b56){const _0x28e4a2='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5e90fc='',_0x36eb69='';for(let _0x1d78c6=0x0,_0x198083,_0x4a1814,_0x49e9a1=0x0;_0x4a1814=_0x286b56['charAt'](_0x49e9a1++);~_0x4a1814&&(_0x198083=_0x1d78c6%0x4?_0x198083*0x40+_0x4a1814:_0x4a1814,_0x1d78c6++%0x4)?_0x5e90fc+=String['fromCharCode'](0xff&_0x198083>>(-0x2*_0x1d78c6&0x6)):0x0){_0x4a1814=_0x28e4a2['indexOf'](_0x4a1814);}for(let _0x28ed87=0x0,_0x2d4785=_0x5e90fc['length'];_0x28ed87<_0x2d4785;_0x28ed87++){_0x36eb69+='%'+('00'+_0x5e90fc['charCodeAt'](_0x28ed87)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x36eb69);};a0_0x1b75['LmRTmm']=_0x96b22e,_0xea7a6a=arguments,a0_0x1b75['eorPmK']=!![];}const _0x5a3df4=_0xaa0e32[0x0],_0x5662bf=_0x1b75f+_0x5a3df4,_0x1d2ce0=_0xea7a6a[_0x5662bf];return!_0x1d2ce0?(_0x1542bd=a0_0x1b75['LmRTmm'](_0x1542bd),_0xea7a6a[_0x5662bf]=_0x1542bd):_0x1542bd=_0x1d2ce0,_0x1542bd;},a0_0x1b75(_0xea7a6a,_0xecccae);}export class TagParserService{constructor(_0x286b56){this['logger']=_0x286b56;}['parseMessage'](_0x28e4a2){const _0xdd6cf6=a0_0x1b75;this[_0xdd6cf6(0x1b4)][_0xdd6cf6(0x1b8)](_0xdd6cf6(0x1b7));const _0x5e90fc={'recipient':null,'content':_0x28e4a2,'toolCommands':[],'prompt':null,'jobDone':null};try{const _0x36eb69=TagParser[_0xdd6cf6(0x1b3)](_0x28e4a2,'job-done');_0x36eb69['length']>0x0&&(_0x5e90fc['jobDone']=_0x36eb69[0x0]);const _0x1d78c6=TagParser['query'](_0x28e4a2,'message');if(_0x1d78c6[_0xdd6cf6(0x1c3)]>0x0){const _0x198083=_0x1d78c6[0x0];_0x5e90fc['recipient']=_0x198083['attributes']['to'],_0x5e90fc[_0xdd6cf6(0x1af)]=_0x198083['content'],this[_0xdd6cf6(0x1b4)][_0xdd6cf6(0x1b8)](_0xdd6cf6(0x1c1)+_0x5e90fc['recipient']);}return this['parseToolCommands'](_0x28e4a2,_0x5e90fc),this['parsePrompt'](_0x28e4a2,_0x5e90fc),_0x5e90fc;}catch(_0x4a1814){return this[_0xdd6cf6(0x1b4)][_0xdd6cf6(0x1bf)]('Error\x20parsing\x20message\x20with\x20TagParser:',_0x4a1814),_0x5e90fc;}}['parseToolCommands'](_0x49e9a1,_0x28ed87){const _0x630b5=a0_0x1b75,_0x2d4785=TagParser[_0x630b5(0x1bb)](_0x49e9a1,'tools-commands');for(const _0x4426b4 of _0x2d4785){const _0x1cc72d=_0x4426b4['content'],_0x31f218=TagParser['query'](_0x1cc72d,'tool');for(const _0x33e975 of _0x31f218){const _0x40f86d=_0x33e975['attributes']['id'];if(!_0x40f86d)continue;const _0x41323d=_0x33e975[_0x630b5(0x1af)];_0x28ed87[_0x630b5(0x1c4)][_0x630b5(0x1b1)]({'toolId':_0x40f86d,'content':_0x41323d,'rawTag':_0x33e975}),this['logger']['info'](_0x630b5(0x1be)+_0x40f86d);}}if(_0x2d4785[_0x630b5(0x1c3)]===0x0&&_0x49e9a1['includes']('[tool\x20id=')){const _0x4c3277=TagParser[_0x630b5(0x1bb)](_0x49e9a1,'tool');for(const _0x3ce203 of _0x4c3277){const _0x314eba=_0x3ce203[_0x630b5(0x1b9)]['id'];if(!_0x314eba)continue;const _0x1bc1f1=_0x3ce203[_0x630b5(0x1af)];_0x28ed87[_0x630b5(0x1c4)]['push']({'toolId':_0x314eba,'content':_0x1bc1f1,'rawTag':_0x3ce203}),this[_0x630b5(0x1b4)][_0x630b5(0x1b8)](_0x630b5(0x1ad)+_0x314eba);}}}[a0_0x429cfe(0x1c7)](_0x528173,_0x46040f){const _0xe4d6ad=a0_0x429cfe,_0xccafb4=TagParser['query'](_0x528173,'prompt');if(_0xccafb4[_0xe4d6ad(0x1c3)]>0x0){const _0x5dbe8f=_0xccafb4[0x0],_0x178fec=_0x5dbe8f[_0xe4d6ad(0x1b9)][_0xe4d6ad(0x1b0)]||'User\x20Prompt',_0x4946eb=_0x5dbe8f['content'],_0x34b95f=TagParser['extractContent'](_0x4946eb,_0xe4d6ad(0x1c0));_0x46040f['prompt']={'name':_0x178fec,'text':_0x4946eb['replace'](/\[option\](.*?)\[\/option\]/gs,'')['trim'](),'options':_0x34b95f},this['logger'][_0xe4d6ad(0x1b8)](_0xe4d6ad(0x1bd)+_0x178fec+'\x20with\x20'+_0x34b95f['length']+_0xe4d6ad(0x1c2));}}}