const a0_0x3a66c6=a0_0x4a01;(function(_0x4d25b5,_0x55711c){const _0x2e4400=a0_0x4a01,_0x297b95=_0x4d25b5();while(!![]){try{const _0x5bcfe8=-parseInt(_0x2e4400(0x150))/0x1+parseInt(_0x2e4400(0x138))/0x2+parseInt(_0x2e4400(0x156))/0x3*(parseInt(_0x2e4400(0x14d))/0x4)+parseInt(_0x2e4400(0x154))/0x5*(parseInt(_0x2e4400(0x15d))/0x6)+-parseInt(_0x2e4400(0x140))/0x7+parseInt(_0x2e4400(0x13f))/0x8+-parseInt(_0x2e4400(0x155))/0x9;if(_0x5bcfe8===_0x55711c)break;else _0x297b95['push'](_0x297b95['shift']());}catch(_0x127d98){_0x297b95['push'](_0x297b95['shift']());}}}(a0_0x42b0,0xe0ee9));export class RateLimitService{constructor(_0xde16f4){const _0x27c8c0=a0_0x4a01;this[_0x27c8c0(0x14e)]=_0xde16f4,this[_0x27c8c0(0x157)]=new Map(),this['rateLimitHits']=new Map(),this[_0x27c8c0(0x15f)]=0x7530,this[_0x27c8c0(0x14b)]=0xea60,this['CHECK_INTERVAL']=0x3e8;}[a0_0x3a66c6(0x141)](_0x4330ca,_0x1103a1){const _0x1d97c2=a0_0x3a66c6,_0x311902=Date['now']()+_0x1103a1,_0x3e6f1f=this[_0x1d97c2(0x157)]['get'](_0x4330ca)||0x0;_0x311902>_0x3e6f1f&&(this['nextAllowedTime'][_0x1d97c2(0x171)](_0x4330ca,_0x311902),this[_0x1d97c2(0x14e)][_0x1d97c2(0x134)]('Rate\x20limit\x20delay\x20set\x20for\x20'+_0x4330ca+':\x20'+_0x1103a1+_0x1d97c2(0x133)+new Date(_0x311902)[_0x1d97c2(0x148)]()+')'));}[a0_0x3a66c6(0x14a)](_0x14b796){const _0x45f3cc=a0_0x3a66c6,_0x2cc16d=this[_0x45f3cc(0x135)][_0x45f3cc(0x15e)](_0x14b796)||0x0,_0x4c226d=_0x2cc16d+0x1;this['rateLimitHits']['set'](_0x14b796,_0x4c226d);let _0x5401e7;_0x4c226d===0x1?_0x5401e7=this[_0x45f3cc(0x15f)]:_0x5401e7=this['EXTENDED_RATE_LIMIT_DELAY'],this['setDelay'](_0x14b796,_0x5401e7),this[_0x45f3cc(0x14e)]['warn']('Rate\x20limit\x20hit\x20#'+_0x4c226d+_0x45f3cc(0x13b)+_0x14b796+_0x45f3cc(0x169)+_0x5401e7+'ms\x20delay');}async['waitIfNeeded'](_0xd6e4){const _0x18674d=a0_0x3a66c6,_0x19337c=this[_0x18674d(0x157)][_0x18674d(0x15e)](_0xd6e4)||0x0,_0x36697e=Date[_0x18674d(0x13c)]();if(_0x36697e>=_0x19337c){this['logger'][_0x18674d(0x15a)](_0xd6e4+_0x18674d(0x131));return;}const _0x3763d3=_0x19337c-_0x36697e,_0x52ac61=_0x3763d3+this['CHECK_INTERVAL'];this[_0x18674d(0x14e)]['info'](_0xd6e4+':\x20Waiting\x20'+_0x52ac61+'ms\x20before\x20sending\x20(until\x20'+new Date(_0x19337c+this[_0x18674d(0x170)])[_0x18674d(0x148)]()+')'),await new Promise(_0x58d0c3=>setTimeout(_0x58d0c3,_0x52ac61));}[a0_0x3a66c6(0x162)](_0x4fc166){const _0x364b64=a0_0x3a66c6;this[_0x364b64(0x135)]['has'](_0x4fc166)&&(this['rateLimitHits']['delete'](_0x4fc166),this[_0x364b64(0x14e)][_0x364b64(0x15a)](_0x4fc166+':\x20Rate\x20limit\x20hits\x20reset\x20(successful\x20request)'));}['getStatus'](_0x73ceda){const _0x17e89f=a0_0x3a66c6,_0x101d7a=this[_0x17e89f(0x157)]['get'](_0x73ceda)||0x0,_0x91302=this['rateLimitHits']['get'](_0x73ceda)||0x0,_0x23767c=Date[_0x17e89f(0x13c)]();return{'serviceModel':_0x73ceda,'nextAllowedTime':_0x101d7a,'nextAllowedDate':_0x101d7a>0x0?new Date(_0x101d7a)[_0x17e89f(0x148)]():null,'remainingDelayMs':Math['max'](0x0,_0x101d7a-_0x23767c),'canSendNow':_0x23767c>=_0x101d7a,'consecutiveRateLimitHits':_0x91302};}['getAllStatus'](){const _0x4086c7=a0_0x3a66c6,_0x4f73c9=new Set([...this[_0x4086c7(0x157)][_0x4086c7(0x142)](),...this['rateLimitHits']['keys']()]),_0x2c7abf={};for(const _0x50bae1 of _0x4f73c9){_0x2c7abf[_0x50bae1]=this['getStatus'](_0x50bae1);}return _0x2c7abf;}['clear'](){const _0x541694=a0_0x3a66c6;this['nextAllowedTime'][_0x541694(0x14c)](),this[_0x541694(0x135)]['clear'](),this[_0x541694(0x14e)]['info'](_0x541694(0x152));}}function a0_0x4a01(_0x2febf9,_0x22f3c7){const _0x42b012=a0_0x42b0();return a0_0x4a01=function(_0x4a012b,_0x184353){_0x4a012b=_0x4a012b-0x130;let _0x75a4d7=_0x42b012[_0x4a012b];if(a0_0x4a01['hZimOI']===undefined){var _0x30d258=function(_0xde16f4){const _0x4330ca='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1103a1='',_0x311902='';for(let _0x3e6f1f=0x0,_0x14b796,_0x2cc16d,_0x4c226d=0x0;_0x2cc16d=_0xde16f4['charAt'](_0x4c226d++);~_0x2cc16d&&(_0x14b796=_0x3e6f1f%0x4?_0x14b796*0x40+_0x2cc16d:_0x2cc16d,_0x3e6f1f++%0x4)?_0x1103a1+=String['fromCharCode'](0xff&_0x14b796>>(-0x2*_0x3e6f1f&0x6)):0x0){_0x2cc16d=_0x4330ca['indexOf'](_0x2cc16d);}for(let _0x5401e7=0x0,_0xd6e4=_0x1103a1['length'];_0x5401e7<_0xd6e4;_0x5401e7++){_0x311902+='%'+('00'+_0x1103a1['charCodeAt'](_0x5401e7)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x311902);};a0_0x4a01['zrdCbY']=_0x30d258,_0x2febf9=arguments,a0_0x4a01['hZimOI']=!![];}const _0x428ed8=_0x42b012[0x0],_0x5da8e8=_0x4a012b+_0x428ed8,_0x508887=_0x2febf9[_0x5da8e8];return!_0x508887?(_0x75a4d7=a0_0x4a01['zrdCbY'](_0x75a4d7),_0x2febf9[_0x5da8e8]=_0x75a4d7):_0x75a4d7=_0x508887,_0x75a4d7;},a0_0x4a01(_0x2febf9,_0x22f3c7);}export class EnhancedLLMService{constructor(_0x329d6e,_0x1d5cb7){const _0x3fb0fb=a0_0x3a66c6;this['config']=_0x329d6e,this[_0x3fb0fb(0x14e)]=_0x1d5cb7,this['rateLimitService']=new RateLimitService(_0x1d5cb7),this['budgetService']=new BudgetService(_0x329d6e,_0x1d5cb7),this['serviceInstances']=new Map(),this['conversationServices']=new Map(),this['serviceStatus']=new Map();}async[a0_0x3a66c6(0x153)](_0x5908aa,_0x34d2d7,_0x226402){const _0x45709a=a0_0x3a66c6,_0x495008=this[_0x45709a(0x172)][_0x45709a(0x15e)](_0x5908aa);if(!_0x495008)throw new Error('Conversation\x20'+_0x5908aa+_0x45709a(0x13e));const _0x5c728f=this['serviceInstances'][_0x45709a(0x15e)](_0x495008);if(!_0x5c728f)throw new Error(_0x45709a(0x146)+_0x495008+_0x45709a(0x149)+_0x5908aa);const _0x435f47=this[_0x45709a(0x143)](_0x495008);await this['rateLimitService'][_0x45709a(0x163)](_0x435f47);const _0x94a755=this['config'][_0x45709a(0x161)]?.[_0x45709a(0x137)]||0x3;let _0x2e0bca=0x0,_0x597423=null;while(_0x2e0bca<=_0x94a755){try{const _0x5ea590=await _0x5c728f['sendMessage'](_0x5908aa,_0x34d2d7,_0x226402);return this[_0x45709a(0x166)][_0x45709a(0x162)](_0x435f47),await this['budgetService'][_0x45709a(0x136)](_0x495008,_0x5c728f[_0x45709a(0x16a)](),_0x5c728f['getLastOutputTokenCount']()),this[_0x45709a(0x16e)]['get'](_0x495008)===_0x45709a(0x144)&&this['serviceStatus'][_0x45709a(0x171)](_0x495008,'available'),_0x5ea590;}catch(_0x9e72c5){_0x597423=_0x9e72c5,this[_0x45709a(0x14e)]['error']('Request\x20failed\x20(attempt\x20'+(_0x2e0bca+0x1)+'/'+(_0x94a755+0x1)+'):',_0x9e72c5);if(this[_0x45709a(0x168)](_0x9e72c5)){this['rateLimitService']['handleRateLimitHit'](_0x435f47);if(_0x2e0bca<_0x94a755){this['logger'][_0x45709a(0x134)]('Rate\x20limit\x20error\x20detected,\x20waiting\x20and\x20retrying...'),await this['rateLimitService']['waitIfNeeded'](_0x435f47);continue;}}if(this['_isNonRetryableError'](_0x9e72c5))throw _0x9e72c5;if(_0x2e0bca>=_0x94a755)break;this[_0x45709a(0x16e)]['set'](_0x495008,'degraded');const _0x50738e=this['config'][_0x45709a(0x161)]?.[_0x45709a(0x14f)]||0x3e8,_0x241b44=this['config'][_0x45709a(0x161)]?.['delayMultiplier']||0x2,_0x5bbcdb=_0x50738e*Math[_0x45709a(0x147)](_0x241b44,_0x2e0bca);this[_0x45709a(0x14e)]['info'](_0x45709a(0x15b)+_0x5bbcdb+_0x45709a(0x13a)),await new Promise(_0x5ea7ae=>setTimeout(_0x5ea7ae,_0x5bbcdb)),_0x2e0bca++;}}throw new Error(_0x45709a(0x16b)+(_0x597423?.[_0x45709a(0x15c)]||'Unknown\x20error'));}['_isRateLimitError'](_0x1c9699){const _0x12aafc=a0_0x3a66c6,_0x1b265d=[_0x12aafc(0x160),'too\x20many\x20requests',_0x12aafc(0x145),_0x12aafc(0x139),'429',_0x12aafc(0x158)],_0x22c686=_0x1c9699['message']?.['toLowerCase']()||'';return _0x1b265d['some'](_0x2ecc7d=>_0x22c686[_0x12aafc(0x13d)](_0x2ecc7d));}[a0_0x3a66c6(0x16d)](_0x3ddb4e){const _0x901749=a0_0x3a66c6,_0x512456=[_0x901749(0x16c),_0x901749(0x151),'unauthorized','model\x20not\x20found',_0x901749(0x132),_0x901749(0x159)],_0x3e960d=_0x3ddb4e[_0x901749(0x15c)]?.[_0x901749(0x130)]()||'';return _0x512456[_0x901749(0x165)](_0x3eb972=>_0x3e960d[_0x901749(0x13d)](_0x3eb972));}['_getServiceModelId'](_0x44c97a){const _0x34b9d3=a0_0x3a66c6,_0x4247c6={'anthropic':_0x34b9d3(0x167),'openai':_0x34b9d3(0x16f),'google':'google-gemini'};return _0x4247c6[_0x44c97a]||_0x44c97a;}['getRateLimitingStatus'](){const _0x1ea80d=a0_0x3a66c6;return this['rateLimitService'][_0x1ea80d(0x164)]();}}function a0_0x42b0(){const _0x473ed4=['ntiYmZu1mKnVs2TszG','nJuWnZaWngrqwhbYtq','C2v0rgvSyxK','A2v5CW','x2DLDfnLCNzPy2vnB2rLBeLK','zgvNCMfKzwq','CxvVDgeGzxHJzwvKzwq','u2vYDMLJzsa','Cg93','Dg9ju09tDhjPBMC','ig5VDcbMB3vUzcbMB3iGy29UDMvYC2f0Aw9Uia','AgfUzgXLuMf0zuXPBwL0sgL0','rvHuru5erurFuKfurv9msu1jvf9eruXbwq','y2XLyxi','mZaYote3mM12DxrYrG','Bg9Nz2vY','yMfZzurLBgf5txm','mtuWmta1mLD0CMXquq','yxv0AgvUDgLJyxrPB24GzMfPBgvK','uMf0zsbSAw1PDgLUzYbZDgf0zsbJBgvHCMvK','C2vUze1LC3nHz2u','mtaYmfDsB3DytW','mtm4mJy5n05vzwr2uq','m3LMAgrkBq','BMv4DefSBg93zwruAw1L','DgHYB3r0Bgu','y29UDgvUDcbWB2XPy3K','zgvIDwC','uMv0CNLPBMCGywz0zxiG','BwvZC2fNzq','oti4ogHJAvzYqG','z2v0','su5jveLbtf9sqvrfx0XjtuLux0rftefz','CMf0zsbSAw1PDa','CMv0CMLLCW','CMvZzxrsyxrLtgLTAxriAxrZ','D2fPDeLMtMvLzgvK','z2v0qwXSu3rHDhvZ','C29Tzq','CMf0zuXPBwL0u2vYDMLJzq','yw50AhjVCgLJlxnVBM5LDa','x2LZuMf0zuXPBwL0rxjYB3i','lcbHChbSEwLUzYa','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','qwXSihjLDhj5igf0DgvTChrZigzHAwXLzdOG','Aw52ywXPzcbHCgKGA2v5','x2LZtM9UuMv0CNLHyMXLrxjYB3i','C2vYDMLJzvn0yxr1CW','B3bLBMfPlwDWDdq','q0Hfq0TFsu5urvjwquW','C2v0','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','Dg9mB3DLCKnHC2u','oIbszwfKEsb0BYbZzw5KicHUBYbKzwXHEsbUzwvKzwqP','Aw52ywXPzcbYzxf1zxn0igzVCM1HDa','BxmGkhvUDgLSia','Aw5MBW','CMf0zuXPBwL0sgL0CW','CMvJB3jKvxnHz2u','Bwf4uMv0CMLLCW','mZu1ota5ogDfDNP2uW','CMvXDwvZDcbSAw1PDa','BxmUlI4','igzVCIa','BM93','Aw5JBhvKzxm','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u'];a0_0x42b0=function(){return _0x473ed4;};return a0_0x42b0();}