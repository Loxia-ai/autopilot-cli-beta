function a0_0x2f6b(_0x36ffea,_0xbe1e64){const _0x29db62=a0_0x29db();return a0_0x2f6b=function(_0x2f6be8,_0x11a018){_0x2f6be8=_0x2f6be8-0xfc;let _0x1ca284=_0x29db62[_0x2f6be8];if(a0_0x2f6b['TOEuzI']===undefined){var _0x4f798a=function(_0x12586b){const _0x49133a='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x57bd55='',_0x317cd5='';for(let _0xfed3ef=0x0,_0x53e6bd,_0x1c6014,_0x36ed0c=0x0;_0x1c6014=_0x12586b['charAt'](_0x36ed0c++);~_0x1c6014&&(_0x53e6bd=_0xfed3ef%0x4?_0x53e6bd*0x40+_0x1c6014:_0x1c6014,_0xfed3ef++%0x4)?_0x57bd55+=String['fromCharCode'](0xff&_0x53e6bd>>(-0x2*_0xfed3ef&0x6)):0x0){_0x1c6014=_0x49133a['indexOf'](_0x1c6014);}for(let _0x55b700=0x0,_0x55792c=_0x57bd55['length'];_0x55b700<_0x55792c;_0x55b700++){_0x317cd5+='%'+('00'+_0x57bd55['charCodeAt'](_0x55b700)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x317cd5);};a0_0x2f6b['LAAckp']=_0x4f798a,_0x36ffea=arguments,a0_0x2f6b['TOEuzI']=!![];}const _0xbdcd09=_0x29db62[0x0],_0x5a06d6=_0x2f6be8+_0xbdcd09,_0x3cb246=_0x36ffea[_0x5a06d6];return!_0x3cb246?(_0x1ca284=a0_0x2f6b['LAAckp'](_0x1ca284),_0x36ffea[_0x5a06d6]=_0x1ca284):_0x1ca284=_0x3cb246,_0x1ca284;},a0_0x2f6b(_0x36ffea,_0xbe1e64);}const a0_0x291422=a0_0x2f6b;(function(_0x4a7a23,_0x5815fa){const _0x5e023e=a0_0x2f6b,_0x5681e9=_0x4a7a23();while(!![]){try{const _0x4115c0=-parseInt(_0x5e023e(0x108))/0x1+-parseInt(_0x5e023e(0x117))/0x2+-parseInt(_0x5e023e(0x131))/0x3*(parseInt(_0x5e023e(0x115))/0x4)+-parseInt(_0x5e023e(0x10b))/0x5*(parseInt(_0x5e023e(0x12e))/0x6)+-parseInt(_0x5e023e(0x11a))/0x7+-parseInt(_0x5e023e(0x100))/0x8+parseInt(_0x5e023e(0x130))/0x9*(parseInt(_0x5e023e(0x129))/0xa);if(_0x4115c0===_0x5815fa)break;else _0x5681e9['push'](_0x5681e9['shift']());}catch(_0x559445){_0x5681e9['push'](_0x5681e9['shift']());}}}(a0_0x29db,0xd48e4));export class RateLimitService{constructor(_0x12586b){const _0x5dd4dd=a0_0x2f6b;this[_0x5dd4dd(0x137)]=_0x12586b,this['nextAllowedTime']=new Map(),this[_0x5dd4dd(0x125)]=new Map(),this['INITIAL_RATE_LIMIT_DELAY']=0x7530,this[_0x5dd4dd(0x124)]=0xea60,this['CHECK_INTERVAL']=0x3e8;}['setDelay'](_0x49133a,_0x57bd55){const _0x4242f0=a0_0x2f6b,_0x317cd5=Date[_0x4242f0(0xff)]()+_0x57bd55,_0xfed3ef=this['nextAllowedTime']['get'](_0x49133a)||0x0;_0x317cd5>_0xfed3ef&&(this['nextAllowedTime']['set'](_0x49133a,_0x317cd5),this[_0x4242f0(0x137)]['info'](_0x4242f0(0x105)+_0x49133a+':\x20'+_0x57bd55+_0x4242f0(0x127)+new Date(_0x317cd5)[_0x4242f0(0x119)]()+')'));}[a0_0x291422(0x10a)](_0x53e6bd){const _0x4caeba=a0_0x291422,_0x1c6014=this['rateLimitHits'][_0x4caeba(0xfd)](_0x53e6bd)||0x0,_0x36ed0c=_0x1c6014+0x1;this[_0x4caeba(0x125)][_0x4caeba(0x10e)](_0x53e6bd,_0x36ed0c);let _0x55b700;_0x36ed0c===0x1?_0x55b700=this[_0x4caeba(0x136)]:_0x55b700=this['EXTENDED_RATE_LIMIT_DELAY'],this['setDelay'](_0x53e6bd,_0x55b700),this['logger'][_0x4caeba(0x116)]('Rate\x20limit\x20hit\x20#'+_0x36ed0c+'\x20for\x20'+_0x53e6bd+_0x4caeba(0x140)+_0x55b700+'ms\x20delay');}async['waitIfNeeded'](_0x55792c){const _0x148687=a0_0x291422,_0x29809d=this['nextAllowedTime'][_0x148687(0xfd)](_0x55792c)||0x0,_0x7854e7=Date['now']();if(_0x7854e7>=_0x29809d){this['logger'][_0x148687(0x126)](_0x55792c+_0x148687(0x109));return;}const _0x126ad0=_0x29809d-_0x7854e7,_0x4b5b6a=_0x126ad0+this[_0x148687(0x10f)];this['logger']['info'](_0x55792c+_0x148687(0x120)+_0x4b5b6a+_0x148687(0x111)+new Date(_0x29809d+this['CHECK_INTERVAL'])['toISOString']()+')'),await new Promise(_0xe74866=>setTimeout(_0xe74866,_0x4b5b6a));}['resetRateLimitHits'](_0x2d31bb){const _0x5b3426=a0_0x291422;this[_0x5b3426(0x125)][_0x5b3426(0x10d)](_0x2d31bb)&&(this['rateLimitHits']['delete'](_0x2d31bb),this[_0x5b3426(0x137)]['debug'](_0x2d31bb+_0x5b3426(0x107)));}[a0_0x291422(0x112)](_0x57371e){const _0x4dead5=a0_0x291422,_0x61463c=this[_0x4dead5(0x13d)]['get'](_0x57371e)||0x0,_0x42a1a6=this['rateLimitHits']['get'](_0x57371e)||0x0,_0x1c3d49=Date['now']();return{'serviceModel':_0x57371e,'nextAllowedTime':_0x61463c,'nextAllowedDate':_0x61463c>0x0?new Date(_0x61463c)[_0x4dead5(0x119)]():null,'remainingDelayMs':Math[_0x4dead5(0x135)](0x0,_0x61463c-_0x1c3d49),'canSendNow':_0x1c3d49>=_0x61463c,'consecutiveRateLimitHits':_0x42a1a6};}[a0_0x291422(0x12f)](){const _0x44c0d1=a0_0x291422,_0x62956f=new Set([...this['nextAllowedTime'][_0x44c0d1(0x103)](),...this['rateLimitHits'][_0x44c0d1(0x103)]()]),_0x27f9a5={};for(const _0x5ea6b0 of _0x62956f){_0x27f9a5[_0x5ea6b0]=this['getStatus'](_0x5ea6b0);}return _0x27f9a5;}['clear'](){const _0x3ebf89=a0_0x291422;this['nextAllowedTime'][_0x3ebf89(0x13e)](),this['rateLimitHits'][_0x3ebf89(0x13e)](),this['logger'][_0x3ebf89(0x106)](_0x3ebf89(0x11f));}}export class EnhancedLLMService{constructor(_0x5b740c,_0x1dc9bc){const _0x498671=a0_0x291422;this[_0x498671(0x132)]=_0x5b740c,this[_0x498671(0x137)]=_0x1dc9bc,this[_0x498671(0x11d)]=new RateLimitService(_0x1dc9bc),this[_0x498671(0x11e)]=new BudgetService(_0x5b740c,_0x1dc9bc),this[_0x498671(0x128)]=new Map(),this['conversationServices']=new Map(),this['serviceStatus']=new Map();}async[a0_0x291422(0x110)](_0x117f81,_0x33e55b,_0x4e7ac8){const _0x35abe0=a0_0x291422,_0x1b7f4e=this['conversationServices']['get'](_0x117f81);if(!_0x1b7f4e)throw new Error('Conversation\x20'+_0x117f81+_0x35abe0(0x11b));const _0x24071f=this[_0x35abe0(0x128)][_0x35abe0(0xfd)](_0x1b7f4e);if(!_0x24071f)throw new Error(_0x35abe0(0x121)+_0x1b7f4e+'\x20not\x20found\x20for\x20conversation\x20'+_0x117f81);const _0x32586a=this[_0x35abe0(0x138)](_0x1b7f4e);await this[_0x35abe0(0x11d)][_0x35abe0(0x101)](_0x32586a);const _0x747dae=this['config']['retries']?.[_0x35abe0(0x114)]||0x3;let _0x354c7d=0x0,_0x3767fb=null;while(_0x354c7d<=_0x747dae){try{const _0x322e9e=await _0x24071f[_0x35abe0(0x110)](_0x117f81,_0x33e55b,_0x4e7ac8);return this['rateLimitService'][_0x35abe0(0x118)](_0x32586a),await this[_0x35abe0(0x11e)]['recordUsage'](_0x1b7f4e,_0x24071f['getLastInputTokenCount'](),_0x24071f['getLastOutputTokenCount']()),this['serviceStatus']['get'](_0x1b7f4e)===_0x35abe0(0x10c)&&this[_0x35abe0(0x13a)][_0x35abe0(0x10e)](_0x1b7f4e,'available'),_0x322e9e;}catch(_0x247be4){_0x3767fb=_0x247be4,this[_0x35abe0(0x137)][_0x35abe0(0x12b)]('Request\x20failed\x20(attempt\x20'+(_0x354c7d+0x1)+'/'+(_0x747dae+0x1)+'):',_0x247be4);if(this['_isRateLimitError'](_0x247be4)){this[_0x35abe0(0x11d)][_0x35abe0(0x10a)](_0x32586a);if(_0x354c7d<_0x747dae){this[_0x35abe0(0x137)][_0x35abe0(0x106)]('Rate\x20limit\x20error\x20detected,\x20waiting\x20and\x20retrying...'),await this['rateLimitService'][_0x35abe0(0x101)](_0x32586a);continue;}}if(this[_0x35abe0(0xfe)](_0x247be4))throw _0x247be4;if(_0x354c7d>=_0x747dae)break;this[_0x35abe0(0x13a)]['set'](_0x1b7f4e,'degraded');const _0x26357f=this['config'][_0x35abe0(0x12c)]?.['baseDelayMs']||0x3e8,_0xa9478=this[_0x35abe0(0x132)][_0x35abe0(0x12c)]?.[_0x35abe0(0x139)]||0x2,_0x3364e6=_0x26357f*Math['pow'](_0xa9478,_0x354c7d);this['logger']['info'](_0x35abe0(0x12d)+_0x3364e6+'ms...'),await new Promise(_0x36359b=>setTimeout(_0x36359b,_0x3364e6)),_0x354c7d++;}}throw new Error('All\x20retry\x20attempts\x20failed:\x20'+(_0x3767fb?.[_0x35abe0(0x13f)]||'Unknown\x20error'));}[a0_0x291422(0x13c)](_0x20f955){const _0x15dc11=a0_0x291422,_0x59a793=[_0x15dc11(0x13b),'too\x20many\x20requests',_0x15dc11(0xfc),_0x15dc11(0x123),_0x15dc11(0x141),_0x15dc11(0x12a)],_0xf95614=_0x20f955[_0x15dc11(0x13f)]?.[_0x15dc11(0x104)]()||'';return _0x59a793['some'](_0x1f4950=>_0xf95614['includes'](_0x1f4950));}['_isNonRetryableError'](_0x475f14){const _0x4f6de4=a0_0x291422,_0x495d2f=[_0x4f6de4(0x113),'authentication\x20failed','unauthorized',_0x4f6de4(0x133),_0x4f6de4(0x11c),'content\x20policy'],_0x5519a1=_0x475f14['message']?.['toLowerCase']()||'';return _0x495d2f['some'](_0x3041e6=>_0x5519a1['includes'](_0x3041e6));}[a0_0x291422(0x138)](_0x39f594){const _0x327933=a0_0x291422,_0x56024f={'anthropic':_0x327933(0x102),'openai':_0x327933(0x134),'google':'google-gemini'};return _0x56024f[_0x39f594]||_0x39f594;}[a0_0x291422(0x122)](){const _0xb4656a=a0_0x291422;return this[_0xb4656a(0x11d)]['getAllStatus']();}}function a0_0x29db(){const _0x2e1d00=['x2DLDfnLCNzPy2vnB2rLBeLK','zgvSyxLnDwX0AxbSAwvY','C2vYDMLJzvn0yxr1CW','CMf0zsbSAw1PDa','x2LZuMf0zuXPBwL0rxjYB3i','BMv4DefSBg93zwruAw1L','y2XLyxi','BwvZC2fNzq','lcbHChbSEwLUzYa','ndi5','CxvVDgeGzxHJzwvKzwq','z2v0','x2LZtM9UuMv0CNLHyMXLrxjYB3i','BM93','mte4ndKYmdbpzhv5CvG','D2fPDeLMtMvLzgvK','yw50AhjVCgLJlxnVBM5LDa','A2v5CW','Dg9mB3DLCKnHC2u','uMf0zsbSAw1PDcbKzwXHEsbZzxqGzM9Yia','Aw5MBW','oIbsyxrLigXPBwL0igHPDhmGCMvZzxqGkhn1y2nLC3nMDwWGCMvXDwvZDcK','mtu5nZaYnKLRtfbeEq','oIbszwfKEsb0BYbZzw5KicHUBYbKzwXHEsbUzwvKzwqP','AgfUzgXLuMf0zuXPBwL0sgL0','nda3nJK5mgPKCwDzCW','zgvNCMfKzwq','AgfZ','C2v0','q0Hfq0TFsu5urvjwquW','C2vUze1LC3nHz2u','BxmGyMvMB3jLihnLBMrPBMCGkhvUDgLSia','z2v0u3rHDhvZ','Aw52ywXPzcbHCgKGA2v5','Bwf4uMv0CMLLCW','mJiZmtCXnK5mD0DSyq','D2fYBG','mJm2mZmZmLjUB2jwrW','CMvZzxrsyxrLtgLTAxriAxrZ','Dg9ju09tDhjPBMC','mteXmJCWmdrTAwnVrhe','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','Aw52ywXPzcbYzxf1zxn0igzVCM1HDa','CMf0zuXPBwL0u2vYDMLJzq','yNvKz2v0u2vYDMLJzq','uMf0zsbSAw1PDgLUzYbZDgf0zsbJBgvHCMvK','oIbxywL0Aw5Nia','u2vYDMLJzsa','z2v0uMf0zuXPBwL0Aw5Nu3rHDhvZ','CMvXDwvZDcbSAw1PDa','rvHuru5erurFuKfurv9msu1jvf9eruXbwq','CMf0zuXPBwL0sgL0CW','zgvIDwC','BxmGkhvUDgLSia','C2vYDMLJzuLUC3rHBMnLCW','otq2nJy5nJbqBwDpue8','DgHYB3r0Bgu','zxjYB3i','CMv0CMLLCW','uMv0CNLPBMCGywz0zxiG','mtjrB3ngv1K','z2v0qwXSu3rHDhvZ','oxfMzuLHwq','nLnisMfMvG','y29UzMLN','Bw9KzwWGBM90igzVDw5K','B3bLBMfPlwDWDdq','Bwf4','su5jveLbtf9sqvrfx0XjtuLux0rftefz','Bg9Nz2vY'];a0_0x29db=function(){return _0x2e1d00;};return a0_0x29db();}