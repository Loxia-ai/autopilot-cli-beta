function a0_0x3b4e(){const _0x4414df=['B3bLBMfPlwDWDdq','odiYntC1vLL5AhPp','y2XLyxi','y29UDMvYC2f0Aw9Uu2vYDMLJzxm','z2v0uMf0zuXPBwL0Aw5Nu3rHDhvZ','mtvTvNDczM8','y29UzMLN','D2fYBG','Bwf4','BxmGyMvMB3jLihnLBMrPBMCGkhvUDgLSia','uMv0CNLPBMCGywz0zxiG','zgvIDwC','AgfZ','z2v0u3rHDhvZ','C29Tzq','lcbHChbSEwLUzYa','rvHuru5erurFuKfurv9msu1jvf9eruXbwq','mJi1ntCXnu9cr1PtEG','z2v0','CMvZzxrsyxrLtgLTAxriAxrZ','Aw5MBW','x2LZuMf0zuXPBwL0rxjYB3i','nJG2mtK2mffVu1HHyW','yNvKz2v0u2vYDMLJzq','C2v0','ntu4mZy0q1LZvNnU','z2v0tgfZDeLUChv0vg9Rzw5dB3vUDa','zgvSyxLnDwX0AxbSAwvY','uMf0zsbSAw1PDcbOAxqGiW','D2fPDeLMtMvLzgvK','nJiWnJeYANvKvNr1','uMvXDwvZDcbMywLSzwqGkgf0DgvTChqG','BwvZC2fNzq','q29UDMvYC2f0Aw9Uia','BMv4DefSBg93zwruAw1L','CMvXDwvZDcbSAw1PDa','CMv0CMLLCW','CMf0zuXPBwL0u2vYDMLJzq','uMf0zsbSAw1PDcbLCNjVCIbKzxrLy3rLzcWGD2fPDgLUzYbHBMqGCMv0CNLPBMCUlI4','su5jveLbtf9sqvrfx0XjtuLux0rftefz','Dw5HDxrOB3jPEMvK','Aw52ywXPzcbYzxf1zxn0igzVCM1HDa','z2v0qwXSu3rHDhvZ','Bg9Nz2vY','zgvNCMfKzwq','qwXSihjLDhj5igf0DgvTChrZigzHAwXLzdOG','igLZig5VDcbYzwDPC3rLCMvKihDPDgGGyw55ihnLCNzPy2u','y29UDgvUDcbWB2XPy3K','DgHYB3r0Bgu','Aw5JBhvKzxm','otqWnty2mhfOBNr2BW','CMvJB3jKvxnHz2u','mty1mtCXmJHOB3vIu0S','CMf0zuXPBwL0sgL0CW','oIbsyxrLigXPBwL0igHPDhmGCMvZzxqGkhn1y2nLC3nMDwWGCMvXDwvZDcK','CxvVDgeGzxHJzwvKzwq','uMf0zsbSAw1PDgLUzYbZDgf0zsbJBgvHCMvK','yMfZzurLBgf5txm','BM93','Aw52ywXPzcbHCgKGA2v5'];a0_0x3b4e=function(){return _0x4414df;};return a0_0x3b4e();}const a0_0xbd202e=a0_0x1a93;(function(_0x52fe66,_0x441f54){const _0x435529=a0_0x1a93,_0x715ca8=_0x52fe66();while(!![]){try{const _0x4eaa2b=-parseInt(_0x435529(0x1bc))/0x1+parseInt(_0x435529(0x1d9))/0x2+parseInt(_0x435529(0x1c0))/0x3*(-parseInt(_0x435529(0x1d4))/0x4)+parseInt(_0x435529(0x1d1))/0x5+-parseInt(_0x435529(0x1ed))/0x6+parseInt(_0x435529(0x1cc))/0x7+parseInt(_0x435529(0x1ef))/0x8;if(_0x4eaa2b===_0x441f54)break;else _0x715ca8['push'](_0x715ca8['shift']());}catch(_0x596c64){_0x715ca8['push'](_0x715ca8['shift']());}}}(a0_0x3b4e,0xef9c4));function a0_0x1a93(_0x146835,_0x103412){const _0x3b4ec6=a0_0x3b4e();return a0_0x1a93=function(_0x1a93e4,_0x9e364f){_0x1a93e4=_0x1a93e4-0x1b6;let _0x447c67=_0x3b4ec6[_0x1a93e4];if(a0_0x1a93['JWhjKa']===undefined){var _0x56fbd3=function(_0x580483){const _0x503976='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2a9c8a='',_0x24f93b='';for(let _0x194206=0x0,_0x5bcb60,_0x4dd856,_0x1fe8e3=0x0;_0x4dd856=_0x580483['charAt'](_0x1fe8e3++);~_0x4dd856&&(_0x5bcb60=_0x194206%0x4?_0x5bcb60*0x40+_0x4dd856:_0x4dd856,_0x194206++%0x4)?_0x2a9c8a+=String['fromCharCode'](0xff&_0x5bcb60>>(-0x2*_0x194206&0x6)):0x0){_0x4dd856=_0x503976['indexOf'](_0x4dd856);}for(let _0x38cf3b=0x0,_0x20b593=_0x2a9c8a['length'];_0x38cf3b<_0x20b593;_0x38cf3b++){_0x24f93b+='%'+('00'+_0x2a9c8a['charCodeAt'](_0x38cf3b)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x24f93b);};a0_0x1a93['MVBDbo']=_0x56fbd3,_0x146835=arguments,a0_0x1a93['JWhjKa']=!![];}const _0xa8dd1d=_0x3b4ec6[0x0],_0x1e38e5=_0x1a93e4+_0xa8dd1d,_0x3fece7=_0x146835[_0x1e38e5];return!_0x3fece7?(_0x447c67=a0_0x1a93['MVBDbo'](_0x447c67),_0x146835[_0x1e38e5]=_0x447c67):_0x447c67=_0x3fece7,_0x447c67;},a0_0x1a93(_0x146835,_0x103412);}export class RateLimitService{constructor(_0x580483){const _0x4c3008=a0_0x1a93;this[_0x4c3008(0x1e6)]=_0x580483,this[_0x4c3008(0x1dd)]=new Map(),this[_0x4c3008(0x1f0)]=new Map(),this[_0x4c3008(0x1e2)]=0x7530,this[_0x4c3008(0x1cb)]=0xea60,this['CHECK_INTERVAL']=0x3e8;}['setDelay'](_0x503976,_0x2a9c8a){const _0x4accfd=a0_0x1a93,_0x24f93b=Date[_0x4accfd(0x1b9)]()+_0x2a9c8a,_0x194206=this[_0x4accfd(0x1dd)]['get'](_0x503976)||0x0;_0x24f93b>_0x194206&&(this['nextAllowedTime']['set'](_0x503976,_0x24f93b),this[_0x4accfd(0x1e6)][_0x4accfd(0x1cf)]('Rate\x20limit\x20delay\x20set\x20for\x20'+_0x503976+':\x20'+_0x2a9c8a+'ms\x20(until\x20'+new Date(_0x24f93b)['toISOString']()+')'));}['handleRateLimitHit'](_0x5bcb60){const _0xdeaa02=a0_0x1a93,_0x4dd856=this['rateLimitHits'][_0xdeaa02(0x1cd)](_0x5bcb60)||0x0,_0x1fe8e3=_0x4dd856+0x1;this[_0xdeaa02(0x1f0)]['set'](_0x5bcb60,_0x1fe8e3);let _0x38cf3b;_0x1fe8e3===0x1?_0x38cf3b=this[_0xdeaa02(0x1e2)]:_0x38cf3b=this[_0xdeaa02(0x1cb)],this['setDelay'](_0x5bcb60,_0x38cf3b),this['logger'][_0xdeaa02(0x1c2)](_0xdeaa02(0x1d7)+_0x1fe8e3+'\x20for\x20'+_0x5bcb60+_0xdeaa02(0x1ca)+_0x38cf3b+'ms\x20delay');}async[a0_0xbd202e(0x1d8)](_0x20b593){const _0x3eff2c=a0_0xbd202e,_0x3a1769=this[_0x3eff2c(0x1dd)]['get'](_0x20b593)||0x0,_0x2164a5=Date['now']();if(_0x2164a5>=_0x3a1769){this['logger']['debug'](_0x20b593+':\x20Ready\x20to\x20send\x20(no\x20delay\x20needed)');return;}const _0x4f4e27=_0x3a1769-_0x2164a5,_0x1874bc=_0x4f4e27+this['CHECK_INTERVAL'];this[_0x3eff2c(0x1e6)]['info'](_0x20b593+':\x20Waiting\x20'+_0x1874bc+_0x3eff2c(0x1c4)+new Date(_0x3a1769+this['CHECK_INTERVAL'])['toISOString']()+')'),await new Promise(_0x214311=>setTimeout(_0x214311,_0x1874bc));}[a0_0xbd202e(0x1ce)](_0x234d82){const _0x39433d=a0_0xbd202e;this[_0x39433d(0x1f0)][_0x39433d(0x1c7)](_0x234d82)&&(this['rateLimitHits']['delete'](_0x234d82),this[_0x39433d(0x1e6)][_0x39433d(0x1c6)](_0x234d82+_0x39433d(0x1f1)));}['getStatus'](_0x21d4a6){const _0x42f2ff=a0_0xbd202e,_0xaf8ed0=this['nextAllowedTime'][_0x42f2ff(0x1cd)](_0x21d4a6)||0x0,_0x1d7825=this[_0x42f2ff(0x1f0)]['get'](_0x21d4a6)||0x0,_0x2076c1=Date['now']();return{'serviceModel':_0x21d4a6,'nextAllowedTime':_0xaf8ed0,'nextAllowedDate':_0xaf8ed0>0x0?new Date(_0xaf8ed0)['toISOString']():null,'remainingDelayMs':Math[_0x42f2ff(0x1c3)](0x0,_0xaf8ed0-_0x2076c1),'canSendNow':_0x2076c1>=_0xaf8ed0,'consecutiveRateLimitHits':_0x1d7825};}['getAllStatus'](){const _0x41522f=a0_0xbd202e,_0x597d1c=new Set([...this[_0x41522f(0x1dd)]['keys'](),...this['rateLimitHits']['keys']()]),_0x3e91b5={};for(const _0x1138a9 of _0x597d1c){_0x3e91b5[_0x1138a9]=this[_0x41522f(0x1c8)](_0x1138a9);}return _0x3e91b5;}[a0_0xbd202e(0x1bd)](){const _0x2d1c49=a0_0xbd202e;this['nextAllowedTime']['clear'](),this['rateLimitHits'][_0x2d1c49(0x1bd)](),this[_0x2d1c49(0x1e6)][_0x2d1c49(0x1cf)](_0x2d1c49(0x1b7));}}export class EnhancedLLMService{constructor(_0x40c821,_0x52ce52){const _0x37f82f=a0_0xbd202e;this['config']=_0x40c821,this[_0x37f82f(0x1e6)]=_0x52ce52,this[_0x37f82f(0x1e0)]=new RateLimitService(_0x52ce52),this[_0x37f82f(0x1d2)]=new BudgetService(_0x40c821,_0x52ce52),this['serviceInstances']=new Map(),this['conversationServices']=new Map(),this['serviceStatus']=new Map();}async['sendMessage'](_0x18fdb2,_0x2516e3,_0x4f6fff){const _0x3fa6e3=a0_0xbd202e,_0x457964=this[_0x3fa6e3(0x1be)][_0x3fa6e3(0x1cd)](_0x18fdb2);if(!_0x457964)throw new Error(_0x3fa6e3(0x1dc)+_0x18fdb2+_0x3fa6e3(0x1e9));const _0x2b7f67=this['serviceInstances']['get'](_0x457964);if(!_0x2b7f67)throw new Error('Service\x20'+_0x457964+'\x20not\x20found\x20for\x20conversation\x20'+_0x18fdb2);const _0x316d1e=this['_getServiceModelId'](_0x457964);await this[_0x3fa6e3(0x1e0)][_0x3fa6e3(0x1d8)](_0x316d1e);const _0x5a21c1=this[_0x3fa6e3(0x1c1)][_0x3fa6e3(0x1df)]?.['maxRetries']||0x3;let _0x19198b=0x0,_0x5561b0=null;while(_0x19198b<=_0x5a21c1){try{const _0x401985=await _0x2b7f67['sendMessage'](_0x18fdb2,_0x2516e3,_0x4f6fff);return this['rateLimitService'][_0x3fa6e3(0x1ce)](_0x316d1e),await this['budgetService'][_0x3fa6e3(0x1ee)](_0x457964,_0x2b7f67[_0x3fa6e3(0x1d5)](),_0x2b7f67['getLastOutputTokenCount']()),this['serviceStatus']['get'](_0x457964)===_0x3fa6e3(0x1e7)&&this['serviceStatus'][_0x3fa6e3(0x1d3)](_0x457964,'available'),_0x401985;}catch(_0x29886a){_0x5561b0=_0x29886a,this[_0x3fa6e3(0x1e6)]['error'](_0x3fa6e3(0x1da)+(_0x19198b+0x1)+'/'+(_0x5a21c1+0x1)+'):',_0x29886a);if(this['_isRateLimitError'](_0x29886a)){this['rateLimitService']['handleRateLimitHit'](_0x316d1e);if(_0x19198b<_0x5a21c1){this[_0x3fa6e3(0x1e6)][_0x3fa6e3(0x1cf)](_0x3fa6e3(0x1e1)),await this[_0x3fa6e3(0x1e0)][_0x3fa6e3(0x1d8)](_0x316d1e);continue;}}if(this['_isNonRetryableError'](_0x29886a))throw _0x29886a;if(_0x19198b>=_0x5a21c1)break;this['serviceStatus']['set'](_0x457964,_0x3fa6e3(0x1e7));const _0x5546b2=this['config']['retries']?.[_0x3fa6e3(0x1b8)]||0x3e8,_0x3b2fdb=this[_0x3fa6e3(0x1c1)][_0x3fa6e3(0x1df)]?.[_0x3fa6e3(0x1d6)]||0x2,_0x3d275e=_0x5546b2*Math['pow'](_0x3b2fdb,_0x19198b);this[_0x3fa6e3(0x1e6)]['info'](_0x3fa6e3(0x1c5)+_0x3d275e+'ms...'),await new Promise(_0x4ba2f6=>setTimeout(_0x4ba2f6,_0x3d275e)),_0x19198b++;}}throw new Error(_0x3fa6e3(0x1e8)+(_0x5561b0?.[_0x3fa6e3(0x1db)]||'Unknown\x20error'));}[a0_0xbd202e(0x1d0)](_0x454dec){const _0x104bfc=a0_0xbd202e,_0x3d6c3f=['rate\x20limit','too\x20many\x20requests',_0x104bfc(0x1b6),_0x104bfc(0x1de),'429',_0x104bfc(0x1eb)],_0x4ac708=_0x454dec[_0x104bfc(0x1db)]?.['toLowerCase']()||'';return _0x3d6c3f['some'](_0x5a5aa9=>_0x4ac708['includes'](_0x5a5aa9));}['_isNonRetryableError'](_0x4fd28d){const _0x591a3d=a0_0xbd202e,_0x54b4aa=[_0x591a3d(0x1ba),'authentication\x20failed',_0x591a3d(0x1e3),'model\x20not\x20found',_0x591a3d(0x1e4),_0x591a3d(0x1ea)],_0x3e5b6c=_0x4fd28d['message']?.['toLowerCase']()||'';return _0x54b4aa[_0x591a3d(0x1c9)](_0x1927a8=>_0x3e5b6c[_0x591a3d(0x1ec)](_0x1927a8));}['_getServiceModelId'](_0x231815){const _0x35f3fa=a0_0xbd202e,_0xc2b53c={'anthropic':'anthropic-sonnet','openai':_0x35f3fa(0x1bb),'google':'google-gemini'};return _0xc2b53c[_0x231815]||_0x231815;}[a0_0xbd202e(0x1bf)](){const _0x445dcc=a0_0xbd202e;return this[_0x445dcc(0x1e0)][_0x445dcc(0x1e5)]();}}