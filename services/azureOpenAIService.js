const a0_0x41f22e=a0_0x4caf;(function(_0x2c925c,_0x46a617){const _0x4c96ac=a0_0x4caf,_0x44891b=_0x2c925c();while(!![]){try{const _0x32e9cc=parseInt(_0x4c96ac(0xe2))/0x1+parseInt(_0x4c96ac(0xe3))/0x2*(parseInt(_0x4c96ac(0xd7))/0x3)+-parseInt(_0x4c96ac(0xd0))/0x4+-parseInt(_0x4c96ac(0xda))/0x5*(parseInt(_0x4c96ac(0xf0))/0x6)+parseInt(_0x4c96ac(0xd5))/0x7*(parseInt(_0x4c96ac(0xd3))/0x8)+-parseInt(_0x4c96ac(0xef))/0x9+parseInt(_0x4c96ac(0xe5))/0xa;if(_0x32e9cc===_0x46a617)break;else _0x44891b['push'](_0x44891b['shift']());}catch(_0x11d75b){_0x44891b['push'](_0x44891b['shift']());}}}(a0_0x2a2a,0xb371b));import a0_0x2946ea from'axios';import a0_0x5515b7 from'./keyVaultService.js';function a0_0x2a2a(){const _0x242e12=['mtu3mZu4nhDMDgDluW','ic0G','z3b0ltq','nJi5nZe2mejxze9cuG','mJaYnc0WmI0Xns1WCMv2Awv3','n3jPtM5Wwq','C3rHDhvZ','mtKYnti4m1zSzvnJqW','yxbWBgLJyxrPB24VANnVBG','qxP1CMuGt3bLBKfjiefqssbYzxf1zxn0ihrPBwvVDxq','nZGWmgnqA01Rta','qxP1CMuGt3bLBKfjihnLCNzPy2uGAw5PDgLHBgL6zwqGC3vJy2vZC2z1BgX5','zxjYB3i','y29Kzq','Aw5PDgLHBgL6zwq','qvPvuKuTt1bftKfjlufqss1lrvK','Aw5PDgLHBgL6zq','ChjLC2vUy2vqzw5HBhr5','mtiZnZaWmLn3DKv3ra','mLztBwTSDa','zw5KCg9PBNq','ntiZmtKWDfHet3H1','l2nOyxqVy29TCgXLDgLVBNm/yxbPlxzLCNnPB249','z2v0rgvWBg95BwvUDe5HBwu','yxbPvMvYC2LVBG','z2v0u2vJCMv0','Cg9ZDa','BwvZC2fNzq','Bg9Nz2vY','z3b0ltm1lxr1CMjV','Dw5OzwfSDgH5','otq1mdyXmNfqvvLzza','mJa3nKXdCxj5uW','CMvZCg9UC2u','yxbPs2v5','qxP1CMuGt3bLBKfjignYzwrLBNrPywXZig5VDcbMB3vUzcbPBIblzxKGvMf1Bhq','Aw5MBW','l29Wzw5HAs9KzxbSB3LTzw50CY8','qxP1CMuGt3bLBKfjiefqssbJywXSigzHAwXLzdO','runptK5bqK9sveve','qxP1CMuGt3bLBKfjiefqssbYzxf1zxn0igzHAwXLzdOG'];a0_0x2a2a=function(){return _0x242e12;};return a0_0x2a2a();}class AzureOpenAIService{constructor(_0x36ab57){const _0x5c606c=a0_0x4caf;this[_0x5c606c(0xec)]=_0x36ab57,this[_0x5c606c(0xe4)]=null,this['apiKey']=null,this[_0x5c606c(0xe8)]=_0x5c606c(0xd4),this['initialized']=![];}async[a0_0x41f22e(0xe0)](){const _0x310f74=a0_0x41f22e;if(this[_0x310f74(0xde)])return;try{this['endpoint']=await a0_0x5515b7[_0x310f74(0xe9)]('AZURE-OPENAI-ENDPOINT'),this['apiKey']=await a0_0x5515b7['getSecret'](_0x310f74(0xdf));if(!this[_0x310f74(0xe4)]||!this[_0x310f74(0xc9)])throw new Error(_0x310f74(0xca));this['initialized']=!![],this[_0x310f74(0xec)][_0x310f74(0xcb)](_0x310f74(0xdb));}catch(_0x381d79){this[_0x310f74(0xec)][_0x310f74(0xdc)]('Failed\x20to\x20initialize\x20Azure\x20OpenAI\x20service:',_0x381d79);throw _0x381d79;}}async['chatCompletion'](_0x54131e,_0x454c7c='gpt-4',_0x3e9988={}){const _0x6e3868=a0_0x41f22e;await this[_0x6e3868(0xe0)]();const _0x3988cf=this[_0x6e3868(0xe7)](_0x454c7c),_0x380b58=this['endpoint']+_0x6e3868(0xcc)+_0x3988cf+_0x6e3868(0xe6)+this['apiVersion'],_0x3443bf={'messages':_0x54131e,'max_tokens':_0x3e9988['maxTokens']||0xfa0,'temperature':_0x3e9988['temperature']||0.7,'top_p':_0x3e9988['topP']||0x1,'frequency_penalty':_0x3e9988['frequencyPenalty']||0x0,'presence_penalty':_0x3e9988[_0x6e3868(0xe1)]||0x0,..._0x3e9988};try{const _0x47463c=await a0_0x2946ea[_0x6e3868(0xea)](_0x380b58,_0x3443bf,{'headers':{'api-key':this[_0x6e3868(0xc9)],'Content-Type':_0x6e3868(0xd8)},'timeout':0xea60});return _0x47463c['data'];}catch(_0x1ed6e5){this['logger'][_0x6e3868(0xdc)](_0x6e3868(0xcd),_0x1ed6e5);if(_0x1ed6e5[_0x6e3868(0xc8)])throw new Error('Azure\x20OpenAI\x20API\x20error:\x20'+_0x1ed6e5[_0x6e3868(0xc8)][_0x6e3868(0xd6)]+_0x6e3868(0xd1)+(_0x1ed6e5[_0x6e3868(0xc8)]['data']?.[_0x6e3868(0xdc)]?.[_0x6e3868(0xeb)]||_0x1ed6e5[_0x6e3868(0xc8)]['statusText']));else{if(_0x1ed6e5[_0x6e3868(0xdd)]===_0x6e3868(0xce))throw new Error(_0x6e3868(0xd9));else throw new Error(_0x6e3868(0xcf)+_0x1ed6e5[_0x6e3868(0xeb)]);}}}[a0_0x41f22e(0xe7)](_0x2e19c5){const _0xeee25a=a0_0x41f22e,_0x34eee2={'openai-gpt4':_0xeee25a(0xd2),'openai-gpt3.5':_0xeee25a(0xed),'azure-openai-gpt4':_0xeee25a(0xd2),'azure-openai-gpt35':'gpt-35-turbo','gpt-4':'gpt-4','gpt-3.5-turbo':'gpt-35-turbo'};return _0x34eee2[_0x2e19c5]||_0xeee25a(0xd2);}async['healthCheck'](){const _0x10fce8=a0_0x41f22e;try{await this['initialize']();const _0x123fb1=[{'role':'user','content':'Hello,\x20this\x20is\x20a\x20test\x20message.'}],_0x666f4a=await this['chatCompletion'](_0x123fb1,_0x10fce8(0xed),{'maxTokens':0xa});return{'status':'healthy','endpoint':this[_0x10fce8(0xe4)],'model':'gpt-35-turbo','usage':_0x666f4a['usage']};}catch(_0xe68503){return{'status':_0x10fce8(0xee),'error':_0xe68503['message']};}}}function a0_0x4caf(_0x4bed5e,_0x22bfc9){const _0x2a2a26=a0_0x2a2a();return a0_0x4caf=function(_0x4caf6e,_0x2d14ae){_0x4caf6e=_0x4caf6e-0xc8;let _0x4faf7a=_0x2a2a26[_0x4caf6e];if(a0_0x4caf['yxoxFt']===undefined){var _0x3bb0eb=function(_0x2946ea){const _0x5515b7='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x36ab57='',_0x381d79='';for(let _0x54131e=0x0,_0x454c7c,_0x3e9988,_0x3988cf=0x0;_0x3e9988=_0x2946ea['charAt'](_0x3988cf++);~_0x3e9988&&(_0x454c7c=_0x54131e%0x4?_0x454c7c*0x40+_0x3e9988:_0x3e9988,_0x54131e++%0x4)?_0x36ab57+=String['fromCharCode'](0xff&_0x454c7c>>(-0x2*_0x54131e&0x6)):0x0){_0x3e9988=_0x5515b7['indexOf'](_0x3e9988);}for(let _0x380b58=0x0,_0x3443bf=_0x36ab57['length'];_0x380b58<_0x3443bf;_0x380b58++){_0x381d79+='%'+('00'+_0x36ab57['charCodeAt'](_0x380b58)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x381d79);};a0_0x4caf['OItyBR']=_0x3bb0eb,_0x4bed5e=arguments,a0_0x4caf['yxoxFt']=!![];}const _0x33c48a=_0x2a2a26[0x0],_0x4873a7=_0x4caf6e+_0x33c48a,_0x64c243=_0x4bed5e[_0x4873a7];return!_0x64c243?(_0x4faf7a=a0_0x4caf['OItyBR'](_0x4faf7a),_0x4bed5e[_0x4873a7]=_0x4faf7a):_0x4faf7a=_0x64c243,_0x4faf7a;},a0_0x4caf(_0x4bed5e,_0x22bfc9);}export default new AzureOpenAIService();