const a0_0x29c206=a0_0x5145;(function(_0x55cb60,_0x4388e1){const _0x16950e=a0_0x5145,_0x554ec3=_0x55cb60();while(!![]){try{const _0x415903=parseInt(_0x16950e(0x150))/0x1*(-parseInt(_0x16950e(0x14c))/0x2)+parseInt(_0x16950e(0x16e))/0x3+-parseInt(_0x16950e(0x16f))/0x4*(-parseInt(_0x16950e(0x177))/0x5)+-parseInt(_0x16950e(0x158))/0x6*(-parseInt(_0x16950e(0x14f))/0x7)+parseInt(_0x16950e(0x16c))/0x8+parseInt(_0x16950e(0x161))/0x9+-parseInt(_0x16950e(0x154))/0xa;if(_0x415903===_0x4388e1)break;else _0x554ec3['push'](_0x554ec3['shift']());}catch(_0x6a459e){_0x554ec3['push'](_0x554ec3['shift']());}}}(a0_0x5764,0xb6693));function a0_0x5145(_0x475984,_0x173470){const _0x576421=a0_0x5764();return a0_0x5145=function(_0x5145f1,_0x412fb1){_0x5145f1=_0x5145f1-0x14c;let _0x52984c=_0x576421[_0x5145f1];if(a0_0x5145['QOcyxP']===undefined){var _0x39044a=function(_0x5d59d2){const _0x16ac84='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3fdca2='',_0x57c979='';for(let _0x44110d=0x0,_0x511a51,_0x38e1d6,_0x3f2988=0x0;_0x38e1d6=_0x5d59d2['charAt'](_0x3f2988++);~_0x38e1d6&&(_0x511a51=_0x44110d%0x4?_0x511a51*0x40+_0x38e1d6:_0x38e1d6,_0x44110d++%0x4)?_0x3fdca2+=String['fromCharCode'](0xff&_0x511a51>>(-0x2*_0x44110d&0x6)):0x0){_0x38e1d6=_0x16ac84['indexOf'](_0x38e1d6);}for(let _0x242ed5=0x0,_0x1fa17d=_0x3fdca2['length'];_0x242ed5<_0x1fa17d;_0x242ed5++){_0x57c979+='%'+('00'+_0x3fdca2['charCodeAt'](_0x242ed5)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x57c979);};a0_0x5145['zOQjqx']=_0x39044a,_0x475984=arguments,a0_0x5145['QOcyxP']=!![];}const _0x36375a=_0x576421[0x0],_0x3bf8f2=_0x5145f1+_0x36375a,_0xc71a62=_0x475984[_0x3bf8f2];return!_0xc71a62?(_0x52984c=a0_0x5145['zOQjqx'](_0x52984c),_0x475984[_0x3bf8f2]=_0x52984c):_0x52984c=_0xc71a62,_0x52984c;},a0_0x5145(_0x475984,_0x173470);}import a0_0x5d59d2 from'axios';function a0_0x5764(){const _0x3ac2fa=['zNjLCxvLBMn5ugvUywX0Eq','mtm5nZjfBLHywgS','mxbXEwjvBW','zw5KCg9PBNq','CMvZCg9UC2u','z3b0ltq','mJm4ody0otbxqMz2rMq','zxjYB3i','l29Wzw5HAs9KzxbSB3LTzw50CY8','z3b0ltm1lxr1CMjV','nJu0tLHvq0TZ','DxnLCG','yxbPs2v5','DgvTCgvYyxr1CMu','yxbPvMvYC2LVBG','BwvZC2fNzq','sgvSBg8SihrOAxmGAxmGysb0zxn0ig1LC3nHz2uU','l2nOyxqVy29TCgXLDgLVBNm/yxbPlxzLCNnPB249','ChjLC2vUy2vqzw5HBhr5','mJi1nJC1mffdqvjwza','qxP1CMuGt3bLBKfjignYzwrLBNrPywXZig5VDcbMB3vUzcbPBIblzxKGvMf1Bhq','zgf0yq','qxP1CMuGt3bLBKfjiefqssbYzxf1zxn0igzHAwXLzdOG','C3rHDhvZvgv4Da','Aw5PDgLHBgL6zq','y29Kzq','qxP1CMuGt3bLBKfjiefqssbJywXSigzHAwXLzdO','z2v0u2vJCMv0','z2v0rgvWBg95BwvUDe5HBwu','yxbWBgLJyxrPB24VANnVBG','odG2mZiYnhH6zxbKuW','qvPvuKuTt1bftKfjlufqss1lrvK','mZm1ndKXohnytuLita','offNvLzZyW','Aw5PDgLHBgL6zwq','Cg9ZDa','Bwf4vg9Rzw5Z','Aw5MBW','y2HHDenVBxbSzxrPB24','Bg9Nz2vY','Dg9Wua','mZaWmduXmhnZzgTHCa','AgvHBhrOEq','mtuXnZG0nLnXuMHqBq','ic0G'];a0_0x5764=function(){return _0x3ac2fa;};return a0_0x5764();}import a0_0x16ac84 from'./keyVaultService.js';class AzureOpenAIService{constructor(_0x3fdca2){const _0x4c679e=a0_0x5145;this[_0x4c679e(0x175)]=_0x3fdca2,this['endpoint']=null,this['apiKey']=null,this[_0x4c679e(0x15c)]='2024-02-15-preview',this['initialized']=![];}async['initialize'](){const _0x3854a3=a0_0x5145;if(this[_0x3854a3(0x170)])return;try{this[_0x3854a3(0x151)]=await a0_0x16ac84[_0x3854a3(0x169)]('AZURE-OPENAI-ENDPOINT'),this[_0x3854a3(0x15a)]=await a0_0x16ac84['getSecret'](_0x3854a3(0x16d));if(!this[_0x3854a3(0x151)]||!this[_0x3854a3(0x15a)])throw new Error(_0x3854a3(0x162));this[_0x3854a3(0x170)]=!![],this['logger'][_0x3854a3(0x173)]('Azure\x20OpenAI\x20service\x20initialized\x20successfully');}catch(_0x57c979){this[_0x3854a3(0x175)][_0x3854a3(0x155)]('Failed\x20to\x20initialize\x20Azure\x20OpenAI\x20service:',_0x57c979);throw _0x57c979;}}async[a0_0x29c206(0x174)](_0x44110d,_0x511a51=a0_0x29c206(0x153),_0x38e1d6={}){const _0x39043f=a0_0x29c206;await this[_0x39043f(0x166)]();const _0x3f2988=this[_0x39043f(0x16a)](_0x511a51),_0x242ed5=this['endpoint']+_0x39043f(0x156)+_0x3f2988+_0x39043f(0x15f)+this[_0x39043f(0x15c)],_0x1fa17d={'messages':_0x44110d,'max_tokens':_0x38e1d6[_0x39043f(0x172)]||0xfa0,'temperature':_0x38e1d6[_0x39043f(0x15b)]||0.7,'top_p':_0x38e1d6[_0x39043f(0x176)]||0x1,'frequency_penalty':_0x38e1d6[_0x39043f(0x14e)]||0x0,'presence_penalty':_0x38e1d6[_0x39043f(0x160)]||0x0,..._0x38e1d6};try{const _0x8ae56b=await a0_0x5d59d2[_0x39043f(0x171)](_0x242ed5,_0x1fa17d,{'headers':{'api-key':this['apiKey'],'Content-Type':_0x39043f(0x16b)},'timeout':0xea60});return _0x8ae56b[_0x39043f(0x163)];}catch(_0x10ca41){this['logger']['error'](_0x39043f(0x168),_0x10ca41);if(_0x10ca41[_0x39043f(0x152)])throw new Error('Azure\x20OpenAI\x20API\x20error:\x20'+_0x10ca41['response']['status']+_0x39043f(0x14d)+(_0x10ca41['response'][_0x39043f(0x163)]?.[_0x39043f(0x155)]?.[_0x39043f(0x15d)]||_0x10ca41[_0x39043f(0x152)][_0x39043f(0x165)]));else{if(_0x10ca41[_0x39043f(0x167)]==='ECONNABORTED')throw new Error('Azure\x20OpenAI\x20API\x20request\x20timeout');else throw new Error(_0x39043f(0x164)+_0x10ca41[_0x39043f(0x15d)]);}}}[a0_0x29c206(0x16a)](_0x210276){const _0x59844b=a0_0x29c206,_0x53f44a={'openai-gpt4':_0x59844b(0x153),'openai-gpt3.5':_0x59844b(0x157),'azure-openai-gpt4':'gpt-4','azure-openai-gpt35':_0x59844b(0x157),'gpt-4':_0x59844b(0x153),'gpt-3.5-turbo':_0x59844b(0x157)};return _0x53f44a[_0x210276]||_0x59844b(0x153);}async['healthCheck'](){const _0x5c087a=a0_0x29c206;try{await this[_0x5c087a(0x166)]();const _0x4a2c4f=[{'role':_0x5c087a(0x159),'content':_0x5c087a(0x15e)}],_0x26e962=await this[_0x5c087a(0x174)](_0x4a2c4f,_0x5c087a(0x157),{'maxTokens':0xa});return{'status':_0x5c087a(0x178),'endpoint':this['endpoint'],'model':_0x5c087a(0x157),'usage':_0x26e962['usage']};}catch(_0x23a606){return{'status':'unhealthy','error':_0x23a606[_0x5c087a(0x15d)]};}}}export default new AzureOpenAIService();