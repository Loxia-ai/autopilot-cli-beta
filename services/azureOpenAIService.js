function a0_0x4758(_0x12d14e,_0x53bc09){const _0x55f3d2=a0_0x55f3();return a0_0x4758=function(_0x47587a,_0x3389a2){_0x47587a=_0x47587a-0x79;let _0x5492d9=_0x55f3d2[_0x47587a];if(a0_0x4758['QUZlne']===undefined){var _0x49a307=function(_0x44e5cf){const _0x1b1b66='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x451356='',_0x18db88='';for(let _0x88878a=0x0,_0x3e668a,_0x9c60d1,_0x5e8099=0x0;_0x9c60d1=_0x44e5cf['charAt'](_0x5e8099++);~_0x9c60d1&&(_0x3e668a=_0x88878a%0x4?_0x3e668a*0x40+_0x9c60d1:_0x9c60d1,_0x88878a++%0x4)?_0x451356+=String['fromCharCode'](0xff&_0x3e668a>>(-0x2*_0x88878a&0x6)):0x0){_0x9c60d1=_0x1b1b66['indexOf'](_0x9c60d1);}for(let _0x48edb6=0x0,_0x21de50=_0x451356['length'];_0x48edb6<_0x21de50;_0x48edb6++){_0x18db88+='%'+('00'+_0x451356['charCodeAt'](_0x48edb6)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x18db88);};a0_0x4758['MrBPbA']=_0x49a307,_0x12d14e=arguments,a0_0x4758['QUZlne']=!![];}const _0x6bf93e=_0x55f3d2[0x0],_0x3968b5=_0x47587a+_0x6bf93e,_0x44ec87=_0x12d14e[_0x3968b5];return!_0x44ec87?(_0x5492d9=a0_0x4758['MrBPbA'](_0x5492d9),_0x12d14e[_0x3968b5]=_0x5492d9):_0x5492d9=_0x44ec87,_0x5492d9;},a0_0x4758(_0x12d14e,_0x53bc09);}const a0_0x325c2c=a0_0x4758;(function(_0x1ecdd8,_0x475597){const _0x44932f=a0_0x4758,_0x1cadd2=_0x1ecdd8();while(!![]){try{const _0x2023f4=parseInt(_0x44932f(0x85))/0x1*(-parseInt(_0x44932f(0x8d))/0x2)+parseInt(_0x44932f(0x9b))/0x3*(-parseInt(_0x44932f(0x90))/0x4)+parseInt(_0x44932f(0x9a))/0x5+-parseInt(_0x44932f(0x92))/0x6*(parseInt(_0x44932f(0x95))/0x7)+parseInt(_0x44932f(0x7c))/0x8*(-parseInt(_0x44932f(0x97))/0x9)+parseInt(_0x44932f(0x87))/0xa+parseInt(_0x44932f(0x8f))/0xb;if(_0x2023f4===_0x475597)break;else _0x1cadd2['push'](_0x1cadd2['shift']());}catch(_0x92ffea){_0x1cadd2['push'](_0x1cadd2['shift']());}}}(a0_0x55f3,0x384ca));import a0_0x44e5cf from'axios';function a0_0x55f3(){const _0x4b9649=['Aw5MBW','mZzJvwfmyNu','Dw5OzwfSDgH5','mta2ndC5nZHVvurLB2i','mtG3mKfTAuXlDG','z3b0ltm1lxr1CMjV','nLvfzvDXsa','ChjLC2vUy2vqzw5HBhr5','qxP1CMuGt3bLBKfjignYzwrLBNrPywXZig5VDcbMB3vUzcbPBIblzxKGvMf1Bhq','mtGYndi3n2Pvr0jRra','Aw5PDgLHBgL6zq','ndy4zLvvqurQ','Cg9ZDa','DgvTCgvYyxr1CMu','mtG1ntaYnwvzCwLlDa','mte5ne5lwMPPqW','Bg9Nz2vY','BwvZC2fNzq','z3b0ltq','yxbPs2v5','zw5KCg9PBNq','qxP1CMuGt3bLBKfjihnLCNzPy2uGAw5PDgLHBgL6zwqGC3vJy2vZC2z1BgX5','nJyZndrSyxL6A0i','mJaYnc0WmI0Xns1WCMv2Awv3','Aw5PDgLHBgL6zwq','y2HHDenVBxbSzxrPB24','DxnHz2u','C3rHDhvZvgv4Da','rMfPBgvKihrVigLUAxrPywXPEMuGqxP1CMuGt3bLBKfjihnLCNzPy2u6','yxbPvMvYC2LVBG','z2v0u2vJCMv0','mJm3mJvdz3Lny28','zxjYB3i','mtK2nZyWmg95zKXysa','y29Kzq','qxP1CMuGt3bLBKfjiefqssbYzxf1zxn0igzHAwXLzdOG','CMvZCg9UC2u','runptK5bqK9sveve'];a0_0x55f3=function(){return _0x4b9649;};return a0_0x55f3();}import a0_0x1b1b66 from'./keyVaultService.js';class AzureOpenAIService{constructor(_0x451356){const _0x42bcfa=a0_0x4758;this[_0x42bcfa(0x9c)]=_0x451356,this[_0x42bcfa(0x7a)]=null,this[_0x42bcfa(0x79)]=null,this[_0x42bcfa(0x83)]=_0x42bcfa(0x7d),this[_0x42bcfa(0x7e)]=![];}async[a0_0x325c2c(0x96)](){const _0x1cd7b3=a0_0x325c2c;if(this['initialized'])return;try{this[_0x1cd7b3(0x7a)]=await a0_0x1b1b66['getSecret']('AZURE-OPENAI-ENDPOINT'),this[_0x1cd7b3(0x79)]=await a0_0x1b1b66[_0x1cd7b3(0x84)]('AZURE-OPENAI-API-KEY');if(!this['endpoint']||!this[_0x1cd7b3(0x79)])throw new Error(_0x1cd7b3(0x94));this[_0x1cd7b3(0x7e)]=!![],this[_0x1cd7b3(0x9c)][_0x1cd7b3(0x8c)](_0x1cd7b3(0x7b));}catch(_0x18db88){this['logger']['error'](_0x1cd7b3(0x82),_0x18db88);throw _0x18db88;}}async['chatCompletion'](_0x88878a,_0x3e668a=a0_0x325c2c(0x9e),_0x9c60d1={}){const _0xf54f5a=a0_0x325c2c;await this['initialize']();const _0x5e8099=this['getDeploymentName'](_0x3e668a),_0x48edb6=this[_0xf54f5a(0x7a)]+'/openai/deployments/'+_0x5e8099+'/chat/completions?api-version='+this[_0xf54f5a(0x83)],_0x21de50={'messages':_0x88878a,'max_tokens':_0x9c60d1['maxTokens']||0xfa0,'temperature':_0x9c60d1[_0xf54f5a(0x99)]||0.7,'top_p':_0x9c60d1['topP']||0x1,'frequency_penalty':_0x9c60d1['frequencyPenalty']||0x0,'presence_penalty':_0x9c60d1[_0xf54f5a(0x93)]||0x0,..._0x9c60d1};try{const _0x5b5c58=await a0_0x44e5cf[_0xf54f5a(0x98)](_0x48edb6,_0x21de50,{'headers':{'api-key':this['apiKey'],'Content-Type':'application/json'},'timeout':0xea60});return _0x5b5c58['data'];}catch(_0x35d768){this['logger'][_0xf54f5a(0x86)]('Azure\x20OpenAI\x20API\x20call\x20failed:',_0x35d768);if(_0x35d768['response'])throw new Error('Azure\x20OpenAI\x20API\x20error:\x20'+_0x35d768[_0xf54f5a(0x8a)]['status']+'\x20-\x20'+(_0x35d768['response']['data']?.['error']?.[_0xf54f5a(0x9d)]||_0x35d768['response'][_0xf54f5a(0x81)]));else{if(_0x35d768[_0xf54f5a(0x88)]===_0xf54f5a(0x8b))throw new Error('Azure\x20OpenAI\x20API\x20request\x20timeout');else throw new Error(_0xf54f5a(0x89)+_0x35d768['message']);}}}['getDeploymentName'](_0x4c4f11){const _0x42a966=a0_0x325c2c,_0x3befad={'openai-gpt4':'gpt-4','openai-gpt3.5':_0x42a966(0x91),'azure-openai-gpt4':_0x42a966(0x9e),'azure-openai-gpt35':'gpt-35-turbo','gpt-4':'gpt-4','gpt-3.5-turbo':'gpt-35-turbo'};return _0x3befad[_0x4c4f11]||_0x42a966(0x9e);}async['healthCheck'](){const _0x40c411=a0_0x325c2c;try{await this['initialize']();const _0x51936e=[{'role':'user','content':'Hello,\x20this\x20is\x20a\x20test\x20message.'}],_0x3c22c1=await this[_0x40c411(0x7f)](_0x51936e,_0x40c411(0x91),{'maxTokens':0xa});return{'status':'healthy','endpoint':this['endpoint'],'model':_0x40c411(0x91),'usage':_0x3c22c1[_0x40c411(0x80)]};}catch(_0x188c83){return{'status':_0x40c411(0x8e),'error':_0x188c83['message']};}}}export default new AzureOpenAIService();