const a0_0x588572=a0_0x5c4a;(function(_0x156327,_0x7488fa){const _0x218520=a0_0x5c4a,_0x1a9966=_0x156327();while(!![]){try{const _0x28dc0b=-parseInt(_0x218520(0xd6))/0x1+-parseInt(_0x218520(0xbd))/0x2+-parseInt(_0x218520(0xbe))/0x3*(parseInt(_0x218520(0xbb))/0x4)+parseInt(_0x218520(0xc1))/0x5*(parseInt(_0x218520(0xc2))/0x6)+-parseInt(_0x218520(0xb4))/0x7+-parseInt(_0x218520(0xbc))/0x8*(-parseInt(_0x218520(0xd9))/0x9)+parseInt(_0x218520(0xc3))/0xa*(parseInt(_0x218520(0xb5))/0xb);if(_0x28dc0b===_0x7488fa)break;else _0x1a9966['push'](_0x1a9966['shift']());}catch(_0x14af42){_0x1a9966['push'](_0x1a9966['shift']());}}}(a0_0x26a0,0x4c961));import a0_0x3ec90d from'axios';import a0_0x4039ce from'./keyVaultService.js';function a0_0x5c4a(_0x41c08d,_0x3b6c0e){const _0x26a02d=a0_0x26a0();return a0_0x5c4a=function(_0x5c4a53,_0x5d1480){_0x5c4a53=_0x5c4a53-0xb2;let _0x18bf98=_0x26a02d[_0x5c4a53];if(a0_0x5c4a['kDpXFa']===undefined){var _0x10e6af=function(_0x3ec90d){const _0x4039ce='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x596c77='',_0x303fe8='';for(let _0x23dd86=0x0,_0x40a1a8,_0x359fc0,_0x3cfe88=0x0;_0x359fc0=_0x3ec90d['charAt'](_0x3cfe88++);~_0x359fc0&&(_0x40a1a8=_0x23dd86%0x4?_0x40a1a8*0x40+_0x359fc0:_0x359fc0,_0x23dd86++%0x4)?_0x596c77+=String['fromCharCode'](0xff&_0x40a1a8>>(-0x2*_0x23dd86&0x6)):0x0){_0x359fc0=_0x4039ce['indexOf'](_0x359fc0);}for(let _0x1756c6=0x0,_0x1634fc=_0x596c77['length'];_0x1756c6<_0x1634fc;_0x1756c6++){_0x303fe8+='%'+('00'+_0x596c77['charCodeAt'](_0x1756c6)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x303fe8);};a0_0x5c4a['RlbIBT']=_0x10e6af,_0x41c08d=arguments,a0_0x5c4a['kDpXFa']=!![];}const _0x112138=_0x26a02d[0x0],_0x5ac51b=_0x5c4a53+_0x112138,_0x4bc9e2=_0x41c08d[_0x5ac51b];return!_0x4bc9e2?(_0x18bf98=a0_0x5c4a['RlbIBT'](_0x18bf98),_0x41c08d[_0x5ac51b]=_0x18bf98):_0x18bf98=_0x4bc9e2,_0x18bf98;},a0_0x5c4a(_0x41c08d,_0x3b6c0e);}function a0_0x26a0(){const _0x2654e8=['mti1n3j5yKDnwa','AgvHBhrOEq','AgvHBhrOq2HLy2S','mtb3yvrLvNa','mtaWmtmZnejtsuTZCG','ndiYmhDdy3jsBW','Aw5PDgLHBgL6zwq','z3b0ltm1lxr1CMjV','Aw5PDgLHBgL6zq','runptK5bqK9sveve','y2HHDenVBxbSzxrPB24','CMvZCg9UC2u','qxP1CMuGt3bLBKfjihnLCNzPy2uGAw5PDgLHBgL6zwqGC3vJy2vZC2z1BgX5','qxP1CMuGt3bLBKfjiefqssbJywXSigzHAwXLzdO','z3b0ltq','yxbPvMvYC2LVBG','DxnLCG','yxbWBgLJyxrPB24VANnVBG','zgf0yq','DgvTCgvYyxr1CMu','z2v0u2vJCMv0','ChjLC2vUy2vqzw5HBhr5','sgvSBg8SihrOAxmGAxmGysb0zxn0ig1LC3nHz2uU','rMfPBgvKihrVigLUAxrPywXPEMuGqxP1CMuGt3bLBKfjihnLCNzPy2u6','nte1mZq4v1LpB1DI','zw5KCg9PBNq','y29Kzq','nZC3odDrzKHnA1y','l2nOyxqVy29TCgXLDgLVBNm/yxbPlxzLCNnPB249','C3rHDhvZ','mtC0nty4ogXnBNbcrG','mJq1ndfqrxjlqum','zxjYB3i','yxbPs2v5','mJaYnc0WmI0Xns1WCMv2Awv3','Bg9Nz2vY','z2v0rgvWBg95BwvUDe5HBwu','ntiYohfsrLDOBa','nty4qvPOu3vq','nti1nZaYC1zNuLrQ'];a0_0x26a0=function(){return _0x2654e8;};return a0_0x26a0();}class AzureOpenAIService{constructor(_0x596c77){const _0xf0240c=a0_0x5c4a;this[_0xf0240c(0xb9)]=_0x596c77,this[_0xf0240c(0xd7)]=null,this[_0xf0240c(0xb7)]=null,this[_0xf0240c(0xcd)]=_0xf0240c(0xb8),this['initialized']=![];}async[a0_0x588572(0xc6)](){const _0x517a2f=a0_0x588572;if(this['initialized'])return;try{this[_0x517a2f(0xd7)]=await a0_0x4039ce[_0x517a2f(0xd2)]('AZURE-OPENAI-ENDPOINT'),this['apiKey']=await a0_0x4039ce[_0x517a2f(0xd2)]('AZURE-OPENAI-API-KEY');if(!this[_0x517a2f(0xd7)]||!this['apiKey'])throw new Error('Azure\x20OpenAI\x20credentials\x20not\x20found\x20in\x20Key\x20Vault');this[_0x517a2f(0xc4)]=!![],this['logger']['info'](_0x517a2f(0xca));}catch(_0x303fe8){this['logger'][_0x517a2f(0xb6)](_0x517a2f(0xd5),_0x303fe8);throw _0x303fe8;}}async['chatCompletion'](_0x23dd86,_0x40a1a8='gpt-4',_0x359fc0={}){const _0xe834=a0_0x588572;await this['initialize']();const _0x3cfe88=this[_0xe834(0xba)](_0x40a1a8),_0x1756c6=this['endpoint']+'/openai/deployments/'+_0x3cfe88+_0xe834(0xb2)+this['apiVersion'],_0x1634fc={'messages':_0x23dd86,'max_tokens':_0x359fc0['maxTokens']||0xfa0,'temperature':_0x359fc0[_0xe834(0xd1)]||0.7,'top_p':_0x359fc0['topP']||0x1,'frequency_penalty':_0x359fc0['frequencyPenalty']||0x0,'presence_penalty':_0x359fc0[_0xe834(0xd3)]||0x0,..._0x359fc0};try{const _0xf30a4=await a0_0x3ec90d['post'](_0x1756c6,_0x1634fc,{'headers':{'api-key':this['apiKey'],'Content-Type':_0xe834(0xcf)},'timeout':0xea60});return _0xf30a4[_0xe834(0xd0)];}catch(_0x12786a){this['logger'][_0xe834(0xb6)](_0xe834(0xcb),_0x12786a);if(_0x12786a['response'])throw new Error('Azure\x20OpenAI\x20API\x20error:\x20'+_0x12786a[_0xe834(0xc9)][_0xe834(0xb3)]+'\x20-\x20'+(_0x12786a[_0xe834(0xc9)]['data']?.['error']?.['message']||_0x12786a[_0xe834(0xc9)]['statusText']));else{if(_0x12786a[_0xe834(0xd8)]===_0xe834(0xc7))throw new Error('Azure\x20OpenAI\x20API\x20request\x20timeout');else throw new Error('Azure\x20OpenAI\x20API\x20request\x20failed:\x20'+_0x12786a['message']);}}}[a0_0x588572(0xba)](_0x38d42b){const _0x3519de=a0_0x588572,_0x39b1d7={'openai-gpt4':'gpt-4','openai-gpt3.5':_0x3519de(0xc5),'azure-openai-gpt4':_0x3519de(0xcc),'azure-openai-gpt35':'gpt-35-turbo','gpt-4':_0x3519de(0xcc),'gpt-3.5-turbo':'gpt-35-turbo'};return _0x39b1d7[_0x38d42b]||'gpt-4';}async[a0_0x588572(0xc0)](){const _0x36f3b1=a0_0x588572;try{await this['initialize']();const _0x508044=[{'role':_0x36f3b1(0xce),'content':_0x36f3b1(0xd4)}],_0x565574=await this[_0x36f3b1(0xc8)](_0x508044,'gpt-35-turbo',{'maxTokens':0xa});return{'status':_0x36f3b1(0xbf),'endpoint':this['endpoint'],'model':'gpt-35-turbo','usage':_0x565574['usage']};}catch(_0x31ea89){return{'status':'unhealthy','error':_0x31ea89['message']};}}}export default new AzureOpenAIService();