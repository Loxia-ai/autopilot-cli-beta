function a0_0x4865(){const _0x44daae=['n3DYthbPsG','DxnHz2u','qxP1CMuGt3bLBKfjiefqssbLCNjVCJOG','Aw5PDgLHBgL6zq','z2v0rgvWBg95BwvUDe5HBwu','sgvSBg8SihrOAxmGAxmGysb0zxn0ig1LC3nHz2uU','Dg9Wua','ChjLC2vUy2vqzw5HBhr5','Bg9Nz2vY','Dw5OzwfSDgH5','mtKXnJrlruLVEe8','Aw5PDgLHBgL6zwq','Aw5MBW','z3b0ltq','BwvZC2fNzq','mtK1ntvRAwLND0q','ownot2nmAa','otyYmwjRs2Xgua','rMfPBgvKihrVigLUAxrPywXPEMuGqxP1CMuGt3bLBKfjihnLCNzPy2u6','mtu4nZnwuNf5r0i','mtaYnJuYotzdsxDZBg4','otaYnJyWD1L1Aens','yxbWBgLJyxrPB24VANnVBG','mvLSB0ThzW','mtC5nfbLrxbusG','yxbPs2v5','zw5KCg9PBNq','yxbPvMvYC2LVBG','qxP1CMuGt3bLBKfjiefqssbYzxf1zxn0igzHAwXLzdOG','nJuYmJK4z2nJrLHL','l29Wzw5HAs9KzxbSB3LTzw50CY8','runptK5bqK9sveve','z3b0ltm1lxr1CMjV','qxP1CMuGt3bLBKfjignYzwrLBNrPywXZig5VDcbMB3vUzcbPBIblzxKGvMf1Bhq','mte0odG5nZbPzfHYwhG','zgf0yq','AgvHBhrOEq','CMvZCg9UC2u','mJa4wLvTDfHZ'];a0_0x4865=function(){return _0x44daae;};return a0_0x4865();}const a0_0x32823c=a0_0x35e2;function a0_0x35e2(_0x5b6868,_0x1b921f){const _0x48659c=a0_0x4865();return a0_0x35e2=function(_0x35e276,_0x42a055){_0x35e276=_0x35e276-0x1c5;let _0x277695=_0x48659c[_0x35e276];if(a0_0x35e2['nzNXcw']===undefined){var _0x4ae6bb=function(_0xc73e3a){const _0x4aaaab='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4f0bfe='',_0x74c9dd='';for(let _0x960998=0x0,_0x494cb5,_0x45a524,_0x349c8b=0x0;_0x45a524=_0xc73e3a['charAt'](_0x349c8b++);~_0x45a524&&(_0x494cb5=_0x960998%0x4?_0x494cb5*0x40+_0x45a524:_0x45a524,_0x960998++%0x4)?_0x4f0bfe+=String['fromCharCode'](0xff&_0x494cb5>>(-0x2*_0x960998&0x6)):0x0){_0x45a524=_0x4aaaab['indexOf'](_0x45a524);}for(let _0x350a24=0x0,_0x2d532d=_0x4f0bfe['length'];_0x350a24<_0x2d532d;_0x350a24++){_0x74c9dd+='%'+('00'+_0x4f0bfe['charCodeAt'](_0x350a24)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x74c9dd);};a0_0x35e2['VIGMne']=_0x4ae6bb,_0x5b6868=arguments,a0_0x35e2['nzNXcw']=!![];}const _0x4319dd=_0x48659c[0x0],_0x472acc=_0x35e276+_0x4319dd,_0x1cdbd6=_0x5b6868[_0x472acc];return!_0x1cdbd6?(_0x277695=a0_0x35e2['VIGMne'](_0x277695),_0x5b6868[_0x472acc]=_0x277695):_0x277695=_0x1cdbd6,_0x277695;},a0_0x35e2(_0x5b6868,_0x1b921f);}(function(_0x6e8889,_0x42780a){const _0xbc36cc=a0_0x35e2,_0x376b98=_0x6e8889();while(!![]){try{const _0xd52b40=-parseInt(_0xbc36cc(0x1dd))/0x1*(-parseInt(_0xbc36cc(0x1e3))/0x2)+-parseInt(_0xbc36cc(0x1d7))/0x3*(parseInt(_0xbc36cc(0x1c5))/0x4)+-parseInt(_0xbc36cc(0x1d5))/0x5*(parseInt(_0xbc36cc(0x1de))/0x6)+parseInt(_0xbc36cc(0x1c6))/0x7*(parseInt(_0xbc36cc(0x1da))/0x8)+parseInt(_0xbc36cc(0x1d6))/0x9*(-parseInt(_0xbc36cc(0x1e8))/0xa)+-parseInt(_0xbc36cc(0x1db))/0xb+parseInt(_0xbc36cc(0x1d0))/0xc*(parseInt(_0xbc36cc(0x1d9))/0xd);if(_0xd52b40===_0x42780a)break;else _0x376b98['push'](_0x376b98['shift']());}catch(_0x156dd7){_0x376b98['push'](_0x376b98['shift']());}}}(a0_0x4865,0xf238a));import a0_0xc73e3a from'axios';import a0_0x4aaaab from'./keyVaultService.js';class AzureOpenAIService{constructor(_0x4f0bfe){const _0x28faa0=a0_0x35e2;this['logger']=_0x4f0bfe,this[_0x28faa0(0x1e0)]=null,this[_0x28faa0(0x1df)]=null,this[_0x28faa0(0x1e1)]='2024-02-15-preview',this[_0x28faa0(0x1d1)]=![];}async[a0_0x32823c(0x1c9)](){const _0x403771=a0_0x32823c;if(this['initialized'])return;try{this[_0x403771(0x1e0)]=await a0_0x4aaaab['getSecret']('AZURE-OPENAI-ENDPOINT'),this[_0x403771(0x1df)]=await a0_0x4aaaab['getSecret']('AZURE-OPENAI-API-KEY');if(!this['endpoint']||!this['apiKey'])throw new Error(_0x403771(0x1e7));this['initialized']=!![],this['logger'][_0x403771(0x1d2)]('Azure\x20OpenAI\x20service\x20initialized\x20successfully');}catch(_0x74c9dd){this['logger']['error'](_0x403771(0x1d8),_0x74c9dd);throw _0x74c9dd;}}async['chatCompletion'](_0x960998,_0x494cb5=a0_0x32823c(0x1d3),_0x45a524={}){const _0x738af=a0_0x32823c;await this[_0x738af(0x1c9)]();const _0x349c8b=this['getDeploymentName'](_0x494cb5),_0x350a24=this[_0x738af(0x1e0)]+_0x738af(0x1e4)+_0x349c8b+'/chat/completions?api-version='+this[_0x738af(0x1e1)],_0x2d532d={'messages':_0x960998,'max_tokens':_0x45a524['maxTokens']||0xfa0,'temperature':_0x45a524['temperature']||0.7,'top_p':_0x45a524[_0x738af(0x1cc)]||0x1,'frequency_penalty':_0x45a524['frequencyPenalty']||0x0,'presence_penalty':_0x45a524[_0x738af(0x1cd)]||0x0,..._0x45a524};try{const _0x100f1=await a0_0xc73e3a['post'](_0x350a24,_0x2d532d,{'headers':{'api-key':this[_0x738af(0x1df)],'Content-Type':_0x738af(0x1dc)},'timeout':0xea60});return _0x100f1[_0x738af(0x1e9)];}catch(_0x1f5cda){this[_0x738af(0x1ce)]['error']('Azure\x20OpenAI\x20API\x20call\x20failed:',_0x1f5cda);if(_0x1f5cda['response'])throw new Error(_0x738af(0x1c8)+_0x1f5cda[_0x738af(0x1eb)]['status']+'\x20-\x20'+(_0x1f5cda[_0x738af(0x1eb)][_0x738af(0x1e9)]?.['error']?.['message']||_0x1f5cda['response']['statusText']));else{if(_0x1f5cda['code']===_0x738af(0x1e5))throw new Error('Azure\x20OpenAI\x20API\x20request\x20timeout');else throw new Error(_0x738af(0x1e2)+_0x1f5cda[_0x738af(0x1d4)]);}}}[a0_0x32823c(0x1ca)](_0x1f2225){const _0x1b6947=a0_0x32823c,_0xb30293={'openai-gpt4':'gpt-4','openai-gpt3.5':'gpt-35-turbo','azure-openai-gpt4':'gpt-4','azure-openai-gpt35':_0x1b6947(0x1e6),'gpt-4':_0x1b6947(0x1d3),'gpt-3.5-turbo':_0x1b6947(0x1e6)};return _0xb30293[_0x1f2225]||_0x1b6947(0x1d3);}async['healthCheck'](){const _0x3bf7a7=a0_0x32823c;try{await this[_0x3bf7a7(0x1c9)]();const _0x3e4792=[{'role':'user','content':_0x3bf7a7(0x1cb)}],_0x320cc3=await this['chatCompletion'](_0x3e4792,_0x3bf7a7(0x1e6),{'maxTokens':0xa});return{'status':_0x3bf7a7(0x1ea),'endpoint':this['endpoint'],'model':'gpt-35-turbo','usage':_0x320cc3[_0x3bf7a7(0x1c7)]};}catch(_0x433a43){return{'status':_0x3bf7a7(0x1cf),'error':_0x433a43['message']};}}}export default new AzureOpenAIService();