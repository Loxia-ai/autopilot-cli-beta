const a0_0x594260=a0_0x47fb;(function(_0x468e9b,_0xaec6a4){const _0x3d5d78=a0_0x47fb,_0x1a7d0a=_0x468e9b();while(!![]){try{const _0xa583f3=parseInt(_0x3d5d78(0xc4))/0x1+parseInt(_0x3d5d78(0xb7))/0x2*(-parseInt(_0x3d5d78(0xb5))/0x3)+parseInt(_0x3d5d78(0xc7))/0x4+-parseInt(_0x3d5d78(0xc6))/0x5+-parseInt(_0x3d5d78(0xb0))/0x6+-parseInt(_0x3d5d78(0xa9))/0x7+-parseInt(_0x3d5d78(0xaf))/0x8*(-parseInt(_0x3d5d78(0xa2))/0x9);if(_0xa583f3===_0xaec6a4)break;else _0x1a7d0a['push'](_0x1a7d0a['shift']());}catch(_0x1d3d14){_0x1a7d0a['push'](_0x1a7d0a['shift']());}}}(a0_0x1e26,0x72000));import a0_0x5baa10 from'axios';import a0_0x4f8b7c from'./keyVaultService.js';function a0_0x1e26(){const _0x1edb52=['yxbPvMvYC2LVBG','mZKYmdyWnxDpEun5va','mZe5mZe1mNHqqMDgAa','mZa2vNbXzeT3','Cg9ZDa','zgf0yq','sgvSBg8SihrOAxmGAxmGysb0zxn0ig1LC3nHz2uU','qxP1CMuGt3bLBKfjiefqssbYzxf1zxn0igzHAwXLzdOG','CMvZCg9UC2u','y29Kzq','mtyXotaWmNb6DMHrBa','Aw5PDgLHBgL6zq','Dw5OzwfSDgH5','Bwf4vg9Rzw5Z','zw5KCg9PBNq','AgvHBhrOq2HLy2S','mJuZmZG0B1f0t1n6','ndu2mdy0mLfkwezKzG','Bg9Nz2vY','ChjLC2vUy2vqzw5HBhr5','zxjYB3i','DxnHz2u','mJm0otbstLL1v1O','Dg9Wua','mZHjwerhA2q','BwvZC2fNzq','zNjLCxvLBMn5ugvUywX0Eq','Aw5PDgLHBgL6zwq','C3rHDhvZ','qxP1CMuGt3bLBKfjiefqssbLCNjVCJOG','yxbWBgLJyxrPB24VANnVBG','qxP1CMuGt3bLBKfjiefqssbYzxf1zxn0ihrPBwvVDxq','C3rHDhvZvgv4Da','yxbPs2v5','z3b0ltm1lxr1CMjV','AgvHBhrOEq','z3b0ltq','nte2mdu4DgHnrhHK'];a0_0x1e26=function(){return _0x1edb52;};return a0_0x1e26();}function a0_0x47fb(_0x497a4d,_0x285f4a){const _0x1e2669=a0_0x1e26();return a0_0x47fb=function(_0x47fb3c,_0x336d7a){_0x47fb3c=_0x47fb3c-0xa2;let _0x203d52=_0x1e2669[_0x47fb3c];if(a0_0x47fb['larmXM']===undefined){var _0x16566f=function(_0x5baa10){const _0x4f8b7c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x904e88='',_0x3daace='';for(let _0x4bda4a=0x0,_0x20fc5e,_0x962861,_0x50f679=0x0;_0x962861=_0x5baa10['charAt'](_0x50f679++);~_0x962861&&(_0x20fc5e=_0x4bda4a%0x4?_0x20fc5e*0x40+_0x962861:_0x962861,_0x4bda4a++%0x4)?_0x904e88+=String['fromCharCode'](0xff&_0x20fc5e>>(-0x2*_0x4bda4a&0x6)):0x0){_0x962861=_0x4f8b7c['indexOf'](_0x962861);}for(let _0x3e72ac=0x0,_0x529fcb=_0x904e88['length'];_0x3e72ac<_0x529fcb;_0x3e72ac++){_0x3daace+='%'+('00'+_0x904e88['charCodeAt'](_0x3e72ac)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3daace);};a0_0x47fb['BIFKDr']=_0x16566f,_0x497a4d=arguments,a0_0x47fb['larmXM']=!![];}const _0x382882=_0x1e2669[0x0],_0x5ed2ea=_0x47fb3c+_0x382882,_0x5d16d3=_0x497a4d[_0x5ed2ea];return!_0x5d16d3?(_0x203d52=a0_0x47fb['BIFKDr'](_0x203d52),_0x497a4d[_0x5ed2ea]=_0x203d52):_0x203d52=_0x5d16d3,_0x203d52;},a0_0x47fb(_0x497a4d,_0x285f4a);}class AzureOpenAIService{constructor(_0x904e88){const _0x13071c=a0_0x47fb;this[_0x13071c(0xb1)]=_0x904e88,this[_0x13071c(0xad)]=null,this['apiKey']=null,this[_0x13071c(0xc5)]='2024-02-15-preview',this['initialized']=![];}async[a0_0x594260(0xaa)](){const _0x183aa2=a0_0x594260;if(this[_0x183aa2(0xba)])return;try{this['endpoint']=await a0_0x4f8b7c['getSecret']('AZURE-OPENAI-ENDPOINT'),this[_0x183aa2(0xc0)]=await a0_0x4f8b7c['getSecret']('AZURE-OPENAI-API-KEY');if(!this[_0x183aa2(0xad)]||!this[_0x183aa2(0xc0)])throw new Error('Azure\x20OpenAI\x20credentials\x20not\x20found\x20in\x20Key\x20Vault');this['initialized']=!![],this[_0x183aa2(0xb1)]['info']('Azure\x20OpenAI\x20service\x20initialized\x20successfully');}catch(_0x3daace){this['logger']['error']('Failed\x20to\x20initialize\x20Azure\x20OpenAI\x20service:',_0x3daace);throw _0x3daace;}}async['chatCompletion'](_0x4bda4a,_0x20fc5e='gpt-4',_0x962861={}){const _0xe90253=a0_0x594260;await this[_0xe90253(0xaa)]();const _0x50f679=this['getDeploymentName'](_0x20fc5e),_0x3e72ac=this[_0xe90253(0xad)]+'/openai/deployments/'+_0x50f679+'/chat/completions?api-version='+this['apiVersion'],_0x529fcb={'messages':_0x4bda4a,'max_tokens':_0x962861[_0xe90253(0xac)]||0xfa0,'temperature':_0x962861['temperature']||0.7,'top_p':_0x962861[_0xe90253(0xb6)]||0x1,'frequency_penalty':_0x962861[_0xe90253(0xb9)]||0x0,'presence_penalty':_0x962861[_0xe90253(0xb2)]||0x0,..._0x962861};try{const _0x468f65=await a0_0x5baa10[_0xe90253(0xa3)](_0x3e72ac,_0x529fcb,{'headers':{'api-key':this['apiKey'],'Content-Type':_0xe90253(0xbd)},'timeout':0xea60});return _0x468f65[_0xe90253(0xa4)];}catch(_0x90fd36){this['logger']['error']('Azure\x20OpenAI\x20API\x20call\x20failed:',_0x90fd36);if(_0x90fd36['response'])throw new Error(_0xe90253(0xbc)+_0x90fd36[_0xe90253(0xa7)][_0xe90253(0xbb)]+'\x20-\x20'+(_0x90fd36[_0xe90253(0xa7)][_0xe90253(0xa4)]?.[_0xe90253(0xb3)]?.[_0xe90253(0xb8)]||_0x90fd36['response'][_0xe90253(0xbf)]));else{if(_0x90fd36[_0xe90253(0xa8)]==='ECONNABORTED')throw new Error(_0xe90253(0xbe));else throw new Error(_0xe90253(0xa6)+_0x90fd36['message']);}}}['getDeploymentName'](_0x182564){const _0x4fdf96=a0_0x594260,_0xadb1b7={'openai-gpt4':'gpt-4','openai-gpt3.5':'gpt-35-turbo','azure-openai-gpt4':'gpt-4','azure-openai-gpt35':'gpt-35-turbo','gpt-4':_0x4fdf96(0xc3),'gpt-3.5-turbo':_0x4fdf96(0xc1)};return _0xadb1b7[_0x182564]||'gpt-4';}async[a0_0x594260(0xae)](){const _0x9b4468=a0_0x594260;try{await this[_0x9b4468(0xaa)]();const _0x178304=[{'role':'user','content':_0x9b4468(0xa5)}],_0x56990d=await this['chatCompletion'](_0x178304,'gpt-35-turbo',{'maxTokens':0xa});return{'status':_0x9b4468(0xc2),'endpoint':this['endpoint'],'model':_0x9b4468(0xc1),'usage':_0x56990d[_0x9b4468(0xb4)]};}catch(_0x3e475e){return{'status':_0x9b4468(0xab),'error':_0x3e475e['message']};}}}export default new AzureOpenAIService();