const a0_0x3a8967=a0_0x3d6b;(function(_0x1139c3,_0x3747de){const _0x2789eb=a0_0x3d6b,_0x5796fe=_0x1139c3();while(!![]){try{const _0x5619ff=-parseInt(_0x2789eb(0x97))/0x1+-parseInt(_0x2789eb(0x9a))/0x2+-parseInt(_0x2789eb(0x98))/0x3*(parseInt(_0x2789eb(0x87))/0x4)+parseInt(_0x2789eb(0x86))/0x5+parseInt(_0x2789eb(0x8e))/0x6+parseInt(_0x2789eb(0x96))/0x7*(-parseInt(_0x2789eb(0x90))/0x8)+parseInt(_0x2789eb(0xa6))/0x9;if(_0x5619ff===_0x3747de)break;else _0x5796fe['push'](_0x5796fe['shift']());}catch(_0x31786c){_0x5796fe['push'](_0x5796fe['shift']());}}}(a0_0x46d2,0x79e7c));import a0_0x10bc9c from'axios';import a0_0x3ed472 from'./keyVaultService.js';class AzureOpenAIService{constructor(_0x1ef73e){const _0x43e495=a0_0x3d6b;this[_0x43e495(0x8a)]=_0x1ef73e,this['endpoint']=null,this[_0x43e495(0x9f)]=null,this['apiVersion']=_0x43e495(0x9e),this[_0x43e495(0x88)]=![];}async[a0_0x3a8967(0x9b)](){const _0x3726e8=a0_0x3a8967;if(this['initialized'])return;try{this['endpoint']=await a0_0x3ed472[_0x3726e8(0x8c)]('AZURE-OPENAI-ENDPOINT'),this['apiKey']=await a0_0x3ed472[_0x3726e8(0x8c)]('AZURE-OPENAI-API-KEY');if(!this[_0x3726e8(0x91)]||!this['apiKey'])throw new Error(_0x3726e8(0x92));this[_0x3726e8(0x88)]=!![],this[_0x3726e8(0x8a)]['info']('Azure\x20OpenAI\x20service\x20initialized\x20successfully');}catch(_0x558312){this[_0x3726e8(0x8a)]['error']('Failed\x20to\x20initialize\x20Azure\x20OpenAI\x20service:',_0x558312);throw _0x558312;}}async['chatCompletion'](_0x5a749f,_0x32d8a9='gpt-4',_0x1b1232={}){const _0x171d4e=a0_0x3a8967;await this[_0x171d4e(0x9b)]();const _0x22f710=this['getDeploymentName'](_0x32d8a9),_0x58abfd=this['endpoint']+'/openai/deployments/'+_0x22f710+_0x171d4e(0x8b)+this[_0x171d4e(0xa9)],_0x408c19={'messages':_0x5a749f,'max_tokens':_0x1b1232['maxTokens']||0xfa0,'temperature':_0x1b1232[_0x171d4e(0x8d)]||0.7,'top_p':_0x1b1232['topP']||0x1,'frequency_penalty':_0x1b1232[_0x171d4e(0xa1)]||0x0,'presence_penalty':_0x1b1232['presencePenalty']||0x0,..._0x1b1232};try{const _0x3736f1=await a0_0x10bc9c[_0x171d4e(0x8f)](_0x58abfd,_0x408c19,{'headers':{'api-key':this['apiKey'],'Content-Type':_0x171d4e(0x94)},'timeout':0xea60});return _0x3736f1['data'];}catch(_0x24b7d5){this['logger']['error']('Azure\x20OpenAI\x20API\x20call\x20failed:',_0x24b7d5);if(_0x24b7d5[_0x171d4e(0xa2)])throw new Error(_0x171d4e(0x99)+_0x24b7d5['response']['status']+_0x171d4e(0x93)+(_0x24b7d5['response']['data']?.[_0x171d4e(0x84)]?.['message']||_0x24b7d5[_0x171d4e(0xa2)][_0x171d4e(0xa7)]));else{if(_0x24b7d5[_0x171d4e(0x83)]===_0x171d4e(0xa5))throw new Error(_0x171d4e(0x89));else throw new Error(_0x171d4e(0x85)+_0x24b7d5[_0x171d4e(0x95)]);}}}['getDeploymentName'](_0x4ed301){const _0xc840ce=a0_0x3a8967,_0x41649a={'openai-gpt4':'gpt-4','openai-gpt3.5':_0xc840ce(0xa4),'azure-openai-gpt4':_0xc840ce(0xa3),'azure-openai-gpt35':_0xc840ce(0xa4),'gpt-4':'gpt-4','gpt-3.5-turbo':_0xc840ce(0xa4)};return _0x41649a[_0x4ed301]||'gpt-4';}async['healthCheck'](){const _0x35fe4c=a0_0x3a8967;try{await this[_0x35fe4c(0x9b)]();const _0x264413=[{'role':_0x35fe4c(0xa0),'content':_0x35fe4c(0x9d)}],_0x253cb8=await this[_0x35fe4c(0x9c)](_0x264413,_0x35fe4c(0xa4),{'maxTokens':0xa});return{'status':'healthy','endpoint':this['endpoint'],'model':_0x35fe4c(0xa4),'usage':_0x253cb8['usage']};}catch(_0x3e5923){return{'status':_0x35fe4c(0xa8),'error':_0x3e5923[_0x35fe4c(0x95)]};}}}function a0_0x3d6b(_0x49b26e,_0x564ace){const _0x46d267=a0_0x46d2();return a0_0x3d6b=function(_0x3d6b49,_0x1cfb31){_0x3d6b49=_0x3d6b49-0x83;let _0x5995fb=_0x46d267[_0x3d6b49];if(a0_0x3d6b['GBBjvA']===undefined){var _0x25469d=function(_0x10bc9c){const _0x3ed472='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1ef73e='',_0x558312='';for(let _0x5a749f=0x0,_0x32d8a9,_0x1b1232,_0x22f710=0x0;_0x1b1232=_0x10bc9c['charAt'](_0x22f710++);~_0x1b1232&&(_0x32d8a9=_0x5a749f%0x4?_0x32d8a9*0x40+_0x1b1232:_0x1b1232,_0x5a749f++%0x4)?_0x1ef73e+=String['fromCharCode'](0xff&_0x32d8a9>>(-0x2*_0x5a749f&0x6)):0x0){_0x1b1232=_0x3ed472['indexOf'](_0x1b1232);}for(let _0x58abfd=0x0,_0x408c19=_0x1ef73e['length'];_0x58abfd<_0x408c19;_0x58abfd++){_0x558312+='%'+('00'+_0x1ef73e['charCodeAt'](_0x58abfd)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x558312);};a0_0x3d6b['tbAZKu']=_0x25469d,_0x49b26e=arguments,a0_0x3d6b['GBBjvA']=!![];}const _0x3d39d2=_0x46d267[0x0],_0x4826b3=_0x3d6b49+_0x3d39d2,_0x404acd=_0x49b26e[_0x4826b3];return!_0x404acd?(_0x5995fb=a0_0x3d6b['tbAZKu'](_0x5995fb),_0x49b26e[_0x4826b3]=_0x5995fb):_0x5995fb=_0x404acd,_0x5995fb;},a0_0x3d6b(_0x49b26e,_0x564ace);}function a0_0x46d2(){const _0x1f4e22=['Aw5PDgLHBgL6zwq','qxP1CMuGt3bLBKfjiefqssbYzxf1zxn0ihrPBwvVDxq','Bg9Nz2vY','l2nOyxqVy29TCgXLDgLVBNm/yxbPlxzLCNnPB249','z2v0u2vJCMv0','DgvTCgvYyxr1CMu','mJq4ndK1nevAsMLAra','Cg9ZDa','mJmWnJeYmgXsuuzNvW','zw5KCg9PBNq','qxP1CMuGt3bLBKfjignYzwrLBNrPywXZig5VDcbMB3vUzcbPBIblzxKGvMf1Bhq','ic0G','yxbWBgLJyxrPB24VANnVBG','BwvZC2fNzq','mtrdvgvMwNO','otK4mZy3rvLhBgTU','m3H6Ew1cra','qxP1CMuGt3bLBKfjiefqssbLCNjVCJOG','mZiWmJe0rNHzEwfd','Aw5PDgLHBgL6zq','y2HHDenVBxbSzxrPB24','sgvSBg8SihrOAxmGAxmGysb0zxn0ig1LC3nHz2uU','mJaYnc0WmI0Xns1WCMv2Awv3','yxbPs2v5','DxnLCG','zNjLCxvLBMn5ugvUywX0Eq','CMvZCg9UC2u','z3b0ltq','z3b0ltm1lxr1CMjV','runptK5bqK9sveve','mtu1mdy1ntb1BM1hvha','C3rHDhvZvgv4Da','Dw5OzwfSDgH5','yxbPvMvYC2LVBG','y29Kzq','zxjYB3i','qxP1CMuGt3bLBKfjiefqssbYzxf1zxn0igzHAwXLzdOG','ntqXmZa1CuDpB0HM','ndqXnJHXBfDVBw4'];a0_0x46d2=function(){return _0x1f4e22;};return a0_0x46d2();}export default new AzureOpenAIService();