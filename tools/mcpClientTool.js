const a0_0x446d47=a0_0x23db;(function(_0x508e2c,_0x2725a2){const _0x214bfc=a0_0x23db,_0x35e69d=_0x508e2c();while(!![]){try{const _0x26599e=-parseInt(_0x214bfc(0xe3))/0x1+parseInt(_0x214bfc(0xa9))/0x2+-parseInt(_0x214bfc(0xd7))/0x3*(-parseInt(_0x214bfc(0xae))/0x4)+-parseInt(_0x214bfc(0x9c))/0x5*(-parseInt(_0x214bfc(0xb9))/0x6)+parseInt(_0x214bfc(0x98))/0x7+-parseInt(_0x214bfc(0xa8))/0x8+-parseInt(_0x214bfc(0xc5))/0x9;if(_0x26599e===_0x2725a2)break;else _0x35e69d['push'](_0x35e69d['shift']());}catch(_0xb9e4f9){_0x35e69d['push'](_0x35e69d['shift']());}}}(a0_0x909e,0xe8003));import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';import{BaseTool}from'./baseTool.js';import{TagParser}from'../utilities/tagParser.js';function a0_0x23db(_0x468cee,_0xd07a0e){const _0x909e9d=a0_0x909e();return a0_0x23db=function(_0x23db41,_0x3152a7){_0x23db41=_0x23db41-0x96;let _0x3dc493=_0x909e9d[_0x23db41];if(a0_0x23db['byXgno']===undefined){var _0x28efa6=function(_0x36fc18){const _0x2a4a6a='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x416c6c='',_0x28cd14='';for(let _0x1a789f=0x0,_0x3d6ab7,_0x7d1fd9,_0x407c0e=0x0;_0x7d1fd9=_0x36fc18['charAt'](_0x407c0e++);~_0x7d1fd9&&(_0x3d6ab7=_0x1a789f%0x4?_0x3d6ab7*0x40+_0x7d1fd9:_0x7d1fd9,_0x1a789f++%0x4)?_0x416c6c+=String['fromCharCode'](0xff&_0x3d6ab7>>(-0x2*_0x1a789f&0x6)):0x0){_0x7d1fd9=_0x2a4a6a['indexOf'](_0x7d1fd9);}for(let _0x455c88=0x0,_0x337adf=_0x416c6c['length'];_0x455c88<_0x337adf;_0x455c88++){_0x28cd14+='%'+('00'+_0x416c6c['charCodeAt'](_0x455c88)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x28cd14);};a0_0x23db['LrjQyX']=_0x28efa6,_0x468cee=arguments,a0_0x23db['byXgno']=!![];}const _0x565497=_0x909e9d[0x0],_0x1038db=_0x23db41+_0x565497,_0x11bac5=_0x468cee[_0x1038db];return!_0x11bac5?(_0x3dc493=a0_0x23db['LrjQyX'](_0x3dc493),_0x468cee[_0x1038db]=_0x3dc493):_0x3dc493=_0x11bac5,_0x3dc493;},a0_0x23db(_0x468cee,_0xd07a0e);}import a0_0x36fc18 from'path';function a0_0x909e(){const _0x1475a1=['u2f2zwqG','vw5RBM93BIbnq1aGy2XPzw50ignVBw1HBMq6ia','mte1mM1wruTUCW','jYbUB3qGzM91BMqGB24GC2vYDMvYicC','BwnWlxnLCNzLCNm','Bg9Nz2vY','C2vYDMvYtMfTzq','C3bSAxq','zgLZy29UBMvJDa','rxjYB3iGzgLZy29UBMvJDgLUzYbMCM9Tie1ducbZzxj2zxiG','rgLZy29UBMvJDgvKigzYB20GtunqihnLCNzLCJOG','ChvZAa','cK1ducbdBgLLBNqGvg9VBdOGqwXSB3DZihLVDsb0BYbPBNrLCMfJDcb3AxrOie1VzgvSienVBNrLEhqGuhjVDg9JB2WGke1ducKGC2vYDMvYCYb0BYbHy2nLC3mGzxH0zxjUywWGDg9VBhmGyw5KihjLC291CMnLCY4kcLvZywDLoGPBDg9VBcbPzd0IBwnWlwnSAwvUDcjDcLTNzxqTyxzHAwXHyMXLlxnLCNzLCNmGl10kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kcLTHzgqTC2vYDMvYC10kw3mGBMfTzt0IC2vYDMvYlw5HBwuIihvYBd0IAhr0CdOVl3nLCNzLCI11CMWIic9DcLSVywrKlxnLCNzLCNnDcGPBCMvTB3zLlxnLCNzLCL0kC2vYDMvYlw5HBwukwY9Yzw1VDMuTC2vYDMvYxqOkw2DLDc10B29SlxnJAgvTyv0kC2vYDMvYlw5HBwuVDg9VBc1Uyw1LcLSVz2v0lxrVB2WTC2nOzw1HxqOkw21LC3nHz2uTDg8TBwnWxqP7cIaGiNrVB2XFy2fSBci6ihSkicaGicjUyw1LiJOGiNnLCNzLCI1Uyw1Ll3rVB2WTBMfTzsiScIaGicaIyxjNDw1LBNrZiJOGEYaICgfYyw0XiJOGiNzHBhvLmsiSicjWyxjHBtiIoIaIDMfSDwuYiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kcKv4yw1WBgvZoGOXlIbmAxn0igf2ywLSywjSzsbnq1aGC2vYDMvYCZOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lwf2ywLSywjSzs1Zzxj2zxjZic9DcLSVDg9VBf0kcJiUieXPC3qGyxzHAwXHyMXLihrVB2XZigzYB20GywXSihnLCNzLCNm6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kwY90B29SxqOkmY4GqwrKigeGBMv3ie1ducbZzxj2zxi6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2fKzc1Zzxj2zxjZxqPBCYbUyw1LpsjZExn0zw0TDg9VBhmIihvYBd0IAhr0CdOVl2XVy2fSAg9ZDdOZmdaXiIaVxqPBl2fKzc1Zzxj2zxjZxqPBl3rVB2XDcGO0lIbszw1VDMuGyw4GtunqihnLCNzLCJOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBCMvTB3zLlxnLCNzLCL0kC3LZDgvTlxrVB2XZcLSVCMvTB3zLlxnLCNzLCL0kwY90B29SxqOkns4Gr2v0ihrOzsbZy2HLBweGzM9YigeGC3bLy2LMAwmGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lxrVB2WTC2nOzw1HxqPZExn0zw0TDg9VBhmVCNvUq29TBwfUzaPBl2DLDc10B29SlxnJAgvTyv0kwY90B29SxqOknI4Gq2fSBcbHBIbnq1aGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBBwvZC2fNzs10BY1Ty3bDcNSkicaIDg9VBf9JywXSiJOGEWOGicaGiM5HBwuIoIaIC3LZDgvTlxrVB2XZl3j1BKnVBw1HBMqIlaOGicaGiMfYz3vTzw50CYi6ihSGiMnVBw1HBMqIoIaIBhmGlwXHiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kicaGia','ntGXmJj1r3jxzNC','lMXVEgLHlxn0yxrL','zgvSzxrL','CMvHzezPBgu','rMfPBgvKihrVignYzwf0zsbJBgLLBNq','C2XPy2u','rxjYB3iGCgfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNm6','DhLWzq','BwvZC2fNzs10BY1Ty3a','ms4WlJa','C2vYDMvYCY5QC29U','DxjS','mZG5mJm3ne9HruPhEa','ywn0Aw9U','vg9VBcbJywXSig11C3qGAgf2zsbUyw1LigfUzcbHCMD1BwvUDhm','zw50CMLLCW','ywrKu2vYDMvYCW','qwrKAw5Nia','u2vUzgLUzYbTzxnZywDLihrVie1ducbZzxj2zxi','BgvUz3rO','z2v0qxzHAwXHyMXLu2vYDMvYCW','r2v0DgLUzYbZy2HLBweGzM9YihrVB2W6ia','Bg94AweTBwnWlwnSAwvUDa','rMfPBgvKihrVigLUAxrPywXPEMuGtunqihnLCNzLCIbKAxjLy3rVCNK6','DxrMltG','C2v0','BMfTzq','CxvLCNK','C2f2zvnLCNzLCNm','AM9PBG','otq5ofHYEuPSsG','y29TBwfUzhm','C3rKAw8','jYbKB2vZig5VDcbLEgLZDa','D2fYBG','sw52ywXPzcbnq1aGBwvZC2fNzsbMB3jTyxqUiev4CgvJDgvKihSGDg9VBf9JywXSoIb7ig5HBwuSigfYz3vTzw50CYb9ih0','Ahr0Ca','CgfYC2u','AgfZ','Dg9VBeLK','yxr0CMLIDxrLCW','ugfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNmGD2L0AcbuywDqyxjZzxi','mtC4mZuYn1nND0DZvq','CMvTB3zLlxnLCNzLCG','Ahr0CdOVlW','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','tM8GtunqignSAwvUDcbJB21Tyw5KCYbZCgvJAwzPzwq','DhjPBq','u2H1DhrPBMCGzg93BIbnq1aGy2XPzw50ihrVB2W','z2v0lwf2ywLSywjSzs1Zzxj2zxjZ','Dg9VBfnJAgvTyxm','lIbfEhbLy3rLzcbMB3jTyxq6ihnLCNzLCK5HBwuVDg9VBe5HBwu','rMfPBgvKihrVigXVywqGC2f2zwqGtunqihnLCNzLCNm6','z2v0','ru5pru5u','z2v0t3jdCMvHDgvdBgLLBNq','zxjYB3i','y2f0y2G','y29Kzq','u2vYDMvYicC','mJCYndKWneHnDgnusa','zMLUza','BwvZC2fNzq','Aw5MBW','nZi1Dhb3Axjh','C2vYDMvYCW','C3rHCNrZv2L0Aa','z2v0vg9VBfnJAgvTyq','ywrKlxnLCNzLCNm','z2v0lxrVB2WTC2nOzw1H','y2XPzw50CW','C2vYDMvYrgLYzwn0B3j5','z2v0lwf2ywLSywjSzs10B29SCW','Dg9VBf9JywXS','tg9HzgvKia','BgLZDfrVB2XZ','mta5mJiYndbPzvf4ruy','mZy1mtC0nMHRD2rfqG','z2v0rgvZy3jPChrPB24','y29UDgvUDa'];a0_0x909e=function(){return _0x1475a1;};return a0_0x909e();}import a0_0x2a4a6a from'fs/promises';export class MCPClientTool extends BaseTool{constructor(_0x416c6c,_0x28cd14){const _0x27574b=a0_0x23db;super(_0x416c6c,_0x28cd14),this[_0x27574b(0x9d)]=new Map(),this['clients']=new Map(),this['toolSchemas']=new Map(),this[_0x27574b(0xa3)]=a0_0x36fc18[_0x27574b(0xd6)](process['cwd'](),_0x27574b(0xba),_0x27574b(0xb0)),this['initializeServerDirectory']()[_0x27574b(0xf3)](_0x1a789f=>{const _0x486202=_0x27574b;this['logger']['error'](_0x486202(0xd0),_0x1a789f);});}async['initializeServerDirectory'](){const _0xadb18=a0_0x23db;try{await a0_0x2a4a6a['mkdir'](this['serverDirectory'],{'recursive':!![]});try{const _0x3d6ab7=a0_0x36fc18['join'](this[_0xadb18(0xa3)],_0xadb18(0xc3)),_0x7d1fd9=await a0_0x2a4a6a[_0xadb18(0xbc)](_0x3d6ab7,_0xadb18(0xd1)),_0x407c0e=JSON[_0xadb18(0xde)](_0x7d1fd9);for(const [_0x455c88,_0x337adf]of Object['entries'](_0x407c0e)){this['servers'][_0xadb18(0xd2)](_0x455c88,_0x337adf);}this['logger']['info'](_0xadb18(0xa6)+this['servers']['size']+'\x20saved\x20MCP\x20servers');}catch(_0x10f447){_0x10f447[_0xadb18(0x96)]!==_0xadb18(0xf0)&&this['logger']['warn'](_0xadb18(0xee),_0x10f447);}}catch(_0x203de0){this['logger']['error']('Failed\x20to\x20create\x20MCP\x20server\x20directory:',_0x203de0);}}[a0_0x446d47(0xaa)](){const _0x45c77f=a0_0x446d47;return _0x45c77f(0xb8);}['parseParameters'](_0x5ed1f0){const _0x41ff76=a0_0x446d47;this['logger']['info'](_0x41ff76(0xe2));const _0x3f20c8={'commands':[]};try{const _0x2aff69=TagParser['query'](_0x5ed1f0,_0x41ff76(0xeb));_0x2aff69['length']>0x0&&_0x3f20c8[_0x41ff76(0xd8)][_0x41ff76(0xb7)]({'action':'get-available-servers'});const _0x362d1=TagParser['query'](_0x5ed1f0,'get-available-tools');_0x362d1['length']>0x0&&_0x3f20c8['commands']['push']({'action':'get-available-tools'});const _0xc08cc3=TagParser['query'](_0x5ed1f0,_0x41ff76(0xa0));for(const _0x2ca138 of _0xc08cc3){const _0x2e53b4=TagParser[_0x41ff76(0xd4)](_0x2ca138[_0x41ff76(0xab)],'s'),_0x2f9686=[];for(const _0x480800 of _0x2e53b4){const _0x5f8747=_0x480800['attributes']['name'],_0x2f7a78=_0x480800[_0x41ff76(0xe1)]['url'];_0x5f8747&&_0x2f7a78&&_0x2f9686['push']({'name':_0x5f8747,'url':_0x2f7a78});}_0x2f9686[_0x41ff76(0xcc)]>0x0&&_0x3f20c8['commands']['push']({'action':_0x41ff76(0xa0),'servers':_0x2f9686});}const _0x377093=TagParser['query'](_0x5ed1f0,_0x41ff76(0xe4));for(const _0x5382d4 of _0x377093){const _0x222d62=_0x5382d4[_0x41ff76(0xab)][_0x41ff76(0xe9)]();_0x222d62&&_0x3f20c8[_0x41ff76(0xd8)][_0x41ff76(0xb7)]({'action':'remove-server','serverName':_0x222d62});}const _0x2e97af=TagParser['query'](_0x5ed1f0,'get-tool-schema');for(const _0x1a9be2 of _0x2e97af){const _0x1ead69=_0x1a9be2['content']['trim']();_0x1ead69&&_0x3f20c8['commands']['push']({'action':_0x41ff76(0xa1),'toolId':_0x1ead69});}const _0x1c6f29=TagParser['query'](_0x5ed1f0,_0x41ff76(0xc1));for(const _0x35d86f of _0x1c6f29){const _0x14168b=_0x35d86f[_0x41ff76(0xab)][_0x41ff76(0xe9)]();if(_0x14168b){let _0xf6f903;try{_0xf6f903=JSON[_0x41ff76(0xde)](_0x14168b);}catch(_0x390178){this[_0x41ff76(0xb1)][_0x41ff76(0xf2)]('Failed\x20to\x20parse\x20MCP\x20message\x20JSON:',_0x390178);continue;}_0x3f20c8[_0x41ff76(0xd8)][_0x41ff76(0xb7)]({'action':_0x41ff76(0xc1),'message':_0xf6f903});}}return _0x3f20c8;}catch(_0x5eedf3){return this[_0x41ff76(0xb1)]['error'](_0x41ff76(0xbf),_0x5eedf3),{'commands':[]};}}async[a0_0x446d47(0xe7)](_0x135d98,_0x4047a9){const _0x1d9cfe=a0_0x446d47;this['logger']['info']('Executing\x20MCP\x20client\x20command\x20with\x20parameters:',_0x135d98);const _0x504ad6=[];if(!_0x135d98[_0x1d9cfe(0xd8)]||_0x135d98['commands'][_0x1d9cfe(0xcc)]===0x0)throw new Error(_0x1d9cfe(0xe8));for(const _0x2f51a9 of _0x135d98['commands']){try{let _0x4f459d;switch(_0x2f51a9[_0x1d9cfe(0xc6)]){case _0x1d9cfe(0xeb):_0x4f459d=await this['getAvailableServers']();break;case'get-available-tools':_0x4f459d=await this['getAvailableTools']();break;case _0x1d9cfe(0xa0):_0x4f459d=await this[_0x1d9cfe(0xc9)](_0x2f51a9['servers']);break;case'remove-server':_0x4f459d=await this['removeServer'](_0x2f51a9[_0x1d9cfe(0xb2)]);break;case _0x1d9cfe(0xa1):_0x4f459d=await this[_0x1d9cfe(0x9f)](_0x2f51a9[_0x1d9cfe(0xe0)]);break;case'message-to-mcp':_0x4f459d=await this['sendMessageToMcp'](_0x2f51a9[_0x1d9cfe(0x9a)]);break;default:throw new Error(_0x1d9cfe(0xad)+_0x2f51a9['action']);}_0x504ad6[_0x1d9cfe(0xb7)](_0x4f459d);}catch(_0x4a020d){this[_0x1d9cfe(0xb1)][_0x1d9cfe(0xf2)]('Error\x20executing\x20MCP\x20client\x20command\x20'+_0x2f51a9[_0x1d9cfe(0xc6)]+':',_0x4a020d),_0x504ad6[_0x1d9cfe(0xb7)]({'action':_0x2f51a9['action'],'success':![],'error':_0x4a020d['message']});}}return{'results':_0x504ad6};}async[a0_0x446d47(0xcd)](){const _0x46f02f=a0_0x446d47;this[_0x46f02f(0xb1)]['info']('Getting\x20available\x20MCP\x20servers');const _0x68baf6=[];for(const [_0x24780f,_0x403714]of this['servers']['entries']()){_0x68baf6['push']({'name':_0x24780f,'url':_0x403714['url'],'type':_0x403714['type']||'http'});}return{'action':_0x46f02f(0xeb),'servers':_0x68baf6,'success':!![]};}async['getAvailableTools'](){const _0x468f49=a0_0x446d47;this['logger']['info']('Getting available tools from MCP servers');const _0x705023=[],_0x3c629a=[];for(const [_0x192967,_0x1dc68c]of this[_0x468f49(0x9d)]['entries']()){try{const _0x46d9b5=await this['getOrCreateClient'](_0x192967);if(!_0x46d9b5){_0x3c629a['push']({'name':_0x192967,'error':_0x468f49(0xbd)});continue;}const _0x39a4c4=await _0x46d9b5[_0x468f49(0xa7)]();for(const _0x4882d5 of _0x39a4c4){_0x705023['push']({'name':_0x192967+'/'+_0x4882d5['name'],'description':_0x4882d5['description']||'No\x20description','server':_0x192967}),this[_0x468f49(0xec)][_0x468f49(0xd2)](_0x192967+'/'+_0x4882d5[_0x468f49(0xd3)],_0x4882d5);}}catch(_0x4b774c){this[_0x468f49(0xb1)][_0x468f49(0xf2)]('Failed\x20to\x20get\x20tools\x20from\x20server\x20'+_0x192967+':',_0x4b774c),_0x3c629a['push']({'name':_0x192967,'error':_0x4b774c['message']});}}return{'action':_0x468f49(0xa4),'tools':_0x705023,'failedServers':_0x3c629a,'success':!![]};}async[a0_0x446d47(0xc9)](_0x4a1033){const _0x3fa110=a0_0x446d47;this['logger']['info'](_0x3fa110(0xca)+_0x4a1033['length']+'\x20MCP\x20servers');const _0x42d352=[],_0x1559a6=[];for(const _0x26514a of _0x4a1033){try{if(!_0x26514a[_0x3fa110(0xd3)]||!_0x26514a['url'])throw new Error('Server\x20name\x20and\x20URL\x20are\x20required');let _0x1dbcfa='http';_0x26514a['url'][_0x3fa110(0x9e)](_0x3fa110(0xe5))||_0x26514a[_0x3fa110(0xc4)][_0x3fa110(0x9e)]('https://')?_0x1dbcfa=_0x3fa110(0xdd):_0x1dbcfa='stdio',this['servers'][_0x3fa110(0xd2)](_0x26514a[_0x3fa110(0xd3)],{'url':_0x26514a['url'],'type':_0x1dbcfa}),_0x42d352['push'](_0x26514a['name']);}catch(_0x45f671){this[_0x3fa110(0xb1)][_0x3fa110(0xf2)]('Failed\x20to\x20add\x20server\x20'+_0x26514a['name']+':',_0x45f671),_0x1559a6[_0x3fa110(0xb7)]({'name':_0x26514a[_0x3fa110(0xd3)],'error':_0x45f671['message']});}}return await this['saveServers'](),{'action':'add-servers','addedServers':_0x42d352,'failedServers':_0x1559a6,'success':_0x42d352['length']>0x0};}async['removeServer'](_0x4deee3){const _0x557bb1=a0_0x446d47;this[_0x557bb1(0xb1)][_0x557bb1(0x9b)]('Removing\x20MCP\x20server:\x20'+_0x4deee3);if(!this['servers']['has'](_0x4deee3))return{'action':'remove-server','serverName':_0x4deee3,'success':![],'error':_0x557bb1(0x97)+_0x4deee3+_0x557bb1(0xda)};if(this[_0x557bb1(0xa2)]['has'](_0x4deee3)){try{const _0x306a42=this['clients']['get'](_0x4deee3);await _0x306a42['disconnect']();}catch(_0x46f367){this[_0x557bb1(0xb1)][_0x557bb1(0xdb)]('Error\x20disconnecting\x20from\x20server\x20'+_0x4deee3+':',_0x46f367);}this['clients']['delete'](_0x4deee3);}return this[_0x557bb1(0x9d)][_0x557bb1(0xbb)](_0x4deee3),await this[_0x557bb1(0xd5)](),{'action':_0x557bb1(0xe4),'serverName':_0x4deee3,'success':!![]};}async[a0_0x446d47(0x9f)](_0x1924cb){const _0x2af933=a0_0x446d47;this['logger'][_0x2af933(0x9b)](_0x2af933(0xce)+_0x1924cb);const [_0x2da24d,_0x22d0bb]=_0x1924cb['split']('/');if(!_0x2da24d||!_0x22d0bb)throw new Error('Invalid\x20tool\x20ID\x20format:\x20'+_0x1924cb+_0x2af933(0xed));if(!this[_0x2af933(0x9d)]['has'](_0x2da24d))throw new Error('Server\x20\x27'+_0x2da24d+_0x2af933(0xda));if(this[_0x2af933(0xec)]['has'](_0x1924cb))return{'action':'get-tool-schema','toolId':_0x1924cb,'schema':this[_0x2af933(0xec)]['get'](_0x1924cb),'success':!![]};const _0x5a2136=await this[_0x2af933(0xf1)](_0x2da24d);if(!_0x5a2136)throw new Error('Failed\x20to\x20connect\x20to\x20server:\x20'+_0x2da24d);const _0xb3b199=await _0x5a2136['listTools'](),_0x3f7782=_0xb3b199[_0x2af933(0x99)](_0x586aff=>_0x586aff['name']===_0x22d0bb);if(!_0x3f7782)throw new Error('Tool\x20\x27'+_0x22d0bb+_0x2af933(0xaf)+_0x2da24d+'\x27');return this['toolSchemas']['set'](_0x1924cb,_0x3f7782),{'action':_0x2af933(0xa1),'toolId':_0x1924cb,'schema':_0x3f7782,'success':!![]};}async['sendMessageToMcp'](_0x92e56){const _0x51e64a=a0_0x446d47;this[_0x51e64a(0xb1)]['info'](_0x51e64a(0xcb));if(!_0x92e56||!_0x92e56[_0x51e64a(0xa5)])throw new Error(_0x51e64a(0xdc));const {name:_0x1d48b9,arguments:_0x10b305}=_0x92e56['tool_call'];if(!_0x1d48b9||!_0x10b305)throw new Error(_0x51e64a(0xc7));const [_0xe73537,_0xb5425]=_0x1d48b9[_0x51e64a(0xb3)]('/');if(!_0xe73537||!_0xb5425)throw new Error('Invalid\x20tool\x20name\x20format:\x20'+_0x1d48b9+'.\x20Expected\x20format:\x20serverName/toolName');if(!this['servers'][_0x51e64a(0xdf)](_0xe73537))throw new Error(_0x51e64a(0x97)+_0xe73537+'\x27\x20does\x20not\x20exist');const _0x11f0a1=await this[_0x51e64a(0xf1)](_0xe73537);if(!_0x11f0a1)throw new Error(_0x51e64a(0xe6)+_0xe73537);const _0xb531a2=await _0x11f0a1['callTool']({'name':_0xb5425,'arguments':_0x10b305});return{'action':_0x51e64a(0xc1),'toolCall':{'name':_0x1d48b9,'arguments':_0x10b305},'result':_0xb531a2,'success':!![]};}async['getOrCreateClient'](_0xe529e){const _0x45faa2=a0_0x446d47;if(this['clients'][_0x45faa2(0xdf)](_0xe529e))return this[_0x45faa2(0xa2)]['get'](_0xe529e);const _0x35791e=this[_0x45faa2(0x9d)][_0x45faa2(0xef)](_0xe529e);if(!_0x35791e)return this[_0x45faa2(0xb1)]['error']('Server\x20\x27'+_0xe529e+'\x27\x20not\x20found'),null;try{const _0x19275c=new Client({'name':_0x45faa2(0xcf),'version':_0x45faa2(0xc2)});let _0x4804e3;if(_0x35791e['type']===_0x45faa2(0xdd))_0x4804e3=new StreamableHTTPClientTransport(_0x35791e['url']);else{if(_0x35791e[_0x45faa2(0xc0)]===_0x45faa2(0xd9)){const _0x18a6b8=_0x35791e[_0x45faa2(0xc4)][_0x45faa2(0xb3)]('\x20'),_0x47627d=_0x18a6b8[0x0],_0xf721b=_0x18a6b8[_0x45faa2(0xbe)](0x1);_0x4804e3=new StdioClientTransport({'command':_0x47627d,'args':_0xf721b});}else throw new Error('Unsupported\x20server\x20type:\x20'+_0x35791e['type']);}return await _0x19275c['connect'](_0x4804e3),this['clients']['set'](_0xe529e,_0x19275c),_0x19275c;}catch(_0x3b63c1){return this['logger']['error']('Failed\x20to\x20create\x20MCP\x20client\x20for\x20server\x20\x27'+_0xe529e+'\x27:',_0x3b63c1),null;}}async[a0_0x446d47(0xd5)](){const _0x220b04=a0_0x446d47;try{const _0x5e5942=a0_0x36fc18['join'](this[_0x220b04(0xa3)],'servers.json'),_0x5ef4ec={};for(const [_0x1b818f,_0x56fe72]of this['servers'][_0x220b04(0xc8)]()){_0x5ef4ec[_0x1b818f]=_0x56fe72;}await a0_0x2a4a6a['writeFile'](_0x5e5942,JSON['stringify'](_0x5ef4ec,null,0x2),'utf-8'),this['logger']['info'](_0x220b04(0xac)+this['servers']['size']+'\x20MCP\x20servers\x20to\x20file');}catch(_0x55f0a4){this['logger'][_0x220b04(0xf2)]('Failed\x20to\x20save\x20MCP\x20servers\x20to\x20file:',_0x55f0a4);}}async['shutdown'](){const _0x35ec98=a0_0x446d47;this['logger'][_0x35ec98(0x9b)](_0x35ec98(0xea));for(const [_0x256aa2,_0x1058bb]of this[_0x35ec98(0xa2)][_0x35ec98(0xc8)]()){try{await _0x1058bb[_0x35ec98(0xb4)](),this['logger'][_0x35ec98(0x9b)](_0x35ec98(0xb6)+_0x256aa2);}catch(_0xb75fb3){this['logger']['warn'](_0x35ec98(0xb5)+_0x256aa2+':',_0xb75fb3);}}this['clients']['clear']();}}