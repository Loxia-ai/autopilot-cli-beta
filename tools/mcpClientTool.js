const a0_0x15894f=a0_0x500d;(function(_0x3044a2,_0x34a978){const _0x2c574e=a0_0x500d,_0x15b6f6=_0x3044a2();while(!![]){try{const _0x4ea5c6=-parseInt(_0x2c574e(0x214))/0x1+parseInt(_0x2c574e(0x20d))/0x2*(parseInt(_0x2c574e(0x20b))/0x3)+parseInt(_0x2c574e(0x235))/0x4*(parseInt(_0x2c574e(0x202))/0x5)+-parseInt(_0x2c574e(0x1fd))/0x6*(-parseInt(_0x2c574e(0x21b))/0x7)+parseInt(_0x2c574e(0x1f8))/0x8*(parseInt(_0x2c574e(0x238))/0x9)+parseInt(_0x2c574e(0x1f7))/0xa+-parseInt(_0x2c574e(0x200))/0xb;if(_0x4ea5c6===_0x34a978)break;else _0x15b6f6['push'](_0x15b6f6['shift']());}catch(_0x247600){_0x15b6f6['push'](_0x15b6f6['shift']());}}}(a0_0x1b74,0x72dc1));import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';function a0_0x1b74(){const _0x5f0eeb=['ms4WlJa','BMfTzq','ywrKu2vYDMvYCW','y3DK','y29UBMvJDa','z2v0','y29UDgvUDa','Ahr0Ca','C3rKAw8','jYbUB3qGzM91BMqGB24GC2vYDMvYicC','DhLWzq','C2v0','z2v0vg9VBfnJAgvTyq','C2vYDMvYrgLYzwn0B3j5','C2L6zq','z2v0lxrVB2WTC2nOzw1H','uMvTB3zPBMCGtunqihnLCNzLCJOG','AM9PBG','z2v0t3jdCMvHDgvdBgLLBNq','BgvUz3rO','z2v0lwf2ywLSywjSzs10B29SCW','odi1odeYmhLxEe9hta','mZi4AMLdvg9e','CMvHzezPBgu','lMXVEgLHlxn0yxrL','qwrKAw5Nia','BwvZC2fNzs10BY1Ty3a','mty3ng5SA2XfuW','C2vYDMvYCW','r2v0DgLUzYbZy2HLBweGzM9YihrVB2W6ia','mJqZnZK0odDjBLzlsKy','CgfYC2u','mtuXmfPwwgPPqG','Bg94AweTBwnWlwnSAwvUDa','y2XPzw50CW','lIbfEhbLy3rLzcbMB3jTyxq6ihnLCNzLCK5HBwuVDg9VBe5HBwu','C3bSAxq','DxjS','DhjPBq','C2vUze1LC3nHz2vuB01JCa','u2vUzgLUzYbTzxnZywDLihrVie1ducbZzxj2zxi','mJq5B2jpEgrA','z2v0qxzHAwXHyMXLu2vYDMvYCW','mtu5mZzIthnsz3m','vg9VBcbJywXSig11C3qGAgf2zsbUyw1LigfUzcbHCMD1BwvUDhm','rxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzcb3AxrOihbHCMfTzxrLCNm6','ihnHDMvKie1ducbZzxj2zxjZ','zxjYB3i','ugfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNmGD2L0AcbuywDqyxjZzxi','DxrMltG','mtGWnJi4uevftLfR','yxr0CMLIDxrLCW','Aw5MBW','rxjYB3iGzgLZy29UBMvJDgLUzYbMCM9Tie1ducbZzxj2zxiG','u2vYDMvYicC','jYbKB2vZig5VDcbLEgLZDa','sw52ywXPzcb0B29Sig5HBwuGzM9YBwf0oIa','mtC4mdf1zevQA0W','tM8GtunqignSAwvUDcbJB21Tyw5KCYbZCgvJAwzPzwq','y2XLyxi','C2vYDMvYCY5QC29U','C2f2zvnLCNzLCNm','z2v0lwf2ywLSywjSzs1Zzxj2zxjZ','CgfYC2vqyxjHBwv0zxjZ','ywn0Aw9U','AgfZ','zgvSzxrL','ie1ducbZzxj2zxjZihrVigzPBgu','zgLZy29UBMvJDa','y29TBwfUzhm','CMvTB3zLlxnLCNzLCG','C2H1DgrVD24','D2fYBG','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','BwvZC2fNzq','rMfPBgvKihrVihnHDMuGtunqihnLCNzLCNmGDg8GzMLSztO','CMvTB3zLu2vYDMvY','jYbUB3qGzM91BMq','ChvZAa','BwTKAxi','vw5ZDxbWB3j0zwqGC2vYDMvYihr5Cgu6ia','rxjYB3iGCgfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNm6','Dg9VBf9JywXS','nZqXmNLtwwX1ua','Bg9Nz2vY','u2vYDMvYig5HBwuGyw5KifvstcbHCMuGCMvXDwLYzwq','mJqZotLNzNz2tuW','tg9HzgvKia','rMfPBgvKihrVignYzwf0zsbnq1aGy2XPzw50igzVCIbZzxj2zxiGjW','vw5RBM93BIbnq1aGy2XPzw50ignVBw1HBMq6ia','zw50CMLLCW','CxvLCNK','Dg9VBfnJAgvTyxm'];a0_0x1b74=function(){return _0x5f0eeb;};return a0_0x1b74();}import{BaseTool}from'./baseTool.js';function a0_0x500d(_0x5d3e95,_0x50b8ff){const _0x1b747f=a0_0x1b74();return a0_0x500d=function(_0x500d06,_0x59e5cb){_0x500d06=_0x500d06-0x1f2;let _0x2a9ce6=_0x1b747f[_0x500d06];if(a0_0x500d['XBrPUR']===undefined){var _0x1f8f63=function(_0x3515ce){const _0x51fcdc='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x640d51='',_0x2fff3e='';for(let _0x4f3cd7=0x0,_0x2593a7,_0x4c3a72,_0xc5da3a=0x0;_0x4c3a72=_0x3515ce['charAt'](_0xc5da3a++);~_0x4c3a72&&(_0x2593a7=_0x4f3cd7%0x4?_0x2593a7*0x40+_0x4c3a72:_0x4c3a72,_0x4f3cd7++%0x4)?_0x640d51+=String['fromCharCode'](0xff&_0x2593a7>>(-0x2*_0x4f3cd7&0x6)):0x0){_0x4c3a72=_0x51fcdc['indexOf'](_0x4c3a72);}for(let _0x42a7da=0x0,_0x21b1c8=_0x640d51['length'];_0x42a7da<_0x21b1c8;_0x42a7da++){_0x2fff3e+='%'+('00'+_0x640d51['charCodeAt'](_0x42a7da)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2fff3e);};a0_0x500d['gSSUqF']=_0x1f8f63,_0x5d3e95=arguments,a0_0x500d['XBrPUR']=!![];}const _0x273cb1=_0x1b747f[0x0],_0x546798=_0x500d06+_0x273cb1,_0x1f1f16=_0x5d3e95[_0x546798];return!_0x1f1f16?(_0x2a9ce6=a0_0x500d['gSSUqF'](_0x2a9ce6),_0x5d3e95[_0x546798]=_0x2a9ce6):_0x2a9ce6=_0x1f1f16,_0x2a9ce6;},a0_0x500d(_0x5d3e95,_0x50b8ff);}import{TagParser}from'../utilities/tagParser.js';import a0_0x3515ce from'path';import a0_0x51fcdc from'fs/promises';export class MCPClientTool extends BaseTool{constructor(_0x640d51,_0x2fff3e){const _0x3d3f0f=a0_0x500d;super(_0x640d51,_0x2fff3e),this[_0x3d3f0f(0x1fe)]=new Map(),this[_0x3d3f0f(0x204)]=new Map(),this['toolSchemas']=new Map(),this[_0x3d3f0f(0x24c)]=a0_0x3515ce[_0x3d3f0f(0x1f3)](process[_0x3d3f0f(0x242)](),_0x3d3f0f(0x1fa),'mcp-servers'),this['initializeServerDirectory']()['catch'](_0x4f3cd7=>{this['logger']['error']('Failed\x20to\x20initialize\x20MCP\x20server\x20directory:',_0x4f3cd7);});}async['initializeServerDirectory'](){const _0x392e1d=a0_0x500d;try{await a0_0x51fcdc[_0x392e1d(0x231)](this['serverDirectory'],{'recursive':!![]});try{const _0x2593a7=a0_0x3515ce['join'](this[_0x392e1d(0x24c)],_0x392e1d(0x21e)),_0x4c3a72=await a0_0x51fcdc[_0x392e1d(0x1f9)](_0x2593a7,'utf-8'),_0xc5da3a=JSON['parse'](_0x4c3a72);for(const [_0x42a7da,_0x21b1c8]of Object['entries'](_0xc5da3a)){this['servers'][_0x392e1d(0x24a)](_0x42a7da,_0x21b1c8);}this['logger']['info'](_0x392e1d(0x239)+this['servers'][_0x392e1d(0x24d)]+_0x392e1d(0x210));}catch(_0x27c86b){_0x27c86b['code']!=='ENOENT'&&this[_0x392e1d(0x236)][_0x392e1d(0x22a)]('Failed\x20to\x20load\x20saved\x20MCP\x20servers:',_0x27c86b);}}catch(_0x1cc793){this[_0x392e1d(0x236)][_0x392e1d(0x211)]('Failed\x20to\x20create\x20MCP\x20server\x20directory:',_0x1cc793);}}['getDescription'](){return'\x0aMCP\x20Client\x20Tool:\x20Allows\x20you\x20to\x20interact\x20with\x20Model\x20Context\x20Protocol\x20(MCP)\x20servers\x20to\x20access\x20external\x20tools\x20and\x20resources.\x0a\x0aUsage:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[get-available-tools\x20/]\x0a\x0a[add-servers]\x0a[s\x20name=\x22server-name\x22\x20url=\x22http://server-url\x22\x20/]\x0a[/add-servers]\x0a\x0a[remove-server]\x0aserver-name\x0a[/remove-server]\x0a\x0a[get-tool-schema]\x0aserver-name/tool-name\x0a[/get-tool-schema]\x0a\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22server-name/tool-name\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22param1\x22:\x20\x22value1\x22,\x20\x22param2\x22:\x20\x22value2\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20List\x20available\x20MCP\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[/tool]\x0a\x0a2.\x20List\x20available\x20tools\x20from\x20all\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-tools\x20/]\x0a[/tool]\x0a\x0a3.\x20Add\x20a\x20new\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[add-servers]\x0a[s\x20name=\x22system-tools\x22\x20url=\x22http://localhost:3001\x22\x20/]\x0a[/add-servers]\x0a[/tool]\x0a\x0a4.\x20Remove\x20an\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[remove-server]\x0asystem-tools\x0a[/remove-server]\x0a[/tool]\x0a\x0a5.\x20Get\x20the\x20schema\x20for\x20a\x20specific\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-tool-schema]\x0asystem-tools/runCommand\x0a[/get-tool-schema]\x0a[/tool]\x0a\x0a6.\x20Call\x20an\x20MCP\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22system-tools/runCommand\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22command\x22:\x20\x22ls\x20-la\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x20\x20\x20\x20';}[a0_0x15894f(0x221)](_0x59b85a){const _0x2ec69b=a0_0x15894f;this['logger'][_0x2ec69b(0x216)](_0x2ec69b(0x212));const _0xe938f={'commands':[]};try{const _0x4ddf0e=TagParser['query'](_0x59b85a,'get-available-servers');_0x4ddf0e['length']>0x0&&_0xe938f['commands'][_0x2ec69b(0x230)]({'action':_0x2ec69b(0x220)});const _0x470af3=TagParser['query'](_0x59b85a,_0x2ec69b(0x1f6));_0x470af3['length']>0x0&&_0xe938f['commands'][_0x2ec69b(0x230)]({'action':'get-available-tools'});const _0x2e317e=TagParser['query'](_0x59b85a,'add-servers');for(const _0x519965 of _0x2e317e){const _0x4e1c0f=TagParser[_0x2ec69b(0x23d)](_0x519965[_0x2ec69b(0x245)],'s'),_0x56c766=[];for(const _0x485884 of _0x4e1c0f){const _0x251f27=_0x485884[_0x2ec69b(0x215)][_0x2ec69b(0x240)],_0x261d71=_0x485884[_0x2ec69b(0x215)][_0x2ec69b(0x207)];_0x251f27&&_0x261d71&&_0x56c766[_0x2ec69b(0x230)]({'name':_0x251f27,'url':_0x261d71});}_0x56c766['length']>0x0&&_0xe938f['commands']['push']({'action':'add-servers','servers':_0x56c766});}const _0x17aa87=TagParser[_0x2ec69b(0x23d)](_0x59b85a,'remove-server');for(const _0x1cf5b9 of _0x17aa87){const _0x107302=_0x1cf5b9[_0x2ec69b(0x245)]['trim']();_0x107302&&_0xe938f['commands'][_0x2ec69b(0x230)]({'action':_0x2ec69b(0x228),'serverName':_0x107302});}const _0x3d3295=TagParser['query'](_0x59b85a,'get-tool-schema');for(const _0x4f724e of _0x3d3295){const _0x2198d7=_0x4f724e[_0x2ec69b(0x245)][_0x2ec69b(0x208)]();_0x2198d7&&_0xe938f[_0x2ec69b(0x227)]['push']({'action':_0x2ec69b(0x24e),'toolId':_0x2198d7});}const _0x38b267=TagParser[_0x2ec69b(0x23d)](_0x59b85a,'message-to-mcp');for(const _0x24e6c6 of _0x38b267){const _0x333bb6=_0x24e6c6[_0x2ec69b(0x245)][_0x2ec69b(0x208)]();if(_0x333bb6){let _0x26d241;try{_0x26d241=JSON[_0x2ec69b(0x201)](_0x333bb6);}catch(_0x39fac8){this[_0x2ec69b(0x236)][_0x2ec69b(0x211)]('Failed\x20to\x20parse\x20MCP\x20message\x20JSON:',_0x39fac8);continue;}_0xe938f['commands']['push']({'action':'message-to-mcp','message':_0x26d241});}}return _0xe938f;}catch(_0x7913d0){return this['logger']['error'](_0x2ec69b(0x233),_0x7913d0),{'commands':[]};}}async['executeWithParameters'](_0x5500a0,_0x21f24d){const _0x410cbf=a0_0x15894f;this[_0x410cbf(0x236)]['info'](_0x410cbf(0x20f),_0x5500a0);const _0x4eca27=[];if(!_0x5500a0['commands']||_0x5500a0[_0x410cbf(0x227)][_0x410cbf(0x1f5)]===0x0)throw new Error(_0x410cbf(0x21c));for(const _0x2bfe04 of _0x5500a0['commands']){try{let _0x100e37;switch(_0x2bfe04['action']){case _0x410cbf(0x220):_0x100e37=await this[_0x410cbf(0x20c)]();break;case'get-available-tools':_0x100e37=await this['getAvailableTools']();break;case'add-servers':_0x100e37=await this[_0x410cbf(0x241)](_0x2bfe04[_0x410cbf(0x1fe)]);break;case _0x410cbf(0x228):_0x100e37=await this[_0x410cbf(0x22e)](_0x2bfe04['serverName']);break;case _0x410cbf(0x24e):_0x100e37=await this['getToolSchema'](_0x2bfe04['toolId']);break;case _0x410cbf(0x1fc):_0x100e37=await this[_0x410cbf(0x209)](_0x2bfe04['message']);break;default:throw new Error(_0x410cbf(0x23b)+_0x2bfe04['action']);}_0x4eca27['push'](_0x100e37);}catch(_0x26da26){this[_0x410cbf(0x236)]['error']('Error\x20executing\x20MCP\x20client\x20command\x20'+_0x2bfe04[_0x410cbf(0x222)]+':',_0x26da26),_0x4eca27['push']({'action':_0x2bfe04[_0x410cbf(0x222)],'success':![],'error':_0x26da26[_0x410cbf(0x22c)]});}}return{'results':_0x4eca27};}async[a0_0x15894f(0x20c)](){const _0x1cb3a0=a0_0x15894f;this[_0x1cb3a0(0x236)]['info']('Getting\x20available\x20MCP\x20servers');const _0x463ad9=[];for(const [_0x115dc3,_0x4379c5]of this[_0x1cb3a0(0x1fe)]['entries']()){_0x463ad9[_0x1cb3a0(0x230)]({'name':_0x115dc3,'url':_0x4379c5['url'],'type':_0x4379c5[_0x1cb3a0(0x249)]||'http'});}return{'action':'get-available-servers','servers':_0x463ad9,'success':!![]};}async['getAvailableTools'](){const _0x44b72d=a0_0x15894f;this['logger']['info']('Getting available tools from MCP servers');const _0x48429d=[],_0x6d7681=[];for(const [_0x1456db,_0x48893a]of this['servers']['entries']()){try{const _0x26cdd2=await this[_0x44b72d(0x1f4)](_0x1456db);if(!_0x26cdd2){_0x6d7681[_0x44b72d(0x230)]({'name':_0x1456db,'error':'Failed\x20to\x20create\x20client'});continue;}const _0x47636b=await _0x26cdd2['listTools']();for(const _0x3b5b02 of _0x47636b){_0x48429d[_0x44b72d(0x230)]({'name':_0x1456db+'/'+_0x3b5b02['name'],'description':_0x3b5b02['description']||'No\x20description','server':_0x1456db}),this['toolSchemas'][_0x44b72d(0x24a)](_0x1456db+'/'+_0x3b5b02[_0x44b72d(0x240)],_0x3b5b02);}}catch(_0x3b4da5){this[_0x44b72d(0x236)]['error']('Failed\x20to\x20get\x20tools\x20from\x20server\x20'+_0x1456db+':',_0x3b4da5),_0x6d7681[_0x44b72d(0x230)]({'name':_0x1456db,'error':_0x3b4da5[_0x44b72d(0x22c)]});}}return{'action':'get-available-tools','tools':_0x48429d,'failedServers':_0x6d7681,'success':!![]};}async['addServers'](_0x15d0ae){const _0x3f01ca=a0_0x15894f;this['logger'][_0x3f01ca(0x216)](_0x3f01ca(0x1fb)+_0x15d0ae['length']+'\x20MCP\x20servers');const _0x2c3cb2=[],_0x2aa527=[];for(const _0x47812a of _0x15d0ae){try{if(!_0x47812a['name']||!_0x47812a[_0x3f01ca(0x207)])throw new Error(_0x3f01ca(0x237));let _0x3312df=_0x3f01ca(0x246);_0x47812a[_0x3f01ca(0x207)]['startsWith']('http://')||_0x47812a[_0x3f01ca(0x207)]['startsWith']('https://')?_0x3312df='http':_0x3312df=_0x3f01ca(0x247),this['servers']['set'](_0x47812a['name'],{'url':_0x47812a[_0x3f01ca(0x207)],'type':_0x3312df}),_0x2c3cb2[_0x3f01ca(0x230)](_0x47812a[_0x3f01ca(0x240)]);}catch(_0x3193cc){this['logger'][_0x3f01ca(0x211)]('Failed\x20to\x20add\x20server\x20'+_0x47812a[_0x3f01ca(0x240)]+':',_0x3193cc),_0x2aa527['push']({'name':_0x47812a['name'],'error':_0x3193cc['message']});}}return await this[_0x3f01ca(0x21f)](),{'action':'add-servers','addedServers':_0x2c3cb2,'failedServers':_0x2aa527,'success':_0x2c3cb2['length']>0x0};}async[a0_0x15894f(0x22e)](_0xeb090e){const _0x4b9f0b=a0_0x15894f;this['logger']['info'](_0x4b9f0b(0x1f2)+_0xeb090e);if(!this[_0x4b9f0b(0x1fe)]['has'](_0xeb090e))return{'action':'remove-server','serverName':_0xeb090e,'success':![],'error':'Server\x20\x27'+_0xeb090e+'\x27\x20does\x20not\x20exist'};if(this['clients']['has'](_0xeb090e)){try{const _0x1437fc=this['clients']['get'](_0xeb090e);await _0x1437fc[_0x4b9f0b(0x226)]();}catch(_0x4b5944){this['logger'][_0x4b9f0b(0x22a)]('Error\x20disconnecting\x20from\x20server\x20'+_0xeb090e+':',_0x4b5944);}this['clients'][_0x4b9f0b(0x224)](_0xeb090e);}return this[_0x4b9f0b(0x1fe)]['delete'](_0xeb090e),await this['saveServers'](),{'action':'remove-server','serverName':_0xeb090e,'success':!![]};}async[a0_0x15894f(0x24b)](_0xbc5ebd){const _0x17e7dd=a0_0x15894f;this[_0x17e7dd(0x236)][_0x17e7dd(0x216)](_0x17e7dd(0x1ff)+_0xbc5ebd);const [_0x59149c,_0x9aad4b]=_0xbc5ebd[_0x17e7dd(0x206)]('/');if(!_0x59149c||!_0x9aad4b)throw new Error('Invalid\x20tool\x20ID\x20format:\x20'+_0xbc5ebd+_0x17e7dd(0x205));if(!this['servers']['has'](_0x59149c))throw new Error('Server\x20\x27'+_0x59149c+'\x27\x20does\x20not\x20exist');if(this['toolSchemas'][_0x17e7dd(0x223)](_0xbc5ebd))return{'action':_0x17e7dd(0x24e),'toolId':_0xbc5ebd,'schema':this['toolSchemas'][_0x17e7dd(0x244)](_0xbc5ebd),'success':!![]};const _0x4e80cd=await this[_0x17e7dd(0x1f4)](_0x59149c);if(!_0x4e80cd)throw new Error(_0x17e7dd(0x22b)+_0x59149c);const _0x5728e1=await _0x4e80cd['listTools'](),_0x1d416a=_0x5728e1['find'](_0x113583=>_0x113583['name']===_0x9aad4b);if(!_0x1d416a)throw new Error('Tool\x20\x27'+_0x9aad4b+_0x17e7dd(0x248)+_0x59149c+'\x27');return this[_0x17e7dd(0x23e)]['set'](_0xbc5ebd,_0x1d416a),{'action':'get-tool-schema','toolId':_0xbc5ebd,'schema':_0x1d416a,'success':!![]};}async[a0_0x15894f(0x209)](_0x189641){const _0x3e5a12=a0_0x15894f;this['logger'][_0x3e5a12(0x216)](_0x3e5a12(0x20a));if(!_0x189641||!_0x189641[_0x3e5a12(0x234)])throw new Error('Invalid\x20MCP\x20message\x20format.\x20Expected\x20{\x20tool_call:\x20{\x20name,\x20arguments\x20}\x20}');const {name:_0x3cd3de,arguments:_0x439b7f}=_0x189641['tool_call'];if(!_0x3cd3de||!_0x439b7f)throw new Error(_0x3e5a12(0x20e));const [_0x34a27e,_0x4b57ea]=_0x3cd3de['split']('/');if(!_0x34a27e||!_0x4b57ea)throw new Error(_0x3e5a12(0x21a)+_0x3cd3de+_0x3e5a12(0x205));if(!this['servers']['has'](_0x34a27e))throw new Error(_0x3e5a12(0x218)+_0x34a27e+_0x3e5a12(0x219));const _0x38b258=await this['getOrCreateClient'](_0x34a27e);if(!_0x38b258)throw new Error(_0x3e5a12(0x22b)+_0x34a27e);const _0x3ecffc=await _0x38b258['callTool']({'name':_0x4b57ea,'arguments':_0x439b7f});return{'action':_0x3e5a12(0x1fc),'toolCall':{'name':_0x3cd3de,'arguments':_0x439b7f},'result':_0x3ecffc,'success':!![]};}async[a0_0x15894f(0x1f4)](_0x57fa2a){const _0xb9a270=a0_0x15894f;if(this['clients']['has'](_0x57fa2a))return this['clients'][_0xb9a270(0x244)](_0x57fa2a);const _0x2a369f=this[_0xb9a270(0x1fe)][_0xb9a270(0x244)](_0x57fa2a);if(!_0x2a369f)return this['logger']['error']('Server\x20\x27'+_0x57fa2a+_0xb9a270(0x22f)),null;try{const _0x5bfc2d=new Client({'name':_0xb9a270(0x203),'version':_0xb9a270(0x23f)});let _0x3f3b55;if(_0x2a369f[_0xb9a270(0x249)]==='http')_0x3f3b55=new StreamableHTTPClientTransport(_0x2a369f[_0xb9a270(0x207)]);else{if(_0x2a369f['type']==='stdio'){const _0x30db65=_0x2a369f[_0xb9a270(0x207)][_0xb9a270(0x206)]('\x20'),_0x517f53=_0x30db65[0x0],_0x3c0bb1=_0x30db65['slice'](0x1);_0x3f3b55=new StdioClientTransport({'command':_0x517f53,'args':_0x3c0bb1});}else throw new Error(_0xb9a270(0x232)+_0x2a369f['type']);}return await _0x5bfc2d[_0xb9a270(0x243)](_0x3f3b55),this[_0xb9a270(0x204)]['set'](_0x57fa2a,_0x5bfc2d),_0x5bfc2d;}catch(_0x35819d){return this[_0xb9a270(0x236)][_0xb9a270(0x211)](_0xb9a270(0x23a)+_0x57fa2a+'\x27:',_0x35819d),null;}}async[a0_0x15894f(0x21f)](){const _0x968c81=a0_0x15894f;try{const _0x3404d9=a0_0x3515ce['join'](this[_0x968c81(0x24c)],'servers.json'),_0x251328={};for(const [_0x2143a8,_0x4c00a7]of this['servers'][_0x968c81(0x23c)]()){_0x251328[_0x2143a8]=_0x4c00a7;}await a0_0x51fcdc['writeFile'](_0x3404d9,JSON['stringify'](_0x251328,null,0x2),_0x968c81(0x213)),this[_0x968c81(0x236)]['info']('Saved\x20'+this[_0x968c81(0x1fe)]['size']+_0x968c81(0x225));}catch(_0x4c232a){this['logger']['error'](_0x968c81(0x22d),_0x4c232a);}}async[a0_0x15894f(0x229)](){const _0x37d612=a0_0x15894f;this[_0x37d612(0x236)]['info']('Shutting\x20down\x20MCP\x20client\x20tool');for(const [_0x36b21f,_0x1bd56a]of this['clients'][_0x37d612(0x23c)]()){try{await _0x1bd56a['disconnect'](),this['logger'][_0x37d612(0x216)]('Disconnected\x20from\x20MCP\x20server:\x20'+_0x36b21f);}catch(_0x23a7c1){this['logger'][_0x37d612(0x22a)](_0x37d612(0x217)+_0x36b21f+':',_0x23a7c1);}}this['clients'][_0x37d612(0x21d)]();}}