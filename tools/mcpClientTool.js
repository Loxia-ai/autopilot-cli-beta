const a0_0x31d0cb=a0_0xa69b;(function(_0x3da9bb,_0x767657){const _0x23429c=a0_0xa69b,_0x1dc209=_0x3da9bb();while(!![]){try{const _0x459307=-parseInt(_0x23429c(0xec))/0x1*(parseInt(_0x23429c(0xbb))/0x2)+-parseInt(_0x23429c(0xe7))/0x3*(parseInt(_0x23429c(0xe2))/0x4)+parseInt(_0x23429c(0xbe))/0x5+-parseInt(_0x23429c(0xd2))/0x6+parseInt(_0x23429c(0xf4))/0x7+-parseInt(_0x23429c(0xb7))/0x8+-parseInt(_0x23429c(0xd9))/0x9*(-parseInt(_0x23429c(0xd1))/0xa);if(_0x459307===_0x767657)break;else _0x1dc209['push'](_0x1dc209['shift']());}catch(_0xebf6c){_0x1dc209['push'](_0x1dc209['shift']());}}}(a0_0x5d7d,0x3d516));import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';import{BaseTool}from'./baseTool.js';import{TagParser}from'../utilities/tagParser.js';function a0_0x5d7d(){const _0x1458b1=['z2v0qxzHAwXHyMXLvg9VBhm','C3bSAxq','Ahr0Chm6lY8','Bg9Nz2vY','ihnHDMvKie1ducbZzxj2zxjZ','sw52ywXPzcb0B29Sig5HBwuGzM9YBwf0oIa','z2v0rgvZy3jPChrPB24','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','zw50CMLLCW','ie1ducbZzxj2zxjZ','CMvHzezPBgu','rxjYB3iGzgLZy29UBMvJDgLUzYbMCM9Tie1ducbZzxj2zxiG','BwnWlxnLCNzLCNm','rxjYB3iGzxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzca','y29UDgvUDa','CgfYC2u','BMfTzq','u2vUzgLUzYbTzxnZywDLihrVie1ducbZzxj2zxi','mti3odm2mgj2vvfXrG','jYbKB2vZig5VDcbLEgLZDa','vw5ZDxbWB3j0zwqGC2vYDMvYihr5Cgu6ia','y29UBMvJDa','nef3BNfytW','C2f2zvnLCNzLCNm','C3rKAw8','ntuZnJCWDvHZshHS','sw52ywXPzcb0B29SieLeigzVCM1HDdOG','rMfPBgvKihrVigDLDcb0B29SCYbMCM9TihnLCNzLCIa','rMfPBgvKihrVignYzwf0zsbnq1aGy2XPzw50igzVCIbZzxj2zxiGjW','DhjPBq','lIbfEhbLy3rLzcbMB3jTyxq6ihnLCNzLCK5HBwuVDg9VBe5HBwu','BgLZDfrVB2XZ','rMfPBgvKihrVigXVywqGC2f2zwqGtunqihnLCNzLCNm6','Ahr0Ca','AgfZ','Aw5MBW','BwvZC2fNzs10BY1Ty3a','uMvTB3zPBMCGtunqihnLCNzLCJOG','DxrMltG','zgLZy29UBMvJDa','y29TBwfUzhm','u2vYDMvYig5HBwuGyw5KifvstcbHCMuGCMvXDwLYzwq','Dg9VBf9JywXS','tM8GtunqignSAwvUDcbJB21Tyw5KCYbZCgvJAwzPzwq','otmZmdCWt0zxt0f5','mJqWmJeXognqqMfoqW','y29Kzq','C2v0','y2XLyxi','u2vYDMvYicC','BwTKAxi','zxjYB3i','otLxsg9UDhe','lMXVEgLHlxn0yxrL','CMvTB3zLu2vYDMvY','y2XPzw50CW','z2v0lxrVB2WTC2nOzw1H','jYbUB3qGzM91BMqGB24GC2vYDMvYicC','DhLWzq','DxjS','rxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzcb3AxrOihbHCMfTzxrLCNm6','odm4mZzkwfPkDe8','ywn0Aw9U','tM8GzgvZy3jPChrPB24','ChvZAa','Dg9VBfnJAgvTyxm','ndHYtvfzDMC','CMvTB3zLlxnLCNzLCG','C3rHCNrZv2L0Aa','rxjYB3iGzgLZy29UBMvJDgLUzYbMCM9TihnLCNzLCIa','CxvLCNK','mtuZmZq0A0rpsLHv','yxr0CMLIDxrLCW','rMfPBgvKihrVigLUAxrPywXPEMuGtunqihnLCNzLCIbKAxjLy3rVCNK6','z2v0','C3rYAw5NAwz5','rMfPBgvKihrVihbHCNnLie1ducbTzxnZywDLiePtt046','ugfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNmGD2L0AcbuywDqyxjZzxi','z2v0lwf2ywLSywjSzs10B29SCW','mJiXmZu4ouH1qMrLtG','tg9HzgvKia','C2vYDMvYCW','BwvZC2fNzq','vw5RBM93BIbnq1aGy2XPzw50ignVBw1HBMq6ia','z2v0vg9VBfnJAgvTyq','BgvUz3rO','zgvZy3jPChrPB24','C2vYDMvYrgLYzwn0B3j5'];a0_0x5d7d=function(){return _0x1458b1;};return a0_0x5d7d();}function a0_0xa69b(_0x206fdf,_0x29cf7e){const _0x5d7d18=a0_0x5d7d();return a0_0xa69b=function(_0xa69bf6,_0x2b2196){_0xa69bf6=_0xa69bf6-0xa4;let _0x2c9095=_0x5d7d18[_0xa69bf6];if(a0_0xa69b['ccqRuA']===undefined){var _0x5680b2=function(_0xdc9ad3){const _0x2bf00f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x463173='',_0x218e7e='';for(let _0xb33c14=0x0,_0xf09165,_0x535618,_0x1a7e79=0x0;_0x535618=_0xdc9ad3['charAt'](_0x1a7e79++);~_0x535618&&(_0xf09165=_0xb33c14%0x4?_0xf09165*0x40+_0x535618:_0x535618,_0xb33c14++%0x4)?_0x463173+=String['fromCharCode'](0xff&_0xf09165>>(-0x2*_0xb33c14&0x6)):0x0){_0x535618=_0x2bf00f['indexOf'](_0x535618);}for(let _0x154bd9=0x0,_0x1dfb95=_0x463173['length'];_0x154bd9<_0x1dfb95;_0x154bd9++){_0x218e7e+='%'+('00'+_0x463173['charCodeAt'](_0x154bd9)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x218e7e);};a0_0xa69b['bZlCIC']=_0x5680b2,_0x206fdf=arguments,a0_0xa69b['ccqRuA']=!![];}const _0x3692da=_0x5d7d18[0x0],_0x16b92c=_0xa69bf6+_0x3692da,_0x489461=_0x206fdf[_0x16b92c];return!_0x489461?(_0x2c9095=a0_0xa69b['bZlCIC'](_0x2c9095),_0x206fdf[_0x16b92c]=_0x2c9095):_0x2c9095=_0x489461,_0x2c9095;},a0_0xa69b(_0x206fdf,_0x29cf7e);}import a0_0xdc9ad3 from'path';import a0_0x2bf00f from'fs/promises';export class MCPClientTool extends BaseTool{constructor(_0x463173,_0x218e7e){const _0x3128b9=a0_0xa69b;super(_0x463173,_0x218e7e),this[_0x3128b9(0xf6)]=new Map(),this['clients']=new Map(),this['toolSchemas']=new Map(),this[_0x3128b9(0xa4)]=a0_0xdc9ad3['join'](process['cwd'](),_0x3128b9(0xda),_0x3128b9(0xb1)),this['initializeServerDirectory']()['catch'](_0xb33c14=>{const _0x50f834=_0x3128b9;this['logger'][_0x50f834(0xd8)](_0x50f834(0xee),_0xb33c14);});}async['initializeServerDirectory'](){const _0x30ce08=a0_0xa69b;try{await a0_0x2bf00f[_0x30ce08(0xd7)](this['serverDirectory'],{'recursive':!![]});try{const _0xf09165=a0_0xdc9ad3['join'](this['serverDirectory'],'servers.json'),_0x535618=await a0_0x2bf00f[_0x30ce08(0xaf)](_0xf09165,'utf-8'),_0x1a7e79=JSON['parse'](_0x535618);for(const [_0x154bd9,_0x1dfb95]of Object[_0x30ce08(0xad)](_0x1a7e79)){this[_0x30ce08(0xf6)]['set'](_0x154bd9,_0x1dfb95);}this[_0x30ce08(0xa8)]['info'](_0x30ce08(0xf5)+this[_0x30ce08(0xf6)]['size']+_0x30ce08(0xa9));}catch(_0x15dd27){_0x15dd27[_0x30ce08(0xd3)]!=='ENOENT'&&this['logger']['warn'](_0x30ce08(0xc5),_0x15dd27);}}catch(_0x73f2c){this[_0x30ce08(0xa8)][_0x30ce08(0xd8)]('Failed\x20to\x20create\x20MCP\x20server\x20directory:',_0x73f2c);}}[a0_0x31d0cb(0xab)](){return'\x0aMCP\x20Client\x20Tool:\x20Allows\x20you\x20to\x20interact\x20with\x20Model\x20Context\x20Protocol\x20(MCP)\x20servers\x20to\x20access\x20external\x20tools\x20and\x20resources.\x0a\x0aUsage:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[get-available-tools\x20/]\x0a\x0a[add-servers]\x0a[s\x20name=\x22server-name\x22\x20url=\x22http://server-url\x22\x20/]\x0a[/add-servers]\x0a\x0a[remove-server]\x0aserver-name\x0a[/remove-server]\x0a\x0a[get-tool-schema]\x0aserver-name/tool-name\x0a[/get-tool-schema]\x0a\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22server-name/tool-name\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22param1\x22:\x20\x22value1\x22,\x20\x22param2\x22:\x20\x22value2\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20List\x20available\x20MCP\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[/tool]\x0a\x0a2.\x20List\x20available\x20tools\x20from\x20all\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-tools\x20/]\x0a[/tool]\x0a\x0a3.\x20Add\x20a\x20new\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[add-servers]\x0a[s\x20name=\x22system-tools\x22\x20url=\x22http://localhost:3001\x22\x20/]\x0a[/add-servers]\x0a[/tool]\x0a\x0a4.\x20Remove\x20an\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[remove-server]\x0asystem-tools\x0a[/remove-server]\x0a[/tool]\x0a\x0a5.\x20Get\x20the\x20schema\x20for\x20a\x20specific\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-tool-schema]\x0asystem-tools/runCommand\x0a[/get-tool-schema]\x0a[/tool]\x0a\x0a6.\x20Call\x20an\x20MCP\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22system-tools/runCommand\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22command\x22:\x20\x22ls\x20-la\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x20\x20\x20\x20';}['parseParameters'](_0x541be8){const _0x1aa09a=a0_0x31d0cb;this[_0x1aa09a(0xa8)]['info'](_0x1aa09a(0xf2));const _0x143289={'commands':[]};try{const _0x185791=TagParser['query'](_0x541be8,'get-available-servers');_0x185791[_0x1aa09a(0xfa)]>0x0&&_0x143289['commands'][_0x1aa09a(0xe5)]({'action':'get-available-servers'});const _0x2d7a9b=TagParser[_0x1aa09a(0xeb)](_0x541be8,_0x1aa09a(0xf3));_0x2d7a9b['length']>0x0&&_0x143289[_0x1aa09a(0xcd)][_0x1aa09a(0xe5)]({'action':_0x1aa09a(0xf3)});const _0x2372be=TagParser['query'](_0x541be8,'add-servers');for(const _0x1cfcae of _0x2372be){const _0x453d72=TagParser['query'](_0x1cfcae['content'],'s'),_0xf96944=[];for(const _0x253e8c of _0x453d72){const _0x1c7fe4=_0x253e8c['attributes'][_0x1aa09a(0xb5)],_0x29888d=_0x253e8c[_0x1aa09a(0xed)][_0x1aa09a(0xe0)];_0x1c7fe4&&_0x29888d&&_0xf96944[_0x1aa09a(0xe5)]({'name':_0x1c7fe4,'url':_0x29888d});}_0xf96944['length']>0x0&&_0x143289[_0x1aa09a(0xcd)][_0x1aa09a(0xe5)]({'action':'add-servers','servers':_0xf96944});}const _0x59e044=TagParser['query'](_0x541be8,'remove-server');for(const _0x1c9f38 of _0x59e044){const _0x446d0e=_0x1c9f38[_0x1aa09a(0xb3)][_0x1aa09a(0xc2)]();_0x446d0e&&_0x143289['commands']['push']({'action':'remove-server','serverName':_0x446d0e});}const _0x5b03f6=TagParser[_0x1aa09a(0xeb)](_0x541be8,'get-tool-schema');for(const _0x3cf660 of _0x5b03f6){const _0x4c3d80=_0x3cf660[_0x1aa09a(0xb3)]['trim']();_0x4c3d80&&_0x143289[_0x1aa09a(0xcd)][_0x1aa09a(0xe5)]({'action':_0x1aa09a(0xdd),'toolId':_0x4c3d80});}const _0x2daafc=TagParser['query'](_0x541be8,'message-to-mcp');for(const _0x4aab4c of _0x2daafc){const _0x4eb844=_0x4aab4c['content']['trim']();if(_0x4eb844){let _0x234439;try{_0x234439=JSON[_0x1aa09a(0xb4)](_0x4eb844);}catch(_0x557304){this['logger']['error'](_0x1aa09a(0xf1),_0x557304);continue;}_0x143289[_0x1aa09a(0xcd)]['push']({'action':_0x1aa09a(0xc9),'message':_0x234439});}}return _0x143289;}catch(_0x341168){return this['logger'][_0x1aa09a(0xd8)]('Error\x20parsing\x20MCP\x20client\x20parameters:',_0x341168),{'commands':[]};}}async['executeWithParameters'](_0x2e8a23,_0x3a3cac){const _0x1bc4d3=a0_0x31d0cb;this[_0x1bc4d3(0xa8)]['info'](_0x1bc4d3(0xe1),_0x2e8a23);const _0x3add70=[];if(!_0x2e8a23['commands']||_0x2e8a23[_0x1bc4d3(0xcd)][_0x1bc4d3(0xfa)]===0x0)throw new Error(_0x1bc4d3(0xd0));for(const _0x388ae9 of _0x2e8a23[_0x1bc4d3(0xcd)]){try{let _0x10b8a6;switch(_0x388ae9['action']){case'get-available-servers':_0x10b8a6=await this['getAvailableServers']();break;case _0x1bc4d3(0xf3):_0x10b8a6=await this['getAvailableTools']();break;case'add-servers':_0x10b8a6=await this['addServers'](_0x388ae9[_0x1bc4d3(0xf6)]);break;case'remove-server':_0x10b8a6=await this[_0x1bc4d3(0xdb)](_0x388ae9['serverName']);break;case'get-tool-schema':_0x10b8a6=await this[_0x1bc4d3(0xf9)](_0x388ae9['toolId']);break;case _0x1bc4d3(0xc9):_0x10b8a6=await this['sendMessageToMcp'](_0x388ae9[_0x1bc4d3(0xf7)]);break;default:throw new Error(_0x1bc4d3(0xf8)+_0x388ae9['action']);}_0x3add70['push'](_0x10b8a6);}catch(_0x26776d){this[_0x1bc4d3(0xa8)]['error'](_0x1bc4d3(0xb2)+_0x388ae9['action']+':',_0x26776d),_0x3add70[_0x1bc4d3(0xe5)]({'action':_0x388ae9[_0x1bc4d3(0xe3)],'success':![],'error':_0x26776d['message']});}}return{'results':_0x3add70};}async['getAvailableServers'](){const _0x3a0f25=a0_0x31d0cb;this['logger']['info']('Getting\x20available\x20MCP\x20servers');const _0x59c8d1=[];for(const [_0x417990,_0x18393c]of this[_0x3a0f25(0xf6)]['entries']()){_0x59c8d1['push']({'name':_0x417990,'url':_0x18393c[_0x3a0f25(0xe0)],'type':_0x18393c[_0x3a0f25(0xdf)]||_0x3a0f25(0xc6)});}return{'action':'get-available-servers','servers':_0x59c8d1,'success':!![]};}async[a0_0x31d0cb(0xa5)](){const _0x4cf067=a0_0x31d0cb;this['logger'][_0x4cf067(0xc8)]('Getting available tools from MCP servers');const _0x540429=[],_0xf2c23e=[];for(const [_0x107bea,_0x2f9a06]of this['servers']['entries']()){try{const _0x1855ae=await this['getOrCreateClient'](_0x107bea);if(!_0x1855ae){_0xf2c23e[_0x4cf067(0xe5)]({'name':_0x107bea,'error':'Failed\x20to\x20create\x20client'});continue;}const _0x3527d8=await _0x1855ae[_0x4cf067(0xc4)]();for(const _0x68fa5f of _0x3527d8){_0x540429[_0x4cf067(0xe5)]({'name':_0x107bea+'/'+_0x68fa5f['name'],'description':_0x68fa5f[_0x4cf067(0xfb)]||_0x4cf067(0xe4),'server':_0x107bea}),this['toolSchemas'][_0x4cf067(0xd4)](_0x107bea+'/'+_0x68fa5f[_0x4cf067(0xb5)],_0x68fa5f);}}catch(_0x3b9222){this[_0x4cf067(0xa8)][_0x4cf067(0xd8)](_0x4cf067(0xc0)+_0x107bea+':',_0x3b9222),_0xf2c23e['push']({'name':_0x107bea,'error':_0x3b9222[_0x4cf067(0xf7)]});}}return{'action':_0x4cf067(0xf3),'tools':_0x540429,'failedServers':_0xf2c23e,'success':!![]};}async['addServers'](_0x11d540){const _0xa95aa0=a0_0x31d0cb;this[_0xa95aa0(0xa8)][_0xa95aa0(0xc8)]('Adding\x20'+_0x11d540[_0xa95aa0(0xfa)]+_0xa95aa0(0xae));const _0x2b6356=[],_0x7bb37e=[];for(const _0x1bd401 of _0x11d540){try{if(!_0x1bd401['name']||!_0x1bd401[_0xa95aa0(0xe0)])throw new Error(_0xa95aa0(0xce));let _0x34b033='http';_0x1bd401[_0xa95aa0(0xe0)]['startsWith']('http://')||_0x1bd401[_0xa95aa0(0xe0)][_0xa95aa0(0xe9)](_0xa95aa0(0xa7))?_0x34b033='http':_0x34b033=_0xa95aa0(0xbd),this[_0xa95aa0(0xf6)][_0xa95aa0(0xd4)](_0x1bd401['name'],{'url':_0x1bd401['url'],'type':_0x34b033}),_0x2b6356[_0xa95aa0(0xe5)](_0x1bd401[_0xa95aa0(0xb5)]);}catch(_0x229959){this['logger']['error']('Failed\x20to\x20add\x20server\x20'+_0x1bd401['name']+':',_0x229959),_0x7bb37e['push']({'name':_0x1bd401[_0xa95aa0(0xb5)],'error':_0x229959['message']});}}return await this[_0xa95aa0(0xbc)](),{'action':'add-servers','addedServers':_0x2b6356,'failedServers':_0x7bb37e,'success':_0x2b6356['length']>0x0};}async[a0_0x31d0cb(0xdb)](_0x25ea15){const _0x756e6c=a0_0x31d0cb;this['logger'][_0x756e6c(0xc8)](_0x756e6c(0xca)+_0x25ea15);if(!this[_0x756e6c(0xf6)]['has'](_0x25ea15))return{'action':_0x756e6c(0xe8),'serverName':_0x25ea15,'success':![],'error':'Server\x20\x27'+_0x25ea15+'\x27\x20does\x20not\x20exist'};if(this[_0x756e6c(0xdc)]['has'](_0x25ea15)){try{const _0x4fbf93=this[_0x756e6c(0xdc)]['get'](_0x25ea15);await _0x4fbf93[_0x756e6c(0xcc)]();}catch(_0x2918d5){this['logger']['warn'](_0x756e6c(0xea)+_0x25ea15+':',_0x2918d5);}this[_0x756e6c(0xdc)]['delete'](_0x25ea15);}return this['servers']['delete'](_0x25ea15),await this[_0x756e6c(0xbc)](),{'action':_0x756e6c(0xe8),'serverName':_0x25ea15,'success':!![]};}async[a0_0x31d0cb(0xf9)](_0x4fcab8){const _0x284767=a0_0x31d0cb;this['logger'][_0x284767(0xc8)]('Getting\x20schema\x20for\x20tool:\x20'+_0x4fcab8);const [_0x4bd664,_0x21da2b]=_0x4fcab8[_0x284767(0xa6)]('/');if(!_0x4bd664||!_0x21da2b)throw new Error(_0x284767(0xbf)+_0x4fcab8+_0x284767(0xc3));if(!this['servers'][_0x284767(0xc7)](_0x4bd664))throw new Error(_0x284767(0xd6)+_0x4bd664+_0x284767(0xb8));if(this['toolSchemas'][_0x284767(0xc7)](_0x4fcab8))return{'action':_0x284767(0xdd),'toolId':_0x4fcab8,'schema':this['toolSchemas']['get'](_0x4fcab8),'success':!![]};const _0x3c8f5a=await this['getOrCreateClient'](_0x4bd664);if(!_0x3c8f5a)throw new Error('Failed\x20to\x20connect\x20to\x20server:\x20'+_0x4bd664);const _0x3f54a3=await _0x3c8f5a[_0x284767(0xc4)](),_0x25f9e2=_0x3f54a3['find'](_0x363e7e=>_0x363e7e[_0x284767(0xb5)]===_0x21da2b);if(!_0x25f9e2)throw new Error('Tool\x20\x27'+_0x21da2b+_0x284767(0xde)+_0x4bd664+'\x27');return this[_0x284767(0xe6)]['set'](_0x4fcab8,_0x25f9e2),{'action':_0x284767(0xdd),'toolId':_0x4fcab8,'schema':_0x25f9e2,'success':!![]};}async['sendMessageToMcp'](_0x4058a1){const _0x2175a2=a0_0x31d0cb;this[_0x2175a2(0xa8)]['info'](_0x2175a2(0xb6));if(!_0x4058a1||!_0x4058a1['tool_call'])throw new Error('Invalid\x20MCP\x20message\x20format.\x20Expected\x20{\x20tool_call:\x20{\x20name,\x20arguments\x20}\x20}');const {name:_0x198172,arguments:_0x53ac03}=_0x4058a1[_0x2175a2(0xcf)];if(!_0x198172||!_0x53ac03)throw new Error('Tool\x20call\x20must\x20have\x20name\x20and\x20arguments');const [_0x4fa644,_0x3c07f9]=_0x198172[_0x2175a2(0xa6)]('/');if(!_0x4fa644||!_0x3c07f9)throw new Error(_0x2175a2(0xaa)+_0x198172+'.\x20Expected\x20format:\x20serverName/toolName');if(!this['servers']['has'](_0x4fa644))throw new Error('Server\x20\x27'+_0x4fa644+_0x2175a2(0xb8));const _0x11326a=await this['getOrCreateClient'](_0x4fa644);if(!_0x11326a)throw new Error(_0x2175a2(0xac)+_0x4fa644);const _0x20934d=await _0x11326a['callTool']({'name':_0x3c07f9,'arguments':_0x53ac03});return{'action':_0x2175a2(0xc9),'toolCall':{'name':_0x198172,'arguments':_0x53ac03},'result':_0x20934d,'success':!![]};}async['getOrCreateClient'](_0xcdcfcd){const _0x594b87=a0_0x31d0cb;if(this[_0x594b87(0xdc)][_0x594b87(0xc7)](_0xcdcfcd))return this['clients'][_0x594b87(0xef)](_0xcdcfcd);const _0x55f73a=this['servers'][_0x594b87(0xef)](_0xcdcfcd);if(!_0x55f73a)return this[_0x594b87(0xa8)][_0x594b87(0xd8)](_0x594b87(0xd6)+_0xcdcfcd+'\x27\x20not\x20found'),null;try{const _0x21989c=new Client({'name':'loxia-mcp-client','version':'1.0.0'});let _0x70e716;if(_0x55f73a[_0x594b87(0xdf)]==='http')_0x70e716=new StreamableHTTPClientTransport(_0x55f73a['url']);else{if(_0x55f73a['type']==='stdio'){const _0x1f18e7=_0x55f73a['url'][_0x594b87(0xa6)]('\x20'),_0x344c41=_0x1f18e7[0x0],_0x2ec50a=_0x1f18e7['slice'](0x1);_0x70e716=new StdioClientTransport({'command':_0x344c41,'args':_0x2ec50a});}else throw new Error(_0x594b87(0xb9)+_0x55f73a['type']);}return await _0x21989c[_0x594b87(0xba)](_0x70e716),this[_0x594b87(0xdc)]['set'](_0xcdcfcd,_0x21989c),_0x21989c;}catch(_0x2a4418){return this[_0x594b87(0xa8)]['error'](_0x594b87(0xc1)+_0xcdcfcd+'\x27:',_0x2a4418),null;}}async[a0_0x31d0cb(0xbc)](){const _0xccc45=a0_0x31d0cb;try{const _0x1cb49e=a0_0xdc9ad3['join'](this[_0xccc45(0xa4)],'servers.json'),_0x109a7d={};for(const [_0x207f06,_0x1ab5e3]of this[_0xccc45(0xf6)]['entries']()){_0x109a7d[_0x207f06]=_0x1ab5e3;}await a0_0x2bf00f['writeFile'](_0x1cb49e,JSON[_0xccc45(0xf0)](_0x109a7d,null,0x2),_0xccc45(0xcb)),this['logger']['info']('Saved\x20'+this['servers']['size']+'\x20MCP\x20servers\x20to\x20file');}catch(_0x2306b8){this['logger'][_0xccc45(0xd8)]('Failed\x20to\x20save\x20MCP\x20servers\x20to\x20file:',_0x2306b8);}}async['shutdown'](){const _0x410918=a0_0x31d0cb;this[_0x410918(0xa8)]['info']('Shutting\x20down\x20MCP\x20client\x20tool');for(const [_0x47d407,_0x45e216]of this[_0x410918(0xdc)]['entries']()){try{await _0x45e216[_0x410918(0xcc)](),this[_0x410918(0xa8)][_0x410918(0xc8)]('Disconnected\x20from\x20MCP\x20server:\x20'+_0x47d407);}catch(_0x1aba8d){this[_0x410918(0xa8)]['warn'](_0x410918(0xb0)+_0x47d407+':',_0x1aba8d);}}this[_0x410918(0xdc)][_0x410918(0xd5)]();}}