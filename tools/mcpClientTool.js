function a0_0x25d9(){const _0xea0270=['y2XPzw50CW','z2v0qxzHAwXHyMXLvg9VBhm','yxr0CMLIDxrLCW','BgvUz3rO','rxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzcb3AxrOihbHCMfTzxrLCNm6','z2v0t3jdCMvHDgvdBgLLBNq','ie1ducbZzxj2zxjZ','Bg9Nz2vY','DxjS','C2vUze1LC3nHz2vuB01JCa','C2vYDMvYrgLYzwn0B3j5','C2vYDMvYtMfTzq','z2v0','u2vYDMvYicC','CMvTB3zLlxnLCNzLCG','vg9VBcaN','jYbUB3qGzM91BMq','BwTKAxi','mZeYmZrYELnUA3a','y29UDgvUDa','zw50CMLLCW','z2v0lxrVB2WTC2nOzw1H','z2v0lwf2ywLSywjSzs1Zzxj2zxjZ','u2H1DhrPBMCGzg93BIbnq1aGy2XPzw50ihrVB2W','Dg9VBfnJAgvTyxm','nte5odqZmhHwruPNAa','rMfPBgvKihrVigfKzcbZzxj2zxiG','C2f2zvnLCNzLCNm','ie1ducbZzxj2zxjZihrVigzPBgu','u2f2zwqG','BwvZC2fNzs10BY1Ty3a','qwrKAw5Nia','rMfPBgvKihrVignYzwf0zsbnq1aGC2vYDMvYigrPCMvJDg9YEtO','ywn0Aw9U','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','jYbUB3qGzM91BMqGB24GC2vYDMvYicC','Ahr0Ca','mJCZmJu0yLf5ENv6','C2H1DgrVD24','rMfPBgvKihrVignYzwf0zsbJBgLLBNq','BwnWlxnLCNzLCNm','ndGWogjyrgHSyW','C2v0','lIbfEhbLy3rLzcbMB3jTyxq6ihnLCNzLCK5HBwuVDg9VBe5HBwu','zgvSzxrL','y29UBMvJDa','AM9PBG','Aw5MBW','C2XPy2u','vw5RBM93BIbnq1aGy2XPzw50ignVBw1HBMq6ia','rMfPBgvKihrVihnHDMuGtunqihnLCNzLCNmGDg8GzMLSztO','ChvZAa','zMLUza','DhLWzq','Dg9VBeLK','ywrKlxnLCNzLCNm','Aw5PDgLHBgL6zvnLCNzLCKrPCMvJDg9YEq','rMfPBgvKihrVigLUAxrPywXPEMuGtunqihnLCNzLCIbKAxjLy3rVCNK6','mJGZnJG3oeDhAw1zzW','nZKXmtmYAhjbEvHK','y3DK','Dg9VBf9JywXS','z2v0qxzHAwXHyMXLu2vYDMvYCW','otGXnZK4s3HJAeT2','C2vYDMvYCW','C2vYDMvYCY5QC29U','y29TBwfUzhm','Bg94AweTBwnWlwnSAwvUDa','AgfZ','ywrKu2vYDMvYCW','tM8GzgvZy3jPChrPB24','BMfTzq','rMfPBgvKihrVihbHCNnLie1ducbTzxnZywDLiePtt046','y2fSBfrVB2W','CxvLCNK','BwvZC2fNzq','z2v0vg9VBfnJAgvTyq','BgLZDfrVB2XZ','CMvTB3zLu2vYDMvY','C3bSAxq','DhjPBq','r2v0DgLUzYbHDMfPBgfIBguGtunqihnLCNzLCNm','mJe3mtG4nejKu3nNyG','zxjYB3i','z2v0rgvZy3jPChrPB24','CgfYC2u','y29Kzq','Ahr0Chm6lY8','z2v0lwf2ywLSywjSzs10B29SCW','jYbKB2vZig5VDcbLEgLZDa','C3rHCNrZv2L0Aa','ugfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNmGD2L0AcbuywDqyxjZzxi','zgLZy29UBMvJDa'];a0_0x25d9=function(){return _0xea0270;};return a0_0x25d9();}const a0_0x3949fd=a0_0x3d34;(function(_0x51fde7,_0x3915eb){const _0x5402c9=a0_0x3d34,_0x3e5ceb=_0x51fde7();while(!![]){try{const _0x5b54e0=parseInt(_0x5402c9(0xec))/0x1+parseInt(_0x5402c9(0x102))/0x2+-parseInt(_0x5402c9(0x101))/0x3+-parseInt(_0x5402c9(0xbc))/0x4+-parseInt(_0x5402c9(0xe0))/0x5+-parseInt(_0x5402c9(0x106))/0x6+parseInt(_0x5402c9(0xd9))/0x7*(parseInt(_0x5402c9(0xf0))/0x8);if(_0x5b54e0===_0x3915eb)break;else _0x3e5ceb['push'](_0x3e5ceb['shift']());}catch(_0x455a03){_0x3e5ceb['push'](_0x3e5ceb['shift']());}}}(a0_0x25d9,0xa0c86));import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';import{BaseTool}from'./baseTool.js';import{TagParser}from'../utilities/tagParser.js';import a0_0x14163d from'path';import a0_0x55080c from'fs/promises';function a0_0x3d34(_0x3ccb31,_0x234eb2){const _0x25d9ac=a0_0x25d9();return a0_0x3d34=function(_0x3d34b1,_0x13dba7){_0x3d34b1=_0x3d34b1-0xb9;let _0x1cd25d=_0x25d9ac[_0x3d34b1];if(a0_0x3d34['fCqgPJ']===undefined){var _0x52daf3=function(_0x14163d){const _0x55080c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2f636b='',_0x235283='';for(let _0xeb9d8b=0x0,_0x3edee2,_0x2e8eef,_0x3af13f=0x0;_0x2e8eef=_0x14163d['charAt'](_0x3af13f++);~_0x2e8eef&&(_0x3edee2=_0xeb9d8b%0x4?_0x3edee2*0x40+_0x2e8eef:_0x2e8eef,_0xeb9d8b++%0x4)?_0x2f636b+=String['fromCharCode'](0xff&_0x3edee2>>(-0x2*_0xeb9d8b&0x6)):0x0){_0x2e8eef=_0x55080c['indexOf'](_0x2e8eef);}for(let _0x5e0773=0x0,_0x225f23=_0x2f636b['length'];_0x5e0773<_0x225f23;_0x5e0773++){_0x235283+='%'+('00'+_0x2f636b['charCodeAt'](_0x5e0773)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x235283);};a0_0x3d34['PwQTsq']=_0x52daf3,_0x3ccb31=arguments,a0_0x3d34['fCqgPJ']=!![];}const _0x28bd0a=_0x25d9ac[0x0],_0x229669=_0x3d34b1+_0x28bd0a,_0x2ce5db=_0x3ccb31[_0x229669];return!_0x2ce5db?(_0x1cd25d=a0_0x3d34['PwQTsq'](_0x1cd25d),_0x3ccb31[_0x229669]=_0x1cd25d):_0x1cd25d=_0x2ce5db,_0x1cd25d;},a0_0x3d34(_0x3ccb31,_0x234eb2);}export class MCPClientTool extends BaseTool{constructor(_0x2f636b,_0x235283){const _0x2931a1=a0_0x3d34;super(_0x2f636b,_0x235283),this[_0x2931a1(0x107)]=new Map(),this['clients']=new Map(),this[_0x2931a1(0xdf)]=new Map(),this[_0x2931a1(0xd1)]=a0_0x14163d[_0x2931a1(0xf5)](process[_0x2931a1(0x103)](),'.loxia-state',_0x2931a1(0xef)),this['initializeServerDirectory']()['catch'](_0xeb9d8b=>{const _0x13101a=_0x2931a1;this[_0x13101a(0xce)]['error'](_0x13101a(0x100),_0xeb9d8b);});}async[a0_0x3949fd(0xff)](){const _0x59a705=a0_0x3949fd;try{await a0_0x55080c[_0x59a705(0xd8)](this['serverDirectory'],{'recursive':!![]});try{const _0x3edee2=a0_0x14163d['join'](this['serverDirectory'],_0x59a705(0x108)),_0x2e8eef=await a0_0x55080c['readFile'](_0x3edee2,'utf-8'),_0x3af13f=JSON[_0x59a705(0xbf)](_0x2e8eef);for(const [_0x5e0773,_0x225f23]of Object['entries'](_0x3af13f)){this[_0x59a705(0x107)]['set'](_0x5e0773,_0x225f23);}this[_0x59a705(0xce)]['info']('Loaded\x20'+this['servers']['size']+'\x20saved\x20MCP\x20servers');}catch(_0x6c24b3){_0x6c24b3[_0x59a705(0xc0)]!=='ENOENT'&&this[_0x59a705(0xce)]['warn']('Failed\x20to\x20load\x20saved\x20MCP\x20servers:',_0x6c24b3);}}catch(_0x1ad7e1){this['logger']['error'](_0x59a705(0xe7),_0x1ad7e1);}}[a0_0x3949fd(0xbe)](){return'\x0aMCP\x20Client\x20Tool:\x20Allows\x20you\x20to\x20interact\x20with\x20Model\x20Context\x20Protocol\x20(MCP)\x20servers\x20to\x20access\x20external\x20tools\x20and\x20resources.\x0a\x0aUsage:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[get-available-tools\x20/]\x0a\x0a[add-servers]\x0a[s\x20name=\x22server-name\x22\x20url=\x22http://server-url\x22\x20/]\x0a[/add-servers]\x0a\x0a[remove-server]\x0aserver-name\x0a[/remove-server]\x0a\x0a[get-tool-schema]\x0aserver-name/tool-name\x0a[/get-tool-schema]\x0a\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22server-name/tool-name\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22param1\x22:\x20\x22value1\x22,\x20\x22param2\x22:\x20\x22value2\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20List\x20available\x20MCP\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[/tool]\x0a\x0a2.\x20List\x20available\x20tools\x20from\x20all\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-tools\x20/]\x0a[/tool]\x0a\x0a3.\x20Add\x20a\x20new\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[add-servers]\x0a[s\x20name=\x22system-tools\x22\x20url=\x22http://localhost:3001\x22\x20/]\x0a[/add-servers]\x0a[/tool]\x0a\x0a4.\x20Remove\x20an\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[remove-server]\x0asystem-tools\x0a[/remove-server]\x0a[/tool]\x0a\x0a5.\x20Get\x20the\x20schema\x20for\x20a\x20specific\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-tool-schema]\x0asystem-tools/runCommand\x0a[/get-tool-schema]\x0a[/tool]\x0a\x0a6.\x20Call\x20an\x20MCP\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22system-tools/runCommand\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22command\x22:\x20\x22ls\x20-la\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x20\x20\x20\x20';}['parseParameters'](_0x195aaa){const _0x48b8c8=a0_0x3949fd;this['logger'][_0x48b8c8(0xf6)](_0x48b8c8(0xc5));const _0xc4eaee={'commands':[]};try{const _0x5478f9=TagParser[_0x48b8c8(0x111)](_0x195aaa,'get-available-servers');_0x5478f9[_0x48b8c8(0xca)]>0x0&&_0xc4eaee['commands'][_0x48b8c8(0xfa)]({'action':'get-available-servers'});const _0x1ea58a=TagParser['query'](_0x195aaa,'get-available-tools');_0x1ea58a[_0x48b8c8(0xca)]>0x0&&_0xc4eaee[_0x48b8c8(0x109)][_0x48b8c8(0xfa)]({'action':_0x48b8c8(0xc2)});const _0x37065f=TagParser['query'](_0x195aaa,_0x48b8c8(0xfe));for(const _0x4ccfe7 of _0x37065f){const _0x1692ec=TagParser['query'](_0x4ccfe7[_0x48b8c8(0xda)],'s'),_0xee5fc2=[];for(const _0x1a2a75 of _0x1692ec){const _0x13d147=_0x1a2a75[_0x48b8c8(0xc9)][_0x48b8c8(0x10e)],_0x3d9dd9=_0x1a2a75[_0x48b8c8(0xc9)][_0x48b8c8(0xcf)];_0x13d147&&_0x3d9dd9&&_0xee5fc2['push']({'name':_0x13d147,'url':_0x3d9dd9});}_0xee5fc2[_0x48b8c8(0xca)]>0x0&&_0xc4eaee[_0x48b8c8(0x109)][_0x48b8c8(0xfa)]({'action':'add-servers','servers':_0xee5fc2});}const _0xecbae4=TagParser[_0x48b8c8(0x111)](_0x195aaa,_0x48b8c8(0xd5));for(const _0x4e2190 of _0xecbae4){const _0x519f2e=_0x4e2190['content'][_0x48b8c8(0xba)]();_0x519f2e&&_0xc4eaee['commands'][_0x48b8c8(0xfa)]({'action':_0x48b8c8(0xd5),'serverName':_0x519f2e});}const _0x5c3185=TagParser[_0x48b8c8(0x111)](_0x195aaa,_0x48b8c8(0xdc));for(const _0x467286 of _0x5c3185){const _0x2a2e4e=_0x467286['content']['trim']();_0x2a2e4e&&_0xc4eaee[_0x48b8c8(0x109)]['push']({'action':_0x48b8c8(0xdc),'toolId':_0x2a2e4e});}const _0xafee85=TagParser['query'](_0x195aaa,_0x48b8c8(0xe5));for(const _0x43379c of _0xafee85){const _0x2af96d=_0x43379c[_0x48b8c8(0xda)]['trim']();if(_0x2af96d){let _0xa93ff7;try{_0xa93ff7=JSON[_0x48b8c8(0xbf)](_0x2af96d);}catch(_0x400fa0){this[_0x48b8c8(0xce)][_0x48b8c8(0xbd)](_0x48b8c8(0x10f),_0x400fa0);continue;}_0xc4eaee[_0x48b8c8(0x109)][_0x48b8c8(0xfa)]({'action':_0x48b8c8(0xe5),'message':_0xa93ff7});}}return _0xc4eaee;}catch(_0x1c373e){return this['logger'][_0x48b8c8(0xbd)]('Error\x20parsing\x20MCP\x20client\x20parameters:',_0x1c373e),{'commands':[]};}}async['executeWithParameters'](_0x54e283,_0x5a101a){const _0x37c47d=a0_0x3949fd;this[_0x37c47d(0xce)][_0x37c47d(0xf6)](_0x37c47d(0xcb),_0x54e283);const _0x1b6eac=[];if(!_0x54e283['commands']||_0x54e283[_0x37c47d(0x109)]['length']===0x0)throw new Error('No\x20MCP\x20client\x20commands\x20specified');for(const _0x16633a of _0x54e283['commands']){try{let _0x256d85;switch(_0x16633a['action']){case'get-available-servers':_0x256d85=await this[_0x37c47d(0x105)]();break;case'get-available-tools':_0x256d85=await this['getAvailableTools']();break;case'add-servers':_0x256d85=await this[_0x37c47d(0x10c)](_0x16633a[_0x37c47d(0x107)]);break;case'remove-server':_0x256d85=await this[_0x37c47d(0x115)](_0x16633a[_0x37c47d(0xd2)]);break;case _0x37c47d(0xdc):_0x256d85=await this['getToolSchema'](_0x16633a[_0x37c47d(0xfd)]);break;case _0x37c47d(0xe5):_0x256d85=await this['sendMessageToMcp'](_0x16633a[_0x37c47d(0x112)]);break;default:throw new Error(_0x37c47d(0xf8)+_0x16633a['action']);}_0x1b6eac['push'](_0x256d85);}catch(_0x10c481){this['logger'][_0x37c47d(0xbd)]('Error\x20executing\x20MCP\x20client\x20command\x20'+_0x16633a['action']+':',_0x10c481),_0x1b6eac['push']({'action':_0x16633a[_0x37c47d(0xe8)],'success':![],'error':_0x10c481['message']});}}return{'results':_0x1b6eac};}async['getAvailableServers'](){const _0x5dd0f7=a0_0x3949fd;this['logger'][_0x5dd0f7(0xf6)](_0x5dd0f7(0xbb));const _0x489e4e=[];for(const [_0x4fb53d,_0x1e968e]of this['servers'][_0x5dd0f7(0xdb)]()){_0x489e4e[_0x5dd0f7(0xfa)]({'name':_0x4fb53d,'url':_0x1e968e[_0x5dd0f7(0xcf)],'type':_0x1e968e[_0x5dd0f7(0xfc)]||_0x5dd0f7(0xeb)});}return{'action':_0x5dd0f7(0xdd),'servers':_0x489e4e,'success':!![]};}async[a0_0x3949fd(0xc8)](){const _0x71c95f=a0_0x3949fd;this['logger']['info']('Getting available tools from MCP servers');const _0x2aab93=[],_0x31898a=[];for(const [_0x563090,_0x2f5b12]of this['servers']['entries']()){try{const _0x1a9f31=await this[_0x71c95f(0xcc)](_0x563090);if(!_0x1a9f31){_0x31898a[_0x71c95f(0xfa)]({'name':_0x563090,'error':_0x71c95f(0xee)});continue;}const _0x107ef3=await _0x1a9f31[_0x71c95f(0x114)]();for(const _0x24545d of _0x107ef3){_0x2aab93['push']({'name':_0x563090+'/'+_0x24545d['name'],'description':_0x24545d['description']||_0x71c95f(0x10d),'server':_0x563090}),this['toolSchemas'][_0x71c95f(0xf1)](_0x563090+'/'+_0x24545d['name'],_0x24545d);}}catch(_0x517040){this[_0x71c95f(0xce)]['error']('Failed\x20to\x20get\x20tools\x20from\x20server\x20'+_0x563090+':',_0x517040),_0x31898a[_0x71c95f(0xfa)]({'name':_0x563090,'error':_0x517040[_0x71c95f(0x112)]});}}return{'action':_0x71c95f(0xc2),'tools':_0x2aab93,'failedServers':_0x31898a,'success':!![]};}async['addServers'](_0x5ea759){const _0x6e3f0e=a0_0x3949fd;this[_0x6e3f0e(0xce)]['info'](_0x6e3f0e(0xe6)+_0x5ea759[_0x6e3f0e(0xca)]+_0x6e3f0e(0xcd));const _0x9b831=[],_0x135e3f=[];for(const _0x15f877 of _0x5ea759){try{if(!_0x15f877[_0x6e3f0e(0x10e)]||!_0x15f877['url'])throw new Error('Server\x20name\x20and\x20URL\x20are\x20required');let _0x3b60d5=_0x6e3f0e(0xeb);_0x15f877['url'][_0x6e3f0e(0xc4)]('http://')||_0x15f877['url']['startsWith'](_0x6e3f0e(0xc1))?_0x3b60d5=_0x6e3f0e(0xeb):_0x3b60d5='stdio',this[_0x6e3f0e(0x107)]['set'](_0x15f877['name'],{'url':_0x15f877[_0x6e3f0e(0xcf)],'type':_0x3b60d5}),_0x9b831['push'](_0x15f877[_0x6e3f0e(0x10e)]);}catch(_0x39f7cf){this[_0x6e3f0e(0xce)]['error'](_0x6e3f0e(0xe1)+_0x15f877[_0x6e3f0e(0x10e)]+':',_0x39f7cf),_0x135e3f['push']({'name':_0x15f877['name'],'error':_0x39f7cf['message']});}}return await this[_0x6e3f0e(0xe2)](),{'action':'add-servers','addedServers':_0x9b831,'failedServers':_0x135e3f,'success':_0x9b831[_0x6e3f0e(0xca)]>0x0};}async[a0_0x3949fd(0x115)](_0xda0054){const _0x169c25=a0_0x3949fd;this['logger'][_0x169c25(0xf6)]('Removing\x20MCP\x20server:\x20'+_0xda0054);if(!this[_0x169c25(0x107)]['has'](_0xda0054))return{'action':'remove-server','serverName':_0xda0054,'success':![],'error':_0x169c25(0xd4)+_0xda0054+'\x27\x20does\x20not\x20exist'};if(this['clients'][_0x169c25(0x10b)](_0xda0054)){try{const _0x2f3b75=this[_0x169c25(0xc7)][_0x169c25(0xd3)](_0xda0054);await _0x2f3b75[_0x169c25(0xc6)]();}catch(_0x59971e){this[_0x169c25(0xce)]['warn']('Error\x20disconnecting\x20from\x20server\x20'+_0xda0054+':',_0x59971e);}this[_0x169c25(0xc7)][_0x169c25(0xf3)](_0xda0054);}return this['servers'][_0x169c25(0xf3)](_0xda0054),await this['saveServers'](),{'action':_0x169c25(0xd5),'serverName':_0xda0054,'success':!![]};}async[a0_0x3949fd(0x113)](_0x482c66){const _0x398625=a0_0x3949fd;this[_0x398625(0xce)][_0x398625(0xf6)]('Getting\x20schema\x20for\x20tool:\x20'+_0x482c66);const [_0x52fc95,_0x10d83d]=_0x482c66[_0x398625(0xb9)]('/');if(!_0x52fc95||!_0x10d83d)throw new Error('Invalid\x20tool\x20ID\x20format:\x20'+_0x482c66+_0x398625(0xf2));if(!this['servers'][_0x398625(0x10b)](_0x52fc95))throw new Error(_0x398625(0xd4)+_0x52fc95+_0x398625(0xc3));if(this[_0x398625(0xdf)][_0x398625(0x10b)](_0x482c66))return{'action':'get-tool-schema','toolId':_0x482c66,'schema':this['toolSchemas']['get'](_0x482c66),'success':!![]};const _0x4f4198=await this[_0x398625(0xcc)](_0x52fc95);if(!_0x4f4198)throw new Error(_0x398625(0xe9)+_0x52fc95);const _0x186f08=await _0x4f4198['listTools'](),_0x26c177=_0x186f08[_0x398625(0xfb)](_0x1045fd=>_0x1045fd[_0x398625(0x10e)]===_0x10d83d);if(!_0x26c177)throw new Error(_0x398625(0xd6)+_0x10d83d+_0x398625(0xea)+_0x52fc95+'\x27');return this[_0x398625(0xdf)][_0x398625(0xf1)](_0x482c66,_0x26c177),{'action':'get-tool-schema','toolId':_0x482c66,'schema':_0x26c177,'success':!![]};}async[a0_0x3949fd(0xd0)](_0x1c9ce9){const _0x257204=a0_0x3949fd;this[_0x257204(0xce)]['info']('Sending\x20message\x20to\x20MCP\x20server');if(!_0x1c9ce9||!_0x1c9ce9[_0x257204(0x104)])throw new Error('Invalid\x20MCP\x20message\x20format.\x20Expected\x20{\x20tool_call:\x20{\x20name,\x20arguments\x20}\x20}');const {name:_0x4ac1bd,arguments:_0x27f590}=_0x1c9ce9['tool_call'];if(!_0x4ac1bd||!_0x27f590)throw new Error('Tool\x20call\x20must\x20have\x20name\x20and\x20arguments');const [_0x1b4eec,_0x50f8a1]=_0x4ac1bd[_0x257204(0xb9)]('/');if(!_0x1b4eec||!_0x50f8a1)throw new Error('Invalid\x20tool\x20name\x20format:\x20'+_0x4ac1bd+_0x257204(0xf2));if(!this[_0x257204(0x107)][_0x257204(0x10b)](_0x1b4eec))throw new Error('Server\x20\x27'+_0x1b4eec+_0x257204(0xc3));const _0x59ce69=await this[_0x257204(0xcc)](_0x1b4eec);if(!_0x59ce69)throw new Error(_0x257204(0xe9)+_0x1b4eec);const _0x5af677=await _0x59ce69[_0x257204(0x110)]({'name':_0x50f8a1,'arguments':_0x27f590});return{'action':'message-to-mcp','toolCall':{'name':_0x4ac1bd,'arguments':_0x27f590},'result':_0x5af677,'success':!![]};}async[a0_0x3949fd(0xcc)](_0x8adb1){const _0x40a7a5=a0_0x3949fd;if(this['clients']['has'](_0x8adb1))return this[_0x40a7a5(0xc7)][_0x40a7a5(0xd3)](_0x8adb1);const _0x296c23=this['servers'][_0x40a7a5(0xd3)](_0x8adb1);if(!_0x296c23)return this['logger']['error'](_0x40a7a5(0xd4)+_0x8adb1+_0x40a7a5(0xd7)),null;try{const _0x1822b6=new Client({'name':_0x40a7a5(0x10a),'version':'1.0.0'});let _0x533530;if(_0x296c23[_0x40a7a5(0xfc)]==='http')_0x533530=new StreamableHTTPClientTransport(_0x296c23[_0x40a7a5(0xcf)]);else{if(_0x296c23[_0x40a7a5(0xfc)]==='stdio'){const _0x3d1e31=_0x296c23[_0x40a7a5(0xcf)]['split']('\x20'),_0x236d5c=_0x3d1e31[0x0],_0x326750=_0x3d1e31[_0x40a7a5(0xf7)](0x1);_0x533530=new StdioClientTransport({'command':_0x236d5c,'args':_0x326750});}else throw new Error('Unsupported\x20server\x20type:\x20'+_0x296c23[_0x40a7a5(0xfc)]);}return await _0x1822b6[_0x40a7a5(0xf4)](_0x533530),this['clients'][_0x40a7a5(0xf1)](_0x8adb1,_0x1822b6),_0x1822b6;}catch(_0x33c9f9){return this[_0x40a7a5(0xce)]['error']('Failed\x20to\x20create\x20MCP\x20client\x20for\x20server\x20\x27'+_0x8adb1+'\x27:',_0x33c9f9),null;}}async[a0_0x3949fd(0xe2)](){const _0x17f7fa=a0_0x3949fd;try{const _0x35f34d=a0_0x14163d['join'](this[_0x17f7fa(0xd1)],_0x17f7fa(0x108)),_0x31127b={};for(const [_0x2343bd,_0x3f90c2]of this[_0x17f7fa(0x107)][_0x17f7fa(0xdb)]()){_0x31127b[_0x2343bd]=_0x3f90c2;}await a0_0x55080c['writeFile'](_0x35f34d,JSON['stringify'](_0x31127b,null,0x2),'utf-8'),this['logger']['info'](_0x17f7fa(0xe4)+this['servers']['size']+_0x17f7fa(0xe3));}catch(_0xe280dd){this[_0x17f7fa(0xce)]['error'](_0x17f7fa(0xf9),_0xe280dd);}}async[a0_0x3949fd(0xed)](){const _0x126564=a0_0x3949fd;this['logger']['info'](_0x126564(0xde));for(const [_0x2417cd,_0x5475e7]of this['clients']['entries']()){try{await _0x5475e7[_0x126564(0xc6)](),this[_0x126564(0xce)]['info']('Disconnected\x20from\x20MCP\x20server:\x20'+_0x2417cd);}catch(_0x23fc40){this['logger']['warn']('Error\x20disconnecting\x20from\x20MCP\x20server\x20'+_0x2417cd+':',_0x23fc40);}}this['clients']['clear']();}}