function a0_0x29ad(_0x2d819a,_0x2e1888){const _0x1b5f1f=a0_0x1b5f();return a0_0x29ad=function(_0x29ad9d,_0x5c11af){_0x29ad9d=_0x29ad9d-0x154;let _0x3fc7ea=_0x1b5f1f[_0x29ad9d];if(a0_0x29ad['XChDMA']===undefined){var _0x53b355=function(_0x27d1fd){const _0x188223='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x585ace='',_0x2219c6='';for(let _0x114b9c=0x0,_0x3dd099,_0x2d2f80,_0x3255e2=0x0;_0x2d2f80=_0x27d1fd['charAt'](_0x3255e2++);~_0x2d2f80&&(_0x3dd099=_0x114b9c%0x4?_0x3dd099*0x40+_0x2d2f80:_0x2d2f80,_0x114b9c++%0x4)?_0x585ace+=String['fromCharCode'](0xff&_0x3dd099>>(-0x2*_0x114b9c&0x6)):0x0){_0x2d2f80=_0x188223['indexOf'](_0x2d2f80);}for(let _0x2759bd=0x0,_0x2b58bf=_0x585ace['length'];_0x2759bd<_0x2b58bf;_0x2759bd++){_0x2219c6+='%'+('00'+_0x585ace['charCodeAt'](_0x2759bd)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2219c6);};a0_0x29ad['LvHFWt']=_0x53b355,_0x2d819a=arguments,a0_0x29ad['XChDMA']=!![];}const _0xa3eba8=_0x1b5f1f[0x0],_0x40d190=_0x29ad9d+_0xa3eba8,_0x4ac913=_0x2d819a[_0x40d190];return!_0x4ac913?(_0x3fc7ea=a0_0x29ad['LvHFWt'](_0x3fc7ea),_0x2d819a[_0x40d190]=_0x3fc7ea):_0x3fc7ea=_0x4ac913,_0x3fc7ea;},a0_0x29ad(_0x2d819a,_0x2e1888);}const a0_0x2fcaa7=a0_0x29ad;(function(_0x26618f,_0x16a92e){const _0x5641a2=a0_0x29ad,_0x4ed002=_0x26618f();while(!![]){try{const _0x5d19c6=parseInt(_0x5641a2(0x19a))/0x1*(parseInt(_0x5641a2(0x171))/0x2)+-parseInt(_0x5641a2(0x172))/0x3+parseInt(_0x5641a2(0x18f))/0x4+-parseInt(_0x5641a2(0x189))/0x5*(-parseInt(_0x5641a2(0x185))/0x6)+-parseInt(_0x5641a2(0x190))/0x7*(parseInt(_0x5641a2(0x198))/0x8)+-parseInt(_0x5641a2(0x16c))/0x9+parseInt(_0x5641a2(0x186))/0xa;if(_0x5d19c6===_0x16a92e)break;else _0x4ed002['push'](_0x4ed002['shift']());}catch(_0xdb9229){_0x4ed002['push'](_0x4ed002['shift']());}}}(a0_0x1b5f,0xdb2e8));import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';import{BaseTool}from'./baseTool.js';import{TagParser}from'../utilities/tagParser.js';function a0_0x1b5f(){const _0x2bbe28=['DxjS','Bg9Nz2vY','AgfZ','C3bSAxq','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','C2vYDMvYrgLYzwn0B3j5','z2v0lwf2ywLSywjSzs10B29SCW','z2v0lxrVB2WTC2nOzw1H','u2vYDMvYig5HBwuGyw5KifvstcbHCMuGCMvXDwLYzwq','tM8GtunqignSAwvUDcbJB21Tyw5KCYbZCgvJAwzPzwq','BwnWlxnLCNzLCNm','C2L6zq','DhjPBq','sw52ywXPzcbnq1aGBwvZC2fNzsbMB3jTyxqUiev4CgvJDgvKihSGDg9VBf9JywXSoIb7ig5HBwuSigfYz3vTzw50CYb9ih0','AM9PBG','BwvZC2fNzq','rMfPBgvKihrVihbHCNnLie1ducbTzxnZywDLiePtt046','Aw5MBW','Ahr0Ca','zgvSzxrL','qwrKAw5Nia','CgfYC2u','ie1ducbZzxj2zxjZihrVigzPBgu','rMfPBgvKihrVignYzwf0zsbnq1aGy2XPzw50igzVCIbZzxj2zxiGjW','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','C2vYDMvYCY5QC29U','z2v0rgvZy3jPChrPB24','z2v0qxzHAwXHyMXLvg9VBhm','zxjYB3i','lIbfEhbLy3rLzcbMB3jTyxq6ihnLCNzLCK5HBwuVDg9VBe5HBwu','rMfPBgvKihrVigLUAxrPywXPEMuGtunqihnLCNzLCIbKAxjLy3rVCNK6','rxjYB3iGzxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzca','otmYmdqZnKTPyw9ewa','rMfPBgvKihrVigDLDcb0B29SCYbMCM9TihnLCNzLCIa','CxvLCNK','C3rHCNrZv2L0Aa','Ahr0Chm6lY8','mJm2nJy4t0X5r3Pr','nJm2mZaZBhrpC0Hb','rxjYB3iGCgfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNm6','rxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzcb3AxrOihbHCMfTzxrLCNm6','BwvZC2fNzs10BY1Ty3a','y29TBwfUzhm','Ahr0CdOVlW','zw50CMLLCW','y29UDgvUDa','C2XPy2u','BgLZDfrVB2XZ','C2vYDMvYCW','rgLZy29UBMvJDgvKigzYB20GtunqihnLCNzLCJOG','ywrKlxnLCNzLCNm','C2vUze1LC3nHz2vuB01JCa','vg9VBcbJywXSig11C3qGAgf2zsbUyw1LigfUzcbHCMD1BwvUDhm','ywn0Aw9U','r2v0DgLUzYbHDMfPBgfIBguGtunqihnLCNzLCNm','y2XPzw50CW','y3DK','odiYA2XhrurK','mJK4mZGYmgjLC1nMCG','rMfPBgvKihrVigfKzcbZzxj2zxiG','z2v0lwf2ywLSywjSzs1Zzxj2zxjZ','nde5ntvOtLPPA20','ChvZAa','C2H1DgrVD24','C2v0','z2v0','Aw5PDgLHBgL6zvnLCNzLCKrPCMvJDg9YEq','mJG3ndu0ofnkrKT1sa','mJyZmJGWnxreq1LeqW','z2v0vg9VBfnJAgvTyq','cK1ducbdBgLLBNqGvg9VBdOGqwXSB3DZihLVDsb0BYbPBNrLCMfJDcb3AxrOie1VzgvSienVBNrLEhqGuhjVDg9JB2WGke1ducKGC2vYDMvYCYb0BYbHy2nLC3mGzxH0zxjUywWGDg9VBhmGyw5KihjLC291CMnLCY4kcLvZywDLoGPBDg9VBcbPzd0IBwnWlwnSAwvUDcjDcLTNzxqTyxzHAwXHyMXLlxnLCNzLCNmGl10kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kcLTHzgqTC2vYDMvYC10kw3mGBMfTzt0IC2vYDMvYlw5HBwuIihvYBd0IAhr0CdOVl3nLCNzLCI11CMWIic9DcLSVywrKlxnLCNzLCNnDcGPBCMvTB3zLlxnLCNzLCL0kC2vYDMvYlw5HBwukwY9Yzw1VDMuTC2vYDMvYxqOkw2DLDc10B29SlxnJAgvTyv0kC2vYDMvYlw5HBwuVDg9VBc1Uyw1LcLSVz2v0lxrVB2WTC2nOzw1HxqOkw21LC3nHz2uTDg8TBwnWxqP7cIaGiNrVB2XFy2fSBci6ihSkicaGicjUyw1LiJOGiNnLCNzLCI1Uyw1Ll3rVB2WTBMfTzsiScIaGicaIyxjNDw1LBNrZiJOGEYaICgfYyw0XiJOGiNzHBhvLmsiSicjWyxjHBtiIoIaIDMfSDwuYiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kcKv4yw1WBgvZoGOXlIbmAxn0igf2ywLSywjSzsbnq1aGC2vYDMvYCZOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lwf2ywLSywjSzs1Zzxj2zxjZic9DcLSVDg9VBf0kcJiUieXPC3qGyxzHAwXHyMXLihrVB2XZigzYB20GywXSihnLCNzLCNm6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kwY90B29SxqOkmY4GqwrKigeGBMv3ie1ducbZzxj2zxi6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2fKzc1Zzxj2zxjZxqPBCYbUyw1LpsjZExn0zw0TDg9VBhmIihvYBd0IAhr0CdOVl2XVy2fSAg9ZDdOZmdaXiIaVxqPBl2fKzc1Zzxj2zxjZxqPBl3rVB2XDcGO0lIbszw1VDMuGyw4GtunqihnLCNzLCJOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBCMvTB3zLlxnLCNzLCL0kC3LZDgvTlxrVB2XZcLSVCMvTB3zLlxnLCNzLCL0kwY90B29SxqOkns4Gr2v0ihrOzsbZy2HLBweGzM9YigeGC3bLy2LMAwmGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lxrVB2WTC2nOzw1HxqPZExn0zw0TDg9VBhmVCNvUq29TBwfUzaPBl2DLDc10B29SlxnJAgvTyv0kwY90B29SxqOknI4Gq2fSBcbHBIbnq1aGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBBwvZC2fNzs10BY1Ty3bDcNSkicaIDg9VBf9JywXSiJOGEWOGicaGiM5HBwuIoIaIC3LZDgvTlxrVB2XZl3j1BKnVBw1HBMqIlaOGicaGiMfYz3vTzw50CYi6ihSGiMnVBw1HBMqIoIaIBhmGlwXHiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kicaGia','zgLZy29UBMvJDa','C2f2zvnLCNzLCNm','D2fYBG','Dg9VBfnJAgvTyxm','C3rKAw8','ohLlzLPMwq','CMvTB3zLu2vYDMvY','m0TYDvHJBa','BMfTzq','CMvTB3zLlxnLCNzLCG','u2f2zwqG','BgvUz3rO','BwTKAxi','DxrMltG','u2vYDMvYicC','jYbKB2vZig5VDcbLEgLZDa','DhLWzq','CMvHzezPBgu'];a0_0x1b5f=function(){return _0x2bbe28;};return a0_0x1b5f();}import a0_0x27d1fd from'path';import a0_0x188223 from'fs/promises';export class MCPClientTool extends BaseTool{constructor(_0x585ace,_0x2219c6){const _0x2303a8=a0_0x29ad;super(_0x585ace,_0x2219c6),this[_0x2303a8(0x17c)]=new Map(),this[_0x2303a8(0x183)]=new Map(),this['toolSchemas']=new Map(),this[_0x2303a8(0x1aa)]=a0_0x27d1fd[_0x2303a8(0x15a)](process[_0x2303a8(0x184)](),'.loxia-state',_0x2303a8(0x156)),this[_0x2303a8(0x18e)]()['catch'](_0x114b9c=>{const _0x43f400=_0x2303a8;this['logger'][_0x43f400(0x168)](_0x43f400(0x16a),_0x114b9c);});}async[a0_0x2fcaa7(0x18e)](){const _0x11b170=a0_0x2fcaa7;try{await a0_0x188223[_0x11b170(0x19f)](this['serverDirectory'],{'recursive':!![]});try{const _0x3dd099=a0_0x27d1fd['join'](this[_0x11b170(0x1aa)],_0x11b170(0x165)),_0x2d2f80=await a0_0x188223[_0x11b170(0x1a4)](_0x3dd099,_0x11b170(0x1a0)),_0x3255e2=JSON[_0x11b170(0x161)](_0x2d2f80);for(const [_0x2759bd,_0x2b58bf]of Object[_0x11b170(0x178)](_0x3255e2)){this[_0x11b170(0x17c)][_0x11b170(0x18c)](_0x2759bd,_0x2b58bf);}this[_0x11b170(0x1a6)]['info']('Loaded\x20'+this['servers'][_0x11b170(0x157)]+'\x20saved\x20MCP\x20servers');}catch(_0x3a386a){_0x3a386a['code']!=='ENOENT'&&this['logger']['warn']('Failed\x20to\x20load\x20saved\x20MCP\x20servers:',_0x3a386a);}}catch(_0x3032b3){this[_0x11b170(0x1a6)][_0x11b170(0x168)]('Failed\x20to\x20create\x20MCP\x20server\x20directory:',_0x3032b3);}}[a0_0x2fcaa7(0x166)](){const _0x304cd1=a0_0x2fcaa7;return _0x304cd1(0x192);}['parseParameters'](_0x353ec6){const _0x53b246=a0_0x2fcaa7;this['logger'][_0x53b246(0x15d)]('Parsing\x20MCP\x20client\x20parameters\x20with\x20TagParser');const _0x11fe7c={'commands':[]};try{const _0x9282a9=TagParser['query'](_0x353ec6,'get-available-servers');_0x9282a9[_0x53b246(0x19e)]>0x0&&_0x11fe7c['commands']['push']({'action':_0x53b246(0x188)});const _0x353735=TagParser['query'](_0x353ec6,'get-available-tools');_0x353735['length']>0x0&&_0x11fe7c[_0x53b246(0x176)]['push']({'action':'get-available-tools'});const _0x56f844=TagParser[_0x53b246(0x16e)](_0x353ec6,_0x53b246(0x17e));for(const _0x282d80 of _0x56f844){const _0x21608a=TagParser[_0x53b246(0x16e)](_0x282d80['content'],'s'),_0x3ea742=[];for(const _0x25364c of _0x21608a){const _0x4d0eaf=_0x25364c['attributes'][_0x53b246(0x19b)],_0xcba26a=_0x25364c['attributes']['url'];_0x4d0eaf&&_0xcba26a&&_0x3ea742['push']({'name':_0x4d0eaf,'url':_0xcba26a});}_0x3ea742['length']>0x0&&_0x11fe7c[_0x53b246(0x176)][_0x53b246(0x18a)]({'action':'add-servers','servers':_0x3ea742});}const _0x13343c=TagParser[_0x53b246(0x16e)](_0x353ec6,'remove-server');for(const _0xe4cb7 of _0x13343c){const _0x2a28ab=_0xe4cb7['content'][_0x53b246(0x158)]();_0x2a28ab&&_0x11fe7c['commands']['push']({'action':'remove-server','serverName':_0x2a28ab});}const _0x115328=TagParser['query'](_0x353ec6,'get-tool-schema');for(const _0x461d68 of _0x115328){const _0x57c6ed=_0x461d68['content'][_0x53b246(0x158)]();_0x57c6ed&&_0x11fe7c['commands'][_0x53b246(0x18a)]({'action':'get-tool-schema','toolId':_0x57c6ed});}const _0x2f3064=TagParser['query'](_0x353ec6,_0x53b246(0x175));for(const _0x44785f of _0x2f3064){const _0x43b65b=_0x44785f[_0x53b246(0x179)]['trim']();if(_0x43b65b){let _0x4d5e3d;try{_0x4d5e3d=JSON[_0x53b246(0x161)](_0x43b65b);}catch(_0x1284ac){this['logger']['error'](_0x53b246(0x15c),_0x1284ac);continue;}_0x11fe7c[_0x53b246(0x176)][_0x53b246(0x18a)]({'action':_0x53b246(0x175),'message':_0x4d5e3d});}}return _0x11fe7c;}catch(_0x31c8fd){return this['logger'][_0x53b246(0x168)](_0x53b246(0x173),_0x31c8fd),{'commands':[]};}}async[a0_0x2fcaa7(0x1a9)](_0x3caa65,_0x10e29d){const _0x51bc4a=a0_0x2fcaa7;this[_0x51bc4a(0x1a6)]['info'](_0x51bc4a(0x174),_0x3caa65);const _0x3763c8=[];if(!_0x3caa65[_0x51bc4a(0x176)]||_0x3caa65[_0x51bc4a(0x176)][_0x51bc4a(0x19e)]===0x0)throw new Error(_0x51bc4a(0x155));for(const _0x19f615 of _0x3caa65['commands']){try{let _0x439923;switch(_0x19f615[_0x51bc4a(0x181)]){case'get-available-servers':_0x439923=await this['getAvailableServers']();break;case _0x51bc4a(0x1ab):_0x439923=await this[_0x51bc4a(0x167)]();break;case _0x51bc4a(0x17e):_0x439923=await this['addServers'](_0x19f615['servers']);break;case _0x51bc4a(0x19c):_0x439923=await this['removeServer'](_0x19f615['serverName']);break;case _0x51bc4a(0x1ac):_0x439923=await this[_0x51bc4a(0x191)](_0x19f615['toolId']);break;case'message-to-mcp':_0x439923=await this[_0x51bc4a(0x17f)](_0x19f615[_0x51bc4a(0x15b)]);break;default:throw new Error('Unknown\x20MCP\x20client\x20command:\x20'+_0x19f615[_0x51bc4a(0x181)]);}_0x3763c8['push'](_0x439923);}catch(_0x381e03){this['logger'][_0x51bc4a(0x168)](_0x51bc4a(0x16b)+_0x19f615['action']+':',_0x381e03),_0x3763c8[_0x51bc4a(0x18a)]({'action':_0x19f615['action'],'success':![],'error':_0x381e03['message']});}}return{'results':_0x3763c8};}async['getAvailableServers'](){const _0x4fb4ea=a0_0x2fcaa7;this[_0x4fb4ea(0x1a6)][_0x4fb4ea(0x15d)](_0x4fb4ea(0x182));const _0x4287d8=[];for(const [_0x1c40f0,_0x57f535]of this[_0x4fb4ea(0x17c)][_0x4fb4ea(0x178)]()){_0x4287d8[_0x4fb4ea(0x18a)]({'name':_0x1c40f0,'url':_0x57f535[_0x4fb4ea(0x1a5)],'type':_0x57f535['type']||'http'});}return{'action':'get-available-servers','servers':_0x4287d8,'success':!![]};}async[a0_0x2fcaa7(0x167)](){const _0x2a1b7b=a0_0x2fcaa7;this[_0x2a1b7b(0x1a6)]['info']('Getting available tools from MCP servers');const _0x2b0bdf=[],_0x3f9c2c=[];for(const [_0xf8b216,_0xddce1a]of this[_0x2a1b7b(0x17c)][_0x2a1b7b(0x178)]()){try{const _0x2c05a5=await this['getOrCreateClient'](_0xf8b216);if(!_0x2c05a5){_0x3f9c2c[_0x2a1b7b(0x18a)]({'name':_0xf8b216,'error':'Failed\x20to\x20create\x20client'});continue;}const _0x5307a0=await _0x2c05a5[_0x2a1b7b(0x17b)]();for(const _0x40277b of _0x5307a0){_0x2b0bdf['push']({'name':_0xf8b216+'/'+_0x40277b[_0x2a1b7b(0x19b)],'description':_0x40277b['description']||'No\x20description','server':_0xf8b216}),this[_0x2a1b7b(0x196)][_0x2a1b7b(0x18c)](_0xf8b216+'/'+_0x40277b[_0x2a1b7b(0x19b)],_0x40277b);}}catch(_0x3f5c51){this[_0x2a1b7b(0x1a6)]['error'](_0x2a1b7b(0x16d)+_0xf8b216+':',_0x3f5c51),_0x3f9c2c['push']({'name':_0xf8b216,'error':_0x3f5c51['message']});}}return{'action':_0x2a1b7b(0x1ab),'tools':_0x2b0bdf,'failedServers':_0x3f9c2c,'success':!![]};}async['addServers'](_0x5f56bd){const _0x16ea9c=a0_0x2fcaa7;this[_0x16ea9c(0x1a6)][_0x16ea9c(0x15d)](_0x16ea9c(0x160)+_0x5f56bd[_0x16ea9c(0x19e)]+'\x20MCP\x20servers');const _0x489152=[],_0x1eef6a=[];for(const _0x53dbbb of _0x5f56bd){try{if(!_0x53dbbb[_0x16ea9c(0x19b)]||!_0x53dbbb['url'])throw new Error(_0x16ea9c(0x154));let _0x2ae97d=_0x16ea9c(0x15e);_0x53dbbb['url'][_0x16ea9c(0x16f)](_0x16ea9c(0x177))||_0x53dbbb['url'][_0x16ea9c(0x16f)](_0x16ea9c(0x170))?_0x2ae97d='http':_0x2ae97d='stdio',this[_0x16ea9c(0x17c)]['set'](_0x53dbbb[_0x16ea9c(0x19b)],{'url':_0x53dbbb[_0x16ea9c(0x1a5)],'type':_0x2ae97d}),_0x489152[_0x16ea9c(0x18a)](_0x53dbbb['name']);}catch(_0x18b44a){this['logger']['error'](_0x16ea9c(0x187)+_0x53dbbb['name']+':',_0x18b44a),_0x1eef6a[_0x16ea9c(0x18a)]({'name':_0x53dbbb[_0x16ea9c(0x19b)],'error':_0x18b44a[_0x16ea9c(0x15b)]});}}return await this['saveServers'](),{'action':'add-servers','addedServers':_0x489152,'failedServers':_0x1eef6a,'success':_0x489152[_0x16ea9c(0x19e)]>0x0};}async[a0_0x2fcaa7(0x199)](_0x3620f8){const _0x31bba8=a0_0x2fcaa7;this['logger'][_0x31bba8(0x15d)]('Removing\x20MCP\x20server:\x20'+_0x3620f8);if(!this[_0x31bba8(0x17c)][_0x31bba8(0x1a7)](_0x3620f8))return{'action':'remove-server','serverName':_0x3620f8,'success':![],'error':_0x31bba8(0x1a1)+_0x3620f8+_0x31bba8(0x1a2)};if(this['clients'][_0x31bba8(0x1a7)](_0x3620f8)){try{const _0x36c674=this['clients']['get'](_0x3620f8);await _0x36c674['disconnect']();}catch(_0xcae799){this['logger'][_0x31bba8(0x195)]('Error\x20disconnecting\x20from\x20server\x20'+_0x3620f8+':',_0xcae799);}this['clients'][_0x31bba8(0x15f)](_0x3620f8);}return this[_0x31bba8(0x17c)]['delete'](_0x3620f8),await this[_0x31bba8(0x194)](),{'action':'remove-server','serverName':_0x3620f8,'success':!![]};}async['getToolSchema'](_0x5d5d91){const _0x560c2f=a0_0x2fcaa7;this['logger']['info']('Getting\x20schema\x20for\x20tool:\x20'+_0x5d5d91);const [_0x3628e8,_0x5d9c90]=_0x5d5d91['split']('/');if(!_0x3628e8||!_0x5d9c90)throw new Error('Invalid\x20tool\x20ID\x20format:\x20'+_0x5d5d91+'.\x20Expected\x20format:\x20serverName/toolName');if(!this[_0x560c2f(0x17c)][_0x560c2f(0x1a7)](_0x3628e8))throw new Error(_0x560c2f(0x1a1)+_0x3628e8+_0x560c2f(0x1a2));if(this['toolSchemas'][_0x560c2f(0x1a7)](_0x5d5d91))return{'action':'get-tool-schema','toolId':_0x5d5d91,'schema':this[_0x560c2f(0x196)][_0x560c2f(0x18d)](_0x5d5d91),'success':!![]};const _0x2a995=await this['getOrCreateClient'](_0x3628e8);if(!_0x2a995)throw new Error('Failed\x20to\x20connect\x20to\x20server:\x20'+_0x3628e8);const _0x2e261a=await _0x2a995[_0x560c2f(0x17b)](),_0xc3caea=_0x2e261a['find'](_0x5540f4=>_0x5540f4['name']===_0x5d9c90);if(!_0xc3caea)throw new Error('Tool\x20\x27'+_0x5d9c90+'\x27\x20not\x20found\x20on\x20server\x20\x27'+_0x3628e8+'\x27');return this['toolSchemas'][_0x560c2f(0x18c)](_0x5d5d91,_0xc3caea),{'action':_0x560c2f(0x1ac),'toolId':_0x5d5d91,'schema':_0xc3caea,'success':!![]};}async[a0_0x2fcaa7(0x17f)](_0x1bd148){const _0x34b859=a0_0x2fcaa7;this[_0x34b859(0x1a6)][_0x34b859(0x15d)]('Sending\x20message\x20to\x20MCP\x20server');if(!_0x1bd148||!_0x1bd148['tool_call'])throw new Error(_0x34b859(0x159));const {name:_0x5c49e6,arguments:_0x19b10a}=_0x1bd148['tool_call'];if(!_0x5c49e6||!_0x19b10a)throw new Error(_0x34b859(0x180));const [_0x391a58,_0x5789dc]=_0x5c49e6['split']('/');if(!_0x391a58||!_0x5789dc)throw new Error('Invalid\x20tool\x20name\x20format:\x20'+_0x5c49e6+_0x34b859(0x169));if(!this[_0x34b859(0x17c)]['has'](_0x391a58))throw new Error('Server\x20\x27'+_0x391a58+'\x27\x20does\x20not\x20exist');const _0x182fe1=await this['getOrCreateClient'](_0x391a58);if(!_0x182fe1)throw new Error(_0x34b859(0x164)+_0x391a58);const _0x8ad5fd=await _0x182fe1['callTool']({'name':_0x5789dc,'arguments':_0x19b10a});return{'action':_0x34b859(0x175),'toolCall':{'name':_0x5c49e6,'arguments':_0x19b10a},'result':_0x8ad5fd,'success':!![]};}async['getOrCreateClient'](_0x5b1467){const _0x84afb2=a0_0x2fcaa7;if(this[_0x84afb2(0x183)][_0x84afb2(0x1a7)](_0x5b1467))return this[_0x84afb2(0x183)]['get'](_0x5b1467);const _0x40c3d0=this['servers']['get'](_0x5b1467);if(!_0x40c3d0)return this[_0x84afb2(0x1a6)][_0x84afb2(0x168)]('Server\x20\x27'+_0x5b1467+'\x27\x20not\x20found'),null;try{const _0x5b7cc2=new Client({'name':'loxia-mcp-client','version':'1.0.0'});let _0x27ac47;if(_0x40c3d0[_0x84afb2(0x1a3)]==='http')_0x27ac47=new StreamableHTTPClientTransport(_0x40c3d0[_0x84afb2(0x1a5)]);else{if(_0x40c3d0['type']===_0x84afb2(0x197)){const _0xee18ec=_0x40c3d0[_0x84afb2(0x1a5)][_0x84afb2(0x1a8)]('\x20'),_0x58faa3=_0xee18ec[0x0],_0x3a1507=_0xee18ec[_0x84afb2(0x17a)](0x1);_0x27ac47=new StdioClientTransport({'command':_0x58faa3,'args':_0x3a1507});}else throw new Error('Unsupported\x20server\x20type:\x20'+_0x40c3d0['type']);}return await _0x5b7cc2['connect'](_0x27ac47),this[_0x84afb2(0x183)]['set'](_0x5b1467,_0x5b7cc2),_0x5b7cc2;}catch(_0x4dc674){return this[_0x84afb2(0x1a6)]['error'](_0x84afb2(0x163)+_0x5b1467+'\x27:',_0x4dc674),null;}}async[a0_0x2fcaa7(0x194)](){const _0x17df16=a0_0x2fcaa7;try{const _0x5e8772=a0_0x27d1fd[_0x17df16(0x15a)](this[_0x17df16(0x1aa)],_0x17df16(0x165)),_0x5f4030={};for(const [_0x5e3184,_0x11bdfb]of this[_0x17df16(0x17c)]['entries']()){_0x5f4030[_0x5e3184]=_0x11bdfb;}await a0_0x188223['writeFile'](_0x5e8772,JSON['stringify'](_0x5f4030,null,0x2),'utf-8'),this[_0x17df16(0x1a6)][_0x17df16(0x15d)](_0x17df16(0x19d)+this['servers'][_0x17df16(0x157)]+_0x17df16(0x162));}catch(_0x2b465b){this['logger'][_0x17df16(0x168)]('Failed\x20to\x20save\x20MCP\x20servers\x20to\x20file:',_0x2b465b);}}async[a0_0x2fcaa7(0x18b)](){const _0x4b5f02=a0_0x2fcaa7;this[_0x4b5f02(0x1a6)][_0x4b5f02(0x15d)]('Shutting\x20down\x20MCP\x20client\x20tool');for(const [_0x5c9e31,_0x49b473]of this['clients']['entries']()){try{await _0x49b473[_0x4b5f02(0x193)](),this['logger']['info'](_0x4b5f02(0x17d)+_0x5c9e31);}catch(_0x3fb0b3){this['logger'][_0x4b5f02(0x195)]('Error\x20disconnecting\x20from\x20MCP\x20server\x20'+_0x5c9e31+':',_0x3fb0b3);}}this[_0x4b5f02(0x183)]['clear']();}}