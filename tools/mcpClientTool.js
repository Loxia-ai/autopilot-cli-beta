const a0_0x257448=a0_0x43d4;(function(_0x13ccce,_0x23c08c){const _0x4eb08d=a0_0x43d4,_0x319987=_0x13ccce();while(!![]){try{const _0x573749=parseInt(_0x4eb08d(0xee))/0x1*(parseInt(_0x4eb08d(0xf8))/0x2)+parseInt(_0x4eb08d(0xff))/0x3*(parseInt(_0x4eb08d(0xaf))/0x4)+parseInt(_0x4eb08d(0xfb))/0x5*(parseInt(_0x4eb08d(0xc8))/0x6)+-parseInt(_0x4eb08d(0xd2))/0x7*(-parseInt(_0x4eb08d(0xa8))/0x8)+-parseInt(_0x4eb08d(0xd7))/0x9+-parseInt(_0x4eb08d(0xe3))/0xa*(parseInt(_0x4eb08d(0xec))/0xb)+parseInt(_0x4eb08d(0xdc))/0xc*(-parseInt(_0x4eb08d(0xc3))/0xd);if(_0x573749===_0x23c08c)break;else _0x319987['push'](_0x319987['shift']());}catch(_0x30e4bf){_0x319987['push'](_0x319987['shift']());}}}(a0_0x3e1c,0x5f2a9));import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';function a0_0x43d4(_0x1406c3,_0x4eff4b){const _0x3e1ca6=a0_0x3e1c();return a0_0x43d4=function(_0x43d4d4,_0xd60cc1){_0x43d4d4=_0x43d4d4-0xa6;let _0x3855b4=_0x3e1ca6[_0x43d4d4];if(a0_0x43d4['OrPgZd']===undefined){var _0x2062f7=function(_0x1319ab){const _0x50fbed='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1e149a='',_0x6366be='';for(let _0x53629f=0x0,_0x1db550,_0x17375e,_0xca3f24=0x0;_0x17375e=_0x1319ab['charAt'](_0xca3f24++);~_0x17375e&&(_0x1db550=_0x53629f%0x4?_0x1db550*0x40+_0x17375e:_0x17375e,_0x53629f++%0x4)?_0x1e149a+=String['fromCharCode'](0xff&_0x1db550>>(-0x2*_0x53629f&0x6)):0x0){_0x17375e=_0x50fbed['indexOf'](_0x17375e);}for(let _0x43dc74=0x0,_0x2c3eb2=_0x1e149a['length'];_0x43dc74<_0x2c3eb2;_0x43dc74++){_0x6366be+='%'+('00'+_0x1e149a['charCodeAt'](_0x43dc74)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x6366be);};a0_0x43d4['mPYgwj']=_0x2062f7,_0x1406c3=arguments,a0_0x43d4['OrPgZd']=!![];}const _0x489c64=_0x3e1ca6[0x0],_0x58e3ac=_0x43d4d4+_0x489c64,_0x3a963f=_0x1406c3[_0x58e3ac];return!_0x3a963f?(_0x3855b4=a0_0x43d4['mPYgwj'](_0x3855b4),_0x1406c3[_0x58e3ac]=_0x3855b4):_0x3855b4=_0x3a963f,_0x3855b4;},a0_0x43d4(_0x1406c3,_0x4eff4b);}import{BaseTool}from'./baseTool.js';import{TagParser}from'../utilities/tagParser.js';import a0_0x1319ab from'path';function a0_0x3e1c(){const _0x7fced3=['nu5TrujNwG','CMvHzezPBgu','CMvTB3zLlxnLCNzLCG','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','nLr1CMTWtW','z2v0lxrVB2WTC2nOzw1H','vg9VBcbJywXSig11C3qGAgf2zsbUyw1LigfUzcbHCMD1BwvUDhm','rMfPBgvKihrVihnHDMuGtunqihnLCNzLCNmGDg8GzMLSztO','u2H1DhrPBMCGzg93BIbnq1aGy2XPzw50ihrVB2W','BMfTzq','BgLZDfrVB2XZ','zgvZy3jPChrPB24','ntm3mJq0ofrJtw90sG','D2fYBG','CMvTB3zLu2vYDMvY','y29TBwfUzhm','Bg9Nz2vY','z2v0t3jdCMvHDgvdBgLLBNq','rMfPBgvKihrVigXVywqGC2f2zwqGtunqihnLCNzLCNm6','otG0ndC2rxzVq2zb','Ahr0CdOVlW','BgvUz3rO','z2v0lwf2ywLSywjSzs10B29SCW','cK1ducbdBgLLBNqGvg9VBdOGqwXSB3DZihLVDsb0BYbPBNrLCMfJDcb3AxrOie1VzgvSienVBNrLEhqGuhjVDg9JB2WGke1ducKGC2vYDMvYCYb0BYbHy2nLC3mGzxH0zxjUywWGDg9VBhmGyw5KihjLC291CMnLCY4kcLvZywDLoGPBDg9VBcbPzd0IBwnWlwnSAwvUDcjDcLTNzxqTyxzHAwXHyMXLlxnLCNzLCNmGl10kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kcLTHzgqTC2vYDMvYC10kw3mGBMfTzt0IC2vYDMvYlw5HBwuIihvYBd0IAhr0CdOVl3nLCNzLCI11CMWIic9DcLSVywrKlxnLCNzLCNnDcGPBCMvTB3zLlxnLCNzLCL0kC2vYDMvYlw5HBwukwY9Yzw1VDMuTC2vYDMvYxqOkw2DLDc10B29SlxnJAgvTyv0kC2vYDMvYlw5HBwuVDg9VBc1Uyw1LcLSVz2v0lxrVB2WTC2nOzw1HxqOkw21LC3nHz2uTDg8TBwnWxqP7cIaGiNrVB2XFy2fSBci6ihSkicaGicjUyw1LiJOGiNnLCNzLCI1Uyw1Ll3rVB2WTBMfTzsiScIaGicaIyxjNDw1LBNrZiJOGEYaICgfYyw0XiJOGiNzHBhvLmsiSicjWyxjHBtiIoIaIDMfSDwuYiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kcKv4yw1WBgvZoGOXlIbmAxn0igf2ywLSywjSzsbnq1aGC2vYDMvYCZOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lwf2ywLSywjSzs1Zzxj2zxjZic9DcLSVDg9VBf0kcJiUieXPC3qGyxzHAwXHyMXLihrVB2XZigzYB20GywXSihnLCNzLCNm6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kwY90B29SxqOkmY4GqwrKigeGBMv3ie1ducbZzxj2zxi6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2fKzc1Zzxj2zxjZxqPBCYbUyw1LpsjZExn0zw0TDg9VBhmIihvYBd0IAhr0CdOVl2XVy2fSAg9ZDdOZmdaXiIaVxqPBl2fKzc1Zzxj2zxjZxqPBl3rVB2XDcGO0lIbszw1VDMuGyw4GtunqihnLCNzLCJOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBCMvTB3zLlxnLCNzLCL0kC3LZDgvTlxrVB2XZcLSVCMvTB3zLlxnLCNzLCL0kwY90B29SxqOkns4Gr2v0ihrOzsbZy2HLBweGzM9YigeGC3bLy2LMAwmGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lxrVB2WTC2nOzw1HxqPZExn0zw0TDg9VBhmVCNvUq29TBwfUzaPBl2DLDc10B29SlxnJAgvTyv0kwY90B29SxqOknI4Gq2fSBcbHBIbnq1aGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBBwvZC2fNzs10BY1Ty3bDcNSkicaIDg9VBf9JywXSiJOGEWOGicaGiM5HBwuIoIaIC3LZDgvTlxrVB2XZl3j1BKnVBw1HBMqIlaOGicaGiMfYz3vTzw50CYi6ihSGiMnVBw1HBMqIoIaIBhmGlwXHiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kicaGia','y29UDgvUDa','C3rYAw5NAwz5','vg9VBcaN','z2v0qxzHAwXHyMXLvg9VBhm','rxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzcb3AxrOihbHCMfTzxrLCNm6','z2v0qxzHAwXHyMXLu2vYDMvYCW','Ahr0Chm6lY8','C2vYDMvYCW','ie1ducbZzxj2zxjZihrVigzPBgu','DxjS','vw5RBM93BIbnq1aGy2XPzw50ignVBw1HBMq6ia','AM9PBG','BwvZC2fNzs10BY1Ty3a','AgfZ','ywrKlxnLCNzLCNm','mJKZoeD2sfvdta','Dg9VBfnJAgvTyxm','Dg9VBeLK','BwvZC2fNzq','rxjYB3iGzxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzca','mtq2otqZnK5WuKLnta','rgLZy29UBMvJDgvKigzYB20GtunqihnLCNzLCJOG','y2f0y2G','ie1ducbZzxj2zxjZ','rMfPBgvKihrVignYzwf0zsbJBgLLBNq','C3bSAxq','CgfYC2u','jYbKB2vZig5VDcbLEgLZDa','Aw5MBW','ChvZAa','n1noDgP0sG','y2XPzw50CW','CxvLCNK','lIbfEhbLy3rLzcbMB3jTyxq6ihnLCNzLCK5HBwuVDg9VBe5HBwu','Dg9VBf9JywXS','nti1mJy0m2HgBhP1zq','rMfPBgvKihrVignYzwf0zsbnq1aGC2vYDMvYigrPCMvJDg9YEtO','zxjYB3i','C2vUze1LC3nHz2vuB01JCa','u2vYDMvYig5HBwuGyw5KifvstcbHCMuGCMvXDwLYzwq','mtK5ndrbDhj4D08','ywn0Aw9U','CgfYC2vqyxjHBwv0zxjZ','BwnWlxnLCNzLCNm','C2XPy2u','C2vYDMvYtMfTzq','u2vUzgLUzYbTzxnZywDLihrVie1ducbZzxj2zxi','mZbgzhPfDNG','Aw5PDgLHBgL6zvnLCNzLCKrPCMvJDg9YEq','z2v0','u2vYDMvYicC','y29Kzq','C2H1DgrVD24','z2v0lwf2ywLSywjSzs1Zzxj2zxjZ','C2vYDMvYCY5QC29U','z2v0vg9VBfnJAgvTyq','mtyWnda1m3jmCMreyG','DhjPBq','mu1ZsgrlCq','sw52ywXPzcbnq1aGBwvZC2fNzsbMB3jTyxqUiev4CgvJDgvKihSGDg9VBf9JywXSoIb7ig5HBwuSigfYz3vTzw50CYb9ih0','vw5ZDxbWB3j0zwqGC2vYDMvYihr5Cgu6ia','zw50CMLLCW','DhLWzq','rxjYB3iGzgLZy29UBMvJDgLUzYbMCM9TihnLCNzLCIa','rMfPBgvKihrVihbHCNnLie1ducbTzxnZywDLiePtt046','C2f2zvnLCNzLCNm','D3jPDgvgAwXL','C3rHCNrZv2L0Aa','nZu1nJe4yuHwv0fq','Ahr0Ca','C2v0'];a0_0x3e1c=function(){return _0x7fced3;};return a0_0x3e1c();}import a0_0x50fbed from'fs/promises';export class MCPClientTool extends BaseTool{constructor(_0x1e149a,_0x6366be){const _0x24004f=a0_0x43d4;super(_0x1e149a,_0x6366be),this[_0x24004f(0xbb)]=new Map(),this['clients']=new Map(),this[_0x24004f(0xc4)]=new Map(),this['serverDirectory']=a0_0x1319ab[_0x24004f(0xbf)](process['cwd'](),'.loxia-state',_0x24004f(0xdf)),this[_0x24004f(0xe4)]()[_0x24004f(0xca)](_0x53629f=>{const _0x110e7d=_0x24004f;this['logger'][_0x110e7d(0xd9)]('Failed\x20to\x20initialize\x20MCP\x20server\x20directory:',_0x53629f);});}async[a0_0x257448(0xe4)](){const _0x5847e8=a0_0x257448;try{await a0_0x50fbed['mkdir'](this['serverDirectory'],{'recursive':!![]});try{const _0x1db550=a0_0x1319ab[_0x5847e8(0xbf)](this['serverDirectory'],_0x5847e8(0xea)),_0x17375e=await a0_0x50fbed[_0x5847e8(0xfc)](_0x1db550,'utf-8'),_0xca3f24=JSON[_0x5847e8(0xce)](_0x17375e);for(const [_0x43dc74,_0x2c3eb2]of Object['entries'](_0xca3f24)){this['servers'][_0x5847e8(0xfa)](_0x43dc74,_0x2c3eb2);}this['logger']['info']('Loaded\x20'+this['servers']['size']+'\x20saved\x20MCP\x20servers');}catch(_0x36f9a0){_0x36f9a0[_0x5847e8(0xe7)]!=='ENOENT'&&this[_0x5847e8(0xac)]['warn'](_0x5847e8(0xae),_0x36f9a0);}}catch(_0x560735){this[_0x5847e8(0xac)]['error'](_0x5847e8(0xd8),_0x560735);}}['getDescription'](){const _0x45a1f5=a0_0x257448;return _0x45a1f5(0xb3);}[a0_0x257448(0xde)](_0x131391){const _0xf7bc0b=a0_0x257448;this['logger']['info']('Parsing\x20MCP\x20client\x20parameters\x20with\x20TagParser');const _0x11b7a8={'commands':[]};try{const _0x1c2f0d=TagParser[_0xf7bc0b(0xd4)](_0x131391,'get-available-servers');_0x1c2f0d['length']>0x0&&_0x11b7a8['commands'][_0xf7bc0b(0xd1)]({'action':_0xf7bc0b(0xe9)});const _0x3c3142=TagParser[_0xf7bc0b(0xd4)](_0x131391,_0xf7bc0b(0xb2));_0x3c3142['length']>0x0&&_0x11b7a8['commands'][_0xf7bc0b(0xd1)]({'action':'get-available-tools'});const _0x28020e=TagParser['query'](_0x131391,_0xf7bc0b(0xc2));for(const _0x789a86 of _0x28020e){const _0x493901=TagParser[_0xf7bc0b(0xd4)](_0x789a86['content'],'s'),_0x450486=[];for(const _0x667f68 of _0x493901){const _0xad7acc=_0x667f68['attributes'][_0xf7bc0b(0x104)],_0xea63af=_0x667f68['attributes']['url'];_0xad7acc&&_0xea63af&&_0x450486['push']({'name':_0xad7acc,'url':_0xea63af});}_0x450486[_0xf7bc0b(0xb1)]>0x0&&_0x11b7a8[_0xf7bc0b(0xab)]['push']({'action':'add-servers','servers':_0x450486});}const _0x39d8e8=TagParser[_0xf7bc0b(0xd4)](_0x131391,'remove-server');for(const _0x206146 of _0x39d8e8){const _0x379d40=_0x206146[_0xf7bc0b(0xb4)][_0xf7bc0b(0xed)]();_0x379d40&&_0x11b7a8[_0xf7bc0b(0xab)][_0xf7bc0b(0xd1)]({'action':'remove-server','serverName':_0x379d40});}const _0x2c1ba3=TagParser[_0xf7bc0b(0xd4)](_0x131391,_0xf7bc0b(0x100));for(const _0x5dfb97 of _0x2c1ba3){const _0x374cc5=_0x5dfb97['content'][_0xf7bc0b(0xed)]();_0x374cc5&&_0x11b7a8['commands']['push']({'action':_0xf7bc0b(0x100),'toolId':_0x374cc5});}const _0x244352=TagParser['query'](_0x131391,'message-to-mcp');for(const _0x6cd43f of _0x244352){const _0x255b6e=_0x6cd43f['content'][_0xf7bc0b(0xed)]();if(_0x255b6e){let _0x36ea4f;try{_0x36ea4f=JSON['parse'](_0x255b6e);}catch(_0x1c42da){this[_0xf7bc0b(0xac)]['error'](_0xf7bc0b(0xf4),_0x1c42da);continue;}_0x11b7a8[_0xf7bc0b(0xab)][_0xf7bc0b(0xd1)]({'action':_0xf7bc0b(0xc0),'message':_0x36ea4f});}}return _0x11b7a8;}catch(_0x292160){return this['logger']['error']('Error\x20parsing\x20MCP\x20client\x20parameters:',_0x292160),{'commands':[]};}}async['executeWithParameters'](_0x46526f,_0x438896){const _0x140220=a0_0x257448;this['logger']['info'](_0x140220(0xb8),_0x46526f);const _0x44717f=[];if(!_0x46526f[_0x140220(0xab)]||_0x46526f['commands'][_0x140220(0xb1)]===0x0)throw new Error('No\x20MCP\x20client\x20commands\x20specified');for(const _0x1b94cf of _0x46526f['commands']){try{let _0x50574d;switch(_0x1b94cf[_0x140220(0xdd)]){case'get-available-servers':_0x50574d=await this['getAvailableServers']();break;case _0x140220(0xb2):_0x50574d=await this['getAvailableTools']();break;case _0x140220(0xc2):_0x50574d=await this['addServers'](_0x1b94cf[_0x140220(0xbb)]);break;case _0x140220(0xfd):_0x50574d=await this[_0x140220(0xaa)](_0x1b94cf[_0x140220(0xe1)]);break;case'get-tool-schema':_0x50574d=await this[_0x140220(0xeb)](_0x1b94cf[_0x140220(0xc5)]);break;case'message-to-mcp':_0x50574d=await this['sendMessageToMcp'](_0x1b94cf['message']);break;default:throw new Error(_0x140220(0xbe)+_0x1b94cf[_0x140220(0xdd)]);}_0x44717f['push'](_0x50574d);}catch(_0x304c73){this[_0x140220(0xac)][_0x140220(0xd9)](_0x140220(0xc7)+_0x1b94cf[_0x140220(0xdd)]+':',_0x304c73),_0x44717f['push']({'action':_0x1b94cf['action'],'success':![],'error':_0x304c73['message']});}}return{'results':_0x44717f};}async[a0_0x257448(0xb9)](){const _0x39127b=a0_0x257448;this[_0x39127b(0xac)][_0x39127b(0xd0)]('Getting\x20available\x20MCP\x20servers');const _0x50d09d=[];for(const [_0x15d00f,_0x4aca31]of this[_0x39127b(0xbb)]['entries']()){_0x50d09d[_0x39127b(0xd1)]({'name':_0x15d00f,'url':_0x4aca31['url'],'type':_0x4aca31['type']||'http'});}return{'action':'get-available-servers','servers':_0x50d09d,'success':!![]};}async[a0_0x257448(0xb7)](){const _0x3cbb65=a0_0x257448;this['logger']['info']('Getting available tools from MCP servers');const _0x9d7634=[],_0xcbd36c=[];for(const [_0x363078,_0xd9d7c4]of this['servers']['entries']()){try{const _0x3de549=await this[_0x3cbb65(0xad)](_0x363078);if(!_0x3de549){_0xcbd36c[_0x3cbb65(0xd1)]({'name':_0x363078,'error':_0x3cbb65(0xcc)});continue;}const _0x3e27ef=await _0x3de549[_0x3cbb65(0xa6)]();for(const _0x1a5ffa of _0x3e27ef){_0x9d7634[_0x3cbb65(0xd1)]({'name':_0x363078+'/'+_0x1a5ffa[_0x3cbb65(0x104)],'description':_0x1a5ffa[_0x3cbb65(0xa7)]||'No\x20description','server':_0x363078}),this[_0x3cbb65(0xc4)]['set'](_0x363078+'/'+_0x1a5ffa[_0x3cbb65(0x104)],_0x1a5ffa);}}catch(_0x145d67){this['logger'][_0x3cbb65(0xd9)]('Failed\x20to\x20get\x20tools\x20from\x20server\x20'+_0x363078+':',_0x145d67),_0xcbd36c['push']({'name':_0x363078,'error':_0x145d67['message']});}}return{'action':'get-available-tools','tools':_0x9d7634,'failedServers':_0xcbd36c,'success':!![]};}async['addServers'](_0x31fd67){const _0x4bd5f2=a0_0x257448;this['logger']['info']('Adding\x20'+_0x31fd67[_0x4bd5f2(0xb1)]+_0x4bd5f2(0xcb));const _0x545b35=[],_0x1b6db5=[];for(const _0x8d129c of _0x31fd67){try{if(!_0x8d129c[_0x4bd5f2(0x104)]||!_0x8d129c[_0x4bd5f2(0xbd)])throw new Error(_0x4bd5f2(0xdb));let _0x1b4811='http';_0x8d129c['url'][_0x4bd5f2(0xf7)](_0x4bd5f2(0xb0))||_0x8d129c[_0x4bd5f2(0xbd)][_0x4bd5f2(0xf7)](_0x4bd5f2(0xba))?_0x1b4811=_0x4bd5f2(0xf9):_0x1b4811='stdio',this['servers'][_0x4bd5f2(0xfa)](_0x8d129c[_0x4bd5f2(0x104)],{'url':_0x8d129c[_0x4bd5f2(0xbd)],'type':_0x1b4811}),_0x545b35[_0x4bd5f2(0xd1)](_0x8d129c[_0x4bd5f2(0x104)]);}catch(_0x140fc8){this[_0x4bd5f2(0xac)]['error']('Failed\x20to\x20add\x20server\x20'+_0x8d129c[_0x4bd5f2(0x104)]+':',_0x140fc8),_0x1b6db5[_0x4bd5f2(0xd1)]({'name':_0x8d129c['name'],'error':_0x140fc8[_0x4bd5f2(0xc6)]});}}return await this['saveServers'](),{'action':'add-servers','addedServers':_0x545b35,'failedServers':_0x1b6db5,'success':_0x545b35[_0x4bd5f2(0xb1)]>0x0};}async[a0_0x257448(0xaa)](_0x190aef){const _0x50c017=a0_0x257448;this[_0x50c017(0xac)][_0x50c017(0xd0)]('Removing\x20MCP\x20server:\x20'+_0x190aef);if(!this['servers'][_0x50c017(0xc1)](_0x190aef))return{'action':'remove-server','serverName':_0x190aef,'success':![],'error':_0x50c017(0xe6)+_0x190aef+'\x27\x20does\x20not\x20exist'};if(this[_0x50c017(0xd3)][_0x50c017(0xc1)](_0x190aef)){try{const _0x358857=this[_0x50c017(0xd3)][_0x50c017(0xe5)](_0x190aef);await _0x358857['disconnect']();}catch(_0x8e7758){this['logger']['warn'](_0x50c017(0xf3)+_0x190aef+':',_0x8e7758);}this['clients']['delete'](_0x190aef);}return this['servers']['delete'](_0x190aef),await this[_0x50c017(0xf5)](),{'action':_0x50c017(0xfd),'serverName':_0x190aef,'success':!![]};}async[a0_0x257448(0xeb)](_0x47c0c2){const _0x602e15=a0_0x257448;this[_0x602e15(0xac)][_0x602e15(0xd0)]('Getting\x20schema\x20for\x20tool:\x20'+_0x47c0c2);const [_0x9c9e5a,_0x5bbfd2]=_0x47c0c2['split']('/');if(!_0x9c9e5a||!_0x5bbfd2)throw new Error('Invalid\x20tool\x20ID\x20format:\x20'+_0x47c0c2+'.\x20Expected\x20format:\x20serverName/toolName');if(!this['servers']['has'](_0x9c9e5a))throw new Error(_0x602e15(0xe6)+_0x9c9e5a+'\x27\x20does\x20not\x20exist');if(this['toolSchemas']['has'](_0x47c0c2))return{'action':_0x602e15(0x100),'toolId':_0x47c0c2,'schema':this[_0x602e15(0xc4)][_0x602e15(0xe5)](_0x47c0c2),'success':!![]};const _0x2087e0=await this[_0x602e15(0xad)](_0x9c9e5a);if(!_0x2087e0)throw new Error('Failed\x20to\x20connect\x20to\x20server:\x20'+_0x9c9e5a);const _0x175f85=await _0x2087e0[_0x602e15(0xa6)](),_0x19df16=_0x175f85['find'](_0x1b1bcf=>_0x1b1bcf[_0x602e15(0x104)]===_0x5bbfd2);if(!_0x19df16)throw new Error(_0x602e15(0xb6)+_0x5bbfd2+'\x27\x20not\x20found\x20on\x20server\x20\x27'+_0x9c9e5a+'\x27');return this[_0x602e15(0xc4)]['set'](_0x47c0c2,_0x19df16),{'action':'get-tool-schema','toolId':_0x47c0c2,'schema':_0x19df16,'success':!![]};}async[a0_0x257448(0xda)](_0x18ce86){const _0x338033=a0_0x257448;this[_0x338033(0xac)]['info'](_0x338033(0xe2));if(!_0x18ce86||!_0x18ce86[_0x338033(0xd6)])throw new Error(_0x338033(0xef));const {name:_0x5ec92c,arguments:_0x1b5f4b}=_0x18ce86[_0x338033(0xd6)];if(!_0x5ec92c||!_0x1b5f4b)throw new Error(_0x338033(0x101));const [_0x5db730,_0x51ceac]=_0x5ec92c[_0x338033(0xcd)]('/');if(!_0x5db730||!_0x51ceac)throw new Error('Invalid\x20tool\x20name\x20format:\x20'+_0x5ec92c+_0x338033(0xd5));if(!this[_0x338033(0xbb)]['has'](_0x5db730))throw new Error('Server\x20\x27'+_0x5db730+_0x338033(0xcf));const _0x1676cc=await this[_0x338033(0xad)](_0x5db730);if(!_0x1676cc)throw new Error(_0x338033(0xfe)+_0x5db730);const _0x3b7a93=await _0x1676cc['callTool']({'name':_0x51ceac,'arguments':_0x1b5f4b});return{'action':'message-to-mcp','toolCall':{'name':_0x5ec92c,'arguments':_0x1b5f4b},'result':_0x3b7a93,'success':!![]};}async['getOrCreateClient'](_0x56acaf){const _0x1b9fba=a0_0x257448;if(this['clients']['has'](_0x56acaf))return this[_0x1b9fba(0xd3)]['get'](_0x56acaf);const _0x1d58bc=this['servers'][_0x1b9fba(0xe5)](_0x56acaf);if(!_0x1d58bc)return this['logger'][_0x1b9fba(0xd9)](_0x1b9fba(0xe6)+_0x56acaf+'\x27\x20not\x20found'),null;try{const _0x1819bd=new Client({'name':'loxia-mcp-client','version':'1.0.0'});let _0x559228;if(_0x1d58bc['type']===_0x1b9fba(0xf9))_0x559228=new StreamableHTTPClientTransport(_0x1d58bc['url']);else{if(_0x1d58bc['type']==='stdio'){const _0x31db82=_0x1d58bc[_0x1b9fba(0xbd)]['split']('\x20'),_0x420207=_0x31db82[0x0],_0x4f06f0=_0x31db82[_0x1b9fba(0xe0)](0x1);_0x559228=new StdioClientTransport({'command':_0x420207,'args':_0x4f06f0});}else throw new Error(_0x1b9fba(0xf0)+_0x1d58bc[_0x1b9fba(0xf2)]);}return await _0x1819bd['connect'](_0x559228),this[_0x1b9fba(0xd3)]['set'](_0x56acaf,_0x1819bd),_0x1819bd;}catch(_0x281ed9){return this[_0x1b9fba(0xac)][_0x1b9fba(0xd9)]('Failed\x20to\x20create\x20MCP\x20client\x20for\x20server\x20\x27'+_0x56acaf+'\x27:',_0x281ed9),null;}}async[a0_0x257448(0xf5)](){const _0x55b346=a0_0x257448;try{const _0x2dda65=a0_0x1319ab[_0x55b346(0xbf)](this['serverDirectory'],_0x55b346(0xea)),_0x2f0d8e={};for(const [_0x4df0a5,_0x27c092]of this['servers'][_0x55b346(0xf1)]()){_0x2f0d8e[_0x4df0a5]=_0x27c092;}await a0_0x50fbed[_0x55b346(0xf6)](_0x2dda65,JSON[_0x55b346(0xb5)](_0x2f0d8e,null,0x2),'utf-8'),this[_0x55b346(0xac)][_0x55b346(0xd0)]('Saved\x20'+this[_0x55b346(0xbb)]['size']+_0x55b346(0xbc));}catch(_0x28de69){this['logger'][_0x55b346(0xd9)](_0x55b346(0x102),_0x28de69);}}async[a0_0x257448(0xe8)](){const _0x4098b7=a0_0x257448;this['logger']['info'](_0x4098b7(0x103));for(const [_0x58ae02,_0x1b0b4d]of this['clients']['entries']()){try{await _0x1b0b4d['disconnect'](),this['logger']['info'](_0x4098b7(0xc9)+_0x58ae02);}catch(_0x5e0def){this['logger'][_0x4098b7(0xa9)]('Error\x20disconnecting\x20from\x20MCP\x20server\x20'+_0x58ae02+':',_0x5e0def);}}this[_0x4098b7(0xd3)]['clear']();}}