function a0_0x2ae5(){const _0x301639=['ie1ducbZzxj2zxjZ','ugfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNmGD2L0AcbuywDqyxjZzxi','C3rHCNrZv2L0Aa','CMvHzezPBgu','DhjPBq','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','Aw5MBW','C2vYDMvYtMfTzq','mte5mtuXnK9MwfDNvq','z2v0t3jdCMvHDgvdBgLLBNq','BwvZC2fNzs10BY1Ty3a','ywrKlxnLCNzLCNm','z2v0qxzHAwXHyMXLvg9VBhm','D3jPDgvgAwXL','Aw5PDgLHBgL6zvnLCNzLCKrPCMvJDg9YEq','z2v0vg9VBfnJAgvTyq','rMfPBgvKihrVihnHDMuGtunqihnLCNzLCNmGDg8GzMLSztO','DxjS','ywn0Aw9U','Dg9VBfnJAgvTyxm','rxjYB3iGzxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzca','Dg9VBeLK','jYbUB3qGzM91BMq','y2XPzw50CW','u2vYDMvYig5HBwuGyw5KifvstcbHCMuGCMvXDwLYzwq','ChvZAa','rMfPBgvKihrVignYzwf0zsbnq1aGC2vYDMvYigrPCMvJDg9YEtO','vw5RBM93BIbnq1aGy2XPzw50ignVBw1HBMq6ia','lIbfEhbLy3rLzcbMB3jTyxq6ihnLCNzLCK5HBwuVDg9VBe5HBwu','mJeZotyZmdbqD0Dmwfu','CgfYC2u','zgvSzxrL','y29TBwfUzhm','ms4WlJa','z2v0','CxvLCNK','mZC2mdqZnxn4sw5xyq','z2v0qxzHAwXHyMXLu2vYDMvYCW','odi4zKjgtxfI','mtm3mZe5nZzruejKuhe','z2v0lwf2ywLSywjSzs10B29SCW','C3rKAw8','y2fSBfrVB2W','zxjYB3i','rxjYB3iGzgLZy29UBMvJDgLUzYbMCM9TihnLCNzLCIa','mJvXzLPLBve','rMfPBgvKihrVigDLDcb0B29SCYbMCM9TihnLCNzLCIa','C2f2zvnLCNzLCNm','Dg9VBf9JywXS','D2fYBG','C2H1DgrVD24','Bg9Nz2vY','Bg94AweTBwnWlwnSAwvUDa','ywrKu2vYDMvYCW','BgvUz3rO','BgLZDfrVB2XZ','ota5nhvjyvrKuG','z2v0lxrVB2WTC2nOzw1H','BwvZC2fNzq','y29UDgvUDa','u2f2zwqG','rxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzcb3AxrOihbHCMfTzxrLCNm6','rMfPBgvKihrVigfKzcbZzxj2zxiG','CgfYC2vqyxjHBwv0zxjZ','oxPMvLb0AG','nJi5nZC5mKDXswTnwG','CMvTB3zLu2vYDMvY','zgvZy3jPChrPB24','u2vUzgLUzYbTzxnZywDLihrVie1ducbZzxj2zxi','C2vYDMvYCW','C2L6zq','C2vYDMvYrgLYzwn0B3j5','AgfZ','z2v0lwf2ywLSywjSzs1Zzxj2zxjZ','ihnHDMvKie1ducbZzxj2zxjZ','CMvTB3zLlxnLCNzLCG','rxjYB3iGCgfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNm6','BMfTzq','Ahr0Ca','u2vYDMvYicC','ru5pru5u','AM9PBG','sw52ywXPzcb0B29SieLeigzVCM1HDdOG','C2v0','DxrMltG','C2vUze1LC3nHz2vuB01JCa','zw50CMLLCW','sw52ywXPzcb0B29Sig5HBwuGzM9YBwf0oIa','C3bSAxq','mtC5mdmYq1ffv1vM'];a0_0x2ae5=function(){return _0x301639;};return a0_0x2ae5();}const a0_0x73df7=a0_0xead2;(function(_0x4e5a65,_0x3195bf){const _0xb4313d=a0_0xead2,_0x39659f=_0x4e5a65();while(!![]){try{const _0x581eef=parseInt(_0xb4313d(0x1d7))/0x1+parseInt(_0xb4313d(0x210))/0x2*(parseInt(_0xb4313d(0x1fe))/0x3)+parseInt(_0xb4313d(0x1e0))/0x4*(-parseInt(_0xb4313d(0x205))/0x5)+parseInt(_0xb4313d(0x219))/0x6+-parseInt(_0xb4313d(0x1fc))/0x7+parseInt(_0xb4313d(0x1ff))/0x8*(-parseInt(_0xb4313d(0x218))/0x9)+parseInt(_0xb4313d(0x1f5))/0xa;if(_0x581eef===_0x3195bf)break;else _0x39659f['push'](_0x39659f['shift']());}catch(_0x194a5b){_0x39659f['push'](_0x39659f['shift']());}}}(a0_0x2ae5,0xd6e29));import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';import{BaseTool}from'./baseTool.js';import{TagParser}from'../utilities/tagParser.js';import a0_0x4de1a7 from'path';function a0_0xead2(_0x5be825,_0x551e7d){const _0x2ae53f=a0_0x2ae5();return a0_0xead2=function(_0xead29c,_0x49ad0c){_0xead29c=_0xead29c-0x1c2;let _0x103d1f=_0x2ae53f[_0xead29c];if(a0_0xead2['GokZBs']===undefined){var _0x5722e3=function(_0x4de1a7){const _0x250a62='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1f5679='',_0x4436fe='';for(let _0x4b9dec=0x0,_0xdd9ff2,_0x16b406,_0x98d6c6=0x0;_0x16b406=_0x4de1a7['charAt'](_0x98d6c6++);~_0x16b406&&(_0xdd9ff2=_0x4b9dec%0x4?_0xdd9ff2*0x40+_0x16b406:_0x16b406,_0x4b9dec++%0x4)?_0x1f5679+=String['fromCharCode'](0xff&_0xdd9ff2>>(-0x2*_0x4b9dec&0x6)):0x0){_0x16b406=_0x250a62['indexOf'](_0x16b406);}for(let _0xfc588f=0x0,_0x420fc1=_0x1f5679['length'];_0xfc588f<_0x420fc1;_0xfc588f++){_0x4436fe+='%'+('00'+_0x1f5679['charCodeAt'](_0xfc588f)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4436fe);};a0_0xead2['lIFBKm']=_0x5722e3,_0x5be825=arguments,a0_0xead2['GokZBs']=!![];}const _0x15bec9=_0x2ae53f[0x0],_0x4d7e4a=_0xead29c+_0x15bec9,_0x46b8f1=_0x5be825[_0x4d7e4a];return!_0x46b8f1?(_0x103d1f=a0_0xead2['lIFBKm'](_0x103d1f),_0x5be825[_0x4d7e4a]=_0x103d1f):_0x103d1f=_0x46b8f1,_0x103d1f;},a0_0xead2(_0x5be825,_0x551e7d);}import a0_0x250a62 from'fs/promises';export class MCPClientTool extends BaseTool{constructor(_0x1f5679,_0x4436fe){const _0x48c4f1=a0_0xead2;super(_0x1f5679,_0x4436fe),this[_0x48c4f1(0x1c3)]=new Map(),this['clients']=new Map(),this['toolSchemas']=new Map(),this['serverDirectory']=a0_0x4de1a7[_0x48c4f1(0x1cf)](process['cwd'](),'.loxia-state','mcp-servers'),this['initializeServerDirectory']()['catch'](_0x4b9dec=>{const _0x3c23a9=_0x48c4f1;this[_0x3c23a9(0x20b)][_0x3c23a9(0x203)]('Failed\x20to\x20initialize\x20MCP\x20server\x20directory:',_0x4b9dec);});}async[a0_0x73df7(0x1e6)](){const _0x18e8b6=a0_0x73df7;try{await a0_0x250a62['mkdir'](this[_0x18e8b6(0x1c5)],{'recursive':!![]});try{const _0xdd9ff2=a0_0x4de1a7['join'](this['serverDirectory'],'servers.json'),_0x16b406=await a0_0x250a62[_0x18e8b6(0x1db)](_0xdd9ff2,_0x18e8b6(0x1d2)),_0x98d6c6=JSON[_0x18e8b6(0x1f6)](_0x16b406);for(const [_0xfc588f,_0x420fc1]of Object[_0x18e8b6(0x1d4)](_0x98d6c6)){this[_0x18e8b6(0x1c3)]['set'](_0xfc588f,_0x420fc1);}this[_0x18e8b6(0x20b)]['info']('Loaded\x20'+this['servers']['size']+_0x18e8b6(0x1c8));}catch(_0x517fef){_0x517fef['code']!==_0x18e8b6(0x1ce)&&this[_0x18e8b6(0x20b)]['warn']('Failed\x20to\x20load\x20saved\x20MCP\x20servers:',_0x517fef);}}catch(_0x3d9fb0){this['logger'][_0x18e8b6(0x203)](_0x18e8b6(0x1f2),_0x3d9fb0);}}['getDescription'](){return'\x0aMCP\x20Client\x20Tool:\x20Allows\x20you\x20to\x20interact\x20with\x20Model\x20Context\x20Protocol\x20(MCP)\x20servers\x20to\x20access\x20external\x20tools\x20and\x20resources.\x0a\x0aUsage:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[get-available-tools\x20/]\x0a\x0a[add-servers]\x0a[s\x20name=\x22server-name\x22\x20url=\x22http://server-url\x22\x20/]\x0a[/add-servers]\x0a\x0a[remove-server]\x0aserver-name\x0a[/remove-server]\x0a\x0a[get-tool-schema]\x0aserver-name/tool-name\x0a[/get-tool-schema]\x0a\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22server-name/tool-name\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22param1\x22:\x20\x22value1\x22,\x20\x22param2\x22:\x20\x22value2\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20List\x20available\x20MCP\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[/tool]\x0a\x0a2.\x20List\x20available\x20tools\x20from\x20all\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-tools\x20/]\x0a[/tool]\x0a\x0a3.\x20Add\x20a\x20new\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[add-servers]\x0a[s\x20name=\x22system-tools\x22\x20url=\x22http://localhost:3001\x22\x20/]\x0a[/add-servers]\x0a[/tool]\x0a\x0a4.\x20Remove\x20an\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[remove-server]\x0asystem-tools\x0a[/remove-server]\x0a[/tool]\x0a\x0a5.\x20Get\x20the\x20schema\x20for\x20a\x20specific\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-tool-schema]\x0asystem-tools/runCommand\x0a[/get-tool-schema]\x0a[/tool]\x0a\x0a6.\x20Call\x20an\x20MCP\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22system-tools/runCommand\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22command\x22:\x20\x22ls\x20-la\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x20\x20\x20\x20';}[a0_0x73df7(0x217)](_0x1b5d20){const _0x14b185=a0_0x73df7;this[_0x14b185(0x20b)]['info'](_0x14b185(0x1d9));const _0x1ef093={'commands':[]};try{const _0x4d1322=TagParser['query'](_0x1b5d20,'get-available-servers');_0x4d1322['length']>0x0&&_0x1ef093['commands'][_0x14b185(0x1f1)]({'action':_0x14b185(0x1c7)});const _0x36d156=TagParser[_0x14b185(0x1fb)](_0x1b5d20,'get-available-tools');_0x36d156['length']>0x0&&_0x1ef093['commands'][_0x14b185(0x1f1)]({'action':'get-available-tools'});const _0x361206=TagParser['query'](_0x1b5d20,'add-servers');for(const _0x1b1cea of _0x361206){const _0x16c294=TagParser['query'](_0x1b1cea['content'],'s'),_0xde12f0=[];for(const _0x160cb9 of _0x16c294){const _0x2be246=_0x160cb9['attributes']['name'],_0x42b06b=_0x160cb9['attributes'][_0x14b185(0x1e9)];_0x2be246&&_0x42b06b&&_0xde12f0[_0x14b185(0x1f1)]({'name':_0x2be246,'url':_0x42b06b});}_0xde12f0['length']>0x0&&_0x1ef093[_0x14b185(0x1f8)][_0x14b185(0x1f1)]({'action':'add-servers','servers':_0xde12f0});}const _0x5832d0=TagParser[_0x14b185(0x1fb)](_0x1b5d20,'remove-server');for(const _0x13e166 of _0x5832d0){const _0x20a5ed=_0x13e166[_0x14b185(0x213)][_0x14b185(0x1dc)]();_0x20a5ed&&_0x1ef093['commands']['push']({'action':'remove-server','serverName':_0x20a5ed});}const _0x1b5ff2=TagParser['query'](_0x1b5d20,'get-tool-schema');for(const _0x537d2a of _0x1b5ff2){const _0x5775c9=_0x537d2a[_0x14b185(0x213)]['trim']();_0x5775c9&&_0x1ef093['commands'][_0x14b185(0x1f1)]({'action':'get-tool-schema','toolId':_0x5775c9});}const _0x485711=TagParser[_0x14b185(0x1fb)](_0x1b5d20,_0x14b185(0x1e2));for(const _0x208986 of _0x485711){const _0x53011f=_0x208986[_0x14b185(0x213)][_0x14b185(0x1dc)]();if(_0x53011f){let _0x1ca0db;try{_0x1ca0db=JSON['parse'](_0x53011f);}catch(_0x2a33e6){this[_0x14b185(0x20b)]['error']('Failed\x20to\x20parse\x20MCP\x20message\x20JSON:',_0x2a33e6);continue;}_0x1ef093[_0x14b185(0x1f8)]['push']({'action':'message-to-mcp','message':_0x1ca0db});}}return _0x1ef093;}catch(_0x510d3f){return this['logger'][_0x14b185(0x203)](_0x14b185(0x1ca),_0x510d3f),{'commands':[]};}}async['executeWithParameters'](_0x3b07d7,_0x361a07){const _0x22f67f=a0_0x73df7;this['logger']['info'](_0x22f67f(0x215),_0x3b07d7);const _0x494e9d=[];if(!_0x3b07d7[_0x22f67f(0x1f8)]||_0x3b07d7[_0x22f67f(0x1f8)][_0x22f67f(0x20e)]===0x0)throw new Error('No\x20MCP\x20client\x20commands\x20specified');for(const _0x57d0d6 of _0x3b07d7[_0x22f67f(0x1f8)]){try{let _0x1e259f;switch(_0x57d0d6[_0x22f67f(0x1ea)]){case'get-available-servers':_0x1e259f=await this['getAvailableServers']();break;case'get-available-tools':_0x1e259f=await this[_0x22f67f(0x1e4)]();break;case'add-servers':_0x1e259f=await this[_0x22f67f(0x20d)](_0x57d0d6[_0x22f67f(0x1c3)]);break;case'remove-server':_0x1e259f=await this[_0x22f67f(0x21a)](_0x57d0d6[_0x22f67f(0x1df)]);break;case _0x22f67f(0x211):_0x1e259f=await this[_0x22f67f(0x1e7)](_0x57d0d6[_0x22f67f(0x1ed)]);break;case _0x22f67f(0x1e2):_0x1e259f=await this['sendMessageToMcp'](_0x57d0d6['message']);break;default:throw new Error(_0x22f67f(0x1f3)+_0x57d0d6['action']);}_0x494e9d[_0x22f67f(0x1f1)](_0x1e259f);}catch(_0x43fabb){this['logger']['error'](_0x22f67f(0x1ec)+_0x57d0d6[_0x22f67f(0x1ea)]+':',_0x43fabb),_0x494e9d[_0x22f67f(0x1f1)]({'action':_0x57d0d6['action'],'success':![],'error':_0x43fabb[_0x22f67f(0x212)]});}}return{'results':_0x494e9d};}async[a0_0x73df7(0x1fd)](){const _0x5d0fee=a0_0x73df7;this['logger'][_0x5d0fee(0x1de)]('Getting\x20available\x20MCP\x20servers');const _0x4d2ad6=[];for(const [_0xff4b84,_0x5fa401]of this['servers']['entries']()){_0x4d2ad6['push']({'name':_0xff4b84,'url':_0x5fa401['url'],'type':_0x5fa401['type']||'http'});}return{'action':_0x5d0fee(0x1c7),'servers':_0x4d2ad6,'success':!![]};}async[a0_0x73df7(0x1e4)](){const _0xa90746=a0_0x73df7;this['logger']['info']('Getting available tools from MCP servers');const _0x413e7b=[],_0x240755=[];for(const [_0x504511,_0x27215d]of this[_0xa90746(0x1c3)][_0xa90746(0x1d4)]()){try{const _0x6d0908=await this['getOrCreateClient'](_0x504511);if(!_0x6d0908){_0x240755[_0xa90746(0x1f1)]({'name':_0x504511,'error':'Failed\x20to\x20create\x20client'});continue;}const _0x5745c3=await _0x6d0908['listTools']();for(const _0x1f0816 of _0x5745c3){_0x413e7b['push']({'name':_0x504511+'/'+_0x1f0816['name'],'description':_0x1f0816[_0xa90746(0x21b)]||'No\x20description','server':_0x504511}),this['toolSchemas'][_0xa90746(0x1d1)](_0x504511+'/'+_0x1f0816['name'],_0x1f0816);}}catch(_0x63d939){this[_0xa90746(0x20b)][_0xa90746(0x203)](_0xa90746(0x206)+_0x504511+':',_0x63d939),_0x240755[_0xa90746(0x1f1)]({'name':_0x504511,'error':_0x63d939[_0xa90746(0x212)]});}}return{'action':_0xa90746(0x200),'tools':_0x413e7b,'failedServers':_0x240755,'success':!![]};}async['addServers'](_0xcf1769){const _0x5aa7e1=a0_0x73df7;this['logger']['info']('Adding\x20'+_0xcf1769['length']+_0x5aa7e1(0x1d8));const _0x70f6b5=[],_0x5f1d94=[];for(const _0x4d5a33 of _0xcf1769){try{if(!_0x4d5a33['name']||!_0x4d5a33[_0x5aa7e1(0x1e9)])throw new Error(_0x5aa7e1(0x1f0));let _0x15b804=_0x5aa7e1(0x1cc);_0x4d5a33['url']['startsWith']('http://')||_0x4d5a33[_0x5aa7e1(0x1e9)][_0x5aa7e1(0x1da)]('https://')?_0x15b804='http':_0x15b804=_0x5aa7e1(0x201),this[_0x5aa7e1(0x1c3)][_0x5aa7e1(0x1d1)](_0x4d5a33[_0x5aa7e1(0x1cb)],{'url':_0x4d5a33[_0x5aa7e1(0x1e9)],'type':_0x15b804}),_0x70f6b5['push'](_0x4d5a33[_0x5aa7e1(0x1cb)]);}catch(_0x53e70c){this['logger'][_0x5aa7e1(0x203)](_0x5aa7e1(0x216)+_0x4d5a33[_0x5aa7e1(0x1cb)]+':',_0x53e70c),_0x5f1d94['push']({'name':_0x4d5a33['name'],'error':_0x53e70c['message']});}}return await this[_0x5aa7e1(0x207)](),{'action':_0x5aa7e1(0x1e3),'addedServers':_0x70f6b5,'failedServers':_0x5f1d94,'success':_0x70f6b5['length']>0x0};}async['removeServer'](_0x278211){const _0x10f440=a0_0x73df7;this[_0x10f440(0x20b)][_0x10f440(0x1de)]('Removing\x20MCP\x20server:\x20'+_0x278211);if(!this[_0x10f440(0x1c3)]['has'](_0x278211))return{'action':_0x10f440(0x1c9),'serverName':_0x278211,'success':![],'error':'Server\x20\x27'+_0x278211+'\x27\x20does\x20not\x20exist'};if(this[_0x10f440(0x1ef)][_0x10f440(0x1c6)](_0x278211)){try{const _0x43bd91=this[_0x10f440(0x1ef)][_0x10f440(0x1fa)](_0x278211);await _0x43bd91['disconnect']();}catch(_0x5049b7){this[_0x10f440(0x20b)][_0x10f440(0x209)](_0x10f440(0x204)+_0x278211+':',_0x5049b7);}this[_0x10f440(0x1ef)]['delete'](_0x278211);}return this[_0x10f440(0x1c3)][_0x10f440(0x1f7)](_0x278211),await this['saveServers'](),{'action':'remove-server','serverName':_0x278211,'success':!![]};}async[a0_0x73df7(0x1e7)](_0x3c55a6){const _0xb3730e=a0_0x73df7;this[_0xb3730e(0x20b)][_0xb3730e(0x1de)]('Getting\x20schema\x20for\x20tool:\x20'+_0x3c55a6);const [_0x19d496,_0x5091f5]=_0x3c55a6[_0xb3730e(0x1d6)]('/');if(!_0x19d496||!_0x5091f5)throw new Error(_0xb3730e(0x1d0)+_0x3c55a6+_0xb3730e(0x1f4));if(!this[_0xb3730e(0x1c3)][_0xb3730e(0x1c6)](_0x19d496))throw new Error('Server\x20\x27'+_0x19d496+'\x27\x20does\x20not\x20exist');if(this['toolSchemas']['has'](_0x3c55a6))return{'action':_0xb3730e(0x211),'toolId':_0x3c55a6,'schema':this[_0xb3730e(0x1eb)][_0xb3730e(0x1fa)](_0x3c55a6),'success':!![]};const _0xce2a4c=await this['getOrCreateClient'](_0x19d496);if(!_0xce2a4c)throw new Error(_0xb3730e(0x1dd)+_0x19d496);const _0x415b59=await _0xce2a4c[_0xb3730e(0x20f)](),_0x312433=_0x415b59['find'](_0xf7ee55=>_0xf7ee55['name']===_0x5091f5);if(!_0x312433)throw new Error('Tool\x20\x27'+_0x5091f5+'\x27\x20not\x20found\x20on\x20server\x20\x27'+_0x19d496+'\x27');return this[_0xb3730e(0x1eb)][_0xb3730e(0x1d1)](_0x3c55a6,_0x312433),{'action':'get-tool-schema','toolId':_0x3c55a6,'schema':_0x312433,'success':!![]};}async[a0_0x73df7(0x1d3)](_0xed2d67){const _0x38c839=a0_0x73df7;this['logger']['info'](_0x38c839(0x1c2));if(!_0xed2d67||!_0xed2d67[_0x38c839(0x208)])throw new Error('Invalid\x20MCP\x20message\x20format.\x20Expected\x20{\x20tool_call:\x20{\x20name,\x20arguments\x20}\x20}');const {name:_0x87f21a,arguments:_0x2751c7}=_0xed2d67[_0x38c839(0x208)];if(!_0x87f21a||!_0x2751c7)throw new Error('Tool\x20call\x20must\x20have\x20name\x20and\x20arguments');const [_0x2fc7f9,_0x4fc148]=_0x87f21a['split']('/');if(!_0x2fc7f9||!_0x4fc148)throw new Error(_0x38c839(0x1d5)+_0x87f21a+_0x38c839(0x1f4));if(!this['servers']['has'](_0x2fc7f9))throw new Error(_0x38c839(0x1cd)+_0x2fc7f9+'\x27\x20does\x20not\x20exist');const _0x1bcca0=await this[_0x38c839(0x1e1)](_0x2fc7f9);if(!_0x1bcca0)throw new Error(_0x38c839(0x1dd)+_0x2fc7f9);const _0x4d5d82=await _0x1bcca0[_0x38c839(0x202)]({'name':_0x4fc148,'arguments':_0x2751c7});return{'action':'message-to-mcp','toolCall':{'name':_0x87f21a,'arguments':_0x2751c7},'result':_0x4d5d82,'success':!![]};}async[a0_0x73df7(0x1e1)](_0x2eede2){const _0x154709=a0_0x73df7;if(this['clients']['has'](_0x2eede2))return this[_0x154709(0x1ef)][_0x154709(0x1fa)](_0x2eede2);const _0x45bdfd=this['servers'][_0x154709(0x1fa)](_0x2eede2);if(!_0x45bdfd)return this[_0x154709(0x20b)][_0x154709(0x203)](_0x154709(0x1cd)+_0x2eede2+_0x154709(0x1ee)),null;try{const _0x50f8da=new Client({'name':_0x154709(0x20c),'version':_0x154709(0x1f9)});let _0x2c354c;if(_0x45bdfd['type']===_0x154709(0x1cc))_0x2c354c=new StreamableHTTPClientTransport(_0x45bdfd[_0x154709(0x1e9)]);else{if(_0x45bdfd['type']===_0x154709(0x201)){const _0x40b0f0=_0x45bdfd['url']['split']('\x20'),_0xc8d39a=_0x40b0f0[0x0],_0x2630f9=_0x40b0f0['slice'](0x1);_0x2c354c=new StdioClientTransport({'command':_0xc8d39a,'args':_0x2630f9});}else throw new Error('Unsupported\x20server\x20type:\x20'+_0x45bdfd['type']);}return await _0x50f8da['connect'](_0x2c354c),this[_0x154709(0x1ef)][_0x154709(0x1d1)](_0x2eede2,_0x50f8da),_0x50f8da;}catch(_0x3910c0){return this[_0x154709(0x20b)]['error']('Failed\x20to\x20create\x20MCP\x20client\x20for\x20server\x20\x27'+_0x2eede2+'\x27:',_0x3910c0),null;}}async[a0_0x73df7(0x207)](){const _0x36a716=a0_0x73df7;try{const _0x549b7e=a0_0x4de1a7[_0x36a716(0x1cf)](this['serverDirectory'],'servers.json'),_0x2a4875={};for(const [_0x30a7be,_0x39cd32]of this[_0x36a716(0x1c3)][_0x36a716(0x1d4)]()){_0x2a4875[_0x30a7be]=_0x39cd32;}await a0_0x250a62[_0x36a716(0x1e5)](_0x549b7e,JSON['stringify'](_0x2a4875,null,0x2),_0x36a716(0x1d2)),this[_0x36a716(0x20b)][_0x36a716(0x1de)](_0x36a716(0x214)+this[_0x36a716(0x1c3)][_0x36a716(0x1c4)]+'\x20MCP\x20servers\x20to\x20file');}catch(_0x34f595){this['logger'][_0x36a716(0x203)](_0x36a716(0x1e8),_0x34f595);}}async[a0_0x73df7(0x20a)](){const _0x10c1d9=a0_0x73df7;this['logger'][_0x10c1d9(0x1de)]('Shutting\x20down\x20MCP\x20client\x20tool');for(const [_0x116334,_0x1f8b00]of this[_0x10c1d9(0x1ef)][_0x10c1d9(0x1d4)]()){try{await _0x1f8b00['disconnect'](),this['logger']['info']('Disconnected\x20from\x20MCP\x20server:\x20'+_0x116334);}catch(_0x496902){this[_0x10c1d9(0x20b)][_0x10c1d9(0x209)]('Error\x20disconnecting\x20from\x20MCP\x20server\x20'+_0x116334+':',_0x496902);}}this[_0x10c1d9(0x1ef)]['clear']();}}