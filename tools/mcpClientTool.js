function a0_0xfd92(){const _0x2395c2=['zxjYB3i','C2vUze1LC3nHz2vuB01JCa','AM9PBG','zgLZy29UBMvJDa','rMfPBgvKihrVihbHCNnLie1ducbTzxnZywDLiePtt046','C2f2zvnLCNzLCNm','z2v0qxzHAwXHyMXLvg9VBhm','C2H1DgrVD24','rxjYB3iGzgLZy29UBMvJDgLUzYbMCM9TihnLCNzLCIa','zw50CMLLCW','Aw5MBW','y29UDgvUDa','C2XPy2u','C3bSAxq','C2vYDMvYrgLYzwn0B3j5','CMvHzezPBgu','jYbUB3qGzM91BMq','vw5ZDxbWB3j0zwqGC2vYDMvYihr5Cgu6ia','rMfPBgvKihrVignYzwf0zsbnq1aGC2vYDMvYigrPCMvJDg9YEtO','mtaZnZa3mtDcrfHpEvy','mtCWmdHkyuPOqvC','vg9VBcbJywXSig11C3qGAgf2zsbUyw1LigfUzcbHCMD1BwvUDhm','cK1ducbdBgLLBNqGvg9VBdOGqwXSB3DZihLVDsb0BYbPBNrLCMfJDcb3AxrOie1VzgvSienVBNrLEhqGuhjVDg9JB2WGke1ducKGC2vYDMvYCYb0BYbHy2nLC3mGzxH0zxjUywWGDg9VBhmGyw5KihjLC291CMnLCY4kcLvZywDLoGPBDg9VBcbPzd0IBwnWlwnSAwvUDcjDcLTNzxqTyxzHAwXHyMXLlxnLCNzLCNmGl10kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kcLTHzgqTC2vYDMvYC10kw3mGBMfTzt0IC2vYDMvYlw5HBwuIihvYBd0IAhr0CdOVl3nLCNzLCI11CMWIic9DcLSVywrKlxnLCNzLCNnDcGPBCMvTB3zLlxnLCNzLCL0kC2vYDMvYlw5HBwukwY9Yzw1VDMuTC2vYDMvYxqOkw2DLDc10B29SlxnJAgvTyv0kC2vYDMvYlw5HBwuVDg9VBc1Uyw1LcLSVz2v0lxrVB2WTC2nOzw1HxqOkw21LC3nHz2uTDg8TBwnWxqP7cIaGiNrVB2XFy2fSBci6ihSkicaGicjUyw1LiJOGiNnLCNzLCI1Uyw1Ll3rVB2WTBMfTzsiScIaGicaIyxjNDw1LBNrZiJOGEYaICgfYyw0XiJOGiNzHBhvLmsiSicjWyxjHBtiIoIaIDMfSDwuYiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kcKv4yw1WBgvZoGOXlIbmAxn0igf2ywLSywjSzsbnq1aGC2vYDMvYCZOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lwf2ywLSywjSzs1Zzxj2zxjZic9DcLSVDg9VBf0kcJiUieXPC3qGyxzHAwXHyMXLihrVB2XZigzYB20GywXSihnLCNzLCNm6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kwY90B29SxqOkmY4GqwrKigeGBMv3ie1ducbZzxj2zxi6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2fKzc1Zzxj2zxjZxqPBCYbUyw1LpsjZExn0zw0TDg9VBhmIihvYBd0IAhr0CdOVl2XVy2fSAg9ZDdOZmdaXiIaVxqPBl2fKzc1Zzxj2zxjZxqPBl3rVB2XDcGO0lIbszw1VDMuGyw4GtunqihnLCNzLCJOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBCMvTB3zLlxnLCNzLCL0kC3LZDgvTlxrVB2XZcLSVCMvTB3zLlxnLCNzLCL0kwY90B29SxqOkns4Gr2v0ihrOzsbZy2HLBweGzM9YigeGC3bLy2LMAwmGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lxrVB2WTC2nOzw1HxqPZExn0zw0TDg9VBhmVCNvUq29TBwfUzaPBl2DLDc10B29SlxnJAgvTyv0kwY90B29SxqOknI4Gq2fSBcbHBIbnq1aGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBBwvZC2fNzs10BY1Ty3bDcNSkicaIDg9VBf9JywXSiJOGEWOGicaGiM5HBwuIoIaIC3LZDgvTlxrVB2XZl3j1BKnVBw1HBMqIlaOGicaGiMfYz3vTzw50CYi6ihSGiMnVBw1HBMqIoIaIBhmGlwXHiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kicaGia','z2v0qxzHAwXHyMXLu2vYDMvYCW','u2vYDMvYig5HBwuGyw5KifvstcbHCMuGCMvXDwLYzwq','z2v0','rxjYB3iGCgfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNm6','ywn0Aw9U','BgLZDfrVB2XZ','C2v0','mtyXnZa2rLLUA2vi','oty2odG5s3rJrLHj','CMvTB3zLlxnLCNzLCG','ihnHDMvKie1ducbZzxj2zxjZ','D3jPDgvgAwXL','rMfPBgvKihrVignYzwf0zsbJBgLLBNq','BwTKAxi','CxvLCNK','y29Kzq','y29TBwfUzhm','Aw5PDgLHBgL6zvnLCNzLCKrPCMvJDg9YEq','Dg9VBf9JywXS','y2XPzw50CW','u2vUzgLUzYbTzxnZywDLihrVie1ducbZzxj2zxi','z2v0lwf2ywLSywjSzs1Zzxj2zxjZ','ywrKlxnLCNzLCNm','zgvSzxrL','zMLUza','BwvZC2fNzs10BY1Ty3a','rxjYB3iGzxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzca','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','Dg9VBfnJAgvTyxm','BgvUz3rO','z2v0t3jdCMvHDgvdBgLLBNq','sw52ywXPzcbnq1aGBwvZC2fNzsbMB3jTyxqUiev4CgvJDgvKihSGDg9VBf9JywXSoIb7ig5HBwuSigfYz3vTzw50CYb9ih0','D2fYBG','AgfZ','u2vYDMvYicC','DxjS','lIbfEhbLy3rLzcbMB3jTyxq6ihnLCNzLCK5HBwuVDg9VBe5HBwu','r2v0DgLUzYbHDMfPBgfIBguGtunqihnLCNzLCNm','mty3otG1sgnxs1fK','z2v0lwf2ywLSywjSzs10B29SCW','mJy0CfLXEfnM','Ahr0Chm6lY8','C3rHCNrZv2L0Aa','ugfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNmGD2L0AcbuywDqyxjZzxi','yxr0CMLIDxrLCW','CMvTB3zLu2vYDMvY','tM8GtunqignSAwvUDcbJB21Tyw5KCYbZCgvJAwzPzwq','BwnWlxnLCNzLCNm','C2vYDMvYCW','mJi2mtm3nerJsNPstq','ms4WlJa','uMvTB3zPBMCGtunqihnLCNzLCJOG','rMfPBgvKihrVigLUAxrPywXPEMuGtunqihnLCNzLCIbKAxjLy3rVCNK6','C2vYDMvYtMfTzq','mtmWt0vLC0ns','rxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzcb3AxrOihbHCMfTzxrLCNm6','z2v0vg9VBfnJAgvTyq','mty0otqWEMr3yxvj','CgfYC2vqyxjHBwv0zxjZ','mJy1mvPzvxr3tG','z2v0lxrVB2WTC2nOzw1H','BwvZC2fNzq','qwrKAw5Nia','ywrKu2vYDMvYCW','ndC3t1vpyxHk','C2L6zq','rMfPBgvKihrVigDLDcb0B29SCYbMCM9TihnLCNzLCIa','ChvZAa','u2f2zwqG','Bg9Nz2vY','zgvZy3jPChrPB24','Ahr0Ca','lMXVEgLHlxn0yxrL','BMfTzq','ie1ducbZzxj2zxjZ'];a0_0xfd92=function(){return _0x2395c2;};return a0_0xfd92();}const a0_0x181af4=a0_0x3e78;(function(_0x2c7729,_0xd4a40b){const _0x4cd935=a0_0x3e78,_0x524c8d=_0x2c7729();while(!![]){try{const _0x3c60b2=-parseInt(_0x4cd935(0x16d))/0x1+-parseInt(_0x4cd935(0x196))/0x2+-parseInt(_0x4cd935(0x143))/0x3*(-parseInt(_0x4cd935(0x162))/0x4)+parseInt(_0x4cd935(0x19b))/0x5*(-parseInt(_0x4cd935(0x16c))/0x6)+-parseInt(_0x4cd935(0x161))/0x7+-parseInt(_0x4cd935(0x18d))/0x8*(-parseInt(_0x4cd935(0x18b))/0x9)+parseInt(_0x4cd935(0x19e))/0xa*(parseInt(_0x4cd935(0x1a0))/0xb);if(_0x3c60b2===_0xd4a40b)break;else _0x524c8d['push'](_0x524c8d['shift']());}catch(_0xf0247d){_0x524c8d['push'](_0x524c8d['shift']());}}}(a0_0xfd92,0xf1062));import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';import{BaseTool}from'./baseTool.js';import{TagParser}from'../utilities/tagParser.js';import a0_0xdacece from'path';import a0_0x16706e from'fs/promises';function a0_0x3e78(_0x5d8a1a,_0xdd90e7){const _0xfd925d=a0_0xfd92();return a0_0x3e78=function(_0x3e7828,_0x26a5cb){_0x3e7828=_0x3e7828-0x140;let _0x245256=_0xfd925d[_0x3e7828];if(a0_0x3e78['NwiKyB']===undefined){var _0x4d6a7a=function(_0xdacece){const _0x16706e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5cc6a2='',_0x5e92a8='';for(let _0x3ea8dc=0x0,_0x4d8af4,_0x3f2497,_0x279d52=0x0;_0x3f2497=_0xdacece['charAt'](_0x279d52++);~_0x3f2497&&(_0x4d8af4=_0x3ea8dc%0x4?_0x4d8af4*0x40+_0x3f2497:_0x3f2497,_0x3ea8dc++%0x4)?_0x5cc6a2+=String['fromCharCode'](0xff&_0x4d8af4>>(-0x2*_0x3ea8dc&0x6)):0x0){_0x3f2497=_0x16706e['indexOf'](_0x3f2497);}for(let _0xa734ca=0x0,_0x807399=_0x5cc6a2['length'];_0xa734ca<_0x807399;_0xa734ca++){_0x5e92a8+='%'+('00'+_0x5cc6a2['charCodeAt'](_0xa734ca)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x5e92a8);};a0_0x3e78['omALPb']=_0x4d6a7a,_0x5d8a1a=arguments,a0_0x3e78['NwiKyB']=!![];}const _0x448dd5=_0xfd925d[0x0],_0x155db8=_0x3e7828+_0x448dd5,_0x4a4eab=_0x5d8a1a[_0x155db8];return!_0x4a4eab?(_0x245256=a0_0x3e78['omALPb'](_0x245256),_0x5d8a1a[_0x155db8]=_0x245256):_0x245256=_0x4a4eab,_0x245256;},a0_0x3e78(_0x5d8a1a,_0xdd90e7);}export class MCPClientTool extends BaseTool{constructor(_0x5cc6a2,_0x5e92a8){const _0x260786=a0_0x3e78;super(_0x5cc6a2,_0x5e92a8),this[_0x260786(0x195)]=new Map(),this[_0x260786(0x178)]=new Map(),this['toolSchemas']=new Map(),this['serverDirectory']=a0_0xdacece[_0x260786(0x150)](process['cwd'](),_0x260786(0x14b),_0x260786(0x194)),this['initializeServerDirectory']()['catch'](_0x3ea8dc=>{const _0x54379d=_0x260786;this[_0x54379d(0x148)][_0x54379d(0x14e)](_0x54379d(0x199),_0x3ea8dc);});}async[a0_0x181af4(0x176)](){const _0x73f115=a0_0x181af4;try{await a0_0x16706e[_0x73f115(0x172)](this[_0x73f115(0x15c)],{'recursive':!![]});try{const _0x4d8af4=a0_0xdacece['join'](this[_0x73f115(0x15c)],'servers.json'),_0x3f2497=await a0_0x16706e[_0x73f115(0x15d)](_0x4d8af4,'utf-8'),_0x279d52=JSON['parse'](_0x3f2497);for(const [_0xa734ca,_0x807399]of Object['entries'](_0x279d52)){this[_0x73f115(0x195)]['set'](_0xa734ca,_0x807399);}this['logger']['info']('Loaded\x20'+this[_0x73f115(0x195)]['size']+_0x73f115(0x16f));}catch(_0x177599){_0x177599[_0x73f115(0x174)]!=='ENOENT'&&this[_0x73f115(0x148)][_0x73f115(0x185)]('Failed\x20to\x20load\x20saved\x20MCP\x20servers:',_0x177599);}}catch(_0xde4477){this[_0x73f115(0x148)]['error'](_0x73f115(0x160),_0xde4477);}}['getDescription'](){const _0x430f69=a0_0x181af4;return _0x430f69(0x164);}[a0_0x181af4(0x19f)](_0x311ca4){const _0x70f1f1=a0_0x181af4;this['logger'][_0x70f1f1(0x158)](_0x70f1f1(0x190));const _0x360145={'commands':[]};try{const _0x471ee0=TagParser['query'](_0x311ca4,_0x70f1f1(0x17a));_0x471ee0[_0x70f1f1(0x182)]>0x0&&_0x360145['commands'][_0x70f1f1(0x146)]({'action':'get-available-servers'});const _0x675a79=TagParser[_0x70f1f1(0x173)](_0x311ca4,_0x70f1f1(0x18c));_0x675a79['length']>0x0&&_0x360145[_0x70f1f1(0x175)][_0x70f1f1(0x146)]({'action':'get-available-tools'});const _0x480dc0=TagParser[_0x70f1f1(0x173)](_0x311ca4,_0x70f1f1(0x17b));for(const _0x442554 of _0x480dc0){const _0x18608b=TagParser[_0x70f1f1(0x173)](_0x442554[_0x70f1f1(0x159)],'s'),_0x57f06e=[];for(const _0x42b710 of _0x18608b){const _0xb7bcd=_0x42b710[_0x70f1f1(0x191)]['name'],_0x211ed6=_0x42b710[_0x70f1f1(0x191)]['url'];_0xb7bcd&&_0x211ed6&&_0x57f06e['push']({'name':_0xb7bcd,'url':_0x211ed6});}_0x57f06e['length']>0x0&&_0x360145['commands']['push']({'action':_0x70f1f1(0x17b),'servers':_0x57f06e});}const _0x2c218a=TagParser['query'](_0x311ca4,_0x70f1f1(0x16e));for(const _0x95c52d of _0x2c218a){const _0x27f601=_0x95c52d['content']['trim']();_0x27f601&&_0x360145['commands'][_0x70f1f1(0x146)]({'action':'remove-server','serverName':_0x27f601});}const _0x17ae4f=TagParser[_0x70f1f1(0x173)](_0x311ca4,_0x70f1f1(0x1a1));for(const _0x4bf8b8 of _0x17ae4f){const _0x4883c=_0x4bf8b8[_0x70f1f1(0x159)]['trim']();_0x4883c&&_0x360145['commands']['push']({'action':'get-tool-schema','toolId':_0x4883c});}const _0x5bcdc3=TagParser['query'](_0x311ca4,_0x70f1f1(0x17e));for(const _0x40a968 of _0x5bcdc3){const _0xaaf49a=_0x40a968['content']['trim']();if(_0xaaf49a){let _0x51535c;try{_0x51535c=JSON['parse'](_0xaaf49a);}catch(_0x31e655){this[_0x70f1f1(0x148)]['error'](_0x70f1f1(0x152),_0x31e655);continue;}_0x360145[_0x70f1f1(0x175)]['push']({'action':_0x70f1f1(0x17e),'message':_0x51535c});}}return _0x360145;}catch(_0x14a18f){return this[_0x70f1f1(0x148)][_0x70f1f1(0x14e)](_0x70f1f1(0x168),_0x14a18f),{'commands':[]};}}async['executeWithParameters'](_0x23fcde,_0x953438){const _0x25902e=a0_0x181af4;this[_0x25902e(0x148)]['info'](_0x25902e(0x19c),_0x23fcde);const _0x4aaca2=[];if(!_0x23fcde[_0x25902e(0x175)]||_0x23fcde['commands'][_0x25902e(0x182)]===0x0)throw new Error(_0x25902e(0x193));for(const _0x5f4fa5 of _0x23fcde['commands']){try{let _0x8d37e7;switch(_0x5f4fa5[_0x25902e(0x169)]){case'get-available-servers':_0x8d37e7=await this['getAvailableServers']();break;case _0x25902e(0x18c):_0x8d37e7=await this[_0x25902e(0x154)]();break;case _0x25902e(0x17b):_0x8d37e7=await this['addServers'](_0x5f4fa5['servers']);break;case'remove-server':_0x8d37e7=await this[_0x25902e(0x192)](_0x5f4fa5[_0x25902e(0x19a)]);break;case _0x25902e(0x1a1):_0x8d37e7=await this[_0x25902e(0x19d)](_0x5f4fa5['toolId']);break;case'message-to-mcp':_0x8d37e7=await this['sendMessageToMcp'](_0x5f4fa5['message']);break;default:throw new Error('Unknown\x20MCP\x20client\x20command:\x20'+_0x5f4fa5[_0x25902e(0x169)]);}_0x4aaca2[_0x25902e(0x146)](_0x8d37e7);}catch(_0x1086ae){this[_0x25902e(0x148)][_0x25902e(0x14e)](_0x25902e(0x17f)+_0x5f4fa5[_0x25902e(0x169)]+':',_0x1086ae),_0x4aaca2['push']({'action':_0x5f4fa5[_0x25902e(0x169)],'success':![],'error':_0x1086ae[_0x25902e(0x140)]});}}return{'results':_0x4aaca2};}async[a0_0x181af4(0x165)](){const _0x2c3584=a0_0x181af4;this['logger']['info'](_0x2c3584(0x18a));const _0x5bed42=[];for(const [_0x3474d6,_0x9876aa]of this[_0x2c3584(0x195)][_0x2c3584(0x157)]()){_0x5bed42['push']({'name':_0x3474d6,'url':_0x9876aa['url'],'type':_0x9876aa['type']||_0x2c3584(0x14a)});}return{'action':'get-available-servers','servers':_0x5bed42,'success':!![]};}async[a0_0x181af4(0x154)](){const _0xe3be86=a0_0x181af4;this['logger'][_0xe3be86(0x158)]('Getting available tools from MCP servers');const _0x490d4d=[],_0x91b465=[];for(const [_0x28c1d2,_0x227b5f]of this['servers'][_0xe3be86(0x157)]()){try{const _0x11c8d8=await this[_0xe3be86(0x183)](_0x28c1d2);if(!_0x11c8d8){_0x91b465['push']({'name':_0x28c1d2,'error':_0xe3be86(0x171)});continue;}const _0x135f4e=await _0x11c8d8[_0xe3be86(0x16a)]();for(const _0x568bb0 of _0x135f4e){_0x490d4d[_0xe3be86(0x146)]({'name':_0x28c1d2+'/'+_0x568bb0[_0xe3be86(0x14c)],'description':_0x568bb0[_0xe3be86(0x149)]||'No\x20description','server':_0x28c1d2}),this['toolSchemas']['set'](_0x28c1d2+'/'+_0x568bb0[_0xe3be86(0x14c)],_0x568bb0);}}catch(_0x3f3537){this[_0xe3be86(0x148)]['error'](_0xe3be86(0x145)+_0x28c1d2+':',_0x3f3537),_0x91b465[_0xe3be86(0x146)]({'name':_0x28c1d2,'error':_0x3f3537['message']});}}return{'action':'get-available-tools','tools':_0x490d4d,'failedServers':_0x91b465,'success':!![]};}async[a0_0x181af4(0x142)](_0x2d49a1){const _0x2a21aa=a0_0x181af4;this['logger'][_0x2a21aa(0x158)](_0x2a21aa(0x141)+_0x2d49a1[_0x2a21aa(0x182)]+_0x2a21aa(0x14d));const _0x421034=[],_0x163eca=[];for(const _0x3df75a of _0x2d49a1){try{if(!_0x3df75a[_0x2a21aa(0x14c)]||!_0x3df75a['url'])throw new Error(_0x2a21aa(0x166));let _0x6d45c3=_0x2a21aa(0x14a);_0x3df75a['url'][_0x2a21aa(0x18f)]('http://')||_0x3df75a[_0x2a21aa(0x188)][_0x2a21aa(0x18f)](_0x2a21aa(0x18e))?_0x6d45c3=_0x2a21aa(0x14a):_0x6d45c3='stdio',this[_0x2a21aa(0x195)][_0x2a21aa(0x16b)](_0x3df75a['name'],{'url':_0x3df75a[_0x2a21aa(0x188)],'type':_0x6d45c3}),_0x421034['push'](_0x3df75a['name']);}catch(_0x3b0193){this['logger']['error']('Failed\x20to\x20add\x20server\x20'+_0x3df75a['name']+':',_0x3b0193),_0x163eca[_0x2a21aa(0x146)]({'name':_0x3df75a[_0x2a21aa(0x14c)],'error':_0x3b0193[_0x2a21aa(0x140)]});}}return await this['saveServers'](),{'action':'add-servers','addedServers':_0x421034,'failedServers':_0x163eca,'success':_0x421034[_0x2a21aa(0x182)]>0x0};}async['removeServer'](_0x27213a){const _0x45cefd=a0_0x181af4;this['logger']['info'](_0x45cefd(0x198)+_0x27213a);if(!this[_0x45cefd(0x195)][_0x45cefd(0x186)](_0x27213a))return{'action':'remove-server','serverName':_0x27213a,'success':![],'error':_0x45cefd(0x187)+_0x27213a+'\x27\x20does\x20not\x20exist'};if(this[_0x45cefd(0x178)][_0x45cefd(0x186)](_0x27213a)){try{const _0x5d7fc1=this['clients']['get'](_0x27213a);await _0x5d7fc1['disconnect']();}catch(_0x36c70d){this[_0x45cefd(0x148)]['warn'](_0x45cefd(0x156)+_0x27213a+':',_0x36c70d);}this[_0x45cefd(0x178)][_0x45cefd(0x17c)](_0x27213a);}return this[_0x45cefd(0x195)][_0x45cefd(0x17c)](_0x27213a),await this[_0x45cefd(0x153)](),{'action':_0x45cefd(0x16e),'serverName':_0x27213a,'success':!![]};}async['getToolSchema'](_0x31ffc1){const _0x18bd16=a0_0x181af4;this['logger']['info']('Getting\x20schema\x20for\x20tool:\x20'+_0x31ffc1);const [_0x269942,_0x63425b]=_0x31ffc1['split']('/');if(!_0x269942||!_0x63425b)throw new Error('Invalid\x20tool\x20ID\x20format:\x20'+_0x31ffc1+_0x18bd16(0x189));if(!this[_0x18bd16(0x195)]['has'](_0x269942))throw new Error(_0x18bd16(0x187)+_0x269942+'\x27\x20does\x20not\x20exist');if(this['toolSchemas']['has'](_0x31ffc1))return{'action':_0x18bd16(0x1a1),'toolId':_0x31ffc1,'schema':this[_0x18bd16(0x181)]['get'](_0x31ffc1),'success':!![]};const _0x1e4b2e=await this[_0x18bd16(0x183)](_0x269942);if(!_0x1e4b2e)throw new Error(_0x18bd16(0x180)+_0x269942);const _0x5ef290=await _0x1e4b2e[_0x18bd16(0x16a)](),_0x317e0c=_0x5ef290[_0x18bd16(0x17d)](_0x126293=>_0x126293['name']===_0x63425b);if(!_0x317e0c)throw new Error('Tool\x20\x27'+_0x63425b+'\x27\x20not\x20found\x20on\x20server\x20\x27'+_0x269942+'\x27');return this[_0x18bd16(0x181)]['set'](_0x31ffc1,_0x317e0c),{'action':'get-tool-schema','toolId':_0x31ffc1,'schema':_0x317e0c,'success':!![]};}async[a0_0x181af4(0x14f)](_0x4ae6cc){const _0x14eaf6=a0_0x181af4;this['logger']['info'](_0x14eaf6(0x179));if(!_0x4ae6cc||!_0x4ae6cc[_0x14eaf6(0x177)])throw new Error(_0x14eaf6(0x184));const {name:_0x54c4cf,arguments:_0x3f07f5}=_0x4ae6cc['tool_call'];if(!_0x54c4cf||!_0x3f07f5)throw new Error(_0x14eaf6(0x163));const [_0x921982,_0x430f12]=_0x54c4cf[_0x14eaf6(0x15b)]('/');if(!_0x921982||!_0x430f12)throw new Error('Invalid\x20tool\x20name\x20format:\x20'+_0x54c4cf+_0x14eaf6(0x189));if(!this['servers'][_0x14eaf6(0x186)](_0x921982))throw new Error('Server\x20\x27'+_0x921982+'\x27\x20does\x20not\x20exist');const _0x457b7c=await this['getOrCreateClient'](_0x921982);if(!_0x457b7c)throw new Error(_0x14eaf6(0x180)+_0x921982);const _0x462cb4=await _0x457b7c['callTool']({'name':_0x430f12,'arguments':_0x3f07f5});return{'action':_0x14eaf6(0x17e),'toolCall':{'name':_0x54c4cf,'arguments':_0x3f07f5},'result':_0x462cb4,'success':!![]};}async[a0_0x181af4(0x183)](_0x5439b8){const _0x4d953e=a0_0x181af4;if(this['clients'][_0x4d953e(0x186)](_0x5439b8))return this[_0x4d953e(0x178)][_0x4d953e(0x167)](_0x5439b8);const _0x4afff1=this[_0x4d953e(0x195)][_0x4d953e(0x167)](_0x5439b8);if(!_0x4afff1)return this[_0x4d953e(0x148)]['error'](_0x4d953e(0x187)+_0x5439b8+_0x4d953e(0x15e)),null;try{const _0x355f5f=new Client({'name':'loxia-mcp-client','version':_0x4d953e(0x197)});let _0xc6f289;if(_0x4afff1['type']===_0x4d953e(0x14a))_0xc6f289=new StreamableHTTPClientTransport(_0x4afff1[_0x4d953e(0x188)]);else{if(_0x4afff1['type']==='stdio'){const _0x219a76=_0x4afff1['url'][_0x4d953e(0x15b)]('\x20'),_0x39b228=_0x219a76[0x0],_0x1cd516=_0x219a76[_0x4d953e(0x15a)](0x1);_0xc6f289=new StdioClientTransport({'command':_0x39b228,'args':_0x1cd516});}else throw new Error(_0x4d953e(0x15f)+_0x4afff1['type']);}return await _0x355f5f['connect'](_0xc6f289),this['clients']['set'](_0x5439b8,_0x355f5f),_0x355f5f;}catch(_0x3314d1){return this['logger'][_0x4d953e(0x14e)]('Failed\x20to\x20create\x20MCP\x20client\x20for\x20server\x20\x27'+_0x5439b8+'\x27:',_0x3314d1),null;}}async['saveServers'](){const _0x3bc87e=a0_0x181af4;try{const _0x1d0593=a0_0xdacece['join'](this[_0x3bc87e(0x15c)],'servers.json'),_0x4e37c0={};for(const [_0x3d0126,_0x3a77ed]of this['servers']['entries']()){_0x4e37c0[_0x3d0126]=_0x3a77ed;}await a0_0x16706e[_0x3bc87e(0x170)](_0x1d0593,JSON['stringify'](_0x4e37c0,null,0x2),'utf-8'),this['logger'][_0x3bc87e(0x158)](_0x3bc87e(0x147)+this[_0x3bc87e(0x195)][_0x3bc87e(0x144)]+'\x20MCP\x20servers\x20to\x20file');}catch(_0x2579c0){this['logger'][_0x3bc87e(0x14e)]('Failed\x20to\x20save\x20MCP\x20servers\x20to\x20file:',_0x2579c0);}}async[a0_0x181af4(0x155)](){const _0x5c8bcd=a0_0x181af4;this[_0x5c8bcd(0x148)][_0x5c8bcd(0x158)]('Shutting\x20down\x20MCP\x20client\x20tool');for(const [_0x5ba230,_0x46674d]of this[_0x5c8bcd(0x178)][_0x5c8bcd(0x157)]()){try{await _0x46674d[_0x5c8bcd(0x151)](),this[_0x5c8bcd(0x148)]['info']('Disconnected\x20from\x20MCP\x20server:\x20'+_0x5ba230);}catch(_0x26e86e){this['logger']['warn']('Error\x20disconnecting\x20from\x20MCP\x20server\x20'+_0x5ba230+':',_0x26e86e);}}this[_0x5c8bcd(0x178)]['clear']();}}