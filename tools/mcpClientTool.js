const a0_0x522b2a=a0_0x2ee0;(function(_0x500a34,_0x1f302d){const _0x4b4db8=a0_0x2ee0,_0x1530a7=_0x500a34();while(!![]){try{const _0x194f7f=-parseInt(_0x4b4db8(0x1a0))/0x1+parseInt(_0x4b4db8(0x1ea))/0x2+parseInt(_0x4b4db8(0x198))/0x3+-parseInt(_0x4b4db8(0x1a6))/0x4+-parseInt(_0x4b4db8(0x199))/0x5+-parseInt(_0x4b4db8(0x1e4))/0x6+-parseInt(_0x4b4db8(0x1dc))/0x7*(-parseInt(_0x4b4db8(0x1e1))/0x8);if(_0x194f7f===_0x1f302d)break;else _0x1530a7['push'](_0x1530a7['shift']());}catch(_0x236775){_0x1530a7['push'](_0x1530a7['shift']());}}}(a0_0x346e,0x6a3a7));import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';function a0_0x2ee0(_0x181be0,_0x38f01c){const _0x346e0c=a0_0x346e();return a0_0x2ee0=function(_0x2ee082,_0x1d5010){_0x2ee082=_0x2ee082-0x198;let _0x4dd47e=_0x346e0c[_0x2ee082];if(a0_0x2ee0['iqFuWq']===undefined){var _0x1b98ad=function(_0x207c7e){const _0x8ef21a='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4eb1f6='',_0x2f75d3='';for(let _0x1267a6=0x0,_0x531a46,_0x39701d,_0x3b5438=0x0;_0x39701d=_0x207c7e['charAt'](_0x3b5438++);~_0x39701d&&(_0x531a46=_0x1267a6%0x4?_0x531a46*0x40+_0x39701d:_0x39701d,_0x1267a6++%0x4)?_0x4eb1f6+=String['fromCharCode'](0xff&_0x531a46>>(-0x2*_0x1267a6&0x6)):0x0){_0x39701d=_0x8ef21a['indexOf'](_0x39701d);}for(let _0x555a17=0x0,_0xa547eb=_0x4eb1f6['length'];_0x555a17<_0xa547eb;_0x555a17++){_0x2f75d3+='%'+('00'+_0x4eb1f6['charCodeAt'](_0x555a17)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2f75d3);};a0_0x2ee0['UdcACa']=_0x1b98ad,_0x181be0=arguments,a0_0x2ee0['iqFuWq']=!![];}const _0x493362=_0x346e0c[0x0],_0x2d4543=_0x2ee082+_0x493362,_0x116fc3=_0x181be0[_0x2d4543];return!_0x116fc3?(_0x4dd47e=a0_0x2ee0['UdcACa'](_0x4dd47e),_0x181be0[_0x2d4543]=_0x4dd47e):_0x4dd47e=_0x116fc3,_0x4dd47e;},a0_0x2ee0(_0x181be0,_0x38f01c);}import{BaseTool}from'./baseTool.js';import{TagParser}from'../utilities/tagParser.js';import a0_0x207c7e from'path';function a0_0x346e(){const _0x5920bf=['z2v0qxzHAwXHyMXLu2vYDMvYCW','Dg9VBeLK','ndyZnZK0mej2rgnIvq','rMfPBgvKihrVignYzwf0zsbnq1aGy2XPzw50igzVCIbZzxj2zxiGjW','z2v0lwf2ywLSywjSzs1Zzxj2zxjZ','rxjYB3iGCgfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNm6','u2f2zwqG','sw52ywXPzcbnq1aGBwvZC2fNzsbMB3jTyxqUiev4CgvJDgvKihSGDg9VBf9JywXSoIb7ig5HBwuSigfYz3vTzw50CYb9ih0','mtuWmtG3nKTjtMvQua','CMvTB3zLlxnLCNzLCG','C2v0','ntCYnta1wuTcqwji','mJqZnti4nuHsr1zZqW','Ahr0Ca','ywrKu2vYDMvYCW','C2H1DgrVD24','BwTKAxi','CxvLCNK','rxjYB3iGzxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzca','nZGWndfqBe1Jy00','C3rHCNrZv2L0Aa','rMfPBgvKihrVihnHDMuGtunqihnLCNzLCNmGDg8GzMLSztO','BwvZC2fNzq','y2fSBfrVB2W','D3jPDgvgAwXL','mZKZnty4yuTPquPU','u2vUzgLUzYbTzxnZywDLihrVie1ducbZzxj2zxi','CMvTB3zLu2vYDMvY','y29UBMvJDa','y29TBwfUzhm','C2vYDMvYCY5QC29U','zxjYB3i','z2v0vg9VBfnJAgvTyq','Dg9VBfnJAgvTyxm','ywrKlxnLCNzLCNm','Aw5MBW','z2v0lxrVB2WTC2nOzw1H','sw52ywXPzcb0B29SieLeigzVCM1HDdOG','Dg9VBf9JywXS','vg9VBcaN','C3bSAxq','rMfPBgvKihrVignYzwf0zsbnq1aGC2vYDMvYigrPCMvJDg9YEtO','ie1ducbZzxj2zxjZ','AgfZ','Ahr0Chm6lY8','BMfTzq','Bg9Nz2vY','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','zw50CMLLCW','C2vUze1LC3nHz2vuB01JCa','ms4WlJa','D2fYBG','u2H1DhrPBMCGzg93BIbnq1aGy2XPzw50ihrVB2W','y2XPzw50CW','ugfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNmGD2L0AcbuywDqyxjZzxi','r2v0DgLUzYbHDMfPBgfIBguGtunqihnLCNzLCNm','CMvHzezPBgu','z2v0qxzHAwXHyMXLvg9VBhm','DhjPBq','z2v0t3jdCMvHDgvdBgLLBNq','C2f2zvnLCNzLCNm','AM9PBG','r2v0DgLUzYbZy2HLBweGzM9YihrVB2W6ia','BgLZDfrVB2XZ','jYbKB2vZig5VDcbLEgLZDa','BgvUz3rO','Aw5PDgLHBgL6zvnLCNzLCKrPCMvJDg9YEq','ChvZAa','C2vYDMvYCW','rxHLy3v0Aw5Nie1ducbJBgLLBNqGy29TBwfUzcb3AxrOihbHCMfTzxrLCNm6','DxjS','u2vYDMvYicC','DhLWzq','qwrKAw5Nia','z2v0','C3rKAw8','C2vYDMvYrgLYzwn0B3j5','C2L6zq','rgLZy29UBMvJDgvKigzYB20GtunqihnLCNzLCJOG','nJuWodCYnKrOt3rPzq','z2v0lwf2ywLSywjSzs10B29SCW','rMfPBgvKihrVihbHCNnLie1ducbTzxnZywDLiePtt046','ywn0Aw9U','zMLUza','ohDHvvP0qW'];a0_0x346e=function(){return _0x5920bf;};return a0_0x346e();}import a0_0x8ef21a from'fs/promises';export class MCPClientTool extends BaseTool{constructor(_0x4eb1f6,_0x2f75d3){const _0x309db6=a0_0x2ee0;super(_0x4eb1f6,_0x2f75d3),this[_0x309db6(0x1d1)]=new Map(),this['clients']=new Map(),this['toolSchemas']=new Map(),this[_0x309db6(0x1d9)]=a0_0x207c7e['join'](process['cwd'](),'.loxia-state','mcp-servers'),this[_0x309db6(0x1cf)]()['catch'](_0x1267a6=>{this['logger']['error']('Failed\x20to\x20initialize\x20MCP\x20server\x20directory:',_0x1267a6);});}async['initializeServerDirectory'](){const _0x2ed938=a0_0x2ee0;try{await a0_0x8ef21a[_0x2ed938(0x19d)](this['serverDirectory'],{'recursive':!![]});try{const _0x531a46=a0_0x207c7e['join'](this['serverDirectory'],_0x2ed938(0x1ab)),_0x39701d=await a0_0x8ef21a[_0x2ed938(0x1c5)](_0x531a46,'utf-8'),_0x3b5438=JSON['parse'](_0x39701d);for(const [_0x555a17,_0xa547eb]of Object['entries'](_0x3b5438)){this['servers']['set'](_0x555a17,_0xa547eb);}this[_0x2ed938(0x1bb)]['info']('Loaded\x20'+this[_0x2ed938(0x1d1)][_0x2ed938(0x1da)]+'\x20saved\x20MCP\x20servers');}catch(_0x129216){_0x129216['code']!=='ENOENT'&&this[_0x2ed938(0x1bb)][_0x2ed938(0x1c0)]('Failed\x20to\x20load\x20saved\x20MCP\x20servers:',_0x129216);}}catch(_0x22bc3f){this[_0x2ed938(0x1bb)][_0x2ed938(0x1ac)](_0x2ed938(0x1b6),_0x22bc3f);}}['getDescription'](){return'\x0aMCP\x20Client\x20Tool:\x20Allows\x20you\x20to\x20interact\x20with\x20Model\x20Context\x20Protocol\x20(MCP)\x20servers\x20to\x20access\x20external\x20tools\x20and\x20resources.\x0a\x0aUsage:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[get-available-tools\x20/]\x0a\x0a[add-servers]\x0a[s\x20name=\x22server-name\x22\x20url=\x22http://server-url\x22\x20/]\x0a[/add-servers]\x0a\x0a[remove-server]\x0aserver-name\x0a[/remove-server]\x0a\x0a[get-tool-schema]\x0aserver-name/tool-name\x0a[/get-tool-schema]\x0a\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22server-name/tool-name\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22param1\x22:\x20\x22value1\x22,\x20\x22param2\x22:\x20\x22value2\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20List\x20available\x20MCP\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-servers\x20/]\x0a[/tool]\x0a\x0a2.\x20List\x20available\x20tools\x20from\x20all\x20servers:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-available-tools\x20/]\x0a[/tool]\x0a\x0a3.\x20Add\x20a\x20new\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[add-servers]\x0a[s\x20name=\x22system-tools\x22\x20url=\x22http://localhost:3001\x22\x20/]\x0a[/add-servers]\x0a[/tool]\x0a\x0a4.\x20Remove\x20an\x20MCP\x20server:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[remove-server]\x0asystem-tools\x0a[/remove-server]\x0a[/tool]\x0a\x0a5.\x20Get\x20the\x20schema\x20for\x20a\x20specific\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[get-tool-schema]\x0asystem-tools/runCommand\x0a[/get-tool-schema]\x0a[/tool]\x0a\x0a6.\x20Call\x20an\x20MCP\x20tool:\x0a[tool\x20id=\x22mcp-client\x22]\x0a[message-to-mcp]\x0a{\x0a\x20\x20\x22tool_call\x22:\x20{\x0a\x20\x20\x20\x20\x22name\x22:\x20\x22system-tools/runCommand\x22,\x0a\x20\x20\x20\x20\x22arguments\x22:\x20{\x20\x22command\x22:\x20\x22ls\x20-la\x22\x20}\x0a\x20\x20}\x0a}\x0a[/message-to-mcp]\x0a[/tool]\x0a\x20\x20\x20\x20';}['parseParameters'](_0xba5a15){const _0xba2f00=a0_0x2ee0;this['logger']['info'](_0xba2f00(0x1c3));const _0x4d4c1d={'commands':[]};try{const _0xe6620d=TagParser['query'](_0xba5a15,'get-available-servers');_0xe6620d['length']>0x0&&_0x4d4c1d['commands']['push']({'action':_0xba2f00(0x1e6)});const _0x271108=TagParser[_0xba2f00(0x19e)](_0xba5a15,'get-available-tools');_0x271108['length']>0x0&&_0x4d4c1d['commands'][_0xba2f00(0x1d0)]({'action':'get-available-tools'});const _0x1f9376=TagParser[_0xba2f00(0x19e)](_0xba5a15,'add-servers');for(const _0x25c998 of _0x1f9376){const _0x22399c=TagParser[_0xba2f00(0x19e)](_0x25c998['content'],'s'),_0x303be6=[];for(const _0x2dea6e of _0x22399c){const _0x10bc83=_0x2dea6e['attributes']['name'],_0x275f0e=_0x2dea6e['attributes']['url'];_0x10bc83&&_0x275f0e&&_0x303be6['push']({'name':_0x10bc83,'url':_0x275f0e});}_0x303be6[_0xba2f00(0x1ce)]>0x0&&_0x4d4c1d['commands'][_0xba2f00(0x1d0)]({'action':_0xba2f00(0x1af),'servers':_0x303be6});}const _0x9ca007=TagParser['query'](_0xba5a15,'remove-server');for(const _0x5d148f of _0x9ca007){const _0x13d63e=_0x5d148f['content'][_0xba2f00(0x1c7)]();_0x13d63e&&_0x4d4c1d['commands'][_0xba2f00(0x1d0)]({'action':'remove-server','serverName':_0x13d63e});}const _0x8d6809=TagParser[_0xba2f00(0x19e)](_0xba5a15,_0xba2f00(0x1b1));for(const _0x486783 of _0x8d6809){const _0x1b765b=_0x486783['content']['trim']();_0x1b765b&&_0x4d4c1d['commands']['push']({'action':_0xba2f00(0x1b1),'toolId':_0x1b765b});}const _0x2206de=TagParser[_0xba2f00(0x19e)](_0xba5a15,'message-to-mcp');for(const _0x1b4552 of _0x2206de){const _0x3e25d6=_0x1b4552['content'][_0xba2f00(0x1c7)]();if(_0x3e25d6){let _0x3200fe;try{_0x3200fe=JSON['parse'](_0x3e25d6);}catch(_0xb2f994){this['logger'][_0xba2f00(0x1ac)](_0xba2f00(0x1de),_0xb2f994);continue;}_0x4d4c1d[_0xba2f00(0x1aa)]['push']({'action':'message-to-mcp','message':_0x3200fe});}}return _0x4d4c1d;}catch(_0xbbc8e){return this[_0xba2f00(0x1bb)][_0xba2f00(0x1ac)](_0xba2f00(0x1e7),_0xbbc8e),{'commands':[]};}}async['executeWithParameters'](_0x10d985,_0x2aaefb){const _0x29bdb2=a0_0x2ee0;this[_0x29bdb2(0x1bb)]['info'](_0x29bdb2(0x1d2),_0x10d985);const _0x35215c=[];if(!_0x10d985[_0x29bdb2(0x1aa)]||_0x10d985[_0x29bdb2(0x1aa)][_0x29bdb2(0x1ce)]===0x0)throw new Error('No\x20MCP\x20client\x20commands\x20specified');for(const _0x344b79 of _0x10d985[_0x29bdb2(0x1aa)]){try{let _0x2396e8;switch(_0x344b79[_0x29bdb2(0x1df)]){case _0x29bdb2(0x1e6):_0x2396e8=await this[_0x29bdb2(0x1e2)]();break;case'get-available-tools':_0x2396e8=await this['getAvailableTools']();break;case'add-servers':_0x2396e8=await this[_0x29bdb2(0x19b)](_0x344b79['servers']);break;case'remove-server':_0x2396e8=await this['removeServer'](_0x344b79['serverName']);break;case _0x29bdb2(0x1b1):_0x2396e8=await this[_0x29bdb2(0x1ad)](_0x344b79[_0x29bdb2(0x1e3)]);break;case'message-to-mcp':_0x2396e8=await this[_0x29bdb2(0x1be)](_0x344b79[_0x29bdb2(0x1a3)]);break;default:throw new Error('Unknown\x20MCP\x20client\x20command:\x20'+_0x344b79['action']);}_0x35215c['push'](_0x2396e8);}catch(_0x346cce){this['logger'][_0x29bdb2(0x1ac)](_0x29bdb2(0x19f)+_0x344b79['action']+':',_0x346cce),_0x35215c['push']({'action':_0x344b79['action'],'success':![],'error':_0x346cce['message']});}}return{'results':_0x35215c};}async[a0_0x522b2a(0x1e2)](){const _0x32d6a8=a0_0x522b2a;this[_0x32d6a8(0x1bb)][_0x32d6a8(0x1b0)](_0x32d6a8(0x1c4));const _0x4a85ec=[];for(const [_0xfea6f8,_0x56b457]of this['servers']['entries']()){_0x4a85ec[_0x32d6a8(0x1d0)]({'name':_0xfea6f8,'url':_0x56b457['url'],'type':_0x56b457[_0x32d6a8(0x1d5)]||'http'});}return{'action':'get-available-servers','servers':_0x4a85ec,'success':!![]};}async[a0_0x522b2a(0x1c6)](){const _0x493f94=a0_0x522b2a;this['logger']['info']('Getting available tools from MCP servers');const _0x334909=[],_0x251660=[];for(const [_0x44bd6a,_0x4f53ed]of this[_0x493f94(0x1d1)][_0x493f94(0x1bd)]()){try{const _0x42e2fa=await this['getOrCreateClient'](_0x44bd6a);if(!_0x42e2fa){_0x251660[_0x493f94(0x1d0)]({'name':_0x44bd6a,'error':'Failed\x20to\x20create\x20client'});continue;}const _0x9dc4e3=await _0x42e2fa['listTools']();for(const _0x1ec2be of _0x9dc4e3){_0x334909[_0x493f94(0x1d0)]({'name':_0x44bd6a+'/'+_0x1ec2be['name'],'description':_0x1ec2be['description']||'No\x20description','server':_0x44bd6a}),this[_0x493f94(0x1ae)]['set'](_0x44bd6a+'/'+_0x1ec2be['name'],_0x1ec2be);}}catch(_0x47f450){this['logger'][_0x493f94(0x1ac)]('Failed\x20to\x20get\x20tools\x20from\x20server\x20'+_0x44bd6a+':',_0x47f450),_0x251660['push']({'name':_0x44bd6a,'error':_0x47f450[_0x493f94(0x1a3)]});}}return{'action':_0x493f94(0x1dd),'tools':_0x334909,'failedServers':_0x251660,'success':!![]};}async['addServers'](_0x43c4d2){const _0x2b6404=a0_0x522b2a;this[_0x2b6404(0x1bb)][_0x2b6404(0x1b0)](_0x2b6404(0x1d6)+_0x43c4d2[_0x2b6404(0x1ce)]+_0x2b6404(0x1b7));const _0x537838=[],_0x29477f=[];for(const _0x228409 of _0x43c4d2){try{if(!_0x228409['name']||!_0x228409[_0x2b6404(0x1d3)])throw new Error('Server\x20name\x20and\x20URL\x20are\x20required');let _0x5ec7f2=_0x2b6404(0x19a);_0x228409[_0x2b6404(0x1d3)][_0x2b6404(0x1a1)]('http://')||_0x228409['url'][_0x2b6404(0x1a1)](_0x2b6404(0x1b9))?_0x5ec7f2=_0x2b6404(0x19a):_0x5ec7f2=_0x2b6404(0x1d8),this[_0x2b6404(0x1d1)]['set'](_0x228409['name'],{'url':_0x228409['url'],'type':_0x5ec7f2}),_0x537838['push'](_0x228409['name']);}catch(_0x1a62fc){this[_0x2b6404(0x1bb)]['error']('Failed\x20to\x20add\x20server\x20'+_0x228409[_0x2b6404(0x1ba)]+':',_0x1a62fc),_0x29477f[_0x2b6404(0x1d0)]({'name':_0x228409['name'],'error':_0x1a62fc['message']});}}return await this['saveServers'](),{'action':_0x2b6404(0x1af),'addedServers':_0x537838,'failedServers':_0x29477f,'success':_0x537838['length']>0x0};}async[a0_0x522b2a(0x1a8)](_0x8495e3){const _0x2d2e71=a0_0x522b2a;this['logger']['info']('Removing\x20MCP\x20server:\x20'+_0x8495e3);if(!this[_0x2d2e71(0x1d1)]['has'](_0x8495e3))return{'action':_0x2d2e71(0x1eb),'serverName':_0x8495e3,'success':![],'error':_0x2d2e71(0x1d4)+_0x8495e3+'\x27\x20does\x20not\x20exist'};if(this[_0x2d2e71(0x1c2)]['has'](_0x8495e3)){try{const _0x406930=this[_0x2d2e71(0x1c2)]['get'](_0x8495e3);await _0x406930['disconnect']();}catch(_0x555918){this['logger']['warn']('Error\x20disconnecting\x20from\x20server\x20'+_0x8495e3+':',_0x555918);}this[_0x2d2e71(0x1c2)]['delete'](_0x8495e3);}return this[_0x2d2e71(0x1d1)]['delete'](_0x8495e3),await this[_0x2d2e71(0x1c9)](),{'action':'remove-server','serverName':_0x8495e3,'success':!![]};}async[a0_0x522b2a(0x1ad)](_0x594701){const _0x54047c=a0_0x522b2a;this['logger'][_0x54047c(0x1b0)](_0x54047c(0x1cb)+_0x594701);const [_0xdbf9f5,_0x103029]=_0x594701[_0x54047c(0x1b5)]('/');if(!_0xdbf9f5||!_0x103029)throw new Error(_0x54047c(0x1b2)+_0x594701+'.\x20Expected\x20format:\x20serverName/toolName');if(!this[_0x54047c(0x1d1)][_0x54047c(0x1b8)](_0xdbf9f5))throw new Error('Server\x20\x27'+_0xdbf9f5+_0x54047c(0x1cd));if(this[_0x54047c(0x1ae)][_0x54047c(0x1b8)](_0x594701))return{'action':'get-tool-schema','toolId':_0x594701,'schema':this['toolSchemas'][_0x54047c(0x1d7)](_0x594701),'success':!![]};const _0x25f3ab=await this['getOrCreateClient'](_0xdbf9f5);if(!_0x25f3ab)throw new Error(_0x54047c(0x1bc)+_0xdbf9f5);const _0x31b749=await _0x25f3ab[_0x54047c(0x1cc)](),_0x1f0c71=_0x31b749[_0x54047c(0x1e0)](_0x5064ad=>_0x5064ad['name']===_0x103029);if(!_0x1f0c71)throw new Error(_0x54047c(0x1b4)+_0x103029+'\x27\x20not\x20found\x20on\x20server\x20\x27'+_0xdbf9f5+'\x27');return this['toolSchemas'][_0x54047c(0x1ec)](_0x594701,_0x1f0c71),{'action':'get-tool-schema','toolId':_0x594701,'schema':_0x1f0c71,'success':!![]};}async[a0_0x522b2a(0x1be)](_0x3a1565){const _0x77ddcd=a0_0x522b2a;this[_0x77ddcd(0x1bb)][_0x77ddcd(0x1b0)](_0x77ddcd(0x1a7));if(!_0x3a1565||!_0x3a1565['tool_call'])throw new Error(_0x77ddcd(0x1e9));const {name:_0x3d6758,arguments:_0x1b6c5b}=_0x3a1565[_0x77ddcd(0x1b3)];if(!_0x3d6758||!_0x1b6c5b)throw new Error('Tool\x20call\x20must\x20have\x20name\x20and\x20arguments');const [_0x26a356,_0x19c2f3]=_0x3d6758[_0x77ddcd(0x1b5)]('/');if(!_0x26a356||!_0x19c2f3)throw new Error('Invalid\x20tool\x20name\x20format:\x20'+_0x3d6758+'.\x20Expected\x20format:\x20serverName/toolName');if(!this[_0x77ddcd(0x1d1)][_0x77ddcd(0x1b8)](_0x26a356))throw new Error('Server\x20\x27'+_0x26a356+'\x27\x20does\x20not\x20exist');const _0x14ce0c=await this[_0x77ddcd(0x1c8)](_0x26a356);if(!_0x14ce0c)throw new Error(_0x77ddcd(0x1bc)+_0x26a356);const _0x5b70e4=await _0x14ce0c[_0x77ddcd(0x1a4)]({'name':_0x19c2f3,'arguments':_0x1b6c5b});return{'action':'message-to-mcp','toolCall':{'name':_0x3d6758,'arguments':_0x1b6c5b},'result':_0x5b70e4,'success':!![]};}async[a0_0x522b2a(0x1c8)](_0xb272d){const _0xe7f350=a0_0x522b2a;if(this['clients'][_0xe7f350(0x1b8)](_0xb272d))return this['clients']['get'](_0xb272d);const _0x13d146=this['servers'][_0xe7f350(0x1d7)](_0xb272d);if(!_0x13d146)return this[_0xe7f350(0x1bb)][_0xe7f350(0x1ac)](_0xe7f350(0x1d4)+_0xb272d+'\x27\x20not\x20found'),null;try{const _0x5deda6=new Client({'name':'loxia-mcp-client','version':_0xe7f350(0x1bf)});let _0x35d996;if(_0x13d146['type']===_0xe7f350(0x19a))_0x35d996=new StreamableHTTPClientTransport(_0x13d146['url']);else{if(_0x13d146['type']==='stdio'){const _0xfd177=_0x13d146[_0xe7f350(0x1d3)]['split']('\x20'),_0x1e0644=_0xfd177[0x0],_0xbe007=_0xfd177['slice'](0x1);_0x35d996=new StdioClientTransport({'command':_0x1e0644,'args':_0xbe007});}else throw new Error('Unsupported\x20server\x20type:\x20'+_0x13d146[_0xe7f350(0x1d5)]);}return await _0x5deda6[_0xe7f350(0x1a9)](_0x35d996),this['clients']['set'](_0xb272d,_0x5deda6),_0x5deda6;}catch(_0x39c773){return this['logger'][_0xe7f350(0x1ac)](_0xe7f350(0x1e5)+_0xb272d+'\x27:',_0x39c773),null;}}async['saveServers'](){const _0x316486=a0_0x522b2a;try{const _0x4a8ac1=a0_0x207c7e[_0x316486(0x1ca)](this[_0x316486(0x1d9)],'servers.json'),_0x474ef8={};for(const [_0x44cea3,_0x43601a]of this['servers']['entries']()){_0x474ef8[_0x44cea3]=_0x43601a;}await a0_0x8ef21a[_0x316486(0x1a5)](_0x4a8ac1,JSON['stringify'](_0x474ef8,null,0x2),'utf-8'),this[_0x316486(0x1bb)][_0x316486(0x1b0)](_0x316486(0x1e8)+this['servers']['size']+'\x20MCP\x20servers\x20to\x20file');}catch(_0x27248a){this[_0x316486(0x1bb)][_0x316486(0x1ac)](_0x316486(0x1a2),_0x27248a);}}async[a0_0x522b2a(0x19c)](){const _0x17ec4c=a0_0x522b2a;this['logger'][_0x17ec4c(0x1b0)](_0x17ec4c(0x1c1));for(const [_0x256792,_0x54224b]of this[_0x17ec4c(0x1c2)]['entries']()){try{await _0x54224b['disconnect'](),this[_0x17ec4c(0x1bb)][_0x17ec4c(0x1b0)](_0x17ec4c(0x1db)+_0x256792);}catch(_0x49db63){this['logger']['warn']('Error\x20disconnecting\x20from\x20MCP\x20server\x20'+_0x256792+':',_0x49db63);}}this['clients']['clear']();}}