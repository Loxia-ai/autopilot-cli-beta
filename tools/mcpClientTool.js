const a0_0x1c9da7=a0_0x396a;(function(_0x209d88,_0x4a9291){const _0x5bdecd=a0_0x396a,_0x5ed9d4=_0x209d88();while(!![]){try{const _0xc72f2b=parseInt(_0x5bdecd(0x1fa))/0x1*(parseInt(_0x5bdecd(0x224))/0x2)+-parseInt(_0x5bdecd(0x1e4))/0x3*(-parseInt(_0x5bdecd(0x207))/0x4)+-parseInt(_0x5bdecd(0x1f0))/0x5*(parseInt(_0x5bdecd(0x1e5))/0x6)+-parseInt(_0x5bdecd(0x21b))/0x7*(parseInt(_0x5bdecd(0x22e))/0x8)+-parseInt(_0x5bdecd(0x202))/0x9*(parseInt(_0x5bdecd(0x1e1))/0xa)+parseInt(_0x5bdecd(0x214))/0xb+parseInt(_0x5bdecd(0x1f2))/0xc*(parseInt(_0x5bdecd(0x222))/0xd);if(_0xc72f2b===_0x4a9291)break;else _0x5ed9d4['push'](_0x5ed9d4['shift']());}catch(_0xef76f2){_0x5ed9d4['push'](_0x5ed9d4['shift']());}}}(a0_0x554a,0x47547));function a0_0x396a(_0x2325f9,_0x5e2c83){const _0x554a22=a0_0x554a();return a0_0x396a=function(_0x396a1a,_0x3cd214){_0x396a1a=_0x396a1a-0x1de;let _0xbe1819=_0x554a22[_0x396a1a];if(a0_0x396a['jmaHKw']===undefined){var _0x572701=function(_0x4f3c1f){const _0x15082d='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2fff81='',_0xddf353='';for(let _0x4eb475=0x0,_0x1218a5,_0x3ca1ec,_0x12bda9=0x0;_0x3ca1ec=_0x4f3c1f['charAt'](_0x12bda9++);~_0x3ca1ec&&(_0x1218a5=_0x4eb475%0x4?_0x1218a5*0x40+_0x3ca1ec:_0x3ca1ec,_0x4eb475++%0x4)?_0x2fff81+=String['fromCharCode'](0xff&_0x1218a5>>(-0x2*_0x4eb475&0x6)):0x0){_0x3ca1ec=_0x15082d['indexOf'](_0x3ca1ec);}for(let _0x1ae75e=0x0,_0x4da9db=_0x2fff81['length'];_0x1ae75e<_0x4da9db;_0x1ae75e++){_0xddf353+='%'+('00'+_0x2fff81['charCodeAt'](_0x1ae75e)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0xddf353);};a0_0x396a['wuLzUY']=_0x572701,_0x2325f9=arguments,a0_0x396a['jmaHKw']=!![];}const _0x12838b=_0x554a22[0x0],_0x16502d=_0x396a1a+_0x12838b,_0x378c6b=_0x2325f9[_0x16502d];return!_0x378c6b?(_0xbe1819=a0_0x396a['wuLzUY'](_0xbe1819),_0x2325f9[_0x16502d]=_0xbe1819):_0xbe1819=_0x378c6b,_0xbe1819;},a0_0x396a(_0x2325f9,_0x5e2c83);}import{Client}from'@modelcontextprotocol/sdk/client/index.js';import{StdioClientTransport}from'@modelcontextprotocol/sdk/client/stdio.js';import{StreamableHTTPClientTransport}from'@modelcontextprotocol/sdk/client/streamableHttp.js';import{BaseTool}from'./baseTool.js';import{TagParser}from'../utilities/tagParser.js';function a0_0x554a(){const _0x265118=['mti1mJuYqvHTsvPi','y2fSBfrVB2W','C2L6zq','z2v0lxrVB2WTC2nOzw1H','Aw5MBW','ie1ducbZzxj2zxjZ','rMfPBgvKihrVignVBM5Ly3qGDg8GC2vYDMvYoIa','lMXVEgLHlxn0yxrL','ChvZAa','BgLZDfrVB2XZ','z2v0qxzHAwXHyMXLu2vYDMvYCW','rMfPBgvKihrVihnHDMuGtunqihnLCNzLCNmGDg8GzMLSztO','u2H1DhrPBMCGzg93BIbnq1aGy2XPzw50ihrVB2W','mtq3ndi2ngTYAKzhuG','z2v0qxzHAwXHyMXLvg9VBhm','Dg9VBeLK','z2v0','rMfPBgvKihrVihbHCNnLie1ducbTzxnZywDLiePtt046','C3bSAxq','sw52ywXPzcb0B29SieLeigzVCM1HDdOG','mJm5mJy5ogneq0rTuG','vg9VBcbJywXSig11C3qGAgf2zsbUyw1LigfUzcbHCMD1BwvUDhm','CMvHzezPBgu','BwvZC2fNzq','Aw5PDgLHBgL6zvnLCNzLCKrPCMvJDg9YEq','BMfTzq','CMvTB3zLlxnLCNzLCG','mJqXofrYwLrVCG','Bg9Nz2vY','mtqZnLzHA2LMEa','DxjS','lIbfEhbLy3rLzcbMB3jTyxq6ihnLCNzLCK5HBwuVDg9VBe5HBwu','rMfPBgvKihrVignYzwf0zsbnq1aGy2XPzw50igzVCIbZzxj2zxiGjW','y29UDgvUDa','rMfPBgvKihrVignYzwf0zsbJBgLLBNq','ywrKlxnLCNzLCNm','AM9PBG','ywn0Aw9U','BwvZC2fNzs10BY1Ty3a','oeHyr0XPCq','jYbUB3qGzM91BMq','rMfPBgvKihrVigDLDcb0B29SCYbMCM9TihnLCNzLCIa','DhLWzq','yxr0CMLIDxrLCW','jYbKB2vZig5VDcbLEgLZDa','rMfPBgvKihrVigLUAxrPywXPEMuGtunqihnLCNzLCIbKAxjLy3rVCNK6','Ahr0Chm6lY8','C3rKAw8','ywrKu2vYDMvYCW','z2v0lwf2ywLSywjSzs10B29SCW','y2XPzw50CW','mtq4mtbICej1ufm','CgfYC2u','C2vYDMvYCY5QC29U','ndvpu1rvweG','mtHeseLtsgu','u2vYDMvYicC','C2vYDMvYCW','Ahr0CdOVlW','C2vYDMvYrgLYzwn0B3j5','BgvUz3rO','DxrMltG','C2f2zvnLCNzLCNm','zxjYB3i','z2v0lwf2ywLSywjSzs1Zzxj2zxjZ','C2vUze1LC3nHz2vuB01JCa','mti3mJeWs2PuBKnJ','rMfPBgvKihrVigXVywqGC2f2zwqGtunqihnLCNzLCNm6','nZG5nLHYCxrjuW','DhjPBq','y29TBwfUzhm','BwnWlxnLCNzLCNm','CxvLCNK','C3rHCNrZv2L0Aa','zw50CMLLCW','ms4WlJa','ndrqvMXKu0S','Ahr0Ca','Dg9VBfnJAgvTyxm','tg9HzgvKia','AgfZ','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','D2fYBG','C3rYAw5NAwz5','mJG4rhrmAMTs','rxjYB3iGCgfYC2LUzYbnq1aGy2XPzw50ihbHCMfTzxrLCNm6','C2v0','zgvSzxrL','cK1ducbdBgLLBNqGvg9VBdOGqwXSB3DZihLVDsb0BYbPBNrLCMfJDcb3AxrOie1VzgvSienVBNrLEhqGuhjVDg9JB2WGke1ducKGC2vYDMvYCYb0BYbHy2nLC3mGzxH0zxjUywWGDg9VBhmGyw5KihjLC291CMnLCY4kcLvZywDLoGPBDg9VBcbPzd0IBwnWlwnSAwvUDcjDcLTNzxqTyxzHAwXHyMXLlxnLCNzLCNmGl10kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kcLTHzgqTC2vYDMvYC10kw3mGBMfTzt0IC2vYDMvYlw5HBwuIihvYBd0IAhr0CdOVl3nLCNzLCI11CMWIic9DcLSVywrKlxnLCNzLCNnDcGPBCMvTB3zLlxnLCNzLCL0kC2vYDMvYlw5HBwukwY9Yzw1VDMuTC2vYDMvYxqOkw2DLDc10B29SlxnJAgvTyv0kC2vYDMvYlw5HBwuVDg9VBc1Uyw1LcLSVz2v0lxrVB2WTC2nOzw1HxqOkw21LC3nHz2uTDg8TBwnWxqP7cIaGiNrVB2XFy2fSBci6ihSkicaGicjUyw1LiJOGiNnLCNzLCI1Uyw1Ll3rVB2WTBMfTzsiScIaGicaIyxjNDw1LBNrZiJOGEYaICgfYyw0XiJOGiNzHBhvLmsiSicjWyxjHBtiIoIaIDMfSDwuYiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kcKv4yw1WBgvZoGOXlIbmAxn0igf2ywLSywjSzsbnq1aGC2vYDMvYCZOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lwf2ywLSywjSzs1Zzxj2zxjZic9DcLSVDg9VBf0kcJiUieXPC3qGyxzHAwXHyMXLihrVB2XZigzYB20GywXSihnLCNzLCNm6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2DLDc1HDMfPBgfIBguTDg9VBhmGl10kwY90B29SxqOkmY4GqwrKigeGBMv3ie1ducbZzxj2zxi6cLT0B29SigLKpsjTy3aTy2XPzw50iL0kw2fKzc1Zzxj2zxjZxqPBCYbUyw1LpsjZExn0zw0TDg9VBhmIihvYBd0IAhr0CdOVl2XVy2fSAg9ZDdOZmdaXiIaVxqPBl2fKzc1Zzxj2zxjZxqPBl3rVB2XDcGO0lIbszw1VDMuGyw4GtunqihnLCNzLCJOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBCMvTB3zLlxnLCNzLCL0kC3LZDgvTlxrVB2XZcLSVCMvTB3zLlxnLCNzLCL0kwY90B29SxqOkns4Gr2v0ihrOzsbZy2HLBweGzM9YigeGC3bLy2LMAwmGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBz2v0lxrVB2WTC2nOzw1HxqPZExn0zw0TDg9VBhmVCNvUq29TBwfUzaPBl2DLDc10B29SlxnJAgvTyv0kwY90B29SxqOknI4Gq2fSBcbHBIbnq1aGDg9VBdOkw3rVB2WGAwq9iM1JCc1JBgLLBNqIxqPBBwvZC2fNzs10BY1Ty3bDcNSkicaIDg9VBf9JywXSiJOGEWOGicaGiM5HBwuIoIaIC3LZDgvTlxrVB2XZl3j1BKnVBw1HBMqIlaOGicaGiMfYz3vTzw50CYi6ihSGiMnVBw1HBMqIoIaIBhmGlwXHiIb9cIaGFqP9cLSVBwvZC2fNzs10BY1Ty3bDcLSVDg9VBf0kicaGia'];a0_0x554a=function(){return _0x265118;};return a0_0x554a();}import a0_0x4f3c1f from'path';import a0_0x15082d from'fs/promises';export class MCPClientTool extends BaseTool{constructor(_0x2fff81,_0xddf353){const _0x2d8a78=a0_0x396a;super(_0x2fff81,_0xddf353),this['servers']=new Map(),this['clients']=new Map(),this[_0x2d8a78(0x1fc)]=new Map(),this['serverDirectory']=a0_0x4f3c1f[_0x2d8a78(0x22b)](process['cwd'](),_0x2d8a78(0x20e),_0x2d8a78(0x1f5)),this[_0x2d8a78(0x21f)]()['catch'](_0x4eb475=>{const _0x36b141=_0x2d8a78;this['logger']['error'](_0x36b141(0x234),_0x4eb475);});}async[a0_0x1c9da7(0x21f)](){const _0x573c3c=a0_0x1c9da7;try{await a0_0x15082d['mkdir'](this[_0x573c3c(0x1e9)],{'recursive':!![]});try{const _0x1218a5=a0_0x4f3c1f[_0x573c3c(0x22b)](this['serverDirectory'],'servers.json'),_0x3ca1ec=await a0_0x15082d[_0x573c3c(0x21d)](_0x1218a5,_0x573c3c(0x1eb)),_0x12bda9=JSON[_0x573c3c(0x1e2)](_0x3ca1ec);for(const [_0x1ae75e,_0x4da9db]of Object[_0x573c3c(0x1f8)](_0x12bda9)){this[_0x573c3c(0x1e7)]['set'](_0x1ae75e,_0x4da9db);}this['logger']['info'](_0x573c3c(0x1fd)+this[_0x573c3c(0x1e7)]['size']+'\x20saved\x20MCP\x20servers');}catch(_0x3fc004){_0x3fc004['code']!=='ENOENT'&&this[_0x573c3c(0x223)]['warn'](_0x573c3c(0x1f1),_0x3fc004);}}catch(_0x264e74){this['logger'][_0x573c3c(0x1ed)]('Failed\x20to\x20create\x20MCP\x20server\x20directory:',_0x264e74);}}['getDescription'](){const _0x57ca7b=a0_0x1c9da7;return _0x57ca7b(0x206);}['parseParameters'](_0x47c7d0){const _0x24d855=a0_0x1c9da7;this[_0x24d855(0x223)]['info']('Parsing\x20MCP\x20client\x20parameters\x20with\x20TagParser');const _0x214c3e={'commands':[]};try{const _0x3f6afc=TagParser[_0x24d855(0x1f6)](_0x47c7d0,_0x24d855(0x1ee));_0x3f6afc[_0x24d855(0x1ea)]>0x0&&_0x214c3e['commands'][_0x24d855(0x20f)]({'action':'get-available-servers'});const _0x32fdfb=TagParser['query'](_0x47c7d0,'get-available-tools');_0x32fdfb[_0x24d855(0x1ea)]>0x0&&_0x214c3e['commands'][_0x24d855(0x20f)]({'action':_0x24d855(0x1df)});const _0x316048=TagParser['query'](_0x47c7d0,_0x24d855(0x22a));for(const _0x3888c5 of _0x316048){const _0x19a96a=TagParser['query'](_0x3888c5[_0x24d855(0x228)],'s'),_0x17e81a=[];for(const _0x547c7c of _0x19a96a){const _0x1b1562=_0x547c7c[_0x24d855(0x232)]['name'],_0x46c533=_0x547c7c[_0x24d855(0x232)][_0x24d855(0x225)];_0x1b1562&&_0x46c533&&_0x17e81a['push']({'name':_0x1b1562,'url':_0x46c533});}_0x17e81a[_0x24d855(0x1ea)]>0x0&&_0x214c3e[_0x24d855(0x1f4)]['push']({'action':_0x24d855(0x22a),'servers':_0x17e81a});}const _0x7454a4=TagParser[_0x24d855(0x1f6)](_0x47c7d0,'remove-server');for(const _0x531f72 of _0x7454a4){const _0x1542d5=_0x531f72['content'][_0x24d855(0x1f3)]();_0x1542d5&&_0x214c3e[_0x24d855(0x1f4)]['push']({'action':_0x24d855(0x221),'serverName':_0x1542d5});}const _0x494769=TagParser['query'](_0x47c7d0,_0x24d855(0x20a));for(const _0xb4d501 of _0x494769){const _0x259f5d=_0xb4d501['content']['trim']();_0x259f5d&&_0x214c3e[_0x24d855(0x1f4)][_0x24d855(0x20f)]({'action':_0x24d855(0x20a),'toolId':_0x259f5d});}const _0x349b63=TagParser['query'](_0x47c7d0,'message-to-mcp');for(const _0x357571 of _0x349b63){const _0x5bf7b1=_0x357571[_0x24d855(0x228)]['trim']();if(_0x5bf7b1){let _0x46deba;try{_0x46deba=JSON['parse'](_0x5bf7b1);}catch(_0x303b75){this['logger'][_0x24d855(0x1ed)](_0x24d855(0x218),_0x303b75);continue;}_0x214c3e[_0x24d855(0x1f4)]['push']({'action':'message-to-mcp','message':_0x46deba});}}return _0x214c3e;}catch(_0x3748d5){return this[_0x24d855(0x223)][_0x24d855(0x1ed)](_0x24d855(0x203),_0x3748d5),{'commands':[]};}}async[a0_0x1c9da7(0x1ff)](_0x1c826b,_0x57475d){const _0x2287e6=a0_0x1c9da7;this[_0x2287e6(0x223)][_0x2287e6(0x20b)]('Executing\x20MCP\x20client\x20command\x20with\x20parameters:',_0x1c826b);const _0x2bd000=[];if(!_0x1c826b[_0x2287e6(0x1f4)]||_0x1c826b['commands']['length']===0x0)throw new Error('No\x20MCP\x20client\x20commands\x20specified');for(const _0x3fee78 of _0x1c826b[_0x2287e6(0x1f4)]){try{let _0x15f658;switch(_0x3fee78['action']){case'get-available-servers':_0x15f658=await this[_0x2287e6(0x211)]();break;case'get-available-tools':_0x15f658=await this[_0x2287e6(0x215)]();break;case'add-servers':_0x15f658=await this[_0x2287e6(0x1de)](_0x3fee78[_0x2287e6(0x1e7)]);break;case _0x2287e6(0x221):_0x15f658=await this['removeServer'](_0x3fee78['serverName']);break;case _0x2287e6(0x20a):_0x15f658=await this['getToolSchema'](_0x3fee78[_0x2287e6(0x216)]);break;case'message-to-mcp':_0x15f658=await this[_0x2287e6(0x1ef)](_0x3fee78[_0x2287e6(0x21e)]);break;default:throw new Error('Unknown\x20MCP\x20client\x20command:\x20'+_0x3fee78['action']);}_0x2bd000[_0x2287e6(0x20f)](_0x15f658);}catch(_0x456e1d){this['logger']['error']('Error\x20executing\x20MCP\x20client\x20command\x20'+_0x3fee78['action']+':',_0x456e1d),_0x2bd000['push']({'action':_0x3fee78[_0x2287e6(0x22c)],'success':![],'error':_0x456e1d[_0x2287e6(0x21e)]});}}return{'results':_0x2bd000};}async[a0_0x1c9da7(0x211)](){const _0x3c9d71=a0_0x1c9da7;this['logger'][_0x3c9d71(0x20b)]('Getting\x20available\x20MCP\x20servers');const _0x65ebc7=[];for(const [_0x4a2cd1,_0x816a1c]of this['servers'][_0x3c9d71(0x1f8)]()){_0x65ebc7[_0x3c9d71(0x20f)]({'name':_0x4a2cd1,'url':_0x816a1c[_0x3c9d71(0x225)],'type':_0x816a1c['type']||_0x3c9d71(0x1fb)});}return{'action':_0x3c9d71(0x1ee),'servers':_0x65ebc7,'success':!![]};}async[a0_0x1c9da7(0x215)](){const _0x5de948=a0_0x1c9da7;this['logger'][_0x5de948(0x20b)]('Getting available tools from MCP servers');const _0x4d15a1=[],_0x26a351=[];for(const [_0x6f21e4,_0x47382f]of this[_0x5de948(0x1e7)]['entries']()){try{const _0x43890a=await this['getOrCreateClient'](_0x6f21e4);if(!_0x43890a){_0x26a351[_0x5de948(0x20f)]({'name':_0x6f21e4,'error':_0x5de948(0x229)});continue;}const _0x18d4c9=await _0x43890a['listTools']();for(const _0x3835a4 of _0x18d4c9){_0x4d15a1[_0x5de948(0x20f)]({'name':_0x6f21e4+'/'+_0x3835a4['name'],'description':_0x3835a4['description']||'No\x20description','server':_0x6f21e4}),this['toolSchemas'][_0x5de948(0x204)](_0x6f21e4+'/'+_0x3835a4[_0x5de948(0x220)],_0x3835a4);}}catch(_0x48584e){this['logger']['error'](_0x5de948(0x230)+_0x6f21e4+':',_0x48584e),_0x26a351[_0x5de948(0x20f)]({'name':_0x6f21e4,'error':_0x48584e['message']});}}return{'action':_0x5de948(0x1df),'tools':_0x4d15a1,'failedServers':_0x26a351,'success':!![]};}async['addServers'](_0x27c77f){const _0x586570=a0_0x1c9da7;this[_0x586570(0x223)]['info']('Adding\x20'+_0x27c77f['length']+_0x586570(0x20c));const _0x32cbc7=[],_0x2cd3d0=[];for(const _0xbeabb7 of _0x27c77f){try{if(!_0xbeabb7[_0x586570(0x220)]||!_0xbeabb7[_0x586570(0x225)])throw new Error('Server\x20name\x20and\x20URL\x20are\x20required');let _0x4b9d72=_0x586570(0x1fb);_0xbeabb7['url'][_0x586570(0x1f7)](_0x586570(0x1e8))||_0xbeabb7[_0x586570(0x225)]['startsWith'](_0x586570(0x235))?_0x4b9d72='http':_0x4b9d72='stdio',this['servers'][_0x586570(0x204)](_0xbeabb7[_0x586570(0x220)],{'url':_0xbeabb7['url'],'type':_0x4b9d72}),_0x32cbc7[_0x586570(0x20f)](_0xbeabb7['name']);}catch(_0x51803d){this[_0x586570(0x223)][_0x586570(0x1ed)]('Failed\x20to\x20add\x20server\x20'+_0xbeabb7['name']+':',_0x51803d),_0x2cd3d0[_0x586570(0x20f)]({'name':_0xbeabb7[_0x586570(0x220)],'error':_0x51803d[_0x586570(0x21e)]});}}return await this['saveServers'](),{'action':_0x586570(0x22a),'addedServers':_0x32cbc7,'failedServers':_0x2cd3d0,'success':_0x32cbc7[_0x586570(0x1ea)]>0x0};}async['removeServer'](_0x1ad5af){const _0x38a6a2=a0_0x1c9da7;this[_0x38a6a2(0x223)][_0x38a6a2(0x20b)]('Removing\x20MCP\x20server:\x20'+_0x1ad5af);if(!this[_0x38a6a2(0x1e7)][_0x38a6a2(0x1fe)](_0x1ad5af))return{'action':'remove-server','serverName':_0x1ad5af,'success':![],'error':_0x38a6a2(0x1e6)+_0x1ad5af+'\x27\x20does\x20not\x20exist'};if(this[_0x38a6a2(0x1e0)][_0x38a6a2(0x1fe)](_0x1ad5af)){try{const _0x57f531=this[_0x38a6a2(0x1e0)]['get'](_0x1ad5af);await _0x57f531['disconnect']();}catch(_0x473bad){this['logger']['warn']('Error\x20disconnecting\x20from\x20server\x20'+_0x1ad5af+':',_0x473bad);}this[_0x38a6a2(0x1e0)][_0x38a6a2(0x205)](_0x1ad5af);}return this[_0x38a6a2(0x1e7)][_0x38a6a2(0x205)](_0x1ad5af),await this['saveServers'](),{'action':'remove-server','serverName':_0x1ad5af,'success':!![]};}async['getToolSchema'](_0x3f881c){const _0x2da5c9=a0_0x1c9da7;this['logger']['info']('Getting\x20schema\x20for\x20tool:\x20'+_0x3f881c);const [_0x56c0fb,_0xafeca]=_0x3f881c['split']('/');if(!_0x56c0fb||!_0xafeca)throw new Error(_0x2da5c9(0x21a)+_0x3f881c+_0x2da5c9(0x226));if(!this['servers']['has'](_0x56c0fb))throw new Error('Server\x20\x27'+_0x56c0fb+_0x2da5c9(0x233));if(this['toolSchemas']['has'](_0x3f881c))return{'action':_0x2da5c9(0x20a),'toolId':_0x3f881c,'schema':this[_0x2da5c9(0x1fc)][_0x2da5c9(0x217)](_0x3f881c),'success':!![]};const _0x3893c3=await this['getOrCreateClient'](_0x56c0fb);if(!_0x3893c3)throw new Error('Failed\x20to\x20connect\x20to\x20server:\x20'+_0x56c0fb);const _0xa4fd50=await _0x3893c3[_0x2da5c9(0x210)](),_0x45cee9=_0xa4fd50['find'](_0x2ea41a=>_0x2ea41a['name']===_0xafeca);if(!_0x45cee9)throw new Error('Tool\x20\x27'+_0xafeca+'\x27\x20not\x20found\x20on\x20server\x20\x27'+_0x56c0fb+'\x27');return this[_0x2da5c9(0x1fc)]['set'](_0x3f881c,_0x45cee9),{'action':_0x2da5c9(0x20a),'toolId':_0x3f881c,'schema':_0x45cee9,'success':!![]};}async['sendMessageToMcp'](_0x43c8f8){const _0x4a4db0=a0_0x1c9da7;this[_0x4a4db0(0x223)]['info']('Sending\x20message\x20to\x20MCP\x20server');if(!_0x43c8f8||!_0x43c8f8['tool_call'])throw new Error('Invalid\x20MCP\x20message\x20format.\x20Expected\x20{\x20tool_call:\x20{\x20name,\x20arguments\x20}\x20}');const {name:_0x56bc2c,arguments:_0xb7a6b7}=_0x43c8f8['tool_call'];if(!_0x56bc2c||!_0xb7a6b7)throw new Error(_0x4a4db0(0x21c));const [_0x4a00d5,_0x51a7bc]=_0x56bc2c[_0x4a4db0(0x219)]('/');if(!_0x4a00d5||!_0x51a7bc)throw new Error('Invalid\x20tool\x20name\x20format:\x20'+_0x56bc2c+'.\x20Expected\x20format:\x20serverName/toolName');if(!this[_0x4a4db0(0x1e7)][_0x4a4db0(0x1fe)](_0x4a00d5))throw new Error(_0x4a4db0(0x1e6)+_0x4a00d5+'\x27\x20does\x20not\x20exist');const _0x18c403=await this['getOrCreateClient'](_0x4a00d5);if(!_0x18c403)throw new Error(_0x4a4db0(0x20d)+_0x4a00d5);const _0x359b7c=await _0x18c403[_0x4a4db0(0x208)]({'name':_0x51a7bc,'arguments':_0xb7a6b7});return{'action':_0x4a4db0(0x22d),'toolCall':{'name':_0x56bc2c,'arguments':_0xb7a6b7},'result':_0x359b7c,'success':!![]};}async['getOrCreateClient'](_0x4e4bf7){const _0x6a8fd7=a0_0x1c9da7;if(this[_0x6a8fd7(0x1e0)]['has'](_0x4e4bf7))return this['clients'][_0x6a8fd7(0x217)](_0x4e4bf7);const _0x507f0c=this[_0x6a8fd7(0x1e7)][_0x6a8fd7(0x217)](_0x4e4bf7);if(!_0x507f0c)return this[_0x6a8fd7(0x223)]['error']('Server\x20\x27'+_0x4e4bf7+_0x6a8fd7(0x22f)),null;try{const _0x43e2c3=new Client({'name':'loxia-mcp-client','version':_0x6a8fd7(0x1f9)});let _0x58b19e;if(_0x507f0c['type']===_0x6a8fd7(0x1fb))_0x58b19e=new StreamableHTTPClientTransport(_0x507f0c['url']);else{if(_0x507f0c['type']===_0x6a8fd7(0x236)){const _0x48298f=_0x507f0c[_0x6a8fd7(0x225)]['split']('\x20'),_0xa35d6b=_0x48298f[0x0],_0x5217e4=_0x48298f['slice'](0x1);_0x58b19e=new StdioClientTransport({'command':_0xa35d6b,'args':_0x5217e4});}else throw new Error('Unsupported\x20server\x20type:\x20'+_0x507f0c[_0x6a8fd7(0x231)]);}return await _0x43e2c3['connect'](_0x58b19e),this['clients']['set'](_0x4e4bf7,_0x43e2c3),_0x43e2c3;}catch(_0x5eab5e){return this[_0x6a8fd7(0x223)][_0x6a8fd7(0x1ed)](_0x6a8fd7(0x227)+_0x4e4bf7+'\x27:',_0x5eab5e),null;}}async[a0_0x1c9da7(0x1ec)](){const _0x33f348=a0_0x1c9da7;try{const _0x440e78=a0_0x4f3c1f['join'](this[_0x33f348(0x1e9)],_0x33f348(0x1e3)),_0x2686ae={};for(const [_0x175935,_0x363cdf]of this['servers'][_0x33f348(0x1f8)]()){_0x2686ae[_0x175935]=_0x363cdf;}await a0_0x15082d['writeFile'](_0x440e78,JSON[_0x33f348(0x201)](_0x2686ae,null,0x2),'utf-8'),this[_0x33f348(0x223)][_0x33f348(0x20b)]('Saved\x20'+this[_0x33f348(0x1e7)][_0x33f348(0x209)]+'\x20MCP\x20servers\x20to\x20file');}catch(_0xbb15c3){this['logger']['error'](_0x33f348(0x212),_0xbb15c3);}}async['shutdown'](){const _0x335162=a0_0x1c9da7;this['logger']['info'](_0x335162(0x213));for(const [_0x4c9e89,_0x47c2e3]of this[_0x335162(0x1e0)]['entries']()){try{await _0x47c2e3['disconnect'](),this[_0x335162(0x223)]['info']('Disconnected\x20from\x20MCP\x20server:\x20'+_0x4c9e89);}catch(_0xf03405){this['logger'][_0x335162(0x200)]('Error\x20disconnecting\x20from\x20MCP\x20server\x20'+_0x4c9e89+':',_0xf03405);}}this['clients']['clear']();}}