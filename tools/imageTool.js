function a0_0x3dc8(_0xd37005,_0x4a06b4){const _0x2dc05a=a0_0x2dc0();return a0_0x3dc8=function(_0x3dc8f3,_0x66d7da){_0x3dc8f3=_0x3dc8f3-0x1bd;let _0xa59448=_0x2dc05a[_0x3dc8f3];if(a0_0x3dc8['aNTEgz']===undefined){var _0x27037c=function(_0x1c0f2a){const _0x469073='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4f01cf='',_0x487219='';for(let _0x1d3201=0x0,_0x301b98,_0x408002,_0x1c314d=0x0;_0x408002=_0x1c0f2a['charAt'](_0x1c314d++);~_0x408002&&(_0x301b98=_0x1d3201%0x4?_0x301b98*0x40+_0x408002:_0x408002,_0x1d3201++%0x4)?_0x4f01cf+=String['fromCharCode'](0xff&_0x301b98>>(-0x2*_0x1d3201&0x6)):0x0){_0x408002=_0x469073['indexOf'](_0x408002);}for(let _0x2c6b20=0x0,_0x189c33=_0x4f01cf['length'];_0x2c6b20<_0x189c33;_0x2c6b20++){_0x487219+='%'+('00'+_0x4f01cf['charCodeAt'](_0x2c6b20)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x487219);};a0_0x3dc8['XKCXJm']=_0x27037c,_0xd37005=arguments,a0_0x3dc8['aNTEgz']=!![];}const _0x587926=_0x2dc05a[0x0],_0x322444=_0x3dc8f3+_0x587926,_0x2459bf=_0xd37005[_0x322444];return!_0x2459bf?(_0xa59448=a0_0x3dc8['XKCXJm'](_0xa59448),_0xd37005[_0x322444]=_0xa59448):_0xa59448=_0x2459bf,_0xa59448;},a0_0x3dc8(_0xd37005,_0x4a06b4);}const a0_0x35a0ef=a0_0x3dc8;(function(_0x272d09,_0x1c5b9c){const _0xba0cb0=a0_0x3dc8,_0x1293a4=_0x272d09();while(!![]){try{const _0x11b41a=-parseInt(_0xba0cb0(0x1d7))/0x1+-parseInt(_0xba0cb0(0x1e1))/0x2+parseInt(_0xba0cb0(0x1f5))/0x3+parseInt(_0xba0cb0(0x1bf))/0x4+parseInt(_0xba0cb0(0x1d1))/0x5*(parseInt(_0xba0cb0(0x1da))/0x6)+-parseInt(_0xba0cb0(0x1e3))/0x7*(-parseInt(_0xba0cb0(0x1d6))/0x8)+parseInt(_0xba0cb0(0x1ed))/0x9*(-parseInt(_0xba0cb0(0x1e6))/0xa);if(_0x11b41a===_0x1c5b9c)break;else _0x1293a4['push'](_0x1293a4['shift']());}catch(_0x1488a2){_0x1293a4['push'](_0x1293a4['shift']());}}}(a0_0x2dc0,0x6b91f));function a0_0x2dc0(){const _0x3d9761=['mtaYnhGXmdi0','z2v0r2vUzxjHDgLVBLn0yxr1CW','nZy1mtjNz2Tiy0O','y29TCgXLDgvK','ChjVz3jLC3m','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','u2vUzgLUzYbPBwfNzsbNzw5LCMf0Aw9UihjLCxvLC3qGDg8Gt3bLBKfjihDPDgGGBw9KzwW6ia','z2vUzxjHDgvjBwfNzq','y29UDgvUDa','mJu3mJq0CvPiyvLj','z2vUzxjHDgu','mtu0D01ny0L2','cKLTywDLieDLBMvYyxrPB24Gvg9VBdOGqwXSB3DZihLVDsb0BYbNzw5LCMf0zsbPBwfNzxmGDxnPBMCGquKGBw9KzwXZlGOkvxnHz2u6cLT0B29SigLKpsjPBwfNzs1Nzw4IxqPBz2vUzxjHDguGB3v0Chv0lxbHDgG9iNjLBgf0AxzLl3bHDgGVDg8VC2f2zs9PBwfNzs5WBMCIxqPezxrHAwXLzcbKzxnJCMLWDgLVBIbVzIb0AguGAw1Hz2uGEw91ihDHBNqGDg8Gz2vUzxjHDgukwY9Nzw5LCMf0zv0kwY90B29SxqOkrxHHBxbSzxm6cJeUieDLBMvYyxrLigeGC2LTCgXLigLTywDLoGPBDg9VBcbPzd0IAw1Hz2uTz2vUiL0kw2DLBMvYyxrLig91Dhb1Dc1WyxrOpsjPBwfNzxmVBw91BNrHAw5ZlNbUzYjDcKeGyMvHDxrPzNvSig1VDw50ywLUigXHBMrZy2fWzsb3AxrOihnUB3CTy2fWCgvKihbLywTZlcbHignSzwfYigjSDwuGC2T5lcbHBMqGysbMB3jLC3qGyxqGDgHLigjHC2uGB2yGDgHLig1VDw50ywLUCY4kwY9Nzw5LCMf0zv0kwY90B29SxqOkmI4Gr2vUzxjHDguGysbKzxrHAwXLzcbPBwfNzsb3AxrOihnWzwnPzMLJihn0EwXLoGPBDg9VBcbPzd0IAw1Hz2uTz2vUiL0kw2DLBMvYyxrLig91Dhb1Dc1WyxrOpsjPBwfNzxmVCM9IB3qUCg5NiL0kqsbMDxr1CMLZDgLJihjVyM90igLUigeGy3LIzxjWDw5RignPDhKGyxqGBMLNAhqUifrOzsbYB2jVDcbOyxmGz2XVD2LUzYbIBhvLigv5zxmGyw5KigLZihn0yw5KAw5NihvUzgvYigeGBMvVBIbZAwDUlIbtDhLSztOGzgLNAxrHBcbHCNqSigrLDgfPBgvKlcbOAwDOignVBNrYyxn0lGPBl2DLBMvYyxrLxqPBl3rVB2XDcGOZlIbhzw5LCMf0zsbHBIbHyNn0CMfJDcbHCNqGCgLLy2u6cLT0B29SigLKpsjPBwfNzs1Nzw4IxqPBz2vUzxjHDguGB3v0Chv0lxbHDgG9iMLTywDLCY9HyNn0CMfJDc5WBMCIxqPbyNn0CMfJDcbNzw9TzxrYAwmGC2HHCgvZigLUigjYAwDODcbJB2XVCNmSihDPDgGGysbMB2n1CYbVBIbJAxjJBgvZigfUzcb0CMLHBMDSzxmUifn0EwXLoIbTAw5PBwfSAxn0lcbJBgvHBIbSAw5LCYWGDMLICMfUDcbJB2XVCNmUcLSVz2vUzxjHDgvDcLSVDg9VBf0kcK5VDgvZoGOTieLTywDLigDLBMvYyxrPB24GBwf5ihrHA2uGC29Tzsb0Aw1LihrVignVBxbSzxrLcI0GvgHLig91Dhb1DcbWyxrOihnOB3vSzcbIzsbYzwXHDgL2zsb0BYb0AguGChjVAMvJDcbKAxjLy3rVCNKklsbqCM92AwrLigrLDgfPBgvKigrLC2nYAxb0Aw9UCYbMB3iGyMv0DgvYihjLC3vSDhmklsbzB3uGD2LSBcbYzwnLAxzLigeGBM90AwzPy2f0Aw9UihDOzw4GDgHLigLTywDLigDLBMvYyxrPB24GAxmGy29TCgXLDgukicaGia','CgfYC2vqyxjHBwv0zxjZ','mtbPrK5IsM0','B3v0Chv0ugf0Aa','AxnbyNnVBhv0zq','zNjVBq','CgvUzgLUz0DLBMvYyxrPB25Z','BwvZC2fNzq','zxjYB3i','mta4ndqWmwr3AKv1ta','Dg9tDhjPBMC','y29TBwfUzhm','BM90x2zVDw5K','C3rHDhvZ','Dg9VBhm','B3bLBMfP','zgfSBc1Lltm','otiZmZG1wMvkBxPg','Aw1Hz2vZ','Aw1Hz2vhzw4','y2fUy2vSBgvK','rMfPBgvKihrVigDLBMvYyxrLigLTywDLoIa','BwTKAxi','rxjYB3iGCgfYC2LUzYbPBwfNzsbNzw5LCMf0Aw9UihbHCMfTzxrLCNm6','mZa1nZeYBxDZCeXW','rxjYB3iGzxHLy3v0Aw5NigLTywDLigDLBMvYyxrPB24Gy29TBwfUzca','BM93','B3v0Chv0lxbHDgG','DhjPBq','ChvZAa','C2vYDMLJzxm','C2v0','Bg9Nz2vY','z2v0','y29UzMLN','AgfZ','y2fUy2vS','tM8GAw1Hz2uGz2vUzxjHDgLVBIbJB21Tyw5KCYbZCgvJAwzPzwq','t1bftKfjx0fqsv9lrvK','Bw9KzwW','yxbPs2v5','CMvZB2X2zq','mtbzDfjwAxG','zw52','r2vUzxjHDgLUzYbPBwfNzsb3AxrOihbYB21WDdOG','sw1Hz2uGC2f2zwqGDg86ia','C2L6zq','mJC0otG0vw9Rz1nf','ndC2mJe1tePJzxr6'];a0_0x2dc0=function(){return _0x3d9761;};return a0_0x2dc0();}import a0_0x1c0f2a from'path';import{promises as a0_0x469073}from'fs';import{OpenAI}from'openai';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class ImageTool extends BaseTool{constructor(_0x4f01cf,_0x487219){const _0x495508=a0_0x3dc8;super(_0x4f01cf,_0x487219),this[_0x495508(0x1f3)]=new OpenAI({'apiKey':this[_0x495508(0x1c9)][_0x495508(0x1c5)]?.['openai']?.[_0x495508(0x1cf)]||process[_0x495508(0x1d2)][_0x495508(0x1cd)]}),this['pendingGenerations']=new Map();}['getDescription'](){const _0x45789e=a0_0x3dc8;return _0x45789e(0x1e4);}[a0_0x35a0ef(0x1e5)](_0x1d3201){const _0x216bc7=a0_0x35a0ef;this['logger']['info']('Parsing\x20image\x20generation\x20parameters\x20with\x20TagParser');const _0x301b98={'commands':[]};try{const _0x408002=TagParser['query'](_0x1d3201,'generate');for(const _0x1c314d of _0x408002){const _0x2c6b20=_0x1c314d['attributes'][_0x216bc7(0x1c2)];_0x2c6b20&&_0x301b98[_0x216bc7(0x1ef)][_0x216bc7(0x1c4)]({'action':'generate','path':_0x2c6b20,'prompt':_0x1c314d[_0x216bc7(0x1e0)][_0x216bc7(0x1c3)]()});}return _0x301b98;}catch(_0x189c33){return this['logger'][_0x216bc7(0x1ec)](_0x216bc7(0x1be),_0x189c33),{'commands':[]};}}async[a0_0x35a0ef(0x1dd)](_0x56510b,_0x2a7324){const _0x266d6a=a0_0x35a0ef;this[_0x266d6a(0x1c7)]['info']('Executing\x20image\x20generation\x20command\x20with\x20parameters:',_0x56510b);const _0xbc1b7e=[];if(!_0x56510b['commands']||_0x56510b[_0x266d6a(0x1ef)]['length']===0x0)throw new Error(_0x266d6a(0x1cc));for(const _0x1a2854 of _0x56510b[_0x266d6a(0x1ef)]){try{switch(_0x1a2854['action']){case _0x266d6a(0x1e2):const _0x425e30=await this[_0x266d6a(0x1df)](_0x1a2854['prompt'],_0x1a2854['path'],_0x2a7324);_0xbc1b7e[_0x266d6a(0x1c4)](_0x425e30);break;default:throw new Error('Unknown\x20image\x20generation\x20command:\x20'+_0x1a2854['action']);}}catch(_0x3cc03c){this['logger'][_0x266d6a(0x1ec)](_0x266d6a(0x1c0)+_0x1a2854['action']+':',_0x3cc03c),_0xbc1b7e['push']({'action':_0x1a2854['action'],'success':![],'error':_0x3cc03c[_0x266d6a(0x1eb)]});}}return{'results':_0xbc1b7e};}async[a0_0x35a0ef(0x1df)](_0x5376dc,_0x2f315c,_0x55fee2){const _0x2ea3d4=a0_0x35a0ef;this[_0x2ea3d4(0x1c7)]['info'](_0x2ea3d4(0x1d3)+_0x5376dc);const _0x2d9f70=a0_0x1c0f2a[_0x2ea3d4(0x1e8)](_0x2f315c)?_0x2f315c:a0_0x1c0f2a[_0x2ea3d4(0x1d0)](_0x55fee2,_0x2f315c),_0x83c68b=a0_0x1c0f2a['dirname'](_0x2d9f70);await a0_0x469073[_0x2ea3d4(0x1bd)](_0x83c68b,{'recursive':!![]});const _0x1da218=Date[_0x2ea3d4(0x1c1)]()['toString'](0x24)+Math['random']()[_0x2ea3d4(0x1ee)](0x24)['substring'](0x2,0x9);try{const _0x5bd597=this['config'][_0x2ea3d4(0x1f2)]?.['imageGen']?.[_0x2ea3d4(0x1ce)]||_0x2ea3d4(0x1f4);this[_0x2ea3d4(0x1c7)]['info'](_0x2ea3d4(0x1de)+_0x5bd597);const _0x46622e=await this[_0x2ea3d4(0x1f3)][_0x2ea3d4(0x1f6)]['generate']({'model':_0x5bd597,'prompt':_0x5376dc,'n':0x1,'size':this[_0x2ea3d4(0x1c9)]['tools']?.[_0x2ea3d4(0x1f7)]?.[_0x2ea3d4(0x1d5)]||_0x2ea3d4(0x1d8),'response_format':'b64_json'}),_0x57e400=_0x46622e['data'][0x0]['b64_json'],_0x5d5c34=Buffer[_0x2ea3d4(0x1e9)](_0x57e400,'base64');return await a0_0x469073['writeFile'](_0x2d9f70,_0x5d5c34),this['logger']['info'](_0x2ea3d4(0x1d4)+_0x2d9f70),{'action':'generate','jobId':_0x1da218,'prompt':_0x5376dc,'outputPath':_0x2f315c,'resolvedOutputPath':_0x2d9f70,'success':!![],'status':_0x2ea3d4(0x1db)};}catch(_0x43efd4){throw new Error(_0x2ea3d4(0x1f9)+_0x43efd4['message']);}}async[a0_0x35a0ef(0x1d9)](_0x31990f){const _0x1939c9=a0_0x35a0ef;if(!this['pendingGenerations'][_0x1939c9(0x1ca)](_0x31990f))return{'jobId':_0x31990f,'exists':![],'status':_0x1939c9(0x1f0)};const _0x46c476=this['pendingGenerations'][_0x1939c9(0x1c8)](_0x31990f);return{'jobId':_0x31990f,'exists':!![],'status':_0x46c476['status'],'progress':_0x46c476[_0x1939c9(0x1dc)],'prompt':_0x46c476['prompt'],'outputPath':_0x46c476[_0x1939c9(0x1e7)]};}async['cancelGeneration'](_0x1e0c24){const _0xbe596a=a0_0x35a0ef;if(!this['pendingGenerations']['has'](_0x1e0c24))return{'action':_0xbe596a(0x1cb),'jobId':_0x1e0c24,'success':![],'error':'Generation\x20job\x20not\x20found'};const _0x2b9ce3=this['pendingGenerations'][_0xbe596a(0x1c8)](_0x1e0c24);if(_0x2b9ce3[_0xbe596a(0x1f1)]==='pending')return _0x2b9ce3['status']='cancelled',this[_0xbe596a(0x1ea)][_0xbe596a(0x1c6)](_0x1e0c24,_0x2b9ce3),{'action':_0xbe596a(0x1cb),'jobId':_0x1e0c24,'success':!![]};return{'action':_0xbe596a(0x1cb),'jobId':_0x1e0c24,'success':![],'error':'Cannot\x20cancel\x20job\x20with\x20status:\x20'+_0x2b9ce3[_0xbe596a(0x1f1)]};}async['shutdown'](){const _0x5a9e1b=a0_0x35a0ef;this['logger']['info']('Shutting\x20down\x20image\x20tool');for(const [_0x176a35,_0x1300e5]of this[_0x5a9e1b(0x1ea)]['entries']()){_0x1300e5[_0x5a9e1b(0x1f1)]==='pending'&&(_0x1300e5[_0x5a9e1b(0x1f1)]=_0x5a9e1b(0x1f8),this[_0x5a9e1b(0x1ea)][_0x5a9e1b(0x1c6)](_0x176a35,_0x1300e5));}}}