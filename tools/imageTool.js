const a0_0x10d884=a0_0x792b;(function(_0x17226a,_0x2da736){const _0x54ce39=a0_0x792b,_0x52aa24=_0x17226a();while(!![]){try{const _0x4e1ebb=parseInt(_0x54ce39(0x1fb))/0x1+parseInt(_0x54ce39(0x206))/0x2*(parseInt(_0x54ce39(0x211))/0x3)+parseInt(_0x54ce39(0x1f0))/0x4+-parseInt(_0x54ce39(0x1e7))/0x5*(-parseInt(_0x54ce39(0x1f3))/0x6)+-parseInt(_0x54ce39(0x21f))/0x7+-parseInt(_0x54ce39(0x1ee))/0x8*(parseInt(_0x54ce39(0x1ed))/0x9)+parseInt(_0x54ce39(0x1fe))/0xa*(-parseInt(_0x54ce39(0x203))/0xb);if(_0x4e1ebb===_0x2da736)break;else _0x52aa24['push'](_0x52aa24['shift']());}catch(_0x1e3a32){_0x52aa24['push'](_0x52aa24['shift']());}}}(a0_0x3cf8,0x51974));import a0_0x2477d5 from'path';import{promises as a0_0x51ad60}from'fs';import{TagParser}from'../utilities/tagParser.js';function a0_0x3cf8(){const _0x588130=['r2vUzxjHDgLVBIbQB2iGBM90igzVDw5K','mJa2ntvUq2jhsKm','mJy0DgzRExjA','ChjVBxb0','mJq3nZu2menUz1nLyq','z2v0','rMfPBgvKihrVigrVD25SB2fKigLTywDLoIbivfrqia','mZy2mJCZme9oBhfMwG','Aw1Hz2vvCMW','z2vUzxjHDgu','Bg9Nz2vY','cKLTywDLieDLBMvYyxrPB24Gvg9VBdOGqwXSB3DZihLVDsb0BYbNzw5LCMf0zsbPBwfNzxmGDxnPBMCGrMX1Ec0XlJeTuhjViefjig1VzgvSlGOkvxnHz2u6cLT0B29SigLKpsjPBwfNzs1Nzw4IxqPBz2vUzxjHDguGB3v0Chv0lxbHDgG9iNjLBgf0AxzLl3bHDgGVDg8VC2f2zs9PBwfNzs5WBMCIxqPezxrHAwXLzcbKzxnJCMLWDgLVBIbVzIb0AguGAw1Hz2uGEw91ihDHBNqGDg8Gz2vUzxjHDgukwY9Nzw5LCMf0zv0kwY90B29SxqOkrxHHBxbSzxm6cJeUieDLBMvYyxrLigeGC2LTCgXLigLTywDLoGPBDg9VBcbPzd0IAw1Hz2uTz2vUiL0kw2DLBMvYyxrLig91Dhb1Dc1WyxrOpsjPBwfNzxmVBw91BNrHAw5ZlNbUzYjDcKeGyMvHDxrPzNvSig1VDw50ywLUigXHBMrZy2fWzsb3AxrOihnUB3CTy2fWCgvKihbLywTZlcbHignSzwfYigjSDwuGC2T5lcbHBMqGysbMB3jLC3qGyxqGDgHLigjHC2uGB2yGDgHLig1VDw50ywLUCY4kwY9Nzw5LCMf0zv0kwY90B29SxqOkmI4Gr2vUzxjHDguGysbKzxrHAwXLzcbPBwfNzsb3AxrOihnWzwnPzMLJihn0EwXLoGPBDg9VBcbPzd0IAw1Hz2uTz2vUiL0kw2DLBMvYyxrLig91Dhb1Dc1WyxrOpsjPBwfNzxmVCM9IB3qUCg5NiL0kqsbMDxr1CMLZDgLJihjVyM90igLUigeGy3LIzxjWDw5RignPDhKGyxqGBMLNAhqUifrOzsbYB2jVDcbOyxmGz2XVD2LUzYbIBhvLigv5zxmGyw5KigLZihn0yw5KAw5NihvUzgvYigeGBMvVBIbZAwDUlIbtDhLSztOGzgLNAxrHBcbHCNqSigrLDgfPBgvKlcbOAwDOignVBNrYyxn0lGPBl2DLBMvYyxrLxqPBl3rVB2XDcGOZlIbhzw5LCMf0zsbHBIbHyNn0CMfJDcbHCNqGCgLLy2u6cLT0B29SigLKpsjPBwfNzs1Nzw4IxqPBz2vUzxjHDguGB3v0Chv0lxbHDgG9iMLTywDLCY9HyNn0CMfJDc5WBMCIxqPbyNn0CMfJDcbNzw9TzxrYAwmGC2HHCgvZigLUigjYAwDODcbJB2XVCNmSihDPDgGGysbMB2n1CYbVBIbJAxjJBgvZigfUzcb0CMLHBMDSzxmUifn0EwXLoIbTAw5PBwfSAxn0lcbJBgvHBIbSAw5LCYWGDMLICMfUDcbJB2XVCNmUcLSVz2vUzxjHDgvDcLSVDg9VBf0kcK5VDgvZoGOTieLTywDLigDLBMvYyxrPB24GBwf5ihrHA2uGC29Tzsb0Aw1LihrVignVBxbSzxrLcI0GvgHLig91Dhb1DcbWyxrOihnOB3vSzcbIzsbYzwXHDgL2zsb0BYb0AguGChjVAMvJDcbKAxjLy3rVCNKklsbqCM92AwrLigrLDgfPBgvKigrLC2nYAxb0Aw9UCYbMB3iGyMv0DgvYihjLC3vSDhmklsbzB3uGD2LSBcbYzwnLAxzLigeGBM90AwzPy2f0Aw9UihDOzw4GDgHLigLTywDLigDLBMvYyxrPB24GAxmGy29TCgXLDgukicaGia','yxr0CMLIDxrLCW','vhLWzuvYCM9Y','ywn0Aw9U','mtKXnJG0uLbYqvHj','Dg9tDhjPBMC','rxjYB3iGCgfYC2LUzYbPBwfNzsbNzw5LCMf0Aw9UihbHCMfTzxrLCNm6','mJeWmfP2AwTYEa','BgXTu2vYDMLJzq','rg93BMXVywqGzMfPBgvKoIa','u2H1DhrPBMCGzg93BIbPBwfNzsb0B29S','CxvLCNK','ntm1mJzZvLbxz1e','r2vUzxjHDgLUzYbPBwfNzsb3AxrOihbYB21WDdOG','tM8GAw1Hz2uGz2vUzxjHDgLVBIbJB21Tyw5KCYbZCgvJAwzPzwq','mtC5otbwwKrtA04','C3rHDhvZ','sw1Hz2uGzg93BMXVywqGDgLTzw91Da','ChvZAa','AgfZ','Bw9KzwW','C2v0teXnu2vYDMLJzq','vw5RBM93BIbPBwfNzsbNzw5LCMf0Aw9UignVBw1HBMq6ia','ugfYC2LUzYbPBwfNzsbNzw5LCMf0Aw9UihbHCMfTzxrLCNmGD2L0AcbuywDqyxjZzxi','Aw1Hz2vhzw4','CgvUzgLUzW','mti5y1zuALjM','y29TBwfUzhm','BwvZC2fNzq','ChjVz3jLC3m','Aw5MBW','z2v0r2vUzxjHDgLVBLn0yxr1CW','CgvUzgLUz0DLBMvYyxrPB25Z','DgLTzw91Da','BM93','C2L6zq','mtaYnhGXmdi0','zxjYB3i','y29UzMLN','CxvHBgL0Eq','mJyZnty2mxvxBunMAa','y2fUy2vS','zgLYBMfTzq','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','zNjVBq','vgLTzw91DevYCM9Y','tMv0D29YAYbLCNjVCJOG','z2vUzxjHDgvjBwfNzq','Dg9VBhm','sw1Hz2uGC2f2zwqGDg86ia','nuzvuw5uqq','zw50CMLLCW','BMfTzq','C2H1DgrVD24','C3rHBMrHCMq'];a0_0x3cf8=function(){return _0x588130;};return a0_0x3cf8();}import{BaseTool}from'./baseTool.js';function a0_0x792b(_0x3a89da,_0x5338fb){const _0x3cf8c3=a0_0x3cf8();return a0_0x792b=function(_0x792b5e,_0x4760ba){_0x792b5e=_0x792b5e-0x1e3;let _0x121dcf=_0x3cf8c3[_0x792b5e];if(a0_0x792b['BYIiOA']===undefined){var _0x513ab1=function(_0x2477d5){const _0x51ad60='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3cb3e6='',_0x1d3031='';for(let _0x528b18=0x0,_0x2454ef,_0x2c785e,_0x150aa7=0x0;_0x2c785e=_0x2477d5['charAt'](_0x150aa7++);~_0x2c785e&&(_0x2454ef=_0x528b18%0x4?_0x2454ef*0x40+_0x2c785e:_0x2c785e,_0x528b18++%0x4)?_0x3cb3e6+=String['fromCharCode'](0xff&_0x2454ef>>(-0x2*_0x528b18&0x6)):0x0){_0x2c785e=_0x51ad60['indexOf'](_0x2c785e);}for(let _0x358694=0x0,_0x5384a7=_0x3cb3e6['length'];_0x358694<_0x5384a7;_0x358694++){_0x1d3031+='%'+('00'+_0x3cb3e6['charCodeAt'](_0x358694)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x1d3031);};a0_0x792b['rsIefH']=_0x513ab1,_0x3a89da=arguments,a0_0x792b['BYIiOA']=!![];}const _0x6659c0=_0x3cf8c3[0x0],_0x3b8d69=_0x792b5e+_0x6659c0,_0x28deb1=_0x3a89da[_0x3b8d69];return!_0x28deb1?(_0x121dcf=a0_0x792b['rsIefH'](_0x121dcf),_0x3a89da[_0x3b8d69]=_0x121dcf):_0x121dcf=_0x28deb1,_0x121dcf;},a0_0x792b(_0x3a89da,_0x5338fb);}export class ImageTool extends BaseTool{constructor(_0x3cb3e6,_0x1d3031,_0x528b18=null){const _0x70e539=a0_0x792b;super(_0x3cb3e6,_0x1d3031),this[_0x70e539(0x1ff)]=_0x528b18,this['pendingGenerations']=new Map();}[a0_0x10d884(0x20c)](_0x2454ef){const _0x2c62e6=a0_0x10d884;this[_0x2c62e6(0x1ff)]=_0x2454ef;}['getDescription'](){const _0x1339c6=a0_0x10d884;return _0x1339c6(0x1f7);}['parseParameters'](_0x2c785e){const _0x139168=a0_0x10d884;this[_0x139168(0x1f6)][_0x139168(0x215)](_0x139168(0x20e));const _0x150aa7={'commands':[]};try{const _0x358694=TagParser[_0x139168(0x202)](_0x2c785e,_0x139168(0x1f5));for(const _0x5384a7 of _0x358694){const _0x260a5b=_0x5384a7[_0x139168(0x1f8)]['output-path'];_0x260a5b&&_0x150aa7['commands'][_0x139168(0x209)]({'action':'generate','path':_0x260a5b,'prompt':_0x5384a7['content']['trim']()});}return _0x150aa7;}catch(_0x54025a){return this[_0x139168(0x1f6)]['error'](_0x139168(0x1fd),_0x54025a),{'commands':[]};}}async[a0_0x10d884(0x222)](_0xb4a201,_0xfb2b8a){const _0x218f92=a0_0x10d884;this['logger'][_0x218f92(0x215)]('Executing\x20image\x20generation\x20command\x20with\x20parameters:',_0xb4a201);const _0x3dd33b=[];if(!_0xb4a201[_0x218f92(0x212)]||_0xb4a201[_0x218f92(0x212)]['length']===0x0)throw new Error(_0x218f92(0x205));for(const _0x467f67 of _0xb4a201[_0x218f92(0x212)]){try{switch(_0x467f67['action']){case'generate':const _0x5f05b5=await this[_0x218f92(0x1e4)](_0x467f67[_0x218f92(0x1ef)],_0x467f67['path'],_0xfb2b8a);_0x3dd33b['push'](_0x5f05b5);break;default:throw new Error(_0x218f92(0x20d)+_0x467f67['action']);}}catch(_0x150924){this['logger'][_0x218f92(0x21c)]('Error\x20executing\x20image\x20generation\x20command\x20'+_0x467f67[_0x218f92(0x1fa)]+':',_0x150924),_0x3dd33b[_0x218f92(0x209)]({'action':_0x467f67[_0x218f92(0x1fa)],'success':![],'error':_0x150924[_0x218f92(0x213)]});}}return{'results':_0x3dd33b};}async['generateImage'](_0x2e04f7,_0x2ead53,_0x500a49){const _0x4c1ffd=a0_0x10d884;this[_0x4c1ffd(0x1f6)]['info'](_0x4c1ffd(0x204)+_0x2e04f7);if(!this['llmService'])throw new Error('LLM\x20service\x20not\x20available.\x20Image\x20generation\x20requires\x20server\x20connection.');const _0x5ebab0=a0_0x2477d5['isAbsolute'](_0x2ead53)?_0x2ead53:a0_0x2477d5['resolve'](_0x500a49,_0x2ead53),_0x370ac0=a0_0x2477d5[_0x4c1ffd(0x221)](_0x5ebab0);await a0_0x51ad60['mkdir'](_0x370ac0,{'recursive':!![]});const _0x2261d1=Date[_0x4c1ffd(0x219)]()[_0x4c1ffd(0x1fc)](0x24)+Math['random']()[_0x4c1ffd(0x1fc)](0x24)['substring'](0x2,0x9);try{const _0x2af8bd=this['config'][_0x4c1ffd(0x1e5)]?.[_0x4c1ffd(0x20f)]?.[_0x4c1ffd(0x20b)]||'azure-vision-flux-1-1';this[_0x4c1ffd(0x1f6)][_0x4c1ffd(0x215)]('Image\x20generation\x20config:',{'configModel':this[_0x4c1ffd(0x21d)][_0x4c1ffd(0x1e5)]?.[_0x4c1ffd(0x20f)]?.['model'],'finalModel':_0x2af8bd,'size':this[_0x4c1ffd(0x21d)]['tools']?.['imageGen']?.['size']||'1024x1024','quality':this[_0x4c1ffd(0x21d)]['tools']?.[_0x4c1ffd(0x20f)]?.['quality']||_0x4c1ffd(0x1eb)}),this[_0x4c1ffd(0x1f6)][_0x4c1ffd(0x215)]('Sending\x20image\x20generation\x20request\x20to\x20autopilot-backend\x20with\x20model:\x20'+_0x2af8bd);const _0x3981a0={'model':_0x2af8bd,'size':this[_0x4c1ffd(0x21d)][_0x4c1ffd(0x1e5)]?.[_0x4c1ffd(0x20f)]?.[_0x4c1ffd(0x21a)]||_0x4c1ffd(0x21b),'quality':this['config'][_0x4c1ffd(0x1e5)]?.[_0x4c1ffd(0x20f)]?.[_0x4c1ffd(0x21e)]||'standard','responseFormat':'b64_json'};this[_0x4c1ffd(0x1f6)]['debug']('Image\x20generation\x20options:',_0x3981a0);const _0x3a25b4=await this['llmService'][_0x4c1ffd(0x1e4)](_0x2e04f7,_0x3981a0),_0x4ac14d=_0x3a25b4[_0x4c1ffd(0x1f4)];if(!_0x4ac14d)throw new Error('No image URL received from server');try{const _0x17bd7d=await fetch(_0x4ac14d,{'signal':AbortSignal[_0x4c1ffd(0x218)](0xea60)});if(!_0x17bd7d['ok'])throw new Error(_0x4c1ffd(0x1f2)+_0x17bd7d[_0x4c1ffd(0x207)]);const _0x55ce36=Buffer[_0x4c1ffd(0x223)](await _0x17bd7d['arrayBuffer']());await a0_0x51ad60['writeFile'](_0x5ebab0,_0x55ce36);}catch(_0x2ee654){if(_0x2ee654[_0x4c1ffd(0x1e9)]===_0x4c1ffd(0x224))throw new Error(_0x4c1ffd(0x208));else{if(_0x2ee654['name']===_0x4c1ffd(0x1f9))throw new Error(_0x4c1ffd(0x1e3)+_0x2ee654['message']);else throw new Error(_0x4c1ffd(0x200)+_0x2ee654['message']);}}return this[_0x4c1ffd(0x1f6)][_0x4c1ffd(0x215)](_0x4c1ffd(0x1e6)+_0x5ebab0),{'action':_0x4c1ffd(0x1f5),'jobId':_0x2261d1,'prompt':_0x2e04f7,'outputPath':_0x2ead53,'resolvedOutputPath':_0x5ebab0,'success':!![],'status':'completed','model':_0x3a25b4[_0x4c1ffd(0x20b)],'size':_0x3a25b4[_0x4c1ffd(0x21a)],'usage':_0x3a25b4['usage']};}catch(_0x5b9161){this['logger']['error']('Failed\x20to\x20generate\x20image:\x20'+_0x5b9161['message']);throw new Error('Failed\x20to\x20generate\x20image:\x20'+_0x5b9161['message']);}}async[a0_0x10d884(0x216)](_0x2a10a2){const _0x52f64a=a0_0x10d884;if(!this[_0x52f64a(0x217)][_0x52f64a(0x20a)](_0x2a10a2))return{'jobId':_0x2a10a2,'exists':![],'status':'not_found'};const _0x23368f=this['pendingGenerations']['get'](_0x2a10a2);return{'jobId':_0x2a10a2,'exists':!![],'status':_0x23368f['status'],'progress':_0x23368f[_0x52f64a(0x214)],'prompt':_0x23368f['prompt'],'outputPath':_0x23368f['outputPath']};}async['cancelGeneration'](_0x10af87){const _0x325ec4=a0_0x10d884;if(!this[_0x325ec4(0x217)]['has'](_0x10af87))return{'action':_0x325ec4(0x220),'jobId':_0x10af87,'success':![],'error':_0x325ec4(0x1ec)};const _0x394336=this['pendingGenerations'][_0x325ec4(0x1f1)](_0x10af87);if(_0x394336['status']===_0x325ec4(0x210))return _0x394336[_0x325ec4(0x207)]='cancelled',this['pendingGenerations']['set'](_0x10af87,_0x394336),{'action':_0x325ec4(0x220),'jobId':_0x10af87,'success':!![]};return{'action':_0x325ec4(0x220),'jobId':_0x10af87,'success':![],'error':'Cannot\x20cancel\x20job\x20with\x20status:\x20'+_0x394336['status']};}async[a0_0x10d884(0x1ea)](){const _0x12216e=a0_0x10d884;this[_0x12216e(0x1f6)][_0x12216e(0x215)](_0x12216e(0x201));for(const [_0x2546a2,_0x382024]of this[_0x12216e(0x217)][_0x12216e(0x1e8)]()){_0x382024['status']==='pending'&&(_0x382024['status']='cancelled',this['pendingGenerations']['set'](_0x2546a2,_0x382024));}}}