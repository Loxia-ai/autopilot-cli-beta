function a0_0x3d8e(_0x5eda7b,_0x102e9d){const _0x22d34f=a0_0x22d3();return a0_0x3d8e=function(_0x3d8e22,_0xa56ca3){_0x3d8e22=_0x3d8e22-0xaf;let _0x3470d1=_0x22d34f[_0x3d8e22];if(a0_0x3d8e['gNlXpW']===undefined){var _0x206008=function(_0x3eb20d){const _0x4bfa5e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1b6df0='',_0x15ee1c='';for(let _0x14f07c=0x0,_0x30e7a0,_0x45a501,_0x1745ec=0x0;_0x45a501=_0x3eb20d['charAt'](_0x1745ec++);~_0x45a501&&(_0x30e7a0=_0x14f07c%0x4?_0x30e7a0*0x40+_0x45a501:_0x45a501,_0x14f07c++%0x4)?_0x1b6df0+=String['fromCharCode'](0xff&_0x30e7a0>>(-0x2*_0x14f07c&0x6)):0x0){_0x45a501=_0x4bfa5e['indexOf'](_0x45a501);}for(let _0x1e51a9=0x0,_0xb29621=_0x1b6df0['length'];_0x1e51a9<_0xb29621;_0x1e51a9++){_0x15ee1c+='%'+('00'+_0x1b6df0['charCodeAt'](_0x1e51a9)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x15ee1c);};a0_0x3d8e['qAYJSD']=_0x206008,_0x5eda7b=arguments,a0_0x3d8e['gNlXpW']=!![];}const _0x2d9861=_0x22d34f[0x0],_0x140930=_0x3d8e22+_0x2d9861,_0x121b69=_0x5eda7b[_0x140930];return!_0x121b69?(_0x3470d1=a0_0x3d8e['qAYJSD'](_0x3470d1),_0x5eda7b[_0x140930]=_0x3470d1):_0x3470d1=_0x121b69,_0x3470d1;},a0_0x3d8e(_0x5eda7b,_0x102e9d);}const a0_0x430e02=a0_0x3d8e;(function(_0x55de3c,_0x26d7d0){const _0x110d0e=a0_0x3d8e,_0x1c8077=_0x55de3c();while(!![]){try{const _0x24ffdf=-parseInt(_0x110d0e(0xbb))/0x1*(-parseInt(_0x110d0e(0xdc))/0x2)+-parseInt(_0x110d0e(0xb8))/0x3+-parseInt(_0x110d0e(0xc8))/0x4*(-parseInt(_0x110d0e(0xd6))/0x5)+parseInt(_0x110d0e(0xcc))/0x6*(-parseInt(_0x110d0e(0xc3))/0x7)+parseInt(_0x110d0e(0xdf))/0x8+parseInt(_0x110d0e(0xe4))/0x9+parseInt(_0x110d0e(0xe5))/0xa;if(_0x24ffdf===_0x26d7d0)break;else _0x1c8077['push'](_0x1c8077['shift']());}catch(_0x10da27){_0x1c8077['push'](_0x1c8077['shift']());}}}(a0_0x22d3,0x494a7));function a0_0x22d3(){const _0x1183f2=['y29TCgXLDgvK','y29UDgvUDa','Aw1Hz2vZ','ndqYnJa1AvbKzwTR','mtaYnhGXmdi0','yMfZzty0','mwz4ywjcwG','C3vIC3rYAw5N','Cgf0Aa','BwvZC2fNzq','Dg9VBhm','ChjVBxb0','C2vYDMLJzxm','y2fUy2vSBgvK','nta4ntaXr3nAyuXL','yxbPs2v5','B3v0Chv0ugf0Aa','z2v0rgvZy3jPChrPB24','B3bLBMfP','neXWzNrjDW','C2L6zq','BM93','yJy0x2PZB24','ndHHwu5sv2y','CgvUzgLUz0DLBMvYyxrPB25Z','zxjYB3i','sw1Hz2uGC2f2zwqGDg86ia','z2vUzxjHDgu','y29UzMLN','y2fUy2vSr2vUzxjHDgLVBG','y2fUy2vS','Bg9Nz2vY','zgLYBMfTzq','mJu2ntK2meDpswL1rq','Aw5MBW','CgfYC2vqyxjHBwv0zxjZ','cKLTywDLieDLBMvYyxrPB24Gvg9VBdOGqwXSB3DZihLVDsb0BYbNzw5LCMf0zsbPBwfNzxmGDxnPBMCGquKGBw9KzwXZlGOkvxnHz2u6cLT0B29SigLKpsjPBwfNzs1Nzw4IxqPBz2vUzxjHDguGB3v0Chv0lxbHDgG9iNjLBgf0AxzLl3bHDgGVDg8VC2f2zs9PBwfNzs5WBMCIxqPezxrHAwXLzcbKzxnJCMLWDgLVBIbVzIb0AguGAw1Hz2uGEw91ihDHBNqGDg8Gz2vUzxjHDgukwY9Nzw5LCMf0zv0kwY90B29SxqOkrxHHBxbSzxm6cJeUieDLBMvYyxrLigeGC2LTCgXLigLTywDLoGPBDg9VBcbPzd0IAw1Hz2uTz2vUiL0kw2DLBMvYyxrLig91Dhb1Dc1WyxrOpsjPBwfNzxmVBw91BNrHAw5ZlNbUzYjDcKeGyMvHDxrPzNvSig1VDw50ywLUigXHBMrZy2fWzsb3AxrOihnUB3CTy2fWCgvKihbLywTZlcbHignSzwfYigjSDwuGC2T5lcbHBMqGysbMB3jLC3qGyxqGDgHLigjHC2uGB2yGDgHLig1VDw50ywLUCY4kwY9Nzw5LCMf0zv0kwY90B29SxqOkmI4Gr2vUzxjHDguGysbKzxrHAwXLzcbPBwfNzsb3AxrOihnWzwnPzMLJihn0EwXLoGPBDg9VBcbPzd0IAw1Hz2uTz2vUiL0kw2DLBMvYyxrLig91Dhb1Dc1WyxrOpsjPBwfNzxmVCM9IB3qUCg5NiL0kqsbMDxr1CMLZDgLJihjVyM90igLUigeGy3LIzxjWDw5RignPDhKGyxqGBMLNAhqUifrOzsbYB2jVDcbOyxmGz2XVD2LUzYbIBhvLigv5zxmGyw5KigLZihn0yw5KAw5NihvUzgvYigeGBMvVBIbZAwDUlIbtDhLSztOGzgLNAxrHBcbHCNqSigrLDgfPBgvKlcbOAwDOignVBNrYyxn0lGPBl2DLBMvYyxrLxqPBl3rVB2XDcGOZlIbhzw5LCMf0zsbHBIbHyNn0CMfJDcbHCNqGCgLLy2u6cLT0B29SigLKpsjPBwfNzs1Nzw4IxqPBz2vUzxjHDguGB3v0Chv0lxbHDgG9iMLTywDLCY9HyNn0CMfJDc5WBMCIxqPbyNn0CMfJDcbNzw9TzxrYAwmGC2HHCgvZigLUigjYAwDODcbJB2XVCNmSihDPDgGGysbMB2n1CYbVBIbJAxjJBgvZigfUzcb0CMLHBMDSzxmUifn0EwXLoIbTAw5PBwfSAxn0lcbJBgvHBIbSAw5LCYWGDMLICMfUDcbJB2XVCNmUcLSVz2vUzxjHDgvDcLSVDg9VBf0kcK5VDgvZoGOTieLTywDLigDLBMvYyxrPB24GBwf5ihrHA2uGC29Tzsb0Aw1LihrVignVBxbSzxrLcI0GvgHLig91Dhb1DcbWyxrOihnOB3vSzcbIzsbYzwXHDgL2zsb0BYb0AguGChjVAMvJDcbKAxjLy3rVCNKklsbqCM92AwrLigrLDgfPBgvKigrLC2nYAxb0Aw9UCYbMB3iGyMv0DgvYihjLC3vSDhmklsbzB3uGD2LSBcbYzwnLAxzLigeGBM90AwzPy2f0Aw9UihDOzw4GDgHLigLTywDLigDLBMvYyxrPB24GAxmGy29TCgXLDgukicaGia','ChvZAa','ywn0Aw9U','mte1mta2CwnbtNjw','z2v0r2vUzxjHDgLVBLn0yxr1CW','CgvUzgLUzW','mZmZmdaWAxn4wLfQ','Dg9tDhjPBMC','zw52','z2vUzxjHDgvjBwfNzq','z2v0','mZeXodqXoxvdt01pDq','nZaWmtCWvw5jz0rp','CMfUzg9T','zNjVBq','C3rHDhvZ','vw5RBM93BIbPBwfNzsbNzw5LCMf0Aw9UignVBw1HBMq6ia','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','y29TBwfUzhm','Aw1Hz2vhzw4','C2v0'];a0_0x22d3=function(){return _0x1183f2;};return a0_0x22d3();}import a0_0x3eb20d from'path';import{promises as a0_0x4bfa5e}from'fs';import{OpenAI}from'openai';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class ImageTool extends BaseTool{constructor(_0x1b6df0,_0x15ee1c){const _0x525d37=a0_0x3d8e;super(_0x1b6df0,_0x15ee1c),this[_0x525d37(0xc7)]=new OpenAI({'apiKey':this['config'][_0x525d37(0xc1)]?.['openai']?.[_0x525d37(0xc4)]||process[_0x525d37(0xe1)]['OPENAI_API_KEY']}),this[_0x525d37(0xcd)]=new Map();}[a0_0x430e02(0xc6)](){const _0x205a52=a0_0x430e02;return _0x205a52(0xd9);}[a0_0x430e02(0xd8)](_0x14f07c){const _0x548327=a0_0x430e02;this['logger'][_0x548327(0xd7)]('Parsing\x20image\x20generation\x20parameters\x20with\x20TagParser');const _0x30e7a0={'commands':[]};try{const _0x45a501=TagParser['query'](_0x14f07c,'generate');for(const _0x1745ec of _0x45a501){const _0x1e51a9=_0x1745ec['attributes']['output-path'];_0x1e51a9&&_0x30e7a0[_0x548327(0xb2)][_0x548327(0xda)]({'action':_0x548327(0xd0),'path':_0x1e51a9,'prompt':_0x1745ec[_0x548327(0xb6)]['trim']()});}return _0x30e7a0;}catch(_0xb29621){return this['logger'][_0x548327(0xce)]('Error\x20parsing\x20image\x20generation\x20parameters:',_0xb29621),{'commands':[]};}}async[a0_0x430e02(0xb1)](_0x7332a,_0x1084f4){const _0x466b86=a0_0x430e02;this[_0x466b86(0xd4)]['info']('Executing\x20image\x20generation\x20command\x20with\x20parameters:',_0x7332a);const _0x46b262=[];if(!_0x7332a['commands']||_0x7332a['commands']['length']===0x0)throw new Error('No\x20image\x20generation\x20commands\x20specified');for(const _0x5da1ce of _0x7332a[_0x466b86(0xb2)]){try{switch(_0x5da1ce[_0x466b86(0xdb)]){case'generate':const _0x3227c2=await this[_0x466b86(0xe2)](_0x5da1ce['prompt'],_0x5da1ce[_0x466b86(0xbd)],_0x1084f4);_0x46b262['push'](_0x3227c2);break;default:throw new Error(_0x466b86(0xb0)+_0x5da1ce['action']);}}catch(_0x132dcd){this['logger']['error']('Error\x20executing\x20image\x20generation\x20command\x20'+_0x5da1ce['action']+':',_0x132dcd),_0x46b262['push']({'action':_0x5da1ce[_0x466b86(0xdb)],'success':![],'error':_0x132dcd['message']});}}return{'results':_0x46b262};}async['generateImage'](_0x3489de,_0x351fc3,_0x52af32){const _0x228719=a0_0x430e02;this[_0x228719(0xd4)]['info']('Generating\x20image\x20with\x20prompt:\x20'+_0x3489de);const _0x2601f0=a0_0x3eb20d['isAbsolute'](_0x351fc3)?_0x351fc3:a0_0x3eb20d['resolve'](_0x52af32,_0x351fc3),_0x5e93a1=a0_0x3eb20d[_0x228719(0xd5)](_0x2601f0);await a0_0x4bfa5e['mkdir'](_0x5e93a1,{'recursive':!![]});const _0x18bd9f=Date[_0x228719(0xca)]()[_0x228719(0xe0)](0x24)+Math[_0x228719(0xe6)]()[_0x228719(0xe0)](0x24)[_0x228719(0xbc)](0x2,0x9);try{const _0x4745d9=this[_0x228719(0xd1)]['tools']?.['imageGen']?.['model']||'dall-e-3';this['logger'][_0x228719(0xd7)]('Sending\x20image\x20generation\x20request\x20to\x20OpenAI\x20with\x20model:\x20'+_0x4745d9);const _0x284c46=await this['openai'][_0x228719(0xb7)][_0x228719(0xd0)]({'model':_0x4745d9,'prompt':_0x3489de,'n':0x1,'size':this['config'][_0x228719(0xbf)]?.[_0x228719(0xb3)]?.[_0x228719(0xc9)]||_0x228719(0xb9),'response_format':_0x228719(0xcb)}),_0x4146ed=_0x284c46['data'][0x0][_0x228719(0xcb)],_0x156149=Buffer[_0x228719(0xe7)](_0x4146ed,_0x228719(0xba));return await a0_0x4bfa5e['writeFile'](_0x2601f0,_0x156149),this['logger']['info'](_0x228719(0xcf)+_0x2601f0),{'action':_0x228719(0xd0),'jobId':_0x18bd9f,'prompt':_0x3489de,'outputPath':_0x351fc3,'resolvedOutputPath':_0x2601f0,'success':!![],'status':_0x228719(0xb5)};}catch(_0x3c6519){throw new Error('Failed\x20to\x20generate\x20image:\x20'+_0x3c6519[_0x228719(0xbe)]);}}async[a0_0x430e02(0xdd)](_0x4fe30f){const _0x53829a=a0_0x430e02;if(!this['pendingGenerations']['has'](_0x4fe30f))return{'jobId':_0x4fe30f,'exists':![],'status':'not_found'};const _0xf018da=this[_0x53829a(0xcd)][_0x53829a(0xe3)](_0x4fe30f);return{'jobId':_0x4fe30f,'exists':!![],'status':_0xf018da[_0x53829a(0xaf)],'progress':_0xf018da['progress'],'prompt':_0xf018da[_0x53829a(0xc0)],'outputPath':_0xf018da[_0x53829a(0xc5)]};}async[a0_0x430e02(0xd2)](_0x30d966){const _0x189dca=a0_0x430e02;if(!this['pendingGenerations']['has'](_0x30d966))return{'action':_0x189dca(0xd3),'jobId':_0x30d966,'success':![],'error':'Generation\x20job\x20not\x20found'};const _0x464a2b=this[_0x189dca(0xcd)][_0x189dca(0xe3)](_0x30d966);if(_0x464a2b[_0x189dca(0xaf)]==='pending')return _0x464a2b[_0x189dca(0xaf)]='cancelled',this[_0x189dca(0xcd)]['set'](_0x30d966,_0x464a2b),{'action':'cancel','jobId':_0x30d966,'success':!![]};return{'action':'cancel','jobId':_0x30d966,'success':![],'error':'Cannot\x20cancel\x20job\x20with\x20status:\x20'+_0x464a2b[_0x189dca(0xaf)]};}async['shutdown'](){const _0x42bf3c=a0_0x430e02;this['logger'][_0x42bf3c(0xd7)]('Shutting\x20down\x20image\x20tool');for(const [_0xcb7f83,_0x3103ae]of this[_0x42bf3c(0xcd)]['entries']()){_0x3103ae[_0x42bf3c(0xaf)]===_0x42bf3c(0xde)&&(_0x3103ae['status']=_0x42bf3c(0xc2),this['pendingGenerations'][_0x42bf3c(0xb4)](_0xcb7f83,_0x3103ae));}}}