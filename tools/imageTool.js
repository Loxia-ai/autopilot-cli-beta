const a0_0x2d24f4=a0_0x8b1f;function a0_0x8b1f(_0x117824,_0x1431e5){const _0x3fce4c=a0_0x3fce();return a0_0x8b1f=function(_0x8b1f60,_0x3b5cbe){_0x8b1f60=_0x8b1f60-0x13a;let _0x33be60=_0x3fce4c[_0x8b1f60];if(a0_0x8b1f['FBJnhz']===undefined){var _0xa08867=function(_0x3a6a80){const _0x43e27a='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x216d89='',_0x4364f4='';for(let _0x1079ff=0x0,_0x206f06,_0xbe046e,_0x543714=0x0;_0xbe046e=_0x3a6a80['charAt'](_0x543714++);~_0xbe046e&&(_0x206f06=_0x1079ff%0x4?_0x206f06*0x40+_0xbe046e:_0xbe046e,_0x1079ff++%0x4)?_0x216d89+=String['fromCharCode'](0xff&_0x206f06>>(-0x2*_0x1079ff&0x6)):0x0){_0xbe046e=_0x43e27a['indexOf'](_0xbe046e);}for(let _0x11f56e=0x0,_0x427965=_0x216d89['length'];_0x11f56e<_0x427965;_0x11f56e++){_0x4364f4+='%'+('00'+_0x216d89['charCodeAt'](_0x11f56e)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4364f4);};a0_0x8b1f['JiAvss']=_0xa08867,_0x117824=arguments,a0_0x8b1f['FBJnhz']=!![];}const _0x268e9d=_0x3fce4c[0x0],_0x11656c=_0x8b1f60+_0x268e9d,_0x5bb385=_0x117824[_0x11656c];return!_0x5bb385?(_0x33be60=a0_0x8b1f['JiAvss'](_0x33be60),_0x117824[_0x11656c]=_0x33be60):_0x33be60=_0x5bb385,_0x33be60;},a0_0x8b1f(_0x117824,_0x1431e5);}(function(_0x276cbc,_0x3f82df){const _0x5c7863=a0_0x8b1f,_0x35e162=_0x276cbc();while(!![]){try{const _0x7c8e2d=-parseInt(_0x5c7863(0x14f))/0x1*(-parseInt(_0x5c7863(0x15d))/0x2)+-parseInt(_0x5c7863(0x177))/0x3*(parseInt(_0x5c7863(0x144))/0x4)+-parseInt(_0x5c7863(0x151))/0x5+parseInt(_0x5c7863(0x140))/0x6+-parseInt(_0x5c7863(0x148))/0x7*(-parseInt(_0x5c7863(0x16c))/0x8)+parseInt(_0x5c7863(0x175))/0x9*(parseInt(_0x5c7863(0x15a))/0xa)+parseInt(_0x5c7863(0x154))/0xb;if(_0x7c8e2d===_0x3f82df)break;else _0x35e162['push'](_0x35e162['shift']());}catch(_0x3a1fb9){_0x35e162['push'](_0x35e162['shift']());}}}(a0_0x3fce,0xbfabd));import a0_0x3a6a80 from'path';import{promises as a0_0x43e27a}from'fs';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class ImageTool extends BaseTool{constructor(_0x216d89,_0x4364f4,_0x1079ff=null){super(_0x216d89,_0x4364f4),this['llmService']=_0x1079ff,this['pendingGenerations']=new Map();}['setLLMService'](_0x206f06){const _0x3de78a=a0_0x8b1f;this[_0x3de78a(0x170)]=_0x206f06;}[a0_0x2d24f4(0x168)](){return'\x0aImage\x20Generation\x20Tool:\x20Allows\x20you\x20to\x20generate\x20images\x20using\x20AI\x20models.\x0a\x0aUsage:\x0a[tool\x20id=\x22image-gen\x22]\x0a[generate\x20output-path=\x22relative/path/to/save/image.png\x22]\x0aDetailed\x20description\x20of\x20the\x20image\x20you\x20want\x20to\x20generate\x0a[/generate]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20Generate\x20a\x20simple\x20image:\x0a[tool\x20id=\x22image-gen\x22]\x0a[generate\x20output-path=\x22images/mountains.png\x22]\x0aA\x20beautiful\x20mountain\x20landscape\x20with\x20snow-capped\x20peaks,\x20a\x20clear\x20blue\x20sky,\x20and\x20a\x20forest\x20at\x20the\x20base\x20of\x20the\x20mountains.\x0a[/generate]\x0a[/tool]\x0a\x0a2.\x20Generate\x20a\x20detailed\x20image\x20with\x20specific\x20style:\x0a[tool\x20id=\x22image-gen\x22]\x0a[generate\x20output-path=\x22images/robot.png\x22]\x0aA\x20futuristic\x20robot\x20in\x20a\x20cyberpunk\x20city\x20at\x20night.\x20The\x20robot\x20has\x20glowing\x20blue\x20eyes\x20and\x20is\x20standing\x20under\x20a\x20neon\x20sign.\x20Style:\x20digital\x20art,\x20detailed,\x20high\x20contrast.\x0a[/generate]\x0a[/tool]\x0a\x0a3.\x20Generate\x20an\x20abstract\x20art\x20piece:\x0a[tool\x20id=\x22image-gen\x22]\x0a[generate\x20output-path=\x22images/abstract.png\x22]\x0aAbstract\x20geometric\x20shapes\x20in\x20bright\x20colors,\x20with\x20a\x20focus\x20on\x20circles\x20and\x20triangles.\x20Style:\x20minimalist,\x20clean\x20lines,\x20vibrant\x20colors.\x0a[/generate]\x0a[/tool]\x0a\x0aNotes:\x0a-\x20Image\x20generation\x20may\x20take\x20some\x20time\x20to\x20complete\x0a-\x20The\x20output\x20path\x20should\x20be\x20relative\x20to\x20the\x20project\x20directory\x0a-\x20Provide\x20detailed\x20descriptions\x20for\x20better\x20results\x0a-\x20You\x20will\x20receive\x20a\x20notification\x20when\x20the\x20image\x20generation\x20is\x20complete\x0a\x20\x20\x20\x20';}['parseParameters'](_0xbe046e){const _0x38f953=a0_0x2d24f4;this[_0x38f953(0x13d)][_0x38f953(0x162)]('Parsing\x20image\x20generation\x20parameters\x20with\x20TagParser');const _0x543714={'commands':[]};try{const _0x11f56e=TagParser['query'](_0xbe046e,_0x38f953(0x165));for(const _0x427965 of _0x11f56e){const _0x70846e=_0x427965[_0x38f953(0x16f)][_0x38f953(0x152)];_0x70846e&&_0x543714[_0x38f953(0x15f)][_0x38f953(0x157)]({'action':_0x38f953(0x165),'path':_0x70846e,'prompt':_0x427965['content']['trim']()});}return _0x543714;}catch(_0x2cbc45){return this[_0x38f953(0x13d)]['error']('Error\x20parsing\x20image\x20generation\x20parameters:',_0x2cbc45),{'commands':[]};}}async[a0_0x2d24f4(0x153)](_0x243ef3,_0x5c5531){const _0x34013e=a0_0x2d24f4;this['logger']['info']('Executing\x20image\x20generation\x20command\x20with\x20parameters:',_0x243ef3);const _0x467d11=[];if(!_0x243ef3['commands']||_0x243ef3['commands']['length']===0x0)throw new Error('No\x20image\x20generation\x20commands\x20specified');for(const _0x1afeff of _0x243ef3['commands']){try{switch(_0x1afeff[_0x34013e(0x164)]){case _0x34013e(0x165):const _0x223195=await this[_0x34013e(0x15e)](_0x1afeff['prompt'],_0x1afeff[_0x34013e(0x16e)],_0x5c5531);_0x467d11[_0x34013e(0x157)](_0x223195);break;default:throw new Error('Unknown\x20image\x20generation\x20command:\x20'+_0x1afeff[_0x34013e(0x164)]);}}catch(_0xa1cd00){this['logger']['error']('Error\x20executing\x20image\x20generation\x20command\x20'+_0x1afeff[_0x34013e(0x164)]+':',_0xa1cd00),_0x467d11['push']({'action':_0x1afeff[_0x34013e(0x164)],'success':![],'error':_0xa1cd00['message']});}}return{'results':_0x467d11};}async[a0_0x2d24f4(0x15e)](_0x426979,_0x20ff57,_0x4a883d){const _0x53778a=a0_0x2d24f4;this['logger']['info'](_0x53778a(0x156)+_0x426979);if(!this['llmService'])throw new Error('LLM\x20service\x20not\x20available.\x20Image\x20generation\x20requires\x20server\x20connection.');const _0x301ced=a0_0x3a6a80[_0x53778a(0x14e)](_0x20ff57)?_0x20ff57:a0_0x3a6a80['resolve'](_0x4a883d,_0x20ff57),_0x5746b0=a0_0x3a6a80[_0x53778a(0x161)](_0x301ced);await a0_0x43e27a['mkdir'](_0x5746b0,{'recursive':!![]});const _0x59a5af=Date['now']()['toString'](0x24)+Math[_0x53778a(0x158)]()[_0x53778a(0x16a)](0x24)['substring'](0x2,0x9);try{const _0x20ceff=this[_0x53778a(0x173)][_0x53778a(0x171)]?.['imageGen']?.[_0x53778a(0x143)]||'azure-openai-dalle3';this['logger']['info']('Image\x20generation\x20config:',{'configModel':this[_0x53778a(0x173)]['tools']?.['imageGen']?.[_0x53778a(0x143)],'finalModel':_0x20ceff,'size':this[_0x53778a(0x173)]['tools']?.['imageGen']?.[_0x53778a(0x13b)]||'1024x1024','quality':this[_0x53778a(0x173)][_0x53778a(0x171)]?.['imageGen']?.[_0x53778a(0x159)]||'standard'}),this[_0x53778a(0x13d)]['info']('Sending\x20image\x20generation\x20request\x20to\x20autopilot-backend\x20with\x20model:\x20'+_0x20ceff);const _0x44808e={'model':_0x20ceff,'size':this[_0x53778a(0x173)]['tools']?.['imageGen']?.[_0x53778a(0x13b)]||'1024x1024','quality':this[_0x53778a(0x173)][_0x53778a(0x171)]?.['imageGen']?.[_0x53778a(0x159)]||_0x53778a(0x15b),'responseFormat':'b64_json'};this[_0x53778a(0x13d)][_0x53778a(0x174)](_0x53778a(0x14c),_0x44808e);const _0x14c423=await this['llmService']['generateImage'](_0x426979,_0x44808e),_0x5e4aff=_0x14c423[_0x53778a(0x149)];if(!_0x5e4aff)throw new Error('No image URL received from server');try{const _0x3d7959=await fetch(_0x5e4aff,{'signal':AbortSignal['timeout'](0xea60)});if(!_0x3d7959['ok'])throw new Error('Failed\x20to\x20download\x20image:\x20HTTP\x20'+_0x3d7959[_0x53778a(0x163)]);const _0x91b0c4=Buffer[_0x53778a(0x146)](await _0x3d7959[_0x53778a(0x155)]());await a0_0x43e27a[_0x53778a(0x167)](_0x301ced,_0x91b0c4);}catch(_0x58bc9d){if(_0x58bc9d[_0x53778a(0x150)]===_0x53778a(0x147))throw new Error(_0x53778a(0x13c));else{if(_0x58bc9d[_0x53778a(0x150)]==='TypeError')throw new Error('Network\x20error:\x20'+_0x58bc9d['message']);else throw new Error(_0x53778a(0x172)+_0x58bc9d['message']);}}return this[_0x53778a(0x13d)][_0x53778a(0x162)]('Image\x20saved\x20to:\x20'+_0x301ced),{'action':_0x53778a(0x165),'jobId':_0x59a5af,'prompt':_0x426979,'outputPath':_0x20ff57,'resolvedOutputPath':_0x301ced,'success':!![],'status':'completed','model':_0x14c423[_0x53778a(0x143)],'size':_0x14c423[_0x53778a(0x13b)],'usage':_0x14c423['usage']};}catch(_0x13b2a0){this[_0x53778a(0x13d)]['error']('Failed\x20to\x20generate\x20image:\x20'+_0x13b2a0['message']);throw new Error(_0x53778a(0x169)+_0x13b2a0[_0x53778a(0x13a)]);}}async['getGenerationStatus'](_0x262df2){const _0x416976=a0_0x2d24f4;if(!this['pendingGenerations']['has'](_0x262df2))return{'jobId':_0x262df2,'exists':![],'status':_0x416976(0x15c)};const _0x414efd=this[_0x416976(0x166)][_0x416976(0x176)](_0x262df2);return{'jobId':_0x262df2,'exists':!![],'status':_0x414efd['status'],'progress':_0x414efd[_0x416976(0x14b)],'prompt':_0x414efd[_0x416976(0x13e)],'outputPath':_0x414efd[_0x416976(0x16d)]};}async[a0_0x2d24f4(0x13f)](_0x4c8b5d){const _0x447736=a0_0x2d24f4;if(!this['pendingGenerations'][_0x447736(0x14a)](_0x4c8b5d))return{'action':_0x447736(0x145),'jobId':_0x4c8b5d,'success':![],'error':'Generation\x20job\x20not\x20found'};const _0x17c22b=this['pendingGenerations']['get'](_0x4c8b5d);if(_0x17c22b[_0x447736(0x163)]==='pending')return _0x17c22b[_0x447736(0x163)]='cancelled',this[_0x447736(0x166)][_0x447736(0x160)](_0x4c8b5d,_0x17c22b),{'action':'cancel','jobId':_0x4c8b5d,'success':!![]};return{'action':'cancel','jobId':_0x4c8b5d,'success':![],'error':_0x447736(0x141)+_0x17c22b['status']};}async['shutdown'](){const _0x587979=a0_0x2d24f4;this['logger'][_0x587979(0x162)](_0x587979(0x16b));for(const [_0x2db8f8,_0x17cadb]of this['pendingGenerations'][_0x587979(0x142)]()){_0x17cadb['status']===_0x587979(0x14d)&&(_0x17cadb[_0x587979(0x163)]='cancelled',this[_0x587979(0x166)]['set'](_0x2db8f8,_0x17cadb));}}}function a0_0x3fce(){const _0xd12b81=['BgXTu2vYDMLJzq','Dg9VBhm','rg93BMXVywqGzMfPBgvKoIa','y29UzMLN','zgvIDwC','mJe4mZr3BLbJAgK','z2v0','nda2ndm0m2rzv1LNrG','BwvZC2fNzq','C2L6zq','sw1Hz2uGzg93BMXVywqGDgLTzw91Da','Bg9Nz2vY','ChjVBxb0','y2fUy2vSr2vUzxjHDgLVBG','mZC5mJm2s2TZyvbW','q2fUBM90ignHBMnLBcbQB2iGD2L0AcbZDgf0Dxm6ia','zw50CMLLCW','Bw9KzwW','neP3ww5YAW','y2fUy2vS','zNjVBq','vgLTzw91DevYCM9Y','mJCYm25YtfzyCW','Aw1Hz2vvCMW','AgfZ','ChjVz3jLC3m','sw1Hz2uGz2vUzxjHDgLVBIbVChrPB25ZoG','CgvUzgLUzW','AxnbyNnVBhv0zq','mtmYs2ftvwDK','BMfTzq','nZCYnZK1mhjiwKP4zq','B3v0Chv0lxbHDgG','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','mtK2mdu2ndfLsxvcDhe','yxjYyxLcDwzMzxi','r2vUzxjHDgLUzYbPBwfNzsb3AxrOihbYB21WDdOG','ChvZAa','CMfUzg9T','CxvHBgL0Eq','mJCWzezkBeHq','C3rHBMrHCMq','BM90x2zVDw5K','mti0otHlq3frELm','z2vUzxjHDgvjBwfNzq','y29TBwfUzhm','C2v0','zgLYBMfTzq','Aw5MBW','C3rHDhvZ','ywn0Aw9U','z2vUzxjHDgu','CgvUzgLUz0DLBMvYyxrPB25Z','D3jPDgvgAwXL','z2v0rgvZy3jPChrPB24','rMfPBgvKihrVigDLBMvYyxrLigLTywDLoIa','Dg9tDhjPBMC','u2H1DhrPBMCGzg93BIbPBwfNzsb0B29S','mtK1mJH1tfbOAwG','B3v0Chv0ugf0Aa','Cgf0Aa','yxr0CMLIDxrLCW'];a0_0x3fce=function(){return _0xd12b81;};return a0_0x3fce();}