const a0_0x30e284=a0_0x7aaa;(function(_0x159b5e,_0x40cbc1){const _0x5694fc=a0_0x7aaa,_0xd3039f=_0x159b5e();while(!![]){try{const _0xc43ab0=parseInt(_0x5694fc(0x197))/0x1+parseInt(_0x5694fc(0x179))/0x2+parseInt(_0x5694fc(0x170))/0x3+parseInt(_0x5694fc(0x18d))/0x4*(parseInt(_0x5694fc(0x183))/0x5)+-parseInt(_0x5694fc(0x187))/0x6*(parseInt(_0x5694fc(0x163))/0x7)+-parseInt(_0x5694fc(0x176))/0x8*(parseInt(_0x5694fc(0x160))/0x9)+-parseInt(_0x5694fc(0x174))/0xa*(parseInt(_0x5694fc(0x173))/0xb);if(_0xc43ab0===_0x40cbc1)break;else _0xd3039f['push'](_0xd3039f['shift']());}catch(_0x3f2ee6){_0xd3039f['push'](_0xd3039f['shift']());}}}(a0_0x1f33,0x4b456));import a0_0x55e369 from'path';import{promises as a0_0x107edb}from'fs';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';function a0_0x7aaa(_0x4353db,_0x42b471){const _0x1f335e=a0_0x1f33();return a0_0x7aaa=function(_0x7aaaa1,_0x4f36cf){_0x7aaaa1=_0x7aaaa1-0x158;let _0x21a968=_0x1f335e[_0x7aaaa1];if(a0_0x7aaa['quKgAA']===undefined){var _0x4ef336=function(_0x55e369){const _0x107edb='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x209a90='',_0x9783e8='';for(let _0x29d00e=0x0,_0x57192f,_0x4b49fe,_0x4eb46c=0x0;_0x4b49fe=_0x55e369['charAt'](_0x4eb46c++);~_0x4b49fe&&(_0x57192f=_0x29d00e%0x4?_0x57192f*0x40+_0x4b49fe:_0x4b49fe,_0x29d00e++%0x4)?_0x209a90+=String['fromCharCode'](0xff&_0x57192f>>(-0x2*_0x29d00e&0x6)):0x0){_0x4b49fe=_0x107edb['indexOf'](_0x4b49fe);}for(let _0x8eb131=0x0,_0x4060c3=_0x209a90['length'];_0x8eb131<_0x4060c3;_0x8eb131++){_0x9783e8+='%'+('00'+_0x209a90['charCodeAt'](_0x8eb131)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x9783e8);};a0_0x7aaa['vTwovK']=_0x4ef336,_0x4353db=arguments,a0_0x7aaa['quKgAA']=!![];}const _0x203786=_0x1f335e[0x0],_0x42fdb4=_0x7aaaa1+_0x203786,_0x373a6a=_0x4353db[_0x42fdb4];return!_0x373a6a?(_0x21a968=a0_0x7aaa['vTwovK'](_0x21a968),_0x4353db[_0x42fdb4]=_0x21a968):_0x21a968=_0x373a6a,_0x21a968;},a0_0x7aaa(_0x4353db,_0x42b471);}export class ImageTool extends BaseTool{constructor(_0x209a90,_0x9783e8,_0x29d00e=null){const _0x3d25fc=a0_0x7aaa;super(_0x209a90,_0x9783e8),this['llmService']=_0x29d00e,this[_0x3d25fc(0x15b)]=new Map();}[a0_0x30e284(0x180)](_0x57192f){const _0x47ae7a=a0_0x30e284;this[_0x47ae7a(0x188)]=_0x57192f;}[a0_0x30e284(0x161)](){return'\x0aImage\x20Generation\x20Tool:\x20Allows\x20you\x20to\x20generate\x20images\x20using\x20AI\x20models.\x0a\x0aUsage:\x0a[tool\x20id=\x22image-gen\x22]\x0a[generate\x20output-path=\x22relative/path/to/save/image.png\x22]\x0aDetailed\x20description\x20of\x20the\x20image\x20you\x20want\x20to\x20generate\x0a[/generate]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20Generate\x20a\x20simple\x20image:\x0a[tool\x20id=\x22image-gen\x22]\x0a[generate\x20output-path=\x22images/mountains.png\x22]\x0aA\x20beautiful\x20mountain\x20landscape\x20with\x20snow-capped\x20peaks,\x20a\x20clear\x20blue\x20sky,\x20and\x20a\x20forest\x20at\x20the\x20base\x20of\x20the\x20mountains.\x0a[/generate]\x0a[/tool]\x0a\x0a2.\x20Generate\x20a\x20detailed\x20image\x20with\x20specific\x20style:\x0a[tool\x20id=\x22image-gen\x22]\x0a[generate\x20output-path=\x22images/robot.png\x22]\x0aA\x20futuristic\x20robot\x20in\x20a\x20cyberpunk\x20city\x20at\x20night.\x20The\x20robot\x20has\x20glowing\x20blue\x20eyes\x20and\x20is\x20standing\x20under\x20a\x20neon\x20sign.\x20Style:\x20digital\x20art,\x20detailed,\x20high\x20contrast.\x0a[/generate]\x0a[/tool]\x0a\x0a3.\x20Generate\x20an\x20abstract\x20art\x20piece:\x0a[tool\x20id=\x22image-gen\x22]\x0a[generate\x20output-path=\x22images/abstract.png\x22]\x0aAbstract\x20geometric\x20shapes\x20in\x20bright\x20colors,\x20with\x20a\x20focus\x20on\x20circles\x20and\x20triangles.\x20Style:\x20minimalist,\x20clean\x20lines,\x20vibrant\x20colors.\x0a[/generate]\x0a[/tool]\x0a\x0aNotes:\x0a-\x20Image\x20generation\x20may\x20take\x20some\x20time\x20to\x20complete\x0a-\x20The\x20output\x20path\x20should\x20be\x20relative\x20to\x20the\x20project\x20directory\x0a-\x20Provide\x20detailed\x20descriptions\x20for\x20better\x20results\x0a-\x20You\x20will\x20receive\x20a\x20notification\x20when\x20the\x20image\x20generation\x20is\x20complete\x0a\x20\x20\x20\x20';}['parseParameters'](_0x4b49fe){const _0x5c0b57=a0_0x30e284;this['logger'][_0x5c0b57(0x182)]('Parsing\x20image\x20generation\x20parameters\x20with\x20TagParser');const _0x4eb46c={'commands':[]};try{const _0x8eb131=TagParser['query'](_0x4b49fe,_0x5c0b57(0x189));for(const _0x4060c3 of _0x8eb131){const _0x18a8ef=_0x4060c3[_0x5c0b57(0x16b)]['output-path'];_0x18a8ef&&_0x4eb46c[_0x5c0b57(0x190)][_0x5c0b57(0x184)]({'action':'generate','path':_0x18a8ef,'prompt':_0x4060c3['content']['trim']()});}return _0x4eb46c;}catch(_0x1eb503){return this[_0x5c0b57(0x175)][_0x5c0b57(0x16a)](_0x5c0b57(0x194),_0x1eb503),{'commands':[]};}}async['executeWithParameters'](_0x38baab,_0x5cf186){const _0x4c5148=a0_0x30e284;this[_0x4c5148(0x175)]['info'](_0x4c5148(0x169),_0x38baab);const _0x2a9848=[];if(!_0x38baab['commands']||_0x38baab[_0x4c5148(0x190)]['length']===0x0)throw new Error('No\x20image\x20generation\x20commands\x20specified');for(const _0xadc98e of _0x38baab[_0x4c5148(0x190)]){try{switch(_0xadc98e[_0x4c5148(0x195)]){case'generate':const _0x41193d=await this[_0x4c5148(0x17a)](_0xadc98e['prompt'],_0xadc98e[_0x4c5148(0x15f)],_0x5cf186);_0x2a9848['push'](_0x41193d);break;default:throw new Error('Unknown\x20image\x20generation\x20command:\x20'+_0xadc98e['action']);}}catch(_0x5ca991){this['logger']['error']('Error\x20executing\x20image\x20generation\x20command\x20'+_0xadc98e[_0x4c5148(0x195)]+':',_0x5ca991),_0x2a9848[_0x4c5148(0x184)]({'action':_0xadc98e['action'],'success':![],'error':_0x5ca991[_0x4c5148(0x178)]});}}return{'results':_0x2a9848};}async[a0_0x30e284(0x17a)](_0x3a8d64,_0x5cb9ba,_0x2b4f27){const _0x54387b=a0_0x30e284;this[_0x54387b(0x175)]['info'](_0x54387b(0x164)+_0x3a8d64);if(!this['llmService'])throw new Error('LLM\x20service\x20not\x20available.\x20Image\x20generation\x20requires\x20server\x20connection.');const _0x7fb68d=a0_0x55e369['isAbsolute'](_0x5cb9ba)?_0x5cb9ba:a0_0x55e369[_0x54387b(0x172)](_0x2b4f27,_0x5cb9ba),_0x6a93d8=a0_0x55e369[_0x54387b(0x181)](_0x7fb68d);await a0_0x107edb[_0x54387b(0x198)](_0x6a93d8,{'recursive':!![]});const _0x414e4c=Date['now']()['toString'](0x24)+Math['random']()[_0x54387b(0x16c)](0x24)[_0x54387b(0x186)](0x2,0x9);try{const _0x5706e1=this['config']['tools']?.[_0x54387b(0x15a)]?.[_0x54387b(0x171)]||'azure-openai-dalle3';this['logger'][_0x54387b(0x182)]('Image\x20generation\x20config:',{'configModel':this['config']['tools']?.[_0x54387b(0x15a)]?.['model'],'finalModel':_0x5706e1,'size':this[_0x54387b(0x166)][_0x54387b(0x18f)]?.['imageGen']?.['size']||_0x54387b(0x165),'quality':this['config'][_0x54387b(0x18f)]?.['imageGen']?.[_0x54387b(0x17f)]||_0x54387b(0x15d)}),this[_0x54387b(0x175)][_0x54387b(0x182)]('Sending\x20image\x20generation\x20request\x20to\x20autopilot-backend\x20with\x20model:\x20'+_0x5706e1);const _0x765c61={'model':_0x5706e1,'size':this['config']['tools']?.['imageGen']?.[_0x54387b(0x17b)]||'1024x1024','quality':this['config']['tools']?.['imageGen']?.[_0x54387b(0x17f)]||'standard','responseFormat':_0x54387b(0x16f)};this[_0x54387b(0x175)][_0x54387b(0x18b)]('Image\x20generation\x20options:',_0x765c61);const _0xa9434c=await this[_0x54387b(0x188)][_0x54387b(0x17a)](_0x3a8d64,_0x765c61),_0x6dcd91=_0xa9434c['imageUrl'];if(!_0x6dcd91)throw new Error('No image URL received from server');try{const _0x4cdcaa=await fetch(_0x6dcd91,{'signal':AbortSignal['timeout'](0xea60)});if(!_0x4cdcaa['ok'])throw new Error('Failed\x20to\x20download\x20image:\x20HTTP\x20'+_0x4cdcaa[_0x54387b(0x192)]);const _0x3d595b=Buffer[_0x54387b(0x18a)](await _0x4cdcaa[_0x54387b(0x196)]());await a0_0x107edb['writeFile'](_0x7fb68d,_0x3d595b);}catch(_0x284629){if(_0x284629[_0x54387b(0x17e)]===_0x54387b(0x193))throw new Error(_0x54387b(0x168));else{if(_0x284629['name']===_0x54387b(0x162))throw new Error('Network\x20error:\x20'+_0x284629['message']);else throw new Error(_0x54387b(0x16d)+_0x284629['message']);}}return this[_0x54387b(0x175)][_0x54387b(0x182)](_0x54387b(0x15c)+_0x7fb68d),{'action':_0x54387b(0x189),'jobId':_0x414e4c,'prompt':_0x3a8d64,'outputPath':_0x5cb9ba,'resolvedOutputPath':_0x7fb68d,'success':!![],'status':_0x54387b(0x17c),'model':_0xa9434c[_0x54387b(0x171)],'size':_0xa9434c['size'],'usage':_0xa9434c['usage']};}catch(_0x506360){this[_0x54387b(0x175)][_0x54387b(0x16a)]('Failed\x20to\x20generate\x20image:\x20'+_0x506360[_0x54387b(0x178)]);throw new Error('Failed\x20to\x20generate\x20image:\x20'+_0x506360[_0x54387b(0x178)]);}}async[a0_0x30e284(0x15e)](_0x5c19c7){const _0x499635=a0_0x30e284;if(!this[_0x499635(0x15b)][_0x499635(0x18c)](_0x5c19c7))return{'jobId':_0x5c19c7,'exists':![],'status':_0x499635(0x18e)};const _0x14751f=this['pendingGenerations'][_0x499635(0x167)](_0x5c19c7);return{'jobId':_0x5c19c7,'exists':!![],'status':_0x14751f[_0x499635(0x192)],'progress':_0x14751f['progress'],'prompt':_0x14751f[_0x499635(0x191)],'outputPath':_0x14751f[_0x499635(0x158)]};}async[a0_0x30e284(0x185)](_0x1ee7ff){const _0x1a71b5=a0_0x30e284;if(!this['pendingGenerations']['has'](_0x1ee7ff))return{'action':_0x1a71b5(0x16e),'jobId':_0x1ee7ff,'success':![],'error':'Generation\x20job\x20not\x20found'};const _0x417d12=this['pendingGenerations']['get'](_0x1ee7ff);if(_0x417d12[_0x1a71b5(0x192)]===_0x1a71b5(0x17d))return _0x417d12['status']=_0x1a71b5(0x177),this[_0x1a71b5(0x15b)]['set'](_0x1ee7ff,_0x417d12),{'action':_0x1a71b5(0x16e),'jobId':_0x1ee7ff,'success':!![]};return{'action':'cancel','jobId':_0x1ee7ff,'success':![],'error':'Cannot\x20cancel\x20job\x20with\x20status:\x20'+_0x417d12[_0x1a71b5(0x192)]};}async['shutdown'](){const _0x3e7d86=a0_0x30e284;this['logger'][_0x3e7d86(0x182)]('Shutting\x20down\x20image\x20tool');for(const [_0x466968,_0x26da7a]of this['pendingGenerations']['entries']()){_0x26da7a['status']==='pending'&&(_0x26da7a['status']=_0x3e7d86(0x177),this[_0x3e7d86(0x15b)][_0x3e7d86(0x159)](_0x466968,_0x26da7a));}}}function a0_0x1f33(){const _0x130b78=['z2v0rgvZy3jPChrPB24','vhLWzuvYCM9Y','ndK3ruHbr2Pg','r2vUzxjHDgLUzYbPBwfNzsb3AxrOihbYB21WDdOG','mtaYnhGXmdi0','y29UzMLN','z2v0','sw1Hz2uGzg93BMXVywqGDgLTzw91Da','rxHLy3v0Aw5NigLTywDLigDLBMvYyxrPB24Gy29TBwfUzcb3AxrOihbHCMfTzxrLCNm6','zxjYB3i','yxr0CMLIDxrLCW','Dg9tDhjPBMC','rg93BMXVywqGzMfPBgvKoIa','y2fUy2vS','yJy0x2PZB24','mte0mdG2n2TyvwzJBG','Bw9KzwW','CMvZB2X2zq','ntGXodKXmLPMww5LEG','mtbArhzurMW','Bg9Nz2vY','mtzXz1HzsNy','y2fUy2vSBgvK','BwvZC2fNzq','nJmYntqYCKv6v01l','z2vUzxjHDgvjBwfNzq','C2L6zq','y29TCgXLDgvK','CgvUzgLUzW','BMfTzq','CxvHBgL0Eq','C2v0teXnu2vYDMLJzq','zgLYBMfTzq','Aw5MBW','otqZmdv2A21fq2m','ChvZAa','y2fUy2vSr2vUzxjHDgLVBG','C3vIC3rYAw5N','mteYmJzJD3HUwfC','BgXTu2vYDMLJzq','z2vUzxjHDgu','zNjVBq','zgvIDwC','AgfZ','ndrwsuLfreu','BM90x2zVDw5K','Dg9VBhm','y29TBwfUzhm','ChjVBxb0','C3rHDhvZ','vgLTzw91DevYCM9Y','rxjYB3iGCgfYC2LUzYbPBwfNzsbNzw5LCMf0Aw9UihbHCMfTzxrLCNm6','ywn0Aw9U','yxjYyxLcDwzMzxi','mZy3nda2v0reswj6','BwTKAxi','B3v0Chv0ugf0Aa','C2v0','Aw1Hz2vhzw4','CgvUzgLUz0DLBMvYyxrPB25Z','sw1Hz2uGC2f2zwqGDg86ia','C3rHBMrHCMq','z2v0r2vUzxjHDgLVBLn0yxr1CW','Cgf0Aa','mtm1ntGYm0LQq09WyW'];a0_0x1f33=function(){return _0x130b78;};return a0_0x1f33();}