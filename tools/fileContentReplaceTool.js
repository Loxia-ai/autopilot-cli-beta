const a0_0x83246e=a0_0x18af;(function(_0x25ba1b,_0xb66f94){const _0x451713=a0_0x18af,_0x4a7c8b=_0x25ba1b();while(!![]){try{const _0x3a55cd=parseInt(_0x451713(0xea))/0x1+parseInt(_0x451713(0xe2))/0x2*(-parseInt(_0x451713(0xd9))/0x3)+parseInt(_0x451713(0x105))/0x4+parseInt(_0x451713(0xed))/0x5*(-parseInt(_0x451713(0xd6))/0x6)+parseInt(_0x451713(0xee))/0x7*(-parseInt(_0x451713(0xd2))/0x8)+-parseInt(_0x451713(0xf4))/0x9+parseInt(_0x451713(0xd4))/0xa;if(_0x3a55cd===_0xb66f94)break;else _0x4a7c8b['push'](_0x4a7c8b['shift']());}catch(_0x533564){_0x4a7c8b['push'](_0x4a7c8b['shift']());}}}(a0_0x1703,0x1e585));import{promises as a0_0x1dc444}from'fs';import a0_0x40f3b9 from'path';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';function a0_0x1703(){const _0x77fdcf=['nKLpAMzsDq','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','ihrVia','Aw5MBW','rxHLy3v0Aw5NigzPBguGy29UDgvUDcbYzxbSywnLignVBw1HBMqGD2L0AcbWyxjHBwv0zxjZoG','zxnJyxbLuMvNrxHW','uMvWBgfJzsb0ywCGBwLZC2LUzYbVBgqTy29UDgvUDa','AgfZ','zNjVBq','mJeYmte0uLLOvMXO','yxbWBhLuCMLTtw9Kzq','C3bSAxq','DhjPBq','y29UDgvUDa','BMv3BgLUzxm','rxjYB3iGCgfYC2LUzYbMAwXLignVBNrLBNqGCMvWBgfJzsbWyxjHBwv0zxjZoG','ktOkcG','nZe2nJvJvxvdD3K','Bg9Nz2vY','CMvWBgfJzq','nwnvBNn5sq','n3nsCvfwqq','BwvZC2fNzq','icHTB2rLoIa','B2XKlwnVBNrLBNq','BgLUzxmTBgLTAxq','ig5VDcbMB3vUzdOG','mZe2mtm0q1bNwMfY','Bwf0y2G','ugvYzM9YBwLUzYbSAw5LlwXPBwL0zwqGCMvWBgfJzw1LBNqGAw4GBgLUzxm6ia','z2vUzxjHDgveAwzMuMvWB3j0','zxjYB3i','CMvHzezPBgu','CxvLCNK','rxjYB3iGzxHLy3v0Aw5NigzPBguGy29UDgvUDcbYzxbSywnLignVBw1HBMqG','ChvZAa','zw5KC1DPDgG','B2XKq29UDgvUDa','CMvZB2X2zq','tM8GCMvWBgfJzw1LBNrZig1HzguSig9SzcbJB250zw50ig5VDcbMB3vUzcbPBIb0AguGC3bLy2LMAwvKigXPBMvZ','BMv3lwnVBNrLBNq','Bw9Kzq','vw5RBM93BIbMAwXLignVBNrLBNqGCMvWBgfJzsbJB21Tyw5KoIa','D2fYBG','nZKWmZy0ue5VzwPu','lMjHAW','ywn0Aw9U','CgfYC2vmAw5LuMfUz2vZ','y29TBwfUzhm','CMvZB2X2zvbHDgG','BgvUz3rO','Aw5JBhvKzxm','yxr0CMLIDxrLCW','BgLUzxnmAw1PDa','D3jPDgvgAwXL','twfKzsa','AxnbyNnVBhv0zq','AM9PBG','nZKXntm2z2D4Bgvb','BwLU','mJa0mdC0mgDzvKrVDG','zMLSzvbHDgG','mtCXmZbXq0P5BNy','ihjLCgXHy2vTzw50','rgLMzIaOBgLUzxmG'];a0_0x1703=function(){return _0x77fdcf;};return a0_0x1703();}function a0_0x18af(_0x426802,_0x436849){const _0x17030c=a0_0x1703();return a0_0x18af=function(_0x18af2d,_0x20c640){_0x18af2d=_0x18af2d-0xc6;let _0x362a15=_0x17030c[_0x18af2d];if(a0_0x18af['NDRnCW']===undefined){var _0x137c9a=function(_0x1dc444){const _0x40f3b9='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3f8114='',_0x364139='';for(let _0xb38c8=0x0,_0x52f6d1,_0x20abdc,_0x4878af=0x0;_0x20abdc=_0x1dc444['charAt'](_0x4878af++);~_0x20abdc&&(_0x52f6d1=_0xb38c8%0x4?_0x52f6d1*0x40+_0x20abdc:_0x20abdc,_0xb38c8++%0x4)?_0x3f8114+=String['fromCharCode'](0xff&_0x52f6d1>>(-0x2*_0xb38c8&0x6)):0x0){_0x20abdc=_0x40f3b9['indexOf'](_0x20abdc);}for(let _0x3e8e04=0x0,_0x5cd160=_0x3f8114['length'];_0x3e8e04<_0x5cd160;_0x3e8e04++){_0x364139+='%'+('00'+_0x3f8114['charCodeAt'](_0x3e8e04)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x364139);};a0_0x18af['YSnqfU']=_0x137c9a,_0x426802=arguments,a0_0x18af['NDRnCW']=!![];}const _0x5cee6b=_0x17030c[0x0],_0x47002a=_0x18af2d+_0x5cee6b,_0x1a2ed6=_0x426802[_0x47002a];return!_0x1a2ed6?(_0x362a15=a0_0x18af['YSnqfU'](_0x362a15),_0x426802[_0x47002a]=_0x362a15):_0x362a15=_0x1a2ed6,_0x362a15;},a0_0x18af(_0x426802,_0x436849);}export class FileContentReplaceTool extends BaseTool{constructor(_0x3f8114,_0x364139){super(_0x3f8114,_0x364139);}['getDescription'](){return'\x0aFile\x20Content\x20Replace\x20Tool:\x20Allows\x20you\x20to\x20replace\x20specific\x20content\x20within\x20files\x20(use\x20after\x20searching\x20strings\x20with\x20the\x20seek\x20tool).\x0a\x0aUsage:\x0a[tool\x20id=\x22file-content-replace\x22]\x0a[file\x20path=\x22path/to/file.js\x22]\x0a[replace\x20lines-limit=\x223,5,7-9\x22\x20mode=\x22trim|newlines|none\x22]\x0a[old-content]\x0acontent\x20to\x20replace\x0a[/old-content]\x0a[new-content]\x0areplacement\x20content\x0a[/new-content]\x0a[/replace]\x0a[/file]\x0a[/tool]\x0a\x0aParameters:\x0a-\x20path:\x20Path\x20to\x20the\x20file\x20to\x20modify\x0a-\x20lines-limit:\x20Optional\x20comma-separated\x20list\x20of\x20line\x20numbers\x20or\x20ranges\x20to\x20limit\x20the\x20replacement.\x20Examples:\x20\x223,5,7-9\x22\x20will\x20only\x20replace\x20in\x20lines\x203,\x205,\x20and\x207\x20through\x209.\x0a-\x20mode:\x20Optional\x20trim\x20mode\x20for\x20old-content\x20and\x20new-content\x20strings:\x0a\x20\x20*\x20\x22trim\x22\x20(default,\x20recommended):\x20Trim\x20whitespace\x20from\x20both\x20ends\x20of\x20old-content\x20and\x20new-content\x0a\x20\x20*\x20\x22newlines\x22:\x20Only\x20trim\x20newline\x20characters\x20from\x20both\x20ends\x0a\x20\x20*\x20\x22none\x22:\x20Use\x20content\x20as-is\x20without\x20any\x20trimming\x0a-\x20old-content\x20(tag):\x20The\x20string\x20we\x20want\x20to\x20replace\x0a-\x20new-content\x20(tag):\x20The\x20new\x20string\x20we\x20want\x20to\x20put\x20instead\x20of\x20the\x20above\x0a\x0aExamples:\x0a1.\x20Replace\x20content\x20with\x20default\x20trimming:\x0a[tool\x20id=\x22file-content-replace\x22]\x0a[file\x20path=\x22src/components/Button.js\x22]\x0a[replace]\x0a[old-content]\x0a\x20\x20const\x20handleClick\x20=\x20(event)\x20=>\x20{\x0a\x20\x20\x20\x20console.log(\x27Button\x20clicked\x27);\x0a\x20\x20}\x0a[/old-content]\x0a[new-content]\x0a\x20\x20const\x20handleClick\x20=\x20(event)\x20=>\x20{\x0a\x20\x20\x20\x20console.log(\x27Button\x20clicked\x27);\x0a\x20\x20\x20\x20props.onClick\x20&&\x20props.onClick(event);\x0a\x20\x20}\x0a[/new-content]\x0a[/replace]\x0a[/file]\x0a[/tool]\x0a\x0a2.\x20Replace\x20content\x20without\x20any\x20trimming:\x0a[tool\x20id=\x22file-content-replace\x22]\x0a[file\x20path=\x22src/App.js\x22]\x0a[replace\x20mode=\x22none\x22]\x0a[old-content]\x0a\x20\x20return\x20(\x0a\x20\x20\x20\x20<div>Hello</div>\x0a\x20\x20);\x0a[/old-content]\x0a[new-content]\x0a\x20\x20return\x20(\x0a\x20\x20\x20\x20<div>Hello\x20World</div>\x0a\x20\x20);\x0a[/new-content]\x0a[/replace]\x0a[/file]\x0a[/tool]\x0a\x0aNotes:\x0a-\x20The\x20replacement\x20can\x20change\x20multiple\x20lines\x20at\x20once\x0a-\x20Default\x20behavior\x20trims\x20whitespace\x20from\x20old-content\x20and\x20new-content\x20for\x20easier\x20matching\x0a-\x20Use\x20mode=\x22none\x22\x20when\x20exact\x20whitespace\x20matching\x20is\x20required\x0a-\x20The\x20tool\x20will\x20create\x20a\x20backup\x20of\x20the\x20original\x20file\x20before\x20making\x20changes\x0a\x20\x20\x20\x20';}['applyTrimMode'](_0xb38c8,_0x52f6d1=a0_0x83246e(0xe5)){const _0x1056dc=a0_0x83246e;switch(_0x52f6d1){case _0x1056dc(0xe7):return _0xb38c8['replace'](/^\n+|\n+$/g,'');case'none':return _0xb38c8;case _0x1056dc(0xe5):default:return _0xb38c8[_0x1056dc(0xe5)]();}}['parseParameters'](_0x20abdc){const _0x3d9e59=a0_0x83246e;this[_0x3d9e59(0xeb)][_0x3d9e59(0xdc)]('Parsing\x20file\x20content\x20replace\x20parameters\x20with\x20TagParser');const _0x4878af={'commands':[]};try{const _0x3e8e04=TagParser[_0x3d9e59(0xfa)](_0x20abdc,'file');for(const _0x5cd160 of _0x3e8e04){const _0x2d50d9=_0x5cd160[_0x3d9e59(0xcc)]['path'];if(!_0x2d50d9){this['logger'][_0x3d9e59(0x104)]('File\x20tag\x20missing\x20path\x20attribute');continue;}const _0x4222f8=TagParser['query'](_0x5cd160['content'],_0x3d9e59(0xec));for(const _0x4407ed of _0x4222f8){const _0x33a969=_0x4407ed[_0x3d9e59(0xcc)][_0x3d9e59(0xf2)],_0x2d7f51=_0x4407ed['attributes'][_0x3d9e59(0x102)]||'trim',_0x4798e9=TagParser[_0x3d9e59(0xfa)](_0x4407ed['content'],_0x3d9e59(0xf1));if(_0x4798e9['length']===0x0){this['logger'][_0x3d9e59(0x104)](_0x3d9e59(0xdf));continue;}const _0x1bfc77=this[_0x3d9e59(0xe3)](_0x4798e9[0x0][_0x3d9e59(0xe6)],_0x2d7f51),_0x377734=TagParser['query'](_0x4407ed['content'],_0x3d9e59(0x101));if(_0x377734['length']===0x0){this['logger'][_0x3d9e59(0x104)]('Replace\x20tag\x20missing\x20new-content');continue;}const _0x598516=this['applyTrimMode'](_0x377734[0x0][_0x3d9e59(0xe6)],_0x2d7f51);let _0x26b2d1=null;_0x33a969&&(_0x26b2d1=this['parseLineRanges'](_0x33a969)),_0x4878af['commands']['push']({'action':_0x3d9e59(0xec),'filePath':_0x2d50d9,'linesLimit':_0x26b2d1,'oldContent':_0x1bfc77,'newContent':_0x598516,'mode':_0x2d7f51});}}return _0x4878af;}catch(_0x3d1708){return this['logger']['error'](_0x3d9e59(0xe8),_0x3d1708),{'commands':[]};}}[a0_0x83246e(0xc7)](_0x35bd1d){const _0xeab3d8=a0_0x83246e,_0x208ccb=new Set();if(!_0x35bd1d||_0x35bd1d['trim']()==='')return _0x208ccb;const _0x545b65=_0x35bd1d['split'](',');for(const _0x28cf60 of _0x545b65){const _0x3ff4c7=_0x28cf60['trim']();if(_0x3ff4c7==='')continue;if(_0x3ff4c7[_0xeab3d8(0xcb)]('-')){const [_0x4993bd,_0x1da169]=_0x3ff4c7['split']('-')['map'](_0x181432=>parseInt(_0x181432['trim'](),0xa));if(!isNaN(_0x4993bd)&&!isNaN(_0x1da169))for(let _0x43bee3=_0x4993bd;_0x43bee3<=_0x1da169;_0x43bee3++){_0x208ccb['add'](_0x43bee3);}}else{const _0xad4ecf=parseInt(_0x3ff4c7,0xa);!isNaN(_0xad4ecf)&&_0x208ccb['add'](_0xad4ecf);}}return _0x208ccb;}async[a0_0x83246e(0xda)](_0x29771f,_0x5ed29c){const _0xaef85e=a0_0x83246e;this[_0xaef85e(0xeb)]['info'](_0xaef85e(0xdd),_0x29771f);const _0x5ffa66=[];if(!_0x29771f[_0xaef85e(0xc8)]||_0x29771f['commands']['length']===0x0)throw new Error('No\x20file\x20content\x20replace\x20commands\x20specified');for(const _0x327579 of _0x29771f['commands']){try{switch(_0x327579['action']){case _0xaef85e(0xec):_0x5ffa66[_0xaef85e(0xfc)](await this['replaceContent'](_0x327579[_0xaef85e(0xd5)],_0x327579[_0xaef85e(0xfe)],_0x327579['newContent'],_0x327579[_0xaef85e(0xcd)],_0x5ed29c,_0x327579['mode']));break;default:throw new Error(_0xaef85e(0x103)+_0x327579[_0xaef85e(0xc6)]);}}catch(_0x4d08d4){this[_0xaef85e(0xeb)][_0xaef85e(0xf8)](_0xaef85e(0xfb)+_0x327579[_0xaef85e(0xc6)]+':',_0x4d08d4),_0x5ffa66[_0xaef85e(0xfc)]({'action':_0x327579['action'],'filePath':_0x327579['filePath'],'success':![],'error':_0x4d08d4['message']});}}return{'results':_0x5ffa66};}async['replaceContent'](_0x102c17,_0x31db50,_0x2351ed,_0x394092,_0x19043b,_0x3a4d08=a0_0x83246e(0xe5)){const _0x6c2130=a0_0x83246e;this['logger']['info']('Replacing\x20content\x20in\x20file:\x20'+_0x102c17+_0x6c2130(0xf0)+_0x3a4d08+')');const _0x54c2f8=this['resolvePath'](_0x102c17,_0x19043b);try{await a0_0x1dc444['access'](_0x54c2f8);}catch(_0x43b2b1){throw new Error('File\x20'+_0x102c17+_0x6c2130(0xf3)+_0x43b2b1[_0x6c2130(0xef)]);}let _0x54d26d;try{_0x54d26d=await a0_0x1dc444[_0x6c2130(0xf9)](_0x54c2f8,'utf-8');}catch(_0x17226c){throw new Error('Error\x20reading\x20file\x20'+_0x102c17+':\x20'+_0x17226c[_0x6c2130(0xef)]);}const _0x592ce7=_0x54c2f8+_0x6c2130(0x106);try{await a0_0x1dc444[_0x6c2130(0xce)](_0x592ce7,_0x54d26d);}catch(_0x41f517){this[_0x6c2130(0xeb)]['warn']('Failed\x20to\x20create\x20backup\x20file:\x20'+_0x41f517['message']);}const _0x4aeeff=_0x54d26d['split']('\x0a');let _0x4ac920=0x0,_0x56a728=[];if(_0x394092){this['logger']['info'](_0x6c2130(0xf6)+Array['from'](_0x394092)[_0x6c2130(0xd1)](',\x20'));let _0x5a6a26='',_0x33b798=0x0;while(_0x33b798<_0x4aeeff[_0x6c2130(0xca)]){const _0x65c063=_0x33b798+0x1;if(_0x394092['has'](_0x65c063)){const _0x8dacb9=[];let _0x574821=_0x33b798;while(_0x574821<_0x4aeeff['length']&&_0x394092[_0x6c2130(0xe0)](_0x574821+0x1)){_0x8dacb9[_0x6c2130(0xfc)](_0x4aeeff[_0x574821]),_0x574821++;}const _0x4b87d3=_0x8dacb9[_0x6c2130(0xd1)]('\x0a'),_0x4fc541=_0x4b87d3['includes'](_0x31db50)?_0x4b87d3['replace'](new RegExp(this['escapeRegExp'](_0x31db50),'g'),_0x2351ed):_0x4b87d3,_0x1a65c8=_0x4b87d3===_0x4fc541?0x0:(_0x4b87d3[_0x6c2130(0xf5)](new RegExp(this['escapeRegExp'](_0x31db50),'g'))||[])[_0x6c2130(0xca)];_0x4ac920+=_0x1a65c8,_0x5a6a26[_0x6c2130(0xca)]>0x0&&!_0x5a6a26[_0x6c2130(0xfd)]('\x0a')&&(_0x5a6a26+='\x0a'),_0x5a6a26+=_0x4fc541,_0x33b798=_0x574821;}else _0x5a6a26[_0x6c2130(0xca)]>0x0&&!_0x5a6a26[_0x6c2130(0xfd)]('\x0a')&&(_0x5a6a26+='\x0a'),_0x5a6a26+=_0x4aeeff[_0x33b798],_0x33b798++;}_0x4ac920>0x0&&await a0_0x1dc444['writeFile'](_0x54c2f8,_0x5a6a26),_0x56a728=_0x5a6a26[_0x6c2130(0xe4)]('\x0a');}else{this['logger']['info']('Performing\x20replacement\x20in\x20the\x20entire\x20file');if(!_0x54d26d['includes'](_0x31db50))return{'action':'replace','filePath':_0x102c17,'resolvedPath':_0x54c2f8,'success':!![],'replacementCount':0x0,'mode':_0x3a4d08,'message':'Old\x20content\x20not\x20found\x20in\x20file,\x20no\x20changes\x20made'};_0x4ac920=(_0x54d26d[_0x6c2130(0xf5)](new RegExp(this[_0x6c2130(0xde)](_0x31db50),'g'))||[])['length'];const _0x5e63e8=_0x54d26d[_0x6c2130(0xec)](new RegExp(this[_0x6c2130(0xde)](_0x31db50),'g'),_0x2351ed);await a0_0x1dc444[_0x6c2130(0xce)](_0x54c2f8,_0x5e63e8),_0x56a728=_0x5e63e8['split']('\x0a');}const _0x343776=this[_0x6c2130(0xf7)](_0x4aeeff,_0x56a728);return{'action':_0x6c2130(0xec),'filePath':_0x102c17,'resolvedPath':_0x54c2f8,'success':!![],'replacementCount':_0x4ac920,'linesLimit':_0x394092?Array[_0x6c2130(0xe1)](_0x394092):null,'backupPath':_0x592ce7,'diffReport':_0x343776,'mode':_0x3a4d08,'message':_0x4ac920>0x0?_0x6c2130(0xcf)+_0x4ac920+_0x6c2130(0xd7)+(_0x4ac920>0x1?'s':'')+'\x20in\x20file\x20'+_0x102c17+_0x6c2130(0xf0)+_0x3a4d08+')':_0x6c2130(0x100)};}[a0_0x83246e(0xf7)](_0x2a647d,_0xfc21d3){const _0x295934=a0_0x83246e;let _0x49c4f2='',_0x445b28=-0x1,_0x14cc8b=-0x1;const _0x381303=Math['max'](_0x2a647d[_0x295934(0xca)],_0xfc21d3['length']);for(let _0x5cd145=0x0;_0x5cd145<_0x381303;_0x5cd145++){const _0x46a1bf=_0x5cd145<_0x2a647d['length']?_0x2a647d[_0x5cd145]:null,_0x3a5eb4=_0x5cd145<_0xfc21d3['length']?_0xfc21d3[_0x5cd145]:null;_0x46a1bf!==_0x3a5eb4&&(_0x445b28===-0x1&&(_0x445b28=_0x5cd145),_0x14cc8b=_0x5cd145);}if(_0x445b28===-0x1)return'No\x20differences\x20found';const _0x315302=0x2,_0x42093e=Math['max'](0x0,_0x445b28-_0x315302),_0x191568=Math[_0x295934(0xd3)](_0x381303-0x1,_0x14cc8b+_0x315302);_0x49c4f2+=_0x295934(0xd8)+(_0x42093e+0x1)+_0x295934(0xdb)+(_0x191568+0x1)+_0x295934(0xe9);for(let _0x5222d3=_0x42093e;_0x5222d3<=_0x191568;_0x5222d3++){const _0x236d77=_0x5222d3<_0x2a647d['length']?_0x2a647d[_0x5222d3]:'',_0x10ab5e=_0x5222d3<_0xfc21d3['length']?_0xfc21d3[_0x5222d3]:'';_0x236d77===_0x10ab5e?_0x49c4f2+='\x20\x20'+(_0x5222d3+0x1)+':\x20'+_0x236d77+'\x0a':(_0x49c4f2+='-\x20'+(_0x5222d3+0x1)+':\x20'+_0x236d77+'\x0a',_0x49c4f2+='+\x20'+(_0x5222d3+0x1)+':\x20'+_0x10ab5e+'\x0a');}return _0x49c4f2;}['escapeRegExp'](_0xe44800){return _0xe44800['replace'](/[.*+?^${}()|[\]\\]/g,'\x5c$&');}[a0_0x83246e(0xc9)](_0x3e5057,_0x5b19b9){const _0x22f7b9=a0_0x83246e;if(a0_0x40f3b9[_0x22f7b9(0xd0)](_0x3e5057))return _0x3e5057;return a0_0x40f3b9[_0x22f7b9(0xff)](_0x5b19b9,_0x3e5057);}}