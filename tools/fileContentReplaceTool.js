function a0_0x47a4(){const _0xe8b5e2=['uMvWBgfJAw5NignVBNrLBNqGAw4GzMLSztOG','ndy3nZa4mfLruNrKsG','Bwf0y2G','ugvYzM9YBwLUzYbYzxbSywnLBwvUDcbPBIb0AguGzw50AxjLigzPBgu','AgfZ','zxnJyxbLuMvNrxHW','mZy4odyWnhrHwNvkuG','Bwf4','y29UDgvUDa','zw5KC1DPDgG','D2fYBG','uMvWBgfJzsb0ywCGBwLZC2LUzYbVBgqTy29UDgvUDa','mJuWnZe2mLfNBfHivW','rgLMzIaOBgLUzxmG','DxrMltG','AM9PBG','Bw9Kzq','BwfW','ChvZAa','mJaYndqYmg1cEKvtyq','CxvLCNK','mJu1nJCWmLDNu1nRCW','BwvZC2fNzq','y29TBwfUzhm','ig5VDcbMB3vUzdOG','BwLU','ndiWodG2nfnArgn3uW','BM9Uzq','xcqM','yxbWBhLuCMLTtw9Kzq','BgLUzxmTBgLTAxq','icHTB2rLoIa','igLUigzPBguG','Bg9Nz2vY','Aw5MBW','zNjVBq','z2v0rgvZy3jPChrPB24','B2XKq29UDgvUDa','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','Aw5JBhvKzxm','ihjLCgXHy2vTzw50','DhjPBq','ywn0Aw9U','tM8GzMLSzsbJB250zw50ihjLCgXHy2uGy29TBwfUzhmGC3bLy2LMAwvK','nJCZmtG4A1z4t3DZ','CMvWBgfJzq','ktOkcG','CMvZB2X2zvbHDgG','t2XKignVBNrLBNqGBM90igzVDw5KigLUigzPBguSig5VignOyw5NzxmGBwfKzq','CMvWBgfJzunVBNrLBNq','mxLcEeXYwG','zMLSzvbHDgG','CgfYC2vqyxjHBwv0zxjZ','zxjYB3i','rxjYB3iGCgfYC2LUzYbMAwXLignVBNrLBNqGCMvWBgfJzsbWyxjHBwv0zxjZoG','BgLUzxnmAw1PDa','BgvUz3rO','yxr0CMLIDxrLCW'];a0_0x47a4=function(){return _0xe8b5e2;};return a0_0x47a4();}const a0_0x59afaa=a0_0x4ee0;(function(_0x318761,_0x204171){const _0x22f631=a0_0x4ee0,_0x2c3883=_0x318761();while(!![]){try{const _0x2f301f=-parseInt(_0x22f631(0x167))/0x1*(parseInt(_0x22f631(0x148))/0x2)+parseInt(_0x22f631(0x14a))/0x3+parseInt(_0x22f631(0x175))/0x4+-parseInt(_0x22f631(0x170))/0x5+-parseInt(_0x22f631(0x161))/0x6+parseInt(_0x22f631(0x17b))/0x7+parseInt(_0x22f631(0x14f))/0x8;if(_0x2f301f===_0x204171)break;else _0x2c3883['push'](_0x2c3883['shift']());}catch(_0x5b0803){_0x2c3883['push'](_0x2c3883['shift']());}}}(a0_0x47a4,0x92333));import{promises as a0_0x1225c3}from'fs';import a0_0x2f5c7c from'path';import{TagParser}from'../utilities/tagParser.js';function a0_0x4ee0(_0x4d0099,_0x424505){const _0x47a412=a0_0x47a4();return a0_0x4ee0=function(_0x4ee071,_0x13cf97){_0x4ee071=_0x4ee071-0x148;let _0x588aac=_0x47a412[_0x4ee071];if(a0_0x4ee0['ebnSLs']===undefined){var _0x3f4f22=function(_0x1225c3){const _0x2f5c7c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x457f39='',_0x2ffdbc='';for(let _0x343927=0x0,_0x372f25,_0x23d846,_0x2aa1d3=0x0;_0x23d846=_0x1225c3['charAt'](_0x2aa1d3++);~_0x23d846&&(_0x372f25=_0x343927%0x4?_0x372f25*0x40+_0x23d846:_0x23d846,_0x343927++%0x4)?_0x457f39+=String['fromCharCode'](0xff&_0x372f25>>(-0x2*_0x343927&0x6)):0x0){_0x23d846=_0x2f5c7c['indexOf'](_0x23d846);}for(let _0x389e24=0x0,_0x3ac7bb=_0x457f39['length'];_0x389e24<_0x3ac7bb;_0x389e24++){_0x2ffdbc+='%'+('00'+_0x457f39['charCodeAt'](_0x389e24)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2ffdbc);};a0_0x4ee0['XWHfqk']=_0x3f4f22,_0x4d0099=arguments,a0_0x4ee0['ebnSLs']=!![];}const _0xb3c76e=_0x47a412[0x0],_0x39affc=_0x4ee071+_0xb3c76e,_0x72a820=_0x4d0099[_0x39affc];return!_0x72a820?(_0x588aac=a0_0x4ee0['XWHfqk'](_0x588aac),_0x4d0099[_0x39affc]=_0x588aac):_0x588aac=_0x72a820,_0x588aac;},a0_0x4ee0(_0x4d0099,_0x424505);}import{BaseTool}from'./baseTool.js';export class FileContentReplaceTool extends BaseTool{constructor(_0x457f39,_0x2ffdbc){super(_0x457f39,_0x2ffdbc);}[a0_0x59afaa(0x159)](){const _0x494b7c=a0_0x59afaa;return _0x494b7c(0x15b);}[a0_0x59afaa(0x152)](_0x343927,_0x372f25=a0_0x59afaa(0x15e)){const _0x2fb0d1=a0_0x59afaa;switch(_0x372f25){case'newlines':return _0x343927[_0x2fb0d1(0x162)](/^\n+|\n+$/g,'');case _0x2fb0d1(0x150):return _0x343927;case'trim':default:return _0x343927['trim']();}}[a0_0x59afaa(0x169)](_0x23d846){const _0x5375a9=a0_0x59afaa;this['logger']['info']('Parsing\x20file\x20content\x20replace\x20parameters\x20with\x20TagParser');const _0x2aa1d3={'commands':[]};try{const _0x389e24=TagParser[_0x5375a9(0x149)](_0x23d846,'file');for(const _0x3ac7bb of _0x389e24){const _0x5cc9ea=_0x3ac7bb[_0x5375a9(0x16e)]['path'];if(!_0x5cc9ea){this['logger'][_0x5375a9(0x179)]('File\x20tag\x20missing\x20path\x20attribute');continue;}const _0x250bdb=TagParser['query'](_0x3ac7bb['content'],'replace');for(const _0x27f809 of _0x250bdb){const _0x133e45=_0x27f809['attributes'][_0x5375a9(0x153)],_0x356485=_0x27f809[_0x5375a9(0x16e)]['mode']||'trim',_0x14a0db=TagParser['query'](_0x27f809[_0x5375a9(0x177)],'old-content');if(_0x14a0db['length']===0x0){this[_0x5375a9(0x156)][_0x5375a9(0x179)](_0x5375a9(0x17a));continue;}const _0x45acc9=this['applyTrimMode'](_0x14a0db[0x0]['content'],_0x356485),_0x24f95b=TagParser['query'](_0x27f809[_0x5375a9(0x177)],'new-content');if(_0x24f95b['length']===0x0){this[_0x5375a9(0x156)][_0x5375a9(0x179)]('Replace\x20tag\x20missing\x20new-content');continue;}const _0x9a32b5=this['applyTrimMode'](_0x24f95b[0x0][_0x5375a9(0x177)],_0x356485);let _0x11b244=null;_0x133e45&&(_0x11b244=this['parseLineRanges'](_0x133e45)),_0x2aa1d3[_0x5375a9(0x14c)][_0x5375a9(0x181)]({'action':'replace','filePath':_0x5cc9ea,'linesLimit':_0x11b244,'oldContent':_0x45acc9,'newContent':_0x9a32b5,'mode':_0x356485});}}return _0x2aa1d3;}catch(_0x45ad20){return this[_0x5375a9(0x156)][_0x5375a9(0x16a)](_0x5375a9(0x16b),_0x45ad20),{'commands':[]};}}['parseLineRanges'](_0x1d8b15){const _0x2b9ccf=a0_0x59afaa,_0x4b2ea2=new Set();if(!_0x1d8b15||_0x1d8b15[_0x2b9ccf(0x15e)]()==='')return _0x4b2ea2;const _0x5840de=_0x1d8b15['split'](',');for(const _0x50abd5 of _0x5840de){const _0x47e691=_0x50abd5[_0x2b9ccf(0x15e)]();if(_0x47e691==='')continue;if(_0x47e691[_0x2b9ccf(0x15c)]('-')){const [_0x28b701,_0x4cc2ac]=_0x47e691['split']('-')[_0x2b9ccf(0x180)](_0x39868c=>parseInt(_0x39868c[_0x2b9ccf(0x15e)](),0xa));if(!isNaN(_0x28b701)&&!isNaN(_0x4cc2ac))for(let _0xb9935d=_0x28b701;_0xb9935d<=_0x4cc2ac;_0xb9935d++){_0x4b2ea2['add'](_0xb9935d);}}else{const _0x1f8d71=parseInt(_0x47e691,0xa);!isNaN(_0x1f8d71)&&_0x4b2ea2['add'](_0x1f8d71);}}return _0x4b2ea2;}async['executeWithParameters'](_0x34aab7,_0x18d7c9){const _0x570617=a0_0x59afaa;this['logger']['info']('Executing\x20file\x20content\x20replace\x20command\x20with\x20parameters:',_0x34aab7);const _0x286565=[];if(!_0x34aab7[_0x570617(0x14c)]||_0x34aab7['commands']['length']===0x0)throw new Error(_0x570617(0x160));for(const _0x2c2bb7 of _0x34aab7['commands']){try{switch(_0x2c2bb7[_0x570617(0x15f)]){case _0x570617(0x162):_0x286565['push'](await this['replaceContent'](_0x2c2bb7['filePath'],_0x2c2bb7[_0x570617(0x15a)],_0x2c2bb7['newContent'],_0x2c2bb7[_0x570617(0x16c)],_0x18d7c9,_0x2c2bb7[_0x570617(0x17f)]));break;default:throw new Error('Unknown\x20file\x20content\x20replace\x20command:\x20'+_0x2c2bb7['action']);}}catch(_0x1b2792){this[_0x570617(0x156)]['error']('Error\x20executing\x20file\x20content\x20replace\x20command\x20'+_0x2c2bb7['action']+':',_0x1b2792),_0x286565['push']({'action':_0x2c2bb7[_0x570617(0x15f)],'filePath':_0x2c2bb7[_0x570617(0x168)],'success':![],'error':_0x1b2792['message']});}}return{'results':_0x286565};}async[a0_0x59afaa(0x166)](_0x3e33c3,_0x5bf960,_0x3461bc,_0x3af891,_0x46841f,_0x2d2d26='trim'){const _0x230472=a0_0x59afaa;this['logger']['info'](_0x230472(0x16f)+_0x3e33c3+'\x20(mode:\x20'+_0x2d2d26+')');const _0x174a8f=this['resolvePath'](_0x3e33c3,_0x46841f);try{await a0_0x1225c3['access'](_0x174a8f);}catch(_0x4a1f3f){throw new Error('File\x20'+_0x3e33c3+_0x230472(0x14d)+_0x4a1f3f['message']);}let _0x10c419;try{_0x10c419=await a0_0x1225c3['readFile'](_0x174a8f,_0x230472(0x17d));}catch(_0x54011d){throw new Error('Error\x20reading\x20file\x20'+_0x3e33c3+':\x20'+_0x54011d['message']);}const _0x25e89b=_0x174a8f+'.bak';try{await a0_0x1225c3['writeFile'](_0x25e89b,_0x10c419);}catch(_0x588ebf){this[_0x230472(0x156)]['warn']('Failed\x20to\x20create\x20backup\x20file:\x20'+_0x588ebf[_0x230472(0x14b)]);}const _0xb5cd1b=_0x10c419['split']('\x0a');let _0x10af9c=0x0,_0x5b53c9=[];if(_0x3af891){this['logger'][_0x230472(0x157)]('Performing\x20line-limited\x20replacement\x20in\x20lines:\x20'+Array['from'](_0x3af891)[_0x230472(0x17e)](',\x20'));let _0x831a29='',_0x2d91e5=0x0;while(_0x2d91e5<_0xb5cd1b['length']){const _0x37c89b=_0x2d91e5+0x1;if(_0x3af891[_0x230472(0x173)](_0x37c89b)){const _0x59634f=[];let _0x540d9e=_0x2d91e5;while(_0x540d9e<_0xb5cd1b[_0x230472(0x16d)]&&_0x3af891[_0x230472(0x173)](_0x540d9e+0x1)){_0x59634f['push'](_0xb5cd1b[_0x540d9e]),_0x540d9e++;}const _0xeba5e0=_0x59634f[_0x230472(0x17e)]('\x0a'),_0x2ca32b=_0xeba5e0[_0x230472(0x15c)](_0x5bf960)?_0xeba5e0['replace'](new RegExp(this[_0x230472(0x174)](_0x5bf960),'g'),_0x3461bc):_0xeba5e0,_0x38257e=_0xeba5e0===_0x2ca32b?0x0:(_0xeba5e0['match'](new RegExp(this['escapeRegExp'](_0x5bf960),'g'))||[])['length'];_0x10af9c+=_0x38257e,_0x831a29['length']>0x0&&!_0x831a29[_0x230472(0x178)]('\x0a')&&(_0x831a29+='\x0a'),_0x831a29+=_0x2ca32b,_0x2d91e5=_0x540d9e;}else _0x831a29['length']>0x0&&!_0x831a29['endsWith']('\x0a')&&(_0x831a29+='\x0a'),_0x831a29+=_0xb5cd1b[_0x2d91e5],_0x2d91e5++;}_0x10af9c>0x0&&await a0_0x1225c3['writeFile'](_0x174a8f,_0x831a29),_0x5b53c9=_0x831a29['split']('\x0a');}else{this[_0x230472(0x156)]['info'](_0x230472(0x172));if(!_0x10c419['includes'](_0x5bf960))return{'action':_0x230472(0x162),'filePath':_0x3e33c3,'resolvedPath':_0x174a8f,'success':!![],'replacementCount':0x0,'mode':_0x2d2d26,'message':_0x230472(0x165)};_0x10af9c=(_0x10c419[_0x230472(0x171)](new RegExp(this['escapeRegExp'](_0x5bf960),'g'))||[])['length'];const _0x46963d=_0x10c419[_0x230472(0x162)](new RegExp(this[_0x230472(0x174)](_0x5bf960),'g'),_0x3461bc);await a0_0x1225c3['writeFile'](_0x174a8f,_0x46963d),_0x5b53c9=_0x46963d['split']('\x0a');}const _0x2fc091=this['generateDiffReport'](_0xb5cd1b,_0x5b53c9);return{'action':'replace','filePath':_0x3e33c3,'resolvedPath':_0x174a8f,'success':!![],'replacementCount':_0x10af9c,'linesLimit':_0x3af891?Array[_0x230472(0x158)](_0x3af891):null,'backupPath':_0x25e89b,'diffReport':_0x2fc091,'mode':_0x2d2d26,'message':_0x10af9c>0x0?'Made\x20'+_0x10af9c+_0x230472(0x15d)+(_0x10af9c>0x1?'s':'')+_0x230472(0x155)+_0x3e33c3+_0x230472(0x154)+_0x2d2d26+')':'No\x20replacements\x20made,\x20old\x20content\x20not\x20found\x20in\x20the\x20specified\x20lines'};}['generateDiffReport'](_0x16b674,_0x50d0a2){const _0x1a5a7c=a0_0x59afaa;let _0x3e4b59='',_0x54e20f=-0x1,_0x4a9a66=-0x1;const _0x50843c=Math['max'](_0x16b674['length'],_0x50d0a2['length']);for(let _0x3b6ed3=0x0;_0x3b6ed3<_0x50843c;_0x3b6ed3++){const _0x9207d0=_0x3b6ed3<_0x16b674[_0x1a5a7c(0x16d)]?_0x16b674[_0x3b6ed3]:null,_0x26043d=_0x3b6ed3<_0x50d0a2[_0x1a5a7c(0x16d)]?_0x50d0a2[_0x3b6ed3]:null;_0x9207d0!==_0x26043d&&(_0x54e20f===-0x1&&(_0x54e20f=_0x3b6ed3),_0x4a9a66=_0x3b6ed3);}if(_0x54e20f===-0x1)return'No\x20differences\x20found';const _0x3ba0f6=0x2,_0x24f78a=Math[_0x1a5a7c(0x176)](0x0,_0x54e20f-_0x3ba0f6),_0x4a19a2=Math[_0x1a5a7c(0x14e)](_0x50843c-0x1,_0x4a9a66+_0x3ba0f6);_0x3e4b59+=_0x1a5a7c(0x17c)+(_0x24f78a+0x1)+'\x20to\x20'+(_0x4a19a2+0x1)+_0x1a5a7c(0x163);for(let _0x59ed7d=_0x24f78a;_0x59ed7d<=_0x4a19a2;_0x59ed7d++){const _0x257443=_0x59ed7d<_0x16b674[_0x1a5a7c(0x16d)]?_0x16b674[_0x59ed7d]:'',_0x5c8de0=_0x59ed7d<_0x50d0a2['length']?_0x50d0a2[_0x59ed7d]:'';_0x257443===_0x5c8de0?_0x3e4b59+='\x20\x20'+(_0x59ed7d+0x1)+':\x20'+_0x257443+'\x0a':(_0x3e4b59+='-\x20'+(_0x59ed7d+0x1)+':\x20'+_0x257443+'\x0a',_0x3e4b59+='+\x20'+(_0x59ed7d+0x1)+':\x20'+_0x5c8de0+'\x0a');}return _0x3e4b59;}[a0_0x59afaa(0x174)](_0x3d12d7){const _0x294e2b=a0_0x59afaa;return _0x3d12d7[_0x294e2b(0x162)](/[.*+?^${}()|[\]\\]/g,_0x294e2b(0x151));}[a0_0x59afaa(0x164)](_0x12560b,_0x504a56){if(a0_0x2f5c7c['isAbsolute'](_0x12560b))return _0x12560b;return a0_0x2f5c7c['resolve'](_0x504a56,_0x12560b);}}