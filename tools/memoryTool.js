const a0_0x576f3b=a0_0x37dc;(function(_0x55e381,_0x1258c9){const _0x1292dd=a0_0x37dc,_0x5cfab8=_0x55e381();while(!![]){try{const _0x2ccb05=parseInt(_0x1292dd(0x1cb))/0x1+parseInt(_0x1292dd(0x1b4))/0x2+-parseInt(_0x1292dd(0x1d3))/0x3*(-parseInt(_0x1292dd(0x1e3))/0x4)+-parseInt(_0x1292dd(0x1ad))/0x5*(-parseInt(_0x1292dd(0x1d8))/0x6)+-parseInt(_0x1292dd(0x1ca))/0x7*(-parseInt(_0x1292dd(0x1bc))/0x8)+-parseInt(_0x1292dd(0x1bb))/0x9*(parseInt(_0x1292dd(0x1e6))/0xa)+-parseInt(_0x1292dd(0x1bf))/0xb*(parseInt(_0x1292dd(0x1b3))/0xc);if(_0x2ccb05===_0x1258c9)break;else _0x5cfab8['push'](_0x5cfab8['shift']());}catch(_0x8e2ca2){_0x5cfab8['push'](_0x5cfab8['shift']());}}}(a0_0x27e8,0x78520));import{promises as a0_0x2e8ba9}from'fs';import a0_0xe67a2f from'path';import{v4 as a0_0x510c1c}from'uuid';function a0_0x37dc(_0x28facd,_0xbad42e){const _0x27e82e=a0_0x27e8();return a0_0x37dc=function(_0x37dce0,_0x3e7f10){_0x37dce0=_0x37dce0-0x1ac;let _0x3943df=_0x27e82e[_0x37dce0];if(a0_0x37dc['DubRuL']===undefined){var _0x21637a=function(_0x2e8ba9){const _0xe67a2f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x510c1c='',_0x79d405='';for(let _0x317915=0x0,_0x1e2b43,_0x54e73b,_0xccaf82=0x0;_0x54e73b=_0x2e8ba9['charAt'](_0xccaf82++);~_0x54e73b&&(_0x1e2b43=_0x317915%0x4?_0x1e2b43*0x40+_0x54e73b:_0x54e73b,_0x317915++%0x4)?_0x510c1c+=String['fromCharCode'](0xff&_0x1e2b43>>(-0x2*_0x317915&0x6)):0x0){_0x54e73b=_0xe67a2f['indexOf'](_0x54e73b);}for(let _0x5bc0cd=0x0,_0x36e29f=_0x510c1c['length'];_0x5bc0cd<_0x36e29f;_0x5bc0cd++){_0x79d405+='%'+('00'+_0x510c1c['charCodeAt'](_0x5bc0cd)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x79d405);};a0_0x37dc['RGXWFs']=_0x21637a,_0x28facd=arguments,a0_0x37dc['DubRuL']=!![];}const _0x4dc12a=_0x27e82e[0x0],_0x32ff51=_0x37dce0+_0x4dc12a,_0x20c5b4=_0x28facd[_0x32ff51];return!_0x20c5b4?(_0x3943df=a0_0x37dc['RGXWFs'](_0x3943df),_0x28facd[_0x32ff51]=_0x3943df):_0x3943df=_0x20c5b4,_0x3943df;},a0_0x37dc(_0x28facd,_0xbad42e);}import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x79d405,_0x317915){const _0x72146a=a0_0x37dc;super(_0x79d405,_0x317915),this[_0x72146a(0x1e4)]=new Map(),this[_0x72146a(0x1c0)]=![];}[a0_0x576f3b(0x1b2)](){return'\x0aMemory\x20Tool:\x20Allows\x20you\x20to\x20store\x20and\x20retrieve\x20important\x20information\x20that\x20you\x20want\x20to\x20remember\x20throughout\x20the\x20conversation.\x0a\x0aUsage:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22short\x20descriptive\x20name\x22\x20meaning=\x22reason\x20you\x20want\x20to\x20remember\x20this\x22]\x0aContent\x20to\x20remember\x20(can\x20be\x20code,\x20facts,\x20user\x20preferences,\x20etc.)\x0a[/memory]\x0a\x0a[read-all\x20/]\x0a\x0a[read-mem\x20id=\x22memory-id\x22\x20/]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20Store\x20an\x20important\x20piece\x20of\x20information:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22Project\x20requirements\x22\x20meaning=\x22Core\x20requirements\x20specified\x20by\x20the\x20user\x22]\x0a-\x20Must\x20work\x20on\x20both\x20Windows\x20and\x20Linux\x0a-\x20Should\x20support\x20both\x20light\x20and\x20dark\x20themes\x0a-\x20Maximum\x20memory\x20usage:\x20500MB\x0a[/memory]\x0a[/tool]\x0a\x0a2.\x20Retrieve\x20all\x20memories\x20to\x20see\x20what\x27s\x20available:\x0a[tool\x20id=\x22memory\x22]\x0a[read-all\x20/]\x0a[/tool]\x0a\x0a3.\x20Read\x20specific\x20memories:\x0a[tool\x20id=\x22memory\x22]\x0a[read-mem\x20id=\x22a1b2c3d4-5678-90ab-cdef-123456789012\x22\x20/]\x0a[/tool]\x0a\x0aNotes:\x0a-\x20Use\x20this\x20tool\x20to\x20store\x20information\x20that\x20you\x20might\x20need\x20later\x20in\x20the\x20conversation\x0a-\x20Memories\x20persist\x20for\x20the\x20duration\x20of\x20the\x20session\x0a-\x20You\x20can\x20save\x20code\x20snippets,\x20requirements,\x20user\x20preferences,\x20or\x20any\x20other\x20important\x20information\x0a-\x20When\x20storing\x20new\x20information,\x20always\x20provide\x20a\x20clear\x20name\x20and\x20meaning\x20to\x20help\x20you\x20recall\x20why\x20it\x20was\x20important\x0a-\x20Use\x20read-all\x20to\x20get\x20a\x20list\x20of\x20all\x20available\x20memories\x20when\x20you\x20need\x20a\x20reminder\x0a\x0aREMEMBER\x20TO\x20BROWSE\x20YOUR\x20MEMORIES\x20REGULARLY\x20AND\x20USE\x20THEM\x20TO\x20REFINE\x20YOUR\x20CODE\x20AND\x20RESPONSES.\x0a';}['parseParameters'](_0x1e2b43){const _0x9fc819=a0_0x576f3b;this['logger'][_0x9fc819(0x1b6)]('Parsing\x20memory\x20parameters\x20with\x20TagParser');const _0x54e73b={'commands':[]};try{const _0xccaf82=TagParser[_0x9fc819(0x1c1)](_0x1e2b43,_0x9fc819(0x1b5));for(const _0x29490f of _0xccaf82){const _0x3133b5=_0x29490f[_0x9fc819(0x1c7)][_0x9fc819(0x1dc)],_0x94daf0=_0x29490f['attributes'][_0x9fc819(0x1d1)];_0x3133b5&&_0x54e73b[_0x9fc819(0x1cf)]['push']({'action':_0x9fc819(0x1da),'name':_0x3133b5,'meaning':_0x94daf0||'','content':_0x29490f[_0x9fc819(0x1af)]});}const _0x5bc0cd=TagParser[_0x9fc819(0x1c1)](_0x1e2b43,_0x9fc819(0x1e5));_0x5bc0cd['length']>0x0&&_0x54e73b[_0x9fc819(0x1cf)]['push']({'action':_0x9fc819(0x1e5)});const _0x36e29f=TagParser['query'](_0x1e2b43,_0x9fc819(0x1b8));for(const _0x250741 of _0x36e29f){const _0x2f9887=_0x250741[_0x9fc819(0x1c7)]['id'];_0x2f9887&&_0x54e73b[_0x9fc819(0x1cf)]['push']({'action':_0x9fc819(0x1d2),'id':_0x2f9887});}return _0x54e73b;}catch(_0x47f16f){return this[_0x9fc819(0x1cc)][_0x9fc819(0x1d0)](_0x9fc819(0x1ba),_0x47f16f),{'commands':[]};}}async[a0_0x576f3b(0x1c4)](_0x5cfca5,_0x4a2544){const _0x543068=a0_0x576f3b;this['logger']['info'](_0x543068(0x1cd),_0x5cfca5);!this['initialized']&&await this[_0x543068(0x1e7)](_0x4a2544);const _0x5df3e6=[];if(!_0x5cfca5['commands']||_0x5cfca5[_0x543068(0x1cf)]['length']===0x0)throw new Error('No\x20memory\x20commands\x20specified');for(const _0x3477d7 of _0x5cfca5[_0x543068(0x1cf)]){try{let _0xab7873;switch(_0x3477d7['action']){case _0x543068(0x1da):_0xab7873=await this['saveMemory'](_0x3477d7['name'],_0x3477d7['meaning'],_0x3477d7['content']);break;case _0x543068(0x1e5):_0xab7873=await this['readAllMemories']();break;case'read-memory':_0xab7873=await this['readMemory'](_0x3477d7['id']);break;default:throw new Error('Unknown\x20memory\x20command:\x20'+_0x3477d7[_0x543068(0x1b1)]);}_0x5df3e6[_0x543068(0x1d6)](_0xab7873);}catch(_0x402e46){this[_0x543068(0x1cc)][_0x543068(0x1d0)]('Error\x20executing\x20memory\x20command\x20'+_0x3477d7[_0x543068(0x1b1)]+':',_0x402e46),_0x5df3e6[_0x543068(0x1d6)]({'action':_0x3477d7['action'],'success':![],'error':_0x402e46['message']});}}return await this[_0x543068(0x1d7)](_0x4a2544),{'results':_0x5df3e6};}async['initialize'](_0x19d0df){const _0x4b5a1e=a0_0x576f3b;this[_0x4b5a1e(0x1cc)][_0x4b5a1e(0x1b6)](_0x4b5a1e(0x1c5));try{const _0x54aed8=a0_0xe67a2f[_0x4b5a1e(0x1e0)](_0x19d0df,_0x4b5a1e(0x1bd),'memories');await a0_0x2e8ba9[_0x4b5a1e(0x1de)](_0x54aed8,{'recursive':!![]});try{const _0x47200f=a0_0xe67a2f[_0x4b5a1e(0x1e0)](_0x54aed8,'memories.json'),_0x5eed9e=await a0_0x2e8ba9['readFile'](_0x47200f,_0x4b5a1e(0x1c8)),_0x19bc98=JSON[_0x4b5a1e(0x1b9)](_0x5eed9e);for(const [_0x509ccd,_0x23e827]of Object[_0x4b5a1e(0x1b7)](_0x19bc98)){this['memories']['set'](_0x509ccd,_0x23e827);}this[_0x4b5a1e(0x1cc)]['info']('Loaded\x20'+this[_0x4b5a1e(0x1e4)][_0x4b5a1e(0x1d4)]+_0x4b5a1e(0x1d5));}catch(_0x42466a){_0x42466a[_0x4b5a1e(0x1ce)]!==_0x4b5a1e(0x1e1)&&this['logger'][_0x4b5a1e(0x1be)]('Error\x20loading\x20memories:',_0x42466a);}this[_0x4b5a1e(0x1c0)]=!![];}catch(_0x54dde6){this['logger'][_0x4b5a1e(0x1d0)]('Failed\x20to\x20initialize\x20memory\x20storage:',_0x54dde6);throw new Error(_0x4b5a1e(0x1c6)+_0x54dde6['message']);}}async['saveMemory'](_0x2eec7e,_0x4e0894,_0x3063da){const _0x34a096=a0_0x576f3b;this[_0x34a096(0x1cc)]['info'](_0x34a096(0x1d9)+_0x2eec7e);if(!_0x2eec7e||_0x2eec7e[_0x34a096(0x1db)]()==='')throw new Error(_0x34a096(0x1b0));if(!_0x3063da||_0x3063da['trim']()==='')throw new Error(_0x34a096(0x1df));const _0x15dbde=a0_0x510c1c(),_0x188dda={'id':_0x15dbde,'name':_0x2eec7e,'meaning':_0x4e0894||'','content':_0x3063da,'createdAt':new Date()[_0x34a096(0x1e2)]()};return this['memories']['set'](_0x15dbde,_0x188dda),{'action':'save-memory','id':_0x15dbde,'name':_0x2eec7e,'success':!![]};}async['readMemory'](_0x554124){const _0x1c2acc=a0_0x576f3b;this[_0x1c2acc(0x1cc)][_0x1c2acc(0x1b6)]('Reading\x20memory:\x20'+_0x554124);if(!this[_0x1c2acc(0x1e4)]['has'](_0x554124))throw new Error('Memory\x20with\x20ID\x20'+_0x554124+_0x1c2acc(0x1c9));const _0x1a0a06=this[_0x1c2acc(0x1e4)]['get'](_0x554124);return{'action':'read-memory','id':_0x554124,'name':_0x1a0a06['name'],'meaning':_0x1a0a06['meaning'],'content':_0x1a0a06[_0x1c2acc(0x1af)],'createdAt':_0x1a0a06['createdAt'],'success':!![]};}async['readAllMemories'](){const _0x2dc8b2=a0_0x576f3b;this['logger']['info'](_0x2dc8b2(0x1dd));const _0x452c62=[];for(const [_0x3d7569,_0x20fdcd]of this['memories'][_0x2dc8b2(0x1b7)]()){_0x452c62[_0x2dc8b2(0x1d6)]({'id':_0x3d7569,'name':_0x20fdcd['name'],'meaning':_0x20fdcd['meaning'],'createdAt':_0x20fdcd['createdAt']});}return{'action':_0x2dc8b2(0x1e5),'memories':_0x452c62,'count':_0x452c62[_0x2dc8b2(0x1c3)],'success':!![]};}async[a0_0x576f3b(0x1d7)](_0x4fef7d){const _0x4e2d61=a0_0x576f3b;this[_0x4e2d61(0x1cc)][_0x4e2d61(0x1b6)]('Saving\x20memories\x20to\x20disk');try{const _0x3aeee6=a0_0xe67a2f['join'](_0x4fef7d,'.loxia-state','memories');await a0_0x2e8ba9[_0x4e2d61(0x1de)](_0x3aeee6,{'recursive':!![]});const _0x353f4b=a0_0xe67a2f[_0x4e2d61(0x1e0)](_0x3aeee6,'memories.json'),_0x1c80c4={};for(const [_0x1bfc56,_0x1778a0]of this[_0x4e2d61(0x1e4)]['entries']()){_0x1c80c4[_0x1bfc56]=_0x1778a0;}await a0_0x2e8ba9[_0x4e2d61(0x1ae)](_0x353f4b,JSON['stringify'](_0x1c80c4,null,0x2),_0x4e2d61(0x1c8));}catch(_0x157343){this['logger'][_0x4e2d61(0x1d0)](_0x4e2d61(0x1c2),_0x157343);throw new Error('Failed\x20to\x20save\x20memories\x20to\x20disk:\x20'+_0x157343['message']);}}async[a0_0x576f3b(0x1ac)](){const _0x5d878c=a0_0x576f3b;this[_0x5d878c(0x1cc)][_0x5d878c(0x1b6)]('Shutting\x20down\x20memory\x20tool');}}function a0_0x27e8(){const _0x25db50=['CMvHzc1Tzw1VCNK','mtCXqxrtqwLN','C2L6zq','ig1LBw9YAwvZ','ChvZAa','C2f2zu1LBw9YAwvZvg9eAxnR','mJaYmtGYsfz0t29i','u2f2Aw5Nig1LBw9YEtOG','C2f2zs1Tzw1VCNK','DhjPBq','BMfTzq','uMvHzgLUzYbHBgWGBwvTB3jPzxm','BwTKAxi','twvTB3j5ignVBNrLBNqGy2fUBM90igjLigvTChr5','AM9PBG','ru5pru5u','Dg9ju09tDhjPBMC','mJyYmeXkuufXCq','BwvTB3jPzxm','CMvHzc1HBgW','mJbLsgjABhe','Aw5PDgLHBgL6zq','C2H1DgrVD24','mJv5vNfYvee','D3jPDgvgAwXL','y29UDgvUDa','twvTB3j5ig5HBwuGy2fUBM90igjLigvTChr5','ywn0Aw9U','z2v0rgvZy3jPChrPB24','mZeZmdK2oe1jD3Pcza','ntGZnJi4y2fsBeHO','BwvTB3j5','Aw5MBW','zw50CMLLCW','CMvHzc1Tzw0','CgfYC2u','rxjYB3iGCgfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCZO','mZy2mdi4mLnTwxroyq','otzLww5jD3q','lMXVEgLHlxn0yxrL','D2fYBG','mtfhEwjrwLi','Aw5PDgLHBgL6zwq','CxvLCNK','rxjYB3iGC2f2Aw5Nig1LBw9YAwvZihrVigrPC2S6','BgvUz3rO','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','sw5PDgLHBgL6Aw5Nig1LBw9YEsbZDg9YywDL','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6ia','yxr0CMLIDxrLCW','DxrMltG','ig5VDcbMB3vUza','odm3otDcENbJzeu','oti1odu2De15yNPu','Bg9Nz2vY','rxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5KihDPDgGGCgfYyw1LDgvYCZO','y29Kzq','y29TBwfUzhm','zxjYB3i','BwvHBMLUzW'];a0_0x27e8=function(){return _0x25db50;};return a0_0x27e8();}