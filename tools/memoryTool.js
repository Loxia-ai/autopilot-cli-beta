const a0_0x400e80=a0_0x5bd2;(function(_0x37cec4,_0x1d1ef0){const _0x6f150d=a0_0x5bd2,_0x3a30ee=_0x37cec4();while(!![]){try{const _0x592b76=parseInt(_0x6f150d(0x194))/0x1+-parseInt(_0x6f150d(0x172))/0x2+parseInt(_0x6f150d(0x17b))/0x3+parseInt(_0x6f150d(0x19c))/0x4+-parseInt(_0x6f150d(0x197))/0x5*(-parseInt(_0x6f150d(0x181))/0x6)+-parseInt(_0x6f150d(0x16a))/0x7*(parseInt(_0x6f150d(0x192))/0x8)+-parseInt(_0x6f150d(0x16d))/0x9;if(_0x592b76===_0x1d1ef0)break;else _0x3a30ee['push'](_0x3a30ee['shift']());}catch(_0x2ccc24){_0x3a30ee['push'](_0x3a30ee['shift']());}}}(a0_0x54e3,0x29d47));function a0_0x54e3(){const _0x36472c=['sw5PDgLHBgL6Aw5Nig1LBw9YEsbZDg9YywDL','ntq1mZe2BuXjDxvS','BwvTB3j5','ig5VDcbMB3vUza','Aw5PDgLHBgL6zwq','D3jPDgvgAwXL','BwvTB3jPzxm','rxjYB3iGzxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5Kia','uMvHzgLUzYbTzw1VCNK6ia','Aw5MBW','odC4mta2AvnwrLbs','rMfPBgvKihrVihnHDMuGBwvTB3jPzxmGDg8GzgLZAZOG','u2f2Aw5Nig1LBw9YEtOG','y29TBwfUzhm','yxr0CMLIDxrLCW','C2f2zu1LBw9YEq','mtK2mZK5ofLeu0rzza','CgfYC2vqyxjHBwv0zxjZ','BMfTzq','BwvHBMLUzW','BwTKAxi','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','z2v0','C2f2zs1Tzw1VCNK','D2fYBG','ywn0Aw9U','z2v0rgvZy3jPChrPB24','Aw5PDgLHBgL6zq','DhjPBq','CMvHze1LBw9YEq','y29UDgvUDa','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6','rxjYB3iGBg9HzgLUzYbTzw1VCMLLCZO','ndyZmJHzs3joAKy','ChvZAa','ntq5ntfICwHIAgS','rxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5KihDPDgGGCgfYyw1LDgvYCZO','u2H1DhrPBMCGzg93BIbTzw1VCNKGDg9VBa','nuHAs3jLBq','CMvHzc1HBgW','BwvTB3jPzxmUANnVBG','CxvLCNK','y3jLyxrLzef0','mti1nJyWmfLlChrqyG','BwvZC2fNzq','CMvHzefSBe1LBw9YAwvZ','zxjYB3i','AM9PBG','DxrMltG','BgvUz3rO','rxjYB3iGCgfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCZO','ndeZsgnuqvrP','C2L6zq','zw50CMLLCW','mtGZmti2nM5yzeXXvG','Bg9Nz2vY','C2f2zu1LBw9YAwvZvg9eAxnR','lMXVEgLHlxn0yxrL'];a0_0x54e3=function(){return _0x36472c;};return a0_0x54e3();}import{promises as a0_0x3d73a0}from'fs';import a0_0xe97c47 from'path';import{v4 as a0_0x324b1e}from'uuid';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';function a0_0x5bd2(_0x4f2be0,_0x56cf39){const _0x54e34d=a0_0x54e3();return a0_0x5bd2=function(_0x5bd2de,_0x269d78){_0x5bd2de=_0x5bd2de-0x169;let _0x4d3e25=_0x54e34d[_0x5bd2de];if(a0_0x5bd2['wkdEdH']===undefined){var _0x49dd4e=function(_0x3d73a0){const _0xe97c47='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x324b1e='',_0x417d7c='';for(let _0x4e38e7=0x0,_0x37d740,_0x1d15b5,_0x395034=0x0;_0x1d15b5=_0x3d73a0['charAt'](_0x395034++);~_0x1d15b5&&(_0x37d740=_0x4e38e7%0x4?_0x37d740*0x40+_0x1d15b5:_0x1d15b5,_0x4e38e7++%0x4)?_0x324b1e+=String['fromCharCode'](0xff&_0x37d740>>(-0x2*_0x4e38e7&0x6)):0x0){_0x1d15b5=_0xe97c47['indexOf'](_0x1d15b5);}for(let _0x1e4266=0x0,_0x280efc=_0x324b1e['length'];_0x1e4266<_0x280efc;_0x1e4266++){_0x417d7c+='%'+('00'+_0x324b1e['charCodeAt'](_0x1e4266)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x417d7c);};a0_0x5bd2['ntZoXb']=_0x49dd4e,_0x4f2be0=arguments,a0_0x5bd2['wkdEdH']=!![];}const _0x23b950=_0x54e34d[0x0],_0x20a35b=_0x5bd2de+_0x23b950,_0x1284f1=_0x4f2be0[_0x20a35b];return!_0x1284f1?(_0x4d3e25=a0_0x5bd2['ntZoXb'](_0x4d3e25),_0x4f2be0[_0x20a35b]=_0x4d3e25):_0x4d3e25=_0x1284f1,_0x4d3e25;},a0_0x5bd2(_0x4f2be0,_0x56cf39);}export class MemoryTool extends BaseTool{constructor(_0x417d7c,_0x4e38e7){const _0x53f8e0=a0_0x5bd2;super(_0x417d7c,_0x4e38e7),this[_0x53f8e0(0x177)]=new Map(),this[_0x53f8e0(0x175)]=![];}[a0_0x400e80(0x18b)](){return'\x0aMemory\x20Tool:\x20Allows\x20you\x20to\x20store\x20and\x20retrieve\x20important\x20information\x20that\x20you\x20want\x20to\x20remember\x20throughout\x20the\x20conversation.\x0a\x0aUsage:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22short\x20descriptive\x20name\x22\x20meaning=\x22reason\x20you\x20want\x20to\x20remember\x20this\x22]\x0aContent\x20to\x20remember\x20(can\x20be\x20code,\x20facts,\x20user\x20preferences,\x20etc.)\x0a[/memory]\x0a\x0a[read-all\x20/]\x0a\x0a[read-mem\x20id=\x22memory-id\x22\x20/]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20Store\x20an\x20important\x20piece\x20of\x20information:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22Project\x20requirements\x22\x20meaning=\x22Core\x20requirements\x20specified\x20by\x20the\x20user\x22]\x0a-\x20Must\x20work\x20on\x20both\x20Windows\x20and\x20Linux\x0a-\x20Should\x20support\x20both\x20light\x20and\x20dark\x20themes\x0a-\x20Maximum\x20memory\x20usage:\x20500MB\x0a[/memory]\x0a[/tool]\x0a\x0a2.\x20Retrieve\x20all\x20memories\x20to\x20see\x20what\x27s\x20available:\x0a[tool\x20id=\x22memory\x22]\x0a[read-all\x20/]\x0a[/tool]\x0a\x0a3.\x20Read\x20specific\x20memories:\x0a[tool\x20id=\x22memory\x22]\x0a[read-mem\x20id=\x22a1b2c3d4-5678-90ab-cdef-123456789012\x22\x20/]\x0a[/tool]\x0a\x0aNotes:\x0a-\x20Use\x20this\x20tool\x20to\x20store\x20information\x20that\x20you\x20might\x20need\x20later\x20in\x20the\x20conversation\x0a-\x20Memories\x20persist\x20for\x20the\x20duration\x20of\x20the\x20session\x0a-\x20You\x20can\x20save\x20code\x20snippets,\x20requirements,\x20user\x20preferences,\x20or\x20any\x20other\x20important\x20information\x0a-\x20When\x20storing\x20new\x20information,\x20always\x20provide\x20a\x20clear\x20name\x20and\x20meaning\x20to\x20help\x20you\x20recall\x20why\x20it\x20was\x20important\x0a-\x20Use\x20read-all\x20to\x20get\x20a\x20list\x20of\x20all\x20available\x20memories\x20when\x20you\x20need\x20a\x20reminder\x0a';}[a0_0x400e80(0x182)](_0x37d740){const _0x1a7c51=a0_0x400e80;this[_0x1a7c51(0x16e)]['info']('Parsing\x20memory\x20parameters\x20with\x20TagParser');const _0x1d15b5={'commands':[]};try{const _0x395034=TagParser['query'](_0x37d740,_0x1a7c51(0x173));for(const _0x18b4d8 of _0x395034){const _0x8ecdce=_0x18b4d8['attributes']['name'],_0x3c359d=_0x18b4d8['attributes']['meaning'];_0x8ecdce&&_0x1d15b5[_0x1a7c51(0x17e)][_0x1a7c51(0x193)]({'action':'save-memory','name':_0x8ecdce,'meaning':_0x3c359d||'','content':_0x18b4d8['content']});}const _0x1e4266=TagParser[_0x1a7c51(0x19a)](_0x37d740,_0x1a7c51(0x198));_0x1e4266['length']>0x0&&_0x1d15b5['commands']['push']({'action':'read-all'});const _0x280efc=TagParser['query'](_0x37d740,'read-mem');for(const _0x26af25 of _0x280efc){const _0x48b268=_0x26af25[_0x1a7c51(0x17f)]['id'];_0x48b268&&_0x1d15b5[_0x1a7c51(0x17e)]['push']({'action':'read-memory','id':_0x48b268});}return _0x1d15b5;}catch(_0x1d71c6){return this['logger']['error'](_0x1a7c51(0x169),_0x1d71c6),{'commands':[]};}}async[a0_0x400e80(0x186)](_0x2a8ebe,_0xb741af){const _0x165e2b=a0_0x400e80;this['logger']['info'](_0x165e2b(0x195),_0x2a8ebe);!this[_0x165e2b(0x175)]&&await this[_0x165e2b(0x18c)](_0xb741af);const _0x572aca=[];if(!_0x2a8ebe['commands']||_0x2a8ebe['commands']['length']===0x0)throw new Error('No\x20memory\x20commands\x20specified');for(const _0x2de2f2 of _0x2a8ebe['commands']){try{let _0x1290a8;switch(_0x2de2f2['action']){case _0x165e2b(0x188):_0x1290a8=await this['saveMemory'](_0x2de2f2['name'],_0x2de2f2['meaning'],_0x2de2f2[_0x165e2b(0x18f)]);break;case _0x165e2b(0x198):_0x1290a8=await this[_0x165e2b(0x19e)]();break;case'read-memory':_0x1290a8=await this[_0x165e2b(0x18e)](_0x2de2f2['id']);break;default:throw new Error('Unknown\x20memory\x20command:\x20'+_0x2de2f2['action']);}_0x572aca[_0x165e2b(0x193)](_0x1290a8);}catch(_0xfde3b0){this[_0x165e2b(0x16e)]['error'](_0x165e2b(0x178)+_0x2de2f2[_0x165e2b(0x18a)]+':',_0xfde3b0),_0x572aca['push']({'action':_0x2de2f2[_0x165e2b(0x18a)],'success':![],'error':_0xfde3b0['message']});}}return await this['saveMemoriesToDisk'](_0xb741af),{'results':_0x572aca};}async[a0_0x400e80(0x18c)](_0x1f8974){const _0xe4577c=a0_0x400e80;this[_0xe4577c(0x16e)][_0xe4577c(0x17a)](_0xe4577c(0x171));try{const _0x2bfca3=a0_0xe97c47[_0xe4577c(0x1a0)](_0x1f8974,_0xe4577c(0x170),'memories');await a0_0x3d73a0[_0xe4577c(0x185)](_0x2bfca3,{'recursive':!![]});try{const _0x178ecd=a0_0xe97c47[_0xe4577c(0x1a0)](_0x2bfca3,_0xe4577c(0x199)),_0x3a7a90=await a0_0x3d73a0['readFile'](_0x178ecd,_0xe4577c(0x1a1)),_0x1bde08=JSON['parse'](_0x3a7a90);for(const [_0xa26669,_0x551c00]of Object[_0xe4577c(0x16c)](_0x1bde08)){this[_0xe4577c(0x177)]['set'](_0xa26669,_0x551c00);}this[_0xe4577c(0x16e)]['info']('Loaded\x20'+this[_0xe4577c(0x177)][_0xe4577c(0x16b)]+'\x20memories');}catch(_0x18477f){_0x18477f['code']!=='ENOENT'&&this['logger'][_0xe4577c(0x189)](_0xe4577c(0x191),_0x18477f);}this[_0xe4577c(0x175)]=!![];}catch(_0x1658b5){this['logger']['error'](_0xe4577c(0x190),_0x1658b5);throw new Error('Failed\x20to\x20initialize\x20memory\x20storage:\x20'+_0x1658b5[_0xe4577c(0x19d)]);}}async[a0_0x400e80(0x180)](_0x1a11a6,_0xc7f301,_0x247019){const _0x4fc795=a0_0x400e80;this[_0x4fc795(0x16e)]['info'](_0x4fc795(0x17d)+_0x1a11a6);if(!_0x1a11a6||_0x1a11a6['trim']()==='')throw new Error('Memory\x20name\x20cannot\x20be\x20empty');if(!_0x247019||_0x247019[_0x4fc795(0x18d)]()==='')throw new Error('Memory\x20content\x20cannot\x20be\x20empty');const _0x3ad498=a0_0x324b1e(),_0x11e739={'id':_0x3ad498,'name':_0x1a11a6,'meaning':_0xc7f301||'','content':_0x247019,'createdAt':new Date()['toISOString']()};return this['memories']['set'](_0x3ad498,_0x11e739),{'action':_0x4fc795(0x188),'id':_0x3ad498,'name':_0x1a11a6,'success':!![]};}async[a0_0x400e80(0x18e)](_0x44ff72){const _0x1afbea=a0_0x400e80;this[_0x1afbea(0x16e)]['info'](_0x1afbea(0x179)+_0x44ff72);if(!this['memories']['has'](_0x44ff72))throw new Error('Memory\x20with\x20ID\x20'+_0x44ff72+_0x1afbea(0x174));const _0x43ad10=this[_0x1afbea(0x177)][_0x1afbea(0x187)](_0x44ff72);return{'action':'read-memory','id':_0x44ff72,'name':_0x43ad10['name'],'meaning':_0x43ad10['meaning'],'content':_0x43ad10['content'],'createdAt':_0x43ad10[_0x1afbea(0x19b)],'success':!![]};}async['readAllMemories'](){const _0x541783=a0_0x400e80;this['logger']['info']('Reading\x20all\x20memories');const _0x214a43=[];for(const [_0x386600,_0x2650e4]of this[_0x541783(0x177)][_0x541783(0x16c)]()){_0x214a43['push']({'id':_0x386600,'name':_0x2650e4[_0x541783(0x183)],'meaning':_0x2650e4[_0x541783(0x184)],'createdAt':_0x2650e4['createdAt']});}return{'action':_0x541783(0x198),'memories':_0x214a43,'count':_0x214a43[_0x541783(0x1a2)],'success':!![]};}async[a0_0x400e80(0x16f)](_0x5a7f03){const _0x58ce71=a0_0x400e80;this['logger']['info']('Saving\x20memories\x20to\x20disk');try{const _0x5a5ed3=a0_0xe97c47[_0x58ce71(0x1a0)](_0x5a7f03,'.loxia-state','memories');await a0_0x3d73a0['mkdir'](_0x5a5ed3,{'recursive':!![]});const _0x2f617e=a0_0xe97c47[_0x58ce71(0x1a0)](_0x5a5ed3,_0x58ce71(0x199)),_0x43b0f7={};for(const [_0x9b4b43,_0x412b4a]of this['memories']['entries']()){_0x43b0f7[_0x9b4b43]=_0x412b4a;}await a0_0x3d73a0[_0x58ce71(0x176)](_0x2f617e,JSON['stringify'](_0x43b0f7,null,0x2),'utf-8');}catch(_0x59eee0){this['logger'][_0x58ce71(0x19f)]('Error\x20saving\x20memories\x20to\x20disk:',_0x59eee0);throw new Error(_0x58ce71(0x17c)+_0x59eee0['message']);}}async['shutdown'](){const _0x152d17=a0_0x400e80;this['logger']['info'](_0x152d17(0x196));}}