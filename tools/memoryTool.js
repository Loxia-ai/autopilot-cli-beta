function a0_0x23f7(){const _0x564d30=['ig5VDcbMB3vUza','nZu0m1DVwwLqzG','Aw5MBW','mte0ndGWoePAyvDoAG','otH3DKDZrwm','nJe4mdzoy0r5vey','D2fYBG','rxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5KihDPDgGGCgfYyw1LDgvYCZO','rxjYB3iGBg9HzgLUzYbTzw1VCMLLCZO','z2v0','C2L6zq','C2f2zu1LBw9YEq','mti1nJuXmhLssuvkwq','ChvZAa','ndKZnJeXDxfluKf0','C2v0','BwvHBMLUzW','CxvLCNK','BwvTB3jPzxm','CMvHzefSBe1LBw9YAwvZ','AgfZ','CgfYC2vqyxjHBwv0zxjZ','AM9PBG','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','ig1LBw9YAwvZ','C2f2zs1Tzw1VCNK','C2f2zu1LBw9YAwvZvg9eAxnR','twvTB3j5ig5HBwuGy2fUBM90igjLigvTChr5','ng1jBhLIsW','uMvHzgLUzYbTzw1VCNK6ia','Bg9Nz2vY','tM8GBwvTB3j5ignVBw1HBMrZihnWzwnPzMLLza','y29UDgvUDa','CMvHzc1Tzw0','y29TBwfUzhm','sw5PDgLHBgL6Aw5Nig1LBw9YEsbZDg9YywDL','cK1LBw9YEsbuB29SoIbbBgXVD3mGEw91ihrVihn0B3jLigfUzcbYzxrYAwv2zsbPBxbVCNrHBNqGAw5MB3jTyxrPB24GDgHHDcb5B3uGD2fUDcb0BYbYzw1LBwjLCIb0AhjVDwDOB3v0ihrOzsbJB252zxjZyxrPB24UcGPvC2fNztOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IC2HVCNqGzgvZy3jPChrPDMuGBMfTzsiGBwvHBMLUzZ0ICMvHC29UihLVDsb3yw50ihrVihjLBwvTyMvYihrOAxmIxqPdB250zw50ihrVihjLBwvTyMvYicHJyw4GyMuGy29KzsWGzMfJDhmSihvZzxiGChjLzMvYzw5JzxmSigv0yY4PcLSVBwvTB3j5xqOkw3jLywqTywXSic9DcGPBCMvHzc1Tzw0GAwq9iM1LBw9YEs1PzciGl10kwY90B29SxqOkrxHHBxbSzxm6cJeUifn0B3jLigfUigLTCg9YDgfUDcbWAwvJzsbVzIbPBMzVCM1HDgLVBJOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IuhjVAMvJDcbYzxf1AxjLBwvUDhmIig1Lyw5PBMC9iKnVCMuGCMvXDwLYzw1LBNrZihnWzwnPzMLLzcbIEsb0AguGDxnLCIjDcI0GtxvZDcb3B3jRig9UigjVDgGGv2LUzg93CYbHBMqGtgLUDxGklsbtAg91BgqGC3vWCg9YDcbIB3rOigXPz2H0igfUzcbKyxjRihrOzw1LCWOTie1HEgLTDw0GBwvTB3j5ihvZywDLoIa1mdbnqGPBl21LBw9YEv0kwY90B29SxqOkmI4GuMv0CMLLDMuGywXSig1LBw9YAwvZihrVihnLzsb3Agf0j3mGyxzHAwXHyMXLoGPBDg9VBcbPzd0IBwvTB3j5iL0kw3jLywqTywXSic9DcLSVDg9VBf0kcJmUifjLywqGC3bLy2LMAwmGBwvTB3jPzxm6cLT0B29SigLKpsjTzw1VCNKIxqPBCMvHzc1Tzw0GAwq9iMeXyJjJm2q0ltu2nZGTotbHyI1JzgvMlteYmZq1nJC4otaXmIiGl10kwY90B29SxqOktM90zxm6cI0GvxnLihrOAxmGDg9VBcb0BYbZDg9YzsbPBMzVCM1HDgLVBIb0Agf0ihLVDsbTAwDODcbUzwvKigXHDgvYigLUihrOzsbJB252zxjZyxrPB24klsbnzw1VCMLLCYbWzxjZAxn0igzVCIb0AguGzhvYyxrPB24GB2yGDgHLihnLC3nPB24klsbzB3uGy2fUihnHDMuGy29KzsbZBMLWCgv0CYWGCMvXDwLYzw1LBNrZlcb1C2vYihbYzwzLCMvUy2vZlcbVCIbHBNKGB3rOzxiGAw1WB3j0yw50igLUzM9YBwf0Aw9UcI0Gv2HLBIbZDg9YAw5Nig5LDYbPBMzVCM1HDgLVBIWGywX3yxLZihbYB3zPzguGysbJBgvHCIbUyw1LigfUzcbTzwfUAw5NihrVigHLBhaGEw91ihjLy2fSBcb3AhKGAxqGD2fZigLTCg9YDgfUDaOTifvZzsbYzwfKlwfSBcb0BYbNzxqGysbSAxn0ig9MigfSBcbHDMfPBgfIBguGBwvTB3jPzxmGD2HLBIb5B3uGBMvLzcbHihjLBwLUzgvYcG','CMvHzc1HBgW','y29Kzq','Dg9ju09tDhjPBMC','yxr0CMLIDxrLCW','rMfPBgvKihrVihnHDMuGBwvTB3jPzxmGDg8GzgLZAZOG','ywn0Aw9U','ndCWnZi2m0zpBePsCq','zxjYB3i','zw50CMLLCW','BwvZC2fNzq','D3jPDgvgAwXL','mZGWmJiZyu52CgHz','BwTKAxi','mJbWrxjwr0K','twvTB3j5ignVBNrLBNqGy2fUBM90igjLigvTChr5','BwvTB3jPzxmUANnVBG','CMvHzc1Tzw1VCNK','BMfTzq','uMvHzgLUzYbHBgWGBwvTB3jPzxm','CMvHze1LBw9YEq','nJbMzhj5AhC'];a0_0x23f7=function(){return _0x564d30;};return a0_0x23f7();}const a0_0x5a883c=a0_0x259b;(function(_0x34c9ef,_0x2ec3a5){const _0x3f3549=a0_0x259b,_0x390894=_0x34c9ef();while(!![]){try{const _0x4cfea8=-parseInt(_0x3f3549(0x1d4))/0x1*(-parseInt(_0x3f3549(0x1d2))/0x2)+-parseInt(_0x3f3549(0x1a7))/0x3*(-parseInt(_0x3f3549(0x1b5))/0x4)+parseInt(_0x3f3549(0x1a5))/0x5+-parseInt(_0x3f3549(0x19e))/0x6*(-parseInt(_0x3f3549(0x19d))/0x7)+-parseInt(_0x3f3549(0x1d6))/0x8+parseInt(_0x3f3549(0x1c9))/0x9*(-parseInt(_0x3f3549(0x1cb))/0xa)+-parseInt(_0x3f3549(0x1c4))/0xb;if(_0x4cfea8===_0x2ec3a5)break;else _0x390894['push'](_0x390894['shift']());}catch(_0x2b74e9){_0x390894['push'](_0x390894['shift']());}}}(a0_0x23f7,0x1feff));function a0_0x259b(_0x3d0de5,_0x4df666){const _0x23f70f=a0_0x23f7();return a0_0x259b=function(_0x259b08,_0x14b274){_0x259b08=_0x259b08-0x19d;let _0x487499=_0x23f70f[_0x259b08];if(a0_0x259b['dLhhlJ']===undefined){var _0x16585b=function(_0xb81834){const _0x52391b='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2b14bb='',_0x336418='';for(let _0x5071a3=0x0,_0x5e6422,_0x50d846,_0x8074a5=0x0;_0x50d846=_0xb81834['charAt'](_0x8074a5++);~_0x50d846&&(_0x5e6422=_0x5071a3%0x4?_0x5e6422*0x40+_0x50d846:_0x50d846,_0x5071a3++%0x4)?_0x2b14bb+=String['fromCharCode'](0xff&_0x5e6422>>(-0x2*_0x5071a3&0x6)):0x0){_0x50d846=_0x52391b['indexOf'](_0x50d846);}for(let _0x350f75=0x0,_0x407797=_0x2b14bb['length'];_0x350f75<_0x407797;_0x350f75++){_0x336418+='%'+('00'+_0x2b14bb['charCodeAt'](_0x350f75)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x336418);};a0_0x259b['AFcexf']=_0x16585b,_0x3d0de5=arguments,a0_0x259b['dLhhlJ']=!![];}const _0x16d017=_0x23f70f[0x0],_0x2c2769=_0x259b08+_0x16d017,_0x31b838=_0x3d0de5[_0x2c2769];return!_0x31b838?(_0x487499=a0_0x259b['AFcexf'](_0x487499),_0x3d0de5[_0x2c2769]=_0x487499):_0x487499=_0x31b838,_0x487499;},a0_0x259b(_0x3d0de5,_0x4df666);}import{promises as a0_0xb81834}from'fs';import a0_0x52391b from'path';import{v4 as a0_0x2b14bb}from'uuid';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x336418,_0x5071a3){super(_0x336418,_0x5071a3),this['memories']=new Map(),this['initialized']=![];}['getDescription'](){const _0x89d160=a0_0x259b;return _0x89d160(0x1bd);}[a0_0x5a883c(0x1ae)](_0x5e6422){const _0x38a9ec=a0_0x5a883c;this[_0x38a9ec(0x1b7)]['info']('Parsing\x20memory\x20parameters\x20with\x20TagParser');const _0x50d846={'commands':[]};try{const _0x8074a5=TagParser[_0x38a9ec(0x1aa)](_0x5e6422,'memory');for(const _0xba2e08 of _0x8074a5){const _0x67dd97=_0xba2e08['attributes'][_0x38a9ec(0x1cf)],_0x56cbf7=_0xba2e08[_0x38a9ec(0x1c1)]['meaning'];_0x67dd97&&_0x50d846[_0x38a9ec(0x1bb)]['push']({'action':'save-memory','name':_0x67dd97,'meaning':_0x56cbf7||'','content':_0xba2e08[_0x38a9ec(0x1b9)]});}const _0x350f75=TagParser['query'](_0x5e6422,_0x38a9ec(0x1be));_0x350f75['length']>0x0&&_0x50d846['commands'][_0x38a9ec(0x1a6)]({'action':_0x38a9ec(0x1be)});const _0x407797=TagParser['query'](_0x5e6422,_0x38a9ec(0x1ba));for(const _0x106606 of _0x407797){const _0x5c50d9=_0x106606[_0x38a9ec(0x1c1)]['id'];_0x5c50d9&&_0x50d846['commands'][_0x38a9ec(0x1a6)]({'action':_0x38a9ec(0x1ce),'id':_0x5c50d9});}return _0x50d846;}catch(_0x200cbc){return this['logger']['error']('Error\x20parsing\x20memory\x20parameters:',_0x200cbc),{'commands':[]};}}async[a0_0x5a883c(0x1b0)](_0x312603,_0x241c1f){const _0x42cfc3=a0_0x5a883c;this['logger'][_0x42cfc3(0x1d5)](_0x42cfc3(0x1a0),_0x312603);!this['initialized']&&await this['initialize'](_0x241c1f);const _0x2f7401=[];if(!_0x312603['commands']||_0x312603[_0x42cfc3(0x1bb)]['length']===0x0)throw new Error(_0x42cfc3(0x1b8));for(const _0x5abff8 of _0x312603['commands']){try{let _0x137a41;switch(_0x5abff8['action']){case _0x42cfc3(0x1b2):_0x137a41=await this[_0x42cfc3(0x1a4)](_0x5abff8[_0x42cfc3(0x1cf)],_0x5abff8['meaning'],_0x5abff8['content']);break;case _0x42cfc3(0x1be):_0x137a41=await this[_0x42cfc3(0x1ac)]();break;case'read-memory':_0x137a41=await this[_0x42cfc3(0x1d1)](_0x5abff8['id']);break;default:throw new Error('Unknown\x20memory\x20command:\x20'+_0x5abff8[_0x42cfc3(0x1c3)]);}_0x2f7401[_0x42cfc3(0x1a6)](_0x137a41);}catch(_0x4c1c65){this['logger'][_0x42cfc3(0x1c5)]('Error\x20executing\x20memory\x20command\x20'+_0x5abff8[_0x42cfc3(0x1c3)]+':',_0x4c1c65),_0x2f7401[_0x42cfc3(0x1a6)]({'action':_0x5abff8['action'],'success':![],'error':_0x4c1c65[_0x42cfc3(0x1c7)]});}}return await this[_0x42cfc3(0x1b3)](_0x241c1f),{'results':_0x2f7401};}async['initialize'](_0x26ce62){const _0x524bf6=a0_0x5a883c;this['logger'][_0x524bf6(0x1d5)](_0x524bf6(0x1bc));try{const _0x5c9386=a0_0x52391b[_0x524bf6(0x1af)](_0x26ce62,'.loxia-state','memories');await a0_0xb81834[_0x524bf6(0x1ca)](_0x5c9386,{'recursive':!![]});try{const _0xc8ca45=a0_0x52391b['join'](_0x5c9386,_0x524bf6(0x1cd)),_0x17f645=await a0_0xb81834['readFile'](_0xc8ca45,'utf-8'),_0xef9265=JSON['parse'](_0x17f645);for(const [_0x413e21,_0x1583f5]of Object[_0x524bf6(0x1c6)](_0xef9265)){this['memories'][_0x524bf6(0x1a8)](_0x413e21,_0x1583f5);}this['logger']['info']('Loaded\x20'+this['memories'][_0x524bf6(0x1a3)]+_0x524bf6(0x1b1));}catch(_0x49c5c3){_0x49c5c3[_0x524bf6(0x1bf)]!=='ENOENT'&&this[_0x524bf6(0x1b7)][_0x524bf6(0x19f)](_0x524bf6(0x1a1),_0x49c5c3);}this['initialized']=!![];}catch(_0x2f0e0f){this['logger']['error']('Failed\x20to\x20initialize\x20memory\x20storage:',_0x2f0e0f);throw new Error('Failed\x20to\x20initialize\x20memory\x20storage:\x20'+_0x2f0e0f[_0x524bf6(0x1c7)]);}}async['saveMemory'](_0x10e285,_0x337f2e,_0x13b090){const _0x26c2e1=a0_0x5a883c;this[_0x26c2e1(0x1b7)][_0x26c2e1(0x1d5)]('Saving\x20memory:\x20'+_0x10e285);if(!_0x10e285||_0x10e285['trim']()==='')throw new Error(_0x26c2e1(0x1b4));if(!_0x13b090||_0x13b090['trim']()==='')throw new Error(_0x26c2e1(0x1cc));const _0x3a16f6=a0_0x2b14bb(),_0x2fda53={'id':_0x3a16f6,'name':_0x10e285,'meaning':_0x337f2e||'','content':_0x13b090,'createdAt':new Date()[_0x26c2e1(0x1c0)]()};return this['memories'][_0x26c2e1(0x1a8)](_0x3a16f6,_0x2fda53),{'action':'save-memory','id':_0x3a16f6,'name':_0x10e285,'success':!![]};}async[a0_0x5a883c(0x1d1)](_0x52bda0){const _0x25e1de=a0_0x5a883c;this['logger']['info'](_0x25e1de(0x1b6)+_0x52bda0);if(!this[_0x25e1de(0x1ab)][_0x25e1de(0x1ad)](_0x52bda0))throw new Error('Memory\x20with\x20ID\x20'+_0x52bda0+_0x25e1de(0x1d3));const _0x32705e=this['memories'][_0x25e1de(0x1a2)](_0x52bda0);return{'action':'read-memory','id':_0x52bda0,'name':_0x32705e[_0x25e1de(0x1cf)],'meaning':_0x32705e[_0x25e1de(0x1a9)],'content':_0x32705e[_0x25e1de(0x1b9)],'createdAt':_0x32705e['createdAt'],'success':!![]};}async['readAllMemories'](){const _0x3ed315=a0_0x5a883c;this['logger'][_0x3ed315(0x1d5)](_0x3ed315(0x1d0));const _0x32f53e=[];for(const [_0x38ee3a,_0x1dacac]of this['memories'][_0x3ed315(0x1c6)]()){_0x32f53e['push']({'id':_0x38ee3a,'name':_0x1dacac[_0x3ed315(0x1cf)],'meaning':_0x1dacac['meaning'],'createdAt':_0x1dacac['createdAt']});}return{'action':'read-all','memories':_0x32f53e,'count':_0x32f53e['length'],'success':!![]};}async['saveMemoriesToDisk'](_0x1b4ca7){const _0x249d9e=a0_0x5a883c;this['logger'][_0x249d9e(0x1d5)]('Saving\x20memories\x20to\x20disk');try{const _0x4c57fe=a0_0x52391b['join'](_0x1b4ca7,'.loxia-state',_0x249d9e(0x1ab));await a0_0xb81834[_0x249d9e(0x1ca)](_0x4c57fe,{'recursive':!![]});const _0x2eaab8=a0_0x52391b[_0x249d9e(0x1af)](_0x4c57fe,'memories.json'),_0x506f12={};for(const [_0x479a96,_0x5237ca]of this['memories']['entries']()){_0x506f12[_0x479a96]=_0x5237ca;}await a0_0xb81834[_0x249d9e(0x1c8)](_0x2eaab8,JSON['stringify'](_0x506f12,null,0x2),'utf-8');}catch(_0x384f2f){this[_0x249d9e(0x1b7)]['error']('Error\x20saving\x20memories\x20to\x20disk:',_0x384f2f);throw new Error(_0x249d9e(0x1c2)+_0x384f2f['message']);}}async['shutdown'](){const _0x5895c4=a0_0x5a883c;this[_0x5895c4(0x1b7)]['info']('Shutting\x20down\x20memory\x20tool');}}