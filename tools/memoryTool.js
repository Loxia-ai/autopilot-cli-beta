const a0_0x1ce952=a0_0x40fa;(function(_0x444b70,_0x465033){const _0x146a00=a0_0x40fa,_0x5244cf=_0x444b70();while(!![]){try{const _0x405c1b=-parseInt(_0x146a00(0x77))/0x1+-parseInt(_0x146a00(0x8e))/0x2+-parseInt(_0x146a00(0xa0))/0x3+parseInt(_0x146a00(0x9d))/0x4*(parseInt(_0x146a00(0x8f))/0x5)+-parseInt(_0x146a00(0x89))/0x6*(-parseInt(_0x146a00(0x94))/0x7)+-parseInt(_0x146a00(0x8a))/0x8*(-parseInt(_0x146a00(0x9a))/0x9)+parseInt(_0x146a00(0x7f))/0xa;if(_0x405c1b===_0x465033)break;else _0x5244cf['push'](_0x5244cf['shift']());}catch(_0x3e912f){_0x5244cf['push'](_0x5244cf['shift']());}}}(a0_0x523d,0x418ce));import{promises as a0_0x43c4c0}from'fs';import a0_0x4bba2e from'path';function a0_0x40fa(_0x403caf,_0x1b6c34){const _0x523df2=a0_0x523d();return a0_0x40fa=function(_0x40fa7f,_0x8d7f4d){_0x40fa7f=_0x40fa7f-0x6e;let _0x372c82=_0x523df2[_0x40fa7f];if(a0_0x40fa['dRuYpL']===undefined){var _0x4a919b=function(_0x43c4c0){const _0x4bba2e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xc70683='',_0x1f9d41='';for(let _0x48c9bd=0x0,_0x25f24f,_0xc84533,_0xf5c39d=0x0;_0xc84533=_0x43c4c0['charAt'](_0xf5c39d++);~_0xc84533&&(_0x25f24f=_0x48c9bd%0x4?_0x25f24f*0x40+_0xc84533:_0xc84533,_0x48c9bd++%0x4)?_0xc70683+=String['fromCharCode'](0xff&_0x25f24f>>(-0x2*_0x48c9bd&0x6)):0x0){_0xc84533=_0x4bba2e['indexOf'](_0xc84533);}for(let _0x32318f=0x0,_0x2fbc4d=_0xc70683['length'];_0x32318f<_0x2fbc4d;_0x32318f++){_0x1f9d41+='%'+('00'+_0xc70683['charCodeAt'](_0x32318f)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x1f9d41);};a0_0x40fa['oLjVCl']=_0x4a919b,_0x403caf=arguments,a0_0x40fa['dRuYpL']=!![];}const _0x2d03b0=_0x523df2[0x0],_0x1e61fb=_0x40fa7f+_0x2d03b0,_0x2b3c98=_0x403caf[_0x1e61fb];return!_0x2b3c98?(_0x372c82=a0_0x40fa['oLjVCl'](_0x372c82),_0x403caf[_0x1e61fb]=_0x372c82):_0x372c82=_0x2b3c98,_0x372c82;},a0_0x40fa(_0x403caf,_0x1b6c34);}function a0_0x523d(){const _0x3f6856=['zw50CMLLCW','BwvTB3jPzxm','nZyZBxjhBgHu','ugfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCYb3AxrOifrHz1bHCNnLCG','y29UDgvUDa','CgfYC2u','twvTB3j5ihDPDgGGsuqG','BgvUz3rO','mta5odLnq2Diu2e','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6ia','ywn0Aw9U','nJGYmhv3B09NrG','C2H1DgrVD24','CMvHze1LBw9YEq','nJqYodK0zMLuANHX','zxjYB3i','twvTB3j5ig5HBwuGy2fUBM90igjLigvTChr5','BwvHBMLUzW','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','tg9HzgvKia','CMvHzc1Tzw0','Aw5MBW','CMvHzc1Tzw1VCNK','C2f2zs1Tzw1VCNK','rMfPBgvKihrVihnHDMuGBwvTB3jPzxmGDg8GzgLZAZOG','tM8GBwvTB3j5ignVBw1HBMrZihnWzwnPzMLLza','AM9PBG','mJa0nJa0z3bsCwnc','y3jLyxrLzef0','twvTB3j5ignVBNrLBNqGy2fUBM90igjLigvTChr5','CgfYC2vqyxjHBwv0zxjZ','rxjYB3iGBg9HzgLUzYbTzw1VCMLLCZO','AgfZ','BwvZC2fNzq','rxjYB3iGC2f2Aw5Nig1LBw9YAwvZihrVigrPC2S6','otqXodi5mgDzBgHcAG','Aw5PDgLHBgL6zwq','CMvHzc1HBgW','y29TBwfUzhm','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6','C3rYAw5NAwz5','Bg9Nz2vY','CMvHzefSBe1LBw9YAwvZ','ChvZAa','vw5RBM93BIbTzw1VCNKGy29TBwfUzdOG','mJu2oeDwELvsEa','mJCYBLbIEuTj','BMfTzq','z2v0rgvZy3jPChrPB24','D2fYBG','nZq5otG4vefJt1Lh','otvmu3HwBgG','CxvLCNK','C2f2zu1LBw9YEq'];a0_0x523d=function(){return _0x3f6856;};return a0_0x523d();}import{v4 as a0_0xc70683}from'uuid';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x1f9d41,_0x48c9bd){const _0x258509=a0_0x40fa;super(_0x1f9d41,_0x48c9bd),this[_0x258509(0x93)]=new Map(),this['initialized']=![];}[a0_0x1ce952(0x8c)](){return'\x0aMemory\x20Tool:\x20Allows\x20you\x20to\x20store\x20and\x20retrieve\x20important\x20information\x20that\x20you\x20want\x20to\x20remember\x20throughout\x20the\x20conversation.\x0a\x0aUsage:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22short\x20descriptive\x20name\x22\x20meaning=\x22reason\x20you\x20want\x20to\x20remember\x20this\x22]\x0aContent\x20to\x20remember\x20(can\x20be\x20code,\x20facts,\x20user\x20preferences,\x20etc.)\x0a[/memory]\x0a\x0a[read-all\x20/]\x0a\x0a[read-mem\x20id=\x22memory-id\x22\x20/]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20Store\x20an\x20important\x20piece\x20of\x20information:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22Project\x20requirements\x22\x20meaning=\x22Core\x20requirements\x20specified\x20by\x20the\x20user\x22]\x0a-\x20Must\x20work\x20on\x20both\x20Windows\x20and\x20Linux\x0a-\x20Should\x20support\x20both\x20light\x20and\x20dark\x20themes\x0a-\x20Maximum\x20memory\x20usage:\x20500MB\x0a[/memory]\x0a[/tool]\x0a\x0a2.\x20Retrieve\x20all\x20memories\x20to\x20see\x20what\x27s\x20available:\x0a[tool\x20id=\x22memory\x22]\x0a[read-all\x20/]\x0a[/tool]\x0a\x0a3.\x20Read\x20specific\x20memories:\x0a[tool\x20id=\x22memory\x22]\x0a[read-mem\x20id=\x22a1b2c3d4-5678-90ab-cdef-123456789012\x22\x20/]\x0a[/tool]\x0a\x0aNotes:\x0a-\x20Use\x20this\x20tool\x20to\x20store\x20information\x20that\x20you\x20might\x20need\x20later\x20in\x20the\x20conversation\x0a-\x20Memories\x20persist\x20for\x20the\x20duration\x20of\x20the\x20session\x0a-\x20You\x20can\x20save\x20code\x20snippets,\x20requirements,\x20user\x20preferences,\x20or\x20any\x20other\x20important\x20information\x0a-\x20When\x20storing\x20new\x20information,\x20always\x20provide\x20a\x20clear\x20name\x20and\x20meaning\x20to\x20help\x20you\x20recall\x20why\x20it\x20was\x20important\x0a-\x20Use\x20read-all\x20to\x20get\x20a\x20list\x20of\x20all\x20available\x20memories\x20when\x20you\x20need\x20a\x20reminder\x0a';}[a0_0x1ce952(0x7a)](_0x25f24f){const _0x1af3bf=a0_0x1ce952;this[_0x1af3bf(0x85)][_0x1af3bf(0x71)](_0x1af3bf(0x95));const _0xc84533={'commands':[]};try{const _0xf5c39d=TagParser[_0x1af3bf(0x90)](_0x25f24f,'memory');for(const _0x3602ac of _0xf5c39d){const _0x571ae7=_0x3602ac['attributes'][_0x1af3bf(0x8b)],_0x2d6e75=_0x3602ac['attributes']['meaning'];_0x571ae7&&_0xc84533[_0x1af3bf(0x82)][_0x1af3bf(0x87)]({'action':_0x1af3bf(0x73),'name':_0x571ae7,'meaning':_0x2d6e75||'','content':_0x3602ac[_0x1af3bf(0x96)]});}const _0x32318f=TagParser[_0x1af3bf(0x90)](_0x25f24f,_0x1af3bf(0x81));_0x32318f['length']>0x0&&_0xc84533['commands']['push']({'action':_0x1af3bf(0x81)});const _0x2fbc4d=TagParser['query'](_0x25f24f,_0x1af3bf(0x70));for(const _0x1f4082 of _0x2fbc4d){const _0x14c855=_0x1f4082['attributes']['id'];_0x14c855&&_0xc84533[_0x1af3bf(0x82)][_0x1af3bf(0x87)]({'action':'read-memory','id':_0x14c855});}return _0xc84533;}catch(_0x58fa57){return this['logger'][_0x1af3bf(0xa1)]('Error\x20parsing\x20memory\x20parameters:',_0x58fa57),{'commands':[]};}}async[a0_0x1ce952(0x6e)](_0x297fcf,_0x3be397){const _0x502209=a0_0x1ce952;this['logger']['info']('Executing\x20memory\x20command\x20with\x20parameters:',_0x297fcf);!this[_0x502209(0x80)]&&await this['initialize'](_0x3be397);const _0x4d3af5=[];if(!_0x297fcf[_0x502209(0x82)]||_0x297fcf['commands'][_0x502209(0x99)]===0x0)throw new Error(_0x502209(0x75));for(const _0x4bec3e of _0x297fcf[_0x502209(0x82)]){try{let _0x540327;switch(_0x4bec3e[_0x502209(0x9c)]){case'save-memory':_0x540327=await this[_0x502209(0x91)](_0x4bec3e['name'],_0x4bec3e['meaning'],_0x4bec3e['content']);break;case'read-all':_0x540327=await this[_0x502209(0x86)]();break;case'read-memory':_0x540327=await this[_0x502209(0x9f)](_0x4bec3e['id']);break;default:throw new Error(_0x502209(0x88)+_0x4bec3e['action']);}_0x4d3af5['push'](_0x540327);}catch(_0x44c260){this[_0x502209(0x85)]['error']('Error\x20executing\x20memory\x20command\x20'+_0x4bec3e[_0x502209(0x9c)]+':',_0x44c260),_0x4d3af5['push']({'action':_0x4bec3e['action'],'success':![],'error':_0x44c260[_0x502209(0x7d)]});}}return await this['saveMemoriesToDisk'](_0x3be397),{'results':_0x4d3af5};}async['initialize'](_0x27a7e3){const _0x5a8179=a0_0x1ce952;this['logger']['info']('Initializing\x20memory\x20storage');try{const _0x5cfd7a=a0_0x4bba2e[_0x5a8179(0x76)](_0x27a7e3,'.loxia-state','memories');await a0_0x43c4c0['mkdir'](_0x5cfd7a,{'recursive':!![]});try{const _0x4dcc85=a0_0x4bba2e[_0x5a8179(0x76)](_0x5cfd7a,'memories.json'),_0xed864b=await a0_0x43c4c0['readFile'](_0x4dcc85,'utf-8'),_0x5536ef=JSON[_0x5a8179(0x97)](_0xed864b);for(const [_0x130298,_0xb5c9ec]of Object['entries'](_0x5536ef)){this[_0x5a8179(0x93)]['set'](_0x130298,_0xb5c9ec);}this['logger'][_0x5a8179(0x71)](_0x5a8179(0x6f)+this[_0x5a8179(0x93)]['size']+'\x20memories');}catch(_0x146c4d){_0x146c4d['code']!=='ENOENT'&&this['logger'][_0x5a8179(0x8d)](_0x5a8179(0x7b),_0x146c4d);}this['initialized']=!![];}catch(_0x542cec){this[_0x5a8179(0x85)][_0x5a8179(0xa1)](_0x5a8179(0x83),_0x542cec);throw new Error(_0x5a8179(0x9b)+_0x542cec['message']);}}async[a0_0x1ce952(0x91)](_0xd17eff,_0x34c935,_0x22fb47){const _0x5a530a=a0_0x1ce952;this['logger']['info']('Saving\x20memory:\x20'+_0xd17eff);if(!_0xd17eff||_0xd17eff['trim']()==='')throw new Error(_0x5a530a(0xa2));if(!_0x22fb47||_0x22fb47['trim']()==='')throw new Error(_0x5a530a(0x79));const _0x1ac2ef=a0_0xc70683(),_0x4dbf96={'id':_0x1ac2ef,'name':_0xd17eff,'meaning':_0x34c935||'','content':_0x22fb47,'createdAt':new Date()['toISOString']()};return this[_0x5a530a(0x93)]['set'](_0x1ac2ef,_0x4dbf96),{'action':'save-memory','id':_0x1ac2ef,'name':_0xd17eff,'success':!![]};}async['readMemory'](_0x3ea676){const _0x22431a=a0_0x1ce952;this['logger']['info']('Reading\x20memory:\x20'+_0x3ea676);if(!this[_0x22431a(0x93)][_0x22431a(0x7c)](_0x3ea676))throw new Error(_0x22431a(0x98)+_0x3ea676+'\x20not\x20found');const _0x2dee65=this[_0x22431a(0x93)]['get'](_0x3ea676);return{'action':_0x22431a(0x72),'id':_0x3ea676,'name':_0x2dee65['name'],'meaning':_0x2dee65[_0x22431a(0xa3)],'content':_0x2dee65[_0x22431a(0x96)],'createdAt':_0x2dee65[_0x22431a(0x78)],'success':!![]};}async['readAllMemories'](){const _0x211597=a0_0x1ce952;this[_0x211597(0x85)]['info']('Reading\x20all\x20memories');const _0x28ffa9=[];for(const [_0xd71e1f,_0x1e4107]of this[_0x211597(0x93)]['entries']()){_0x28ffa9['push']({'id':_0xd71e1f,'name':_0x1e4107['name'],'meaning':_0x1e4107[_0x211597(0xa3)],'createdAt':_0x1e4107['createdAt']});}return{'action':'read-all','memories':_0x28ffa9,'count':_0x28ffa9[_0x211597(0x99)],'success':!![]};}async['saveMemoriesToDisk'](_0x59b831){const _0x570fb5=a0_0x1ce952;this['logger']['info']('Saving\x20memories\x20to\x20disk');try{const _0x501d41=a0_0x4bba2e[_0x570fb5(0x76)](_0x59b831,'.loxia-state',_0x570fb5(0x93));await a0_0x43c4c0['mkdir'](_0x501d41,{'recursive':!![]});const _0x509435=a0_0x4bba2e['join'](_0x501d41,'memories.json'),_0x29ee08={};for(const [_0x4a1fb9,_0x3b160a]of this['memories'][_0x570fb5(0x92)]()){_0x29ee08[_0x4a1fb9]=_0x3b160a;}await a0_0x43c4c0['writeFile'](_0x509435,JSON[_0x570fb5(0x84)](_0x29ee08,null,0x2),'utf-8');}catch(_0x36dd7a){this['logger']['error'](_0x570fb5(0x7e),_0x36dd7a);throw new Error(_0x570fb5(0x74)+_0x36dd7a['message']);}}async[a0_0x1ce952(0x9e)](){const _0x296782=a0_0x1ce952;this[_0x296782(0x85)][_0x296782(0x71)]('Shutting\x20down\x20memory\x20tool');}}