const a0_0x7361a9=a0_0x42fd;(function(_0x1faa8d,_0x4ba520){const _0x1fb380=a0_0x42fd,_0x721352=_0x1faa8d();while(!![]){try{const _0x3f456f=parseInt(_0x1fb380(0x1ae))/0x1*(-parseInt(_0x1fb380(0x18f))/0x2)+-parseInt(_0x1fb380(0x1b3))/0x3*(-parseInt(_0x1fb380(0x18e))/0x4)+parseInt(_0x1fb380(0x19e))/0x5+-parseInt(_0x1fb380(0x1a9))/0x6+-parseInt(_0x1fb380(0x194))/0x7+parseInt(_0x1fb380(0x19b))/0x8+parseInt(_0x1fb380(0x190))/0x9;if(_0x3f456f===_0x4ba520)break;else _0x721352['push'](_0x721352['shift']());}catch(_0x252b1f){_0x721352['push'](_0x721352['shift']());}}}(a0_0x46a0,0x188e4));import{promises as a0_0x32e9c9}from'fs';import a0_0x231034 from'path';function a0_0x42fd(_0x5a5c21,_0x3c16a2){const _0x46a05b=a0_0x46a0();return a0_0x42fd=function(_0x42fd1e,_0x28059d){_0x42fd1e=_0x42fd1e-0x18d;let _0x31b294=_0x46a05b[_0x42fd1e];if(a0_0x42fd['TGjyyr']===undefined){var _0x406828=function(_0x32e9c9){const _0x231034='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x20dec5='',_0x3e9835='';for(let _0x1211ce=0x0,_0x513f84,_0x3fc71f,_0x8d3b=0x0;_0x3fc71f=_0x32e9c9['charAt'](_0x8d3b++);~_0x3fc71f&&(_0x513f84=_0x1211ce%0x4?_0x513f84*0x40+_0x3fc71f:_0x3fc71f,_0x1211ce++%0x4)?_0x20dec5+=String['fromCharCode'](0xff&_0x513f84>>(-0x2*_0x1211ce&0x6)):0x0){_0x3fc71f=_0x231034['indexOf'](_0x3fc71f);}for(let _0x169ab0=0x0,_0x4b8ca7=_0x20dec5['length'];_0x169ab0<_0x4b8ca7;_0x169ab0++){_0x3e9835+='%'+('00'+_0x20dec5['charCodeAt'](_0x169ab0)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3e9835);};a0_0x42fd['YctFwA']=_0x406828,_0x5a5c21=arguments,a0_0x42fd['TGjyyr']=!![];}const _0x4bbf5b=_0x46a05b[0x0],_0x13fb6a=_0x42fd1e+_0x4bbf5b,_0x1f06b2=_0x5a5c21[_0x13fb6a];return!_0x1f06b2?(_0x31b294=a0_0x42fd['YctFwA'](_0x31b294),_0x5a5c21[_0x13fb6a]=_0x31b294):_0x31b294=_0x1f06b2,_0x31b294;},a0_0x42fd(_0x5a5c21,_0x3c16a2);}import{v4 as a0_0x20dec5}from'uuid';function a0_0x46a0(){const _0x17c4be=['ChvZAa','rxjYB3iGzxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5Kia','ru5pru5u','mtq0nJC4yNbgsvbJ','zxjYB3i','D3jPDgvgAwXL','C2f2zu1LBw9YAwvZvg9eAxnR','zw50CMLLCW','ntnYAePZrw0','lMXVEgLHlxn0yxrL','vw5RBM93BIbTzw1VCNKGy29TBwfUzdOG','ig1LBw9YAwvZ','AM9PBG','m0PSA0rVCq','D2fYBG','sw5PDgLHBgL6Aw5Nig1LBw9YEsbZDg9YywDL','Aw5MBW','cK1LBw9YEsbuB29SoIbbBgXVD3mGEw91ihrVihn0B3jLigfUzcbYzxrYAwv2zsbPBxbVCNrHBNqGAw5MB3jTyxrPB24GDgHHDcb5B3uGD2fUDcb0BYbYzw1LBwjLCIb0AhjVDwDOB3v0ihrOzsbJB252zxjZyxrPB24UcGPvC2fNztOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IC2HVCNqGzgvZy3jPChrPDMuGBMfTzsiGBwvHBMLUzZ0ICMvHC29UihLVDsb3yw50ihrVihjLBwvTyMvYihrOAxmIxqPdB250zw50ihrVihjLBwvTyMvYicHJyw4GyMuGy29KzsWGzMfJDhmSihvZzxiGChjLzMvYzw5JzxmSigv0yY4PcLSVBwvTB3j5xqOkw3jLywqTywXSic9DcGPBCMvHzc1Tzw0GAwq9iM1LBw9YEs1PzciGl10kwY90B29SxqOkrxHHBxbSzxm6cJeUifn0B3jLigfUigLTCg9YDgfUDcbWAwvJzsbVzIbPBMzVCM1HDgLVBJOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IuhjVAMvJDcbYzxf1AxjLBwvUDhmIig1Lyw5PBMC9iKnVCMuGCMvXDwLYzw1LBNrZihnWzwnPzMLLzcbIEsb0AguGDxnLCIjDcI0GtxvZDcb3B3jRig9UigjVDgGGv2LUzg93CYbHBMqGtgLUDxGklsbtAg91BgqGC3vWCg9YDcbIB3rOigXPz2H0igfUzcbKyxjRihrOzw1LCWOTie1HEgLTDw0GBwvTB3j5ihvZywDLoIa1mdbnqGPBl21LBw9YEv0kwY90B29SxqOkmI4GuMv0CMLLDMuGywXSig1LBw9YAwvZihrVihnLzsb3Agf0j3mGyxzHAwXHyMXLoGPBDg9VBcbPzd0IBwvTB3j5iL0kw3jLywqTywXSic9DcLSVDg9VBf0kcJmUifjLywqGC3bLy2LMAwmGBwvTB3jPzxm6cLT0B29SigLKpsjTzw1VCNKIxqPBCMvHzc1Tzw0GAwq9iMeXyJjJm2q0ltu2nZGTotbHyI1JzgvMlteYmZq1nJC4otaXmIiGl10kwY90B29SxqOktM90zxm6cI0GvxnLihrOAxmGDg9VBcb0BYbZDg9YzsbPBMzVCM1HDgLVBIb0Agf0ihLVDsbTAwDODcbUzwvKigXHDgvYigLUihrOzsbJB252zxjZyxrPB24klsbnzw1VCMLLCYbWzxjZAxn0igzVCIb0AguGzhvYyxrPB24GB2yGDgHLihnLC3nPB24klsbzB3uGy2fUihnHDMuGy29KzsbZBMLWCgv0CYWGCMvXDwLYzw1LBNrZlcb1C2vYihbYzwzLCMvUy2vZlcbVCIbHBNKGB3rOzxiGAw1WB3j0yw50igLUzM9YBwf0Aw9UcI0Gv2HLBIbZDg9YAw5Nig5LDYbPBMzVCM1HDgLVBIWGywX3yxLZihbYB3zPzguGysbJBgvHCIbUyw1LigfUzcbTzwfUAw5NihrVigHLBhaGEw91ihjLy2fSBcb3AhKGAxqGD2fZigLTCg9YDgfUDaOTifvZzsbYzwfKlwfSBcb0BYbNzxqGysbSAxn0ig9MigfSBcbHDMfPBgfIBguGBwvTB3jPzxmGD2HLBIb5B3uGBMvLzcbHihjLBwLUzgvYcGPsru1ftujfuIbutYbcuK9xu0uGwu9vuIbnru1puKLfuYbsruDvtefstfKGqu5eifvtrsbusevnifrpifjfrKLorsbzt1vsienpreuGqu5eifjfu1bptLnfuY4','u2f2Aw5Nig1LBw9YAwvZihrVigrPC2S','ywn0Aw9U','BwvTB3j5','CMvHzefSBe1LBw9YAwvZ','BMfTzq','BgvUz3rO','BwTKAxi','BwvTB3jPzxm','rxjYB3iGBg9HzgLUzYbTzw1VCMLLCZO','tM8GBwvTB3j5ignVBw1HBMrZihnWzwnPzMLLza','odGYnJb0rwnUBKe','mtu5nfHrEu5LAq','mtq0mJKXnNPwvuXlzW','y29UDgvUDa','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6','DhjPBq','otC0odi3v2XZs0PH','C2f2zs1Tzw1VCNK','C3rYAw5NAwz5','y29TBwfUzhm','CgfYC2u','Bg9Nz2vY','Aw5PDgLHBgL6zwq','ntKZndmYv3jsCwn1','CMvHzezPBgu','CMvHzc1HBgW','mJq4mtm1sg5HAwzP','CMvHzc1Tzw0','BwvHBMLUzW','CMvHzc1Tzw1VCNK','uMvHzgLUzYbTzw1VCNK6ia','u2f2Aw5Nig1LBw9YEtOG','BwvZC2fNzq','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6ia'];a0_0x46a0=function(){return _0x17c4be;};return a0_0x46a0();}import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x3e9835,_0x1211ce){const _0x1e4b34=a0_0x42fd;super(_0x3e9835,_0x1211ce),this['memories']=new Map(),this[_0x1e4b34(0x19a)]=![];}['getDescription'](){const _0x2d128c=a0_0x42fd;return _0x2d128c(0x1b7);}['parseParameters'](_0x513f84){const _0x2f38dc=a0_0x42fd;this[_0x2f38dc(0x199)]['info']('Parsing\x20memory\x20parameters\x20with\x20TagParser');const _0x3fc71f={'commands':[]};try{const _0x8d3b=TagParser['query'](_0x513f84,_0x2f38dc(0x1ba));for(const _0x1151d4 of _0x8d3b){const _0x34698a=_0x1151d4['attributes']['name'],_0x48367=_0x1151d4['attributes'][_0x2f38dc(0x1a0)];_0x34698a&&_0x3fc71f['commands'][_0x2f38dc(0x1a6)]({'action':_0x2f38dc(0x195),'name':_0x34698a,'meaning':_0x48367||'','content':_0x1151d4['content']});}const _0x169ab0=TagParser['query'](_0x513f84,'read-all');_0x169ab0[_0x2f38dc(0x1bd)]>0x0&&_0x3fc71f['commands'][_0x2f38dc(0x1a6)]({'action':'read-all'});const _0x4b8ca7=TagParser['query'](_0x513f84,_0x2f38dc(0x19f));for(const _0x58a200 of _0x4b8ca7){const _0xce0441=_0x58a200['attributes']['id'];_0xce0441&&_0x3fc71f['commands']['push']({'action':_0x2f38dc(0x1a1),'id':_0xce0441});}return _0x3fc71f;}catch(_0x1d908d){return this['logger'][_0x2f38dc(0x1aa)]('Error\x20parsing\x20memory\x20parameters:',_0x1d908d),{'commands':[]};}}async['executeWithParameters'](_0x337945,_0x202394){const _0xd590f9=a0_0x42fd;this[_0xd590f9(0x199)][_0xd590f9(0x1b6)]('Executing\x20memory\x20command\x20with\x20parameters:',_0x337945);!this['initialized']&&await this['initialize'](_0x202394);const _0x20e6b9=[];if(!_0x337945['commands']||_0x337945[_0xd590f9(0x197)]['length']===0x0)throw new Error(_0xd590f9(0x18d));for(const _0x4546f2 of _0x337945['commands']){try{let _0x35fc64;switch(_0x4546f2[_0xd590f9(0x1b9)]){case'save-memory':_0x35fc64=await this['saveMemory'](_0x4546f2['name'],_0x4546f2['meaning'],_0x4546f2[_0xd590f9(0x191)]);break;case'read-all':_0x35fc64=await this['readAllMemories']();break;case _0xd590f9(0x1a1):_0x35fc64=await this['readMemory'](_0x4546f2['id']);break;default:throw new Error(_0xd590f9(0x1b0)+_0x4546f2['action']);}_0x20e6b9[_0xd590f9(0x1a6)](_0x35fc64);}catch(_0x5bb947){this['logger'][_0xd590f9(0x1aa)](_0xd590f9(0x1a7)+_0x4546f2[_0xd590f9(0x1b9)]+':',_0x5bb947),_0x20e6b9[_0xd590f9(0x1a6)]({'action':_0x4546f2[_0xd590f9(0x1b9)],'success':![],'error':_0x5bb947['message']});}}return await this[_0xd590f9(0x1ac)](_0x202394),{'results':_0x20e6b9};}async['initialize'](_0x2d1df6){const _0x61f0c2=a0_0x42fd;this['logger']['info'](_0x61f0c2(0x1b5));try{const _0x171f09=a0_0x231034[_0x61f0c2(0x1b2)](_0x2d1df6,_0x61f0c2(0x1af),'memories');await a0_0x32e9c9[_0x61f0c2(0x1be)](_0x171f09,{'recursive':!![]});try{const _0x2be067=a0_0x231034[_0x61f0c2(0x1b2)](_0x171f09,'memories.json'),_0x43b648=await a0_0x32e9c9[_0x61f0c2(0x19c)](_0x2be067,'utf-8'),_0x5a3adb=JSON[_0x61f0c2(0x198)](_0x43b648);for(const [_0x3c25b9,_0x71c3bf]of Object['entries'](_0x5a3adb)){this['memories']['set'](_0x3c25b9,_0x71c3bf);}this['logger'][_0x61f0c2(0x1b6)]('Loaded\x20'+this[_0x61f0c2(0x1bf)]['size']+_0x61f0c2(0x1b1));}catch(_0x2e8f72){_0x2e8f72['code']!==_0x61f0c2(0x1a8)&&this['logger'][_0x61f0c2(0x1b4)](_0x61f0c2(0x1c0),_0x2e8f72);}this['initialized']=!![];}catch(_0xcfb027){this[_0x61f0c2(0x199)]['error'](_0x61f0c2(0x192),_0xcfb027);throw new Error(_0x61f0c2(0x1a5)+_0xcfb027['message']);}}async['saveMemory'](_0x3941a8,_0x1eb4ad,_0x1b3294){const _0x2bd54c=a0_0x42fd;this['logger']['info'](_0x2bd54c(0x1a3)+_0x3941a8);if(!_0x3941a8||_0x3941a8['trim']()==='')throw new Error('Memory\x20name\x20cannot\x20be\x20empty');if(!_0x1b3294||_0x1b3294[_0x2bd54c(0x193)]()==='')throw new Error('Memory\x20content\x20cannot\x20be\x20empty');const _0x48f00c=a0_0x20dec5(),_0x16a3d4={'id':_0x48f00c,'name':_0x3941a8,'meaning':_0x1eb4ad||'','content':_0x1b3294,'createdAt':new Date()['toISOString']()};return this[_0x2bd54c(0x1bf)]['set'](_0x48f00c,_0x16a3d4),{'action':'save-memory','id':_0x48f00c,'name':_0x3941a8,'success':!![]};}async['readMemory'](_0x4d1c17){const _0x6a6062=a0_0x42fd;this[_0x6a6062(0x199)]['info'](_0x6a6062(0x1a2)+_0x4d1c17);if(!this['memories']['has'](_0x4d1c17))throw new Error('Memory\x20with\x20ID\x20'+_0x4d1c17+'\x20not\x20found');const _0x2acb26=this[_0x6a6062(0x1bf)]['get'](_0x4d1c17);return{'action':_0x6a6062(0x1a1),'id':_0x4d1c17,'name':_0x2acb26[_0x6a6062(0x1bc)],'meaning':_0x2acb26[_0x6a6062(0x1a0)],'content':_0x2acb26['content'],'createdAt':_0x2acb26['createdAt'],'success':!![]};}async[a0_0x7361a9(0x1bb)](){const _0xbd0ada=a0_0x7361a9;this[_0xbd0ada(0x199)][_0xbd0ada(0x1b6)]('Reading\x20all\x20memories');const _0x3be73b=[];for(const [_0xaf7a36,_0x32057a]of this[_0xbd0ada(0x1bf)]['entries']()){_0x3be73b[_0xbd0ada(0x1a6)]({'id':_0xaf7a36,'name':_0x32057a['name'],'meaning':_0x32057a['meaning'],'createdAt':_0x32057a['createdAt']});}return{'action':_0xbd0ada(0x19d),'memories':_0x3be73b,'count':_0x3be73b[_0xbd0ada(0x1bd)],'success':!![]};}async['saveMemoriesToDisk'](_0x2494d8){const _0x282ef4=a0_0x7361a9;this[_0x282ef4(0x199)]['info'](_0x282ef4(0x1b8));try{const _0x33c4ea=a0_0x231034['join'](_0x2494d8,_0x282ef4(0x1af),_0x282ef4(0x1bf));await a0_0x32e9c9[_0x282ef4(0x1be)](_0x33c4ea,{'recursive':!![]});const _0x3c7172=a0_0x231034[_0x282ef4(0x1b2)](_0x33c4ea,'memories.json'),_0x545382={};for(const [_0x541490,_0x3fb8da]of this['memories'][_0x282ef4(0x1ad)]()){_0x545382[_0x541490]=_0x3fb8da;}await a0_0x32e9c9[_0x282ef4(0x1ab)](_0x3c7172,JSON[_0x282ef4(0x196)](_0x545382,null,0x2),'utf-8');}catch(_0x1c50ee){this['logger']['error']('Error\x20saving\x20memories\x20to\x20disk:',_0x1c50ee);throw new Error('Failed\x20to\x20save\x20memories\x20to\x20disk:\x20'+_0x1c50ee[_0x282ef4(0x1a4)]);}}async['shutdown'](){this['logger']['info']('Shutting\x20down\x20memory\x20tool');}}