const a0_0x32c479=a0_0x9d99;function a0_0x1c56(){const _0x55b5d1=['twvTB3j5ihDPDgGGsuqG','ywn0Aw9U','BwvZC2fNzq','ntKWntmYm3vhCxnOtq','AM9PBG','nJmZm3vQwM9qqq','lMXVEgLHlxn0yxrL','CMvHze1LBw9YEq','mJm2mZzUBwDjCey','vw5RBM93BIbTzw1VCNKGy29TBwfUzdOG','mJvPqwzWsMO','C2f2zu1LBw9YEq','Aw5PDgLHBgL6zq','ig5VDcbMB3vUza','Bg9Nz2vY','BwTKAxi','Aw5PDgLHBgL6zwq','y29TBwfUzhm','zxjYB3i','DhjPBq','cK1LBw9YEsbuB29SoIbbBgXVD3mGEw91ihrVihn0B3jLigfUzcbYzxrYAwv2zsbPBxbVCNrHBNqGAw5MB3jTyxrPB24GDgHHDcb5B3uGD2fUDcb0BYbYzw1LBwjLCIb0AhjVDwDOB3v0ihrOzsbJB252zxjZyxrPB24UcGPvC2fNztOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IC2HVCNqGzgvZy3jPChrPDMuGBMfTzsiGBwvHBMLUzZ0ICMvHC29UihLVDsb3yw50ihrVihjLBwvTyMvYihrOAxmIxqPdB250zw50ihrVihjLBwvTyMvYicHJyw4GyMuGy29KzsWGzMfJDhmSihvZzxiGChjLzMvYzw5JzxmSigv0yY4PcLSVBwvTB3j5xqOkw3jLywqTywXSic9DcGPBCMvHzc1Tzw0GAwq9iM1LBw9YEs1PzciGl10kwY90B29SxqOkrxHHBxbSzxm6cJeUifn0B3jLigfUigLTCg9YDgfUDcbWAwvJzsbVzIbPBMzVCM1HDgLVBJOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IuhjVAMvJDcbYzxf1AxjLBwvUDhmIig1Lyw5PBMC9iKnVCMuGCMvXDwLYzw1LBNrZihnWzwnPzMLLzcbIEsb0AguGDxnLCIjDcI0GtxvZDcb3B3jRig9UigjVDgGGv2LUzg93CYbHBMqGtgLUDxGklsbtAg91BgqGC3vWCg9YDcbIB3rOigXPz2H0igfUzcbKyxjRihrOzw1LCWOTie1HEgLTDw0GBwvTB3j5ihvZywDLoIa1mdbnqGPBl21LBw9YEv0kwY90B29SxqOkmI4GuMv0CMLLDMuGywXSig1LBw9YAwvZihrVihnLzsb3Agf0j3mGyxzHAwXHyMXLoGPBDg9VBcbPzd0IBwvTB3j5iL0kw3jLywqTywXSic9DcLSVDg9VBf0kcJmUifjLywqGC3bLy2LMAwmGBwvTB3jPzxm6cLT0B29SigLKpsjTzw1VCNKIxqPBCMvHzc1Tzw0GAwq9iMeXyJjJm2q0ltu2nZGTotbHyI1JzgvMlteYmZq1nJC4otaXmIiGl10kwY90B29SxqOktM90zxm6cI0GvxnLihrOAxmGDg9VBcb0BYbZDg9YzsbPBMzVCM1HDgLVBIb0Agf0ihLVDsbTAwDODcbUzwvKigXHDgvYigLUihrOzsbJB252zxjZyxrPB24klsbnzw1VCMLLCYbWzxjZAxn0igzVCIb0AguGzhvYyxrPB24GB2yGDgHLihnLC3nPB24klsbzB3uGy2fUihnHDMuGy29KzsbZBMLWCgv0CYWGCMvXDwLYzw1LBNrZlcb1C2vYihbYzwzLCMvUy2vZlcbVCIbHBNKGB3rOzxiGAw1WB3j0yw50igLUzM9YBwf0Aw9UcI0Gv2HLBIbZDg9YAw5Nig5LDYbPBMzVCM1HDgLVBIWGywX3yxLZihbYB3zPzguGysbJBgvHCIbUyw1LigfUzcbTzwfUAw5NihrVigHLBhaGEw91ihjLy2fSBcb3AhKGAxqGD2fZigLTCg9YDgfUDaOTifvZzsbYzwfKlwfSBcb0BYbNzxqGysbSAxn0ig9MigfSBcbHDMfPBgfIBguGBwvTB3jPzxmGD2HLBIb5B3uGBMvLzcbHihjLBwLUzgvYcGPsru1ftujfuIbutYbcuK9xu0uGwu9vuIbnru1puKLfuYbsruDvtefstfKGqu5eifvtrsbusevnifrpifjfrKLorsbzt1vsienpreuGqu5eifjfu1bptLnfuY4','ofrbywf3qW','BgvUz3rO','C2H1DgrVD24','mJyYmJG1nxjPD1H3qG','yxr0CMLIDxrLCW','tM8GBwvTB3j5ignVBw1HBMrZihnWzwnPzMLLza','C2f2zs1Tzw1VCNK','u2H1DhrPBMCGzg93BIbTzw1VCNKGDg9VBa','Dg9ju09tDhjPBMC','ChvZAa','ru5pru5u','u2f2Aw5Nig1LBw9YEtOG','z2v0rgvZy3jPChrPB24','odG1nJu0ENf2wg9U','Aw5MBW','BMfTzq','nZy0EvbKCg5x','mZG5mZiXohvduhn2EG','z2v0','CMvHzc1HBgW','BwvTB3jPzxm','CMvHzezPBgu','mty1odmWodbpv3vMvfO','CMvHzefSBe1LBw9YAwvZ','BwvHBMLUzW','CgfYC2vqyxjHBwv0zxjZ','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6ia','rxjYB3iGBg9HzgLUzYbTzw1VCMLLCZO','CMvHzc1Tzw1VCNK','DxrMltG','CMvHzc1Tzw0','C2f2zu1LBw9YAwvZvg9eAxnR','y29Kzq','y3jLyxrLzef0','y29UDgvUDa','BwvTB3j5'];a0_0x1c56=function(){return _0x55b5d1;};return a0_0x1c56();}(function(_0x234f07,_0x11cbba){const _0x4aa7f9=a0_0x9d99,_0x27b42d=_0x234f07();while(!![]){try{const _0x3e3711=-parseInt(_0x4aa7f9(0xfa))/0x1*(parseInt(_0x4aa7f9(0xf8))/0x2)+parseInt(_0x4aa7f9(0xf5))/0x3*(-parseInt(_0x4aa7f9(0xdc))/0x4)+parseInt(_0x4aa7f9(0x108))/0x5+parseInt(_0x4aa7f9(0xd9))/0x6+-parseInt(_0x4aa7f9(0xdd))/0x7+parseInt(_0x4aa7f9(0x105))/0x8*(-parseInt(_0x4aa7f9(0xf3))/0x9)+parseInt(_0x4aa7f9(0xe2))/0xa;if(_0x3e3711===_0x11cbba)break;else _0x27b42d['push'](_0x27b42d['shift']());}catch(_0x2df6f1){_0x27b42d['push'](_0x27b42d['shift']());}}}(a0_0x1c56,0x666bc));function a0_0x9d99(_0x5bf8bb,_0x1e2d05){const _0x1c56ec=a0_0x1c56();return a0_0x9d99=function(_0x9d994c,_0x11957d){_0x9d994c=_0x9d994c-0xd1;let _0x39c9d7=_0x1c56ec[_0x9d994c];if(a0_0x9d99['OHoNGR']===undefined){var _0x427484=function(_0x2d12d5){const _0x4eb642='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xfbeccc='',_0x22beef='';for(let _0x2c58b0=0x0,_0x5e0aca,_0x26e03c,_0xc7ed1=0x0;_0x26e03c=_0x2d12d5['charAt'](_0xc7ed1++);~_0x26e03c&&(_0x5e0aca=_0x2c58b0%0x4?_0x5e0aca*0x40+_0x26e03c:_0x26e03c,_0x2c58b0++%0x4)?_0xfbeccc+=String['fromCharCode'](0xff&_0x5e0aca>>(-0x2*_0x2c58b0&0x6)):0x0){_0x26e03c=_0x4eb642['indexOf'](_0x26e03c);}for(let _0x5b9daa=0x0,_0x1fd54f=_0xfbeccc['length'];_0x5b9daa<_0x1fd54f;_0x5b9daa++){_0x22beef+='%'+('00'+_0xfbeccc['charCodeAt'](_0x5b9daa)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x22beef);};a0_0x9d99['BKRRyu']=_0x427484,_0x5bf8bb=arguments,a0_0x9d99['OHoNGR']=!![];}const _0x1511e1=_0x1c56ec[0x0],_0x3d75d6=_0x9d994c+_0x1511e1,_0x5a42ca=_0x5bf8bb[_0x3d75d6];return!_0x5a42ca?(_0x39c9d7=a0_0x9d99['BKRRyu'](_0x39c9d7),_0x5bf8bb[_0x3d75d6]=_0x39c9d7):_0x39c9d7=_0x5a42ca,_0x39c9d7;},a0_0x9d99(_0x5bf8bb,_0x1e2d05);}import{promises as a0_0x2d12d5}from'fs';import a0_0x4eb642 from'path';import{v4 as a0_0xfbeccc}from'uuid';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x22beef,_0x2c58b0){const _0x1396da=a0_0x9d99;super(_0x22beef,_0x2c58b0),this[_0x1396da(0xe0)]=new Map(),this[_0x1396da(0x100)]=![];}[a0_0x32c479(0xd8)](){const _0x176b4c=a0_0x32c479;return _0x176b4c(0x104);}[a0_0x32c479(0xe5)](_0x5e0aca){const _0x2ac076=a0_0x32c479;this['logger'][_0x2ac076(0xda)]('Parsing\x20memory\x20parameters\x20with\x20TagParser');const _0x26e03c={'commands':[]};try{const _0xc7ed1=TagParser['query'](_0x5e0aca,_0x2ac076(0xef));for(const _0x5d0da9 of _0xc7ed1){const _0x370d43=_0x5d0da9[_0x2ac076(0x109)]['name'],_0xd3441b=_0x5d0da9[_0x2ac076(0x109)]['meaning'];_0x370d43&&_0x26e03c[_0x2ac076(0x101)]['push']({'action':_0x2ac076(0xd2),'name':_0x370d43,'meaning':_0xd3441b||'','content':_0x5d0da9['content']});}const _0x5b9daa=TagParser['query'](_0x5e0aca,_0x2ac076(0xdf));_0x5b9daa['length']>0x0&&_0x26e03c['commands']['push']({'action':_0x2ac076(0xdf)});const _0x1fd54f=TagParser['query'](_0x5e0aca,_0x2ac076(0xea));for(const _0x3af962 of _0x1fd54f){const _0x14cb94=_0x3af962[_0x2ac076(0x109)]['id'];_0x14cb94&&_0x26e03c[_0x2ac076(0x101)]['push']({'action':'read-memory','id':_0x14cb94});}return _0x26e03c;}catch(_0x1691a1){return this[_0x2ac076(0xfe)]['error']('Error\x20parsing\x20memory\x20parameters:',_0x1691a1),{'commands':[]};}}async['executeWithParameters'](_0x2821cd,_0x244e6b){const _0x2fe4e8=a0_0x32c479;this['logger'][_0x2fe4e8(0xda)]('Executing\x20memory\x20command\x20with\x20parameters:',_0x2821cd);!this[_0x2fe4e8(0x100)]&&await this['initialize'](_0x244e6b);const _0x36477f=[];if(!_0x2821cd[_0x2fe4e8(0x101)]||_0x2821cd['commands'][_0x2fe4e8(0x106)]===0x0)throw new Error(_0x2fe4e8(0xd1));for(const _0x38eec9 of _0x2821cd[_0x2fe4e8(0x101)]){try{let _0x268b24;switch(_0x38eec9[_0x2fe4e8(0xf1)]){case _0x2fe4e8(0xd2):_0x268b24=await this[_0x2fe4e8(0xfb)](_0x38eec9['name'],_0x38eec9['meaning'],_0x38eec9['content']);break;case'read-all':_0x268b24=await this[_0x2fe4e8(0xe3)]();break;case'read-memory':_0x268b24=await this[_0x2fe4e8(0xf7)](_0x38eec9['id']);break;default:throw new Error(_0x2fe4e8(0xf9)+_0x38eec9['action']);}_0x36477f['push'](_0x268b24);}catch(_0x2ef0ce){this[_0x2fe4e8(0xfe)][_0x2fe4e8(0x102)]('Error\x20executing\x20memory\x20command\x20'+_0x38eec9['action']+':',_0x2ef0ce),_0x36477f[_0x2fe4e8(0xd5)]({'action':_0x38eec9['action'],'success':![],'error':_0x2ef0ce['message']});}}return await this[_0x2fe4e8(0xeb)](_0x244e6b),{'results':_0x36477f};}async[a0_0x32c479(0xfc)](_0x55ad4b){const _0x225552=a0_0x32c479;this['logger']['info']('Initializing\x20memory\x20storage');try{const _0x531e9f=a0_0x4eb642[_0x225552(0xf4)](_0x55ad4b,'.loxia-state','memories');await a0_0x2d12d5['mkdir'](_0x531e9f,{'recursive':!![]});try{const _0x4e6f19=a0_0x4eb642[_0x225552(0xf4)](_0x531e9f,'memories.json'),_0x5197cb=await a0_0x2d12d5[_0x225552(0xe1)](_0x4e6f19,_0x225552(0xe9)),_0x4e7941=JSON['parse'](_0x5197cb);for(const [_0x18d686,_0x1a5e72]of Object['entries'](_0x4e7941)){this['memories']['set'](_0x18d686,_0x1a5e72);}this[_0x225552(0xfe)]['info']('Loaded\x20'+this[_0x225552(0xe0)]['size']+'\x20memories');}catch(_0x3ab82c){_0x3ab82c[_0x225552(0xec)]!==_0x225552(0xd6)&&this[_0x225552(0xfe)]['warn'](_0x225552(0xe7),_0x3ab82c);}this['initialized']=!![];}catch(_0x2ce868){this['logger']['error']('Failed\x20to\x20initialize\x20memory\x20storage:',_0x2ce868);throw new Error(_0x225552(0xe6)+_0x2ce868[_0x225552(0xf2)]);}}async['saveMemory'](_0x1a77a3,_0x4d8f0b,_0x4bb3af){const _0x3886a4=a0_0x32c479;this[_0x3886a4(0xfe)][_0x3886a4(0xda)](_0x3886a4(0xd7)+_0x1a77a3);if(!_0x1a77a3||_0x1a77a3[_0x3886a4(0x103)]()==='')throw new Error('Memory\x20name\x20cannot\x20be\x20empty');if(!_0x4bb3af||_0x4bb3af[_0x3886a4(0x103)]()==='')throw new Error('Memory\x20content\x20cannot\x20be\x20empty');const _0x3187c6=a0_0xfbeccc(),_0x490670={'id':_0x3187c6,'name':_0x1a77a3,'meaning':_0x4d8f0b||'','content':_0x4bb3af,'createdAt':new Date()[_0x3886a4(0xd4)]()};return this['memories']['set'](_0x3187c6,_0x490670),{'action':'save-memory','id':_0x3187c6,'name':_0x1a77a3,'success':!![]};}async[a0_0x32c479(0xf7)](_0x2835d6){const _0x40f85e=a0_0x32c479;this['logger']['info']('Reading\x20memory:\x20'+_0x2835d6);if(!this['memories']['has'](_0x2835d6))throw new Error(_0x40f85e(0xf0)+_0x2835d6+_0x40f85e(0xfd));const _0xdab8a5=this['memories'][_0x40f85e(0xde)](_0x2835d6);return{'action':_0x40f85e(0xe8),'id':_0x2835d6,'name':_0xdab8a5[_0x40f85e(0xdb)],'meaning':_0xdab8a5['meaning'],'content':_0xdab8a5[_0x40f85e(0xee)],'createdAt':_0xdab8a5['createdAt'],'success':!![]};}async[a0_0x32c479(0xe3)](){const _0x25ec43=a0_0x32c479;this[_0x25ec43(0xfe)]['info']('Reading\x20all\x20memories');const _0x9c987e=[];for(const [_0x46db11,_0x1bb00d]of this[_0x25ec43(0xe0)]['entries']()){_0x9c987e['push']({'id':_0x46db11,'name':_0x1bb00d[_0x25ec43(0xdb)],'meaning':_0x1bb00d[_0x25ec43(0xe4)],'createdAt':_0x1bb00d[_0x25ec43(0xed)]});}return{'action':'read-all','memories':_0x9c987e,'count':_0x9c987e[_0x25ec43(0x106)],'success':!![]};}async[a0_0x32c479(0xeb)](_0x119458){const _0x1281c9=a0_0x32c479;this[_0x1281c9(0xfe)][_0x1281c9(0xda)]('Saving\x20memories\x20to\x20disk');try{const _0xc0367a=a0_0x4eb642[_0x1281c9(0xf4)](_0x119458,_0x1281c9(0xf6),'memories');await a0_0x2d12d5[_0x1281c9(0xff)](_0xc0367a,{'recursive':!![]});const _0xe7ec0d=a0_0x4eb642[_0x1281c9(0xf4)](_0xc0367a,'memories.json'),_0x54faf7={};for(const [_0x3aedf3,_0xa474f7]of this[_0x1281c9(0xe0)]['entries']()){_0x54faf7[_0x3aedf3]=_0xa474f7;}await a0_0x2d12d5['writeFile'](_0xe7ec0d,JSON['stringify'](_0x54faf7,null,0x2),'utf-8');}catch(_0x4870ea){this[_0x1281c9(0xfe)]['error']('Error\x20saving\x20memories\x20to\x20disk:',_0x4870ea);throw new Error('Failed\x20to\x20save\x20memories\x20to\x20disk:\x20'+_0x4870ea['message']);}}async[a0_0x32c479(0x107)](){const _0x411b02=a0_0x32c479;this['logger'][_0x411b02(0xda)](_0x411b02(0xd3));}}