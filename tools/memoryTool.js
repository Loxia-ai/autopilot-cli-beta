const a0_0x2acea5=a0_0x16f8;(function(_0x3fbdf0,_0x5ee4d4){const _0x255edf=a0_0x16f8,_0xeb348f=_0x3fbdf0();while(!![]){try{const _0x547d34=-parseInt(_0x255edf(0x9e))/0x1+-parseInt(_0x255edf(0x91))/0x2+parseInt(_0x255edf(0x9f))/0x3+-parseInt(_0x255edf(0x74))/0x4*(-parseInt(_0x255edf(0x83))/0x5)+parseInt(_0x255edf(0x73))/0x6+-parseInt(_0x255edf(0x77))/0x7*(-parseInt(_0x255edf(0x79))/0x8)+-parseInt(_0x255edf(0x7e))/0x9*(parseInt(_0x255edf(0x80))/0xa);if(_0x547d34===_0x5ee4d4)break;else _0xeb348f['push'](_0xeb348f['shift']());}catch(_0x30dd29){_0xeb348f['push'](_0xeb348f['shift']());}}}(a0_0x2aaa,0x969e6));function a0_0x2aaa(){const _0x574461=['CMvHzezPBgu','BwvHBMLUzW','nvv6D0jjqW','AM9PBG','twvTB3j5ig5HBwuGy2fUBM90igjLigvTChr5','Aw5MBW','rxjYB3iGCgfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCZO','ugfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCYb3AxrOifrHz1bHCNnLCG','C2f2zu1LBw9YAwvZvg9eAxnR','BwvTB3jPzxmUANnVBG','C2f2zs1Tzw1VCNK','uMvHzgLUzYbHBgWGBwvTB3jPzxm','Dg9ju09tDhjPBMC','D3jPDgvgAwXL','y29UDgvUDa','AgfZ','mJe0nJyWnLbywKrdwa','y29TBwfUzhm','sw5PDgLHBgL6Aw5Nig1LBw9YEsbZDg9YywDL','CxvLCNK','C2H1DgrVD24','CgfYC2vqyxjHBwv0zxjZ','CMvHzc1HBgW','y3jLyxrLzef0','tM8GBwvTB3j5ignVBw1HBMrZihnWzwnPzMLLza','BwTKAxi','ig5VDcbMB3vUza','zxjYB3i','CMvHzc1Tzw1VCNK','mZa4nJq2EMnMELD3','mZm5mZe3ngDJEgHrua','CMvHze1LBw9YEq','uMvHzgLUzYbTzw1VCNK6ia','BwvZC2fNzq','DxrMltG','Aw5PDgLHBgL6zq','ChvZAa','CgfYC2u','CMvHzefSBe1LBw9YAwvZ','rxjYB3iGzxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5Kia','mZy3mdaZohHuqLviDW','ndiXnJu5nKLby3DZtW','BMfTzq','C2f2zu1LBw9YEq','mtrRC1LuCwe','BwvTB3jPzxm','ndq5mdu2BvzuqunA','Bg9Nz2vY','zw50CMLLCW','twvTB3j5ignVBNrLBNqGy2fUBM90igjLigvTChr5','DhjPBq','odiXn29KzLzVyW','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','otK3mgjXsNLlyG'];a0_0x2aaa=function(){return _0x574461;};return a0_0x2aaa();}import{promises as a0_0x5ce7ef}from'fs';import a0_0x5a37a9 from'path';function a0_0x16f8(_0x44a07b,_0x5cea25){const _0x2aaa3c=a0_0x2aaa();return a0_0x16f8=function(_0x16f867,_0xb04945){_0x16f867=_0x16f867-0x6c;let _0x337cef=_0x2aaa3c[_0x16f867];if(a0_0x16f8['bHyCUW']===undefined){var _0x140dd4=function(_0x5ce7ef){const _0x5a37a9='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xa26271='',_0x572505='';for(let _0x7f6bab=0x0,_0xd92580,_0x43e223,_0x249545=0x0;_0x43e223=_0x5ce7ef['charAt'](_0x249545++);~_0x43e223&&(_0xd92580=_0x7f6bab%0x4?_0xd92580*0x40+_0x43e223:_0x43e223,_0x7f6bab++%0x4)?_0xa26271+=String['fromCharCode'](0xff&_0xd92580>>(-0x2*_0x7f6bab&0x6)):0x0){_0x43e223=_0x5a37a9['indexOf'](_0x43e223);}for(let _0x180de2=0x0,_0x530a49=_0xa26271['length'];_0x180de2<_0x530a49;_0x180de2++){_0x572505+='%'+('00'+_0xa26271['charCodeAt'](_0x180de2)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x572505);};a0_0x16f8['yffNMG']=_0x140dd4,_0x44a07b=arguments,a0_0x16f8['bHyCUW']=!![];}const _0x4b4b3c=_0x2aaa3c[0x0],_0xcb610e=_0x16f867+_0x4b4b3c,_0x2cda81=_0x44a07b[_0xcb610e];return!_0x2cda81?(_0x337cef=a0_0x16f8['yffNMG'](_0x337cef),_0x44a07b[_0xcb610e]=_0x337cef):_0x337cef=_0x2cda81,_0x337cef;},a0_0x16f8(_0x44a07b,_0x5cea25);}import{v4 as a0_0xa26271}from'uuid';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x572505,_0x7f6bab){const _0x5449e7=a0_0x16f8;super(_0x572505,_0x7f6bab),this[_0x5449e7(0x78)]=new Map(),this['initialized']=![];}['getDescription'](){return'\x0aMemory\x20Tool:\x20Allows\x20you\x20to\x20store\x20and\x20retrieve\x20important\x20information\x20that\x20you\x20want\x20to\x20remember\x20throughout\x20the\x20conversation.\x0a\x0aUsage:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22short\x20descriptive\x20name\x22\x20meaning=\x22reason\x20you\x20want\x20to\x20remember\x20this\x22]\x0aContent\x20to\x20remember\x20(can\x20be\x20code,\x20facts,\x20user\x20preferences,\x20etc.)\x0a[/memory]\x0a\x0a[read-all\x20/]\x0a\x0a[read-mem\x20id=\x22memory-id\x22\x20/]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20Store\x20an\x20important\x20piece\x20of\x20information:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22Project\x20requirements\x22\x20meaning=\x22Core\x20requirements\x20specified\x20by\x20the\x20user\x22]\x0a-\x20Must\x20work\x20on\x20both\x20Windows\x20and\x20Linux\x0a-\x20Should\x20support\x20both\x20light\x20and\x20dark\x20themes\x0a-\x20Maximum\x20memory\x20usage:\x20500MB\x0a[/memory]\x0a[/tool]\x0a\x0a2.\x20Retrieve\x20all\x20memories\x20to\x20see\x20what\x27s\x20available:\x0a[tool\x20id=\x22memory\x22]\x0a[read-all\x20/]\x0a[/tool]\x0a\x0a3.\x20Read\x20specific\x20memories:\x0a[tool\x20id=\x22memory\x22]\x0a[read-mem\x20id=\x22a1b2c3d4-5678-90ab-cdef-123456789012\x22\x20/]\x0a[/tool]\x0a\x0aNotes:\x0a-\x20Use\x20this\x20tool\x20to\x20store\x20information\x20that\x20you\x20might\x20need\x20later\x20in\x20the\x20conversation\x0a-\x20Memories\x20persist\x20for\x20the\x20duration\x20of\x20the\x20session\x0a-\x20You\x20can\x20save\x20code\x20snippets,\x20requirements,\x20user\x20preferences,\x20or\x20any\x20other\x20important\x20information\x0a-\x20When\x20storing\x20new\x20information,\x20always\x20provide\x20a\x20clear\x20name\x20and\x20meaning\x20to\x20help\x20you\x20recall\x20why\x20it\x20was\x20important\x0a-\x20Use\x20read-all\x20to\x20get\x20a\x20list\x20of\x20all\x20available\x20memories\x20when\x20you\x20need\x20a\x20reminder\x0a';}[a0_0x2acea5(0x96)](_0xd92580){const _0xf0f63e=a0_0x2acea5;this['logger']['info'](_0xf0f63e(0x88));const _0x43e223={'commands':[]};try{const _0x249545=TagParser[_0xf0f63e(0x94)](_0xd92580,'memory');for(const _0x5428ef of _0x249545){const _0xc0a123=_0x5428ef['attributes'][_0xf0f63e(0x75)],_0x513712=_0x5428ef['attributes'][_0xf0f63e(0x82)];_0xc0a123&&_0x43e223['commands']['push']({'action':'save-memory','name':_0xc0a123,'meaning':_0x513712||'','content':_0x5428ef['content']});}const _0x180de2=TagParser['query'](_0xd92580,'read-all');_0x180de2['length']>0x0&&_0x43e223[_0xf0f63e(0x92)][_0xf0f63e(0x6f)]({'action':_0xf0f63e(0x97)});const _0x530a49=TagParser[_0xf0f63e(0x94)](_0xd92580,'read-mem');for(const _0x3edcb0 of _0x530a49){const _0x37c207=_0x3edcb0['attributes']['id'];_0x37c207&&_0x43e223[_0xf0f63e(0x92)][_0xf0f63e(0x6f)]({'action':'read-memory','id':_0x37c207});}return _0x43e223;}catch(_0x586abd){return this[_0xf0f63e(0x7a)][_0xf0f63e(0x9c)](_0xf0f63e(0x87),_0x586abd),{'commands':[]};}}async[a0_0x2acea5(0x7f)](_0x3d4d9b,_0x10e7aa){const _0x196f5d=a0_0x2acea5;this['logger'][_0x196f5d(0x86)]('Executing\x20memory\x20command\x20with\x20parameters:',_0x3d4d9b);!this['initialized']&&await this[_0x196f5d(0x6e)](_0x10e7aa);const _0x3aaa2d=[];if(!_0x3d4d9b['commands']||_0x3d4d9b['commands']['length']===0x0)throw new Error(_0x196f5d(0x99));for(const _0x49704e of _0x3d4d9b[_0x196f5d(0x92)]){try{let _0xa77457;switch(_0x49704e['action']){case _0x196f5d(0x8b):_0xa77457=await this[_0x196f5d(0x76)](_0x49704e['name'],_0x49704e[_0x196f5d(0x82)],_0x49704e[_0x196f5d(0x8f)]);break;case _0x196f5d(0x97):_0xa77457=await this['readAllMemories']();break;case _0x196f5d(0x9d):_0xa77457=await this[_0x196f5d(0xa0)](_0x49704e['id']);break;default:throw new Error('Unknown\x20memory\x20command:\x20'+_0x49704e['action']);}_0x3aaa2d['push'](_0xa77457);}catch(_0x5e7910){this['logger'][_0x196f5d(0x9c)](_0x196f5d(0x72)+_0x49704e['action']+':',_0x5e7910),_0x3aaa2d['push']({'action':_0x49704e['action'],'success':![],'error':_0x5e7910[_0x196f5d(0x6c)]});}}return await this['saveMemoriesToDisk'](_0x10e7aa),{'results':_0x3aaa2d};}async['initialize'](_0x403c01){const _0x110daa=a0_0x2acea5;this['logger']['info'](_0x110daa(0x93));try{const _0x5d638f=a0_0x5a37a9['join'](_0x403c01,'.loxia-state','memories');await a0_0x5ce7ef['mkdir'](_0x5d638f,{'recursive':!![]});try{const _0x19cf7e=a0_0x5a37a9['join'](_0x5d638f,_0x110daa(0x8a)),_0x3ab166=await a0_0x5ce7ef[_0x110daa(0x81)](_0x19cf7e,_0x110daa(0x6d)),_0x28f848=JSON[_0x110daa(0x70)](_0x3ab166);for(const [_0x117a48,_0x6c6bcd]of Object[_0x110daa(0x7b)](_0x28f848)){this['memories']['set'](_0x117a48,_0x6c6bcd);}this[_0x110daa(0x7a)][_0x110daa(0x86)]('Loaded\x20'+this['memories']['size']+'\x20memories');}catch(_0x3ce472){_0x3ce472['code']!=='ENOENT'&&this[_0x110daa(0x7a)]['warn']('Error\x20loading\x20memories:',_0x3ce472);}this['initialized']=!![];}catch(_0x1eeb17){this['logger']['error']('Failed\x20to\x20initialize\x20memory\x20storage:',_0x1eeb17);throw new Error('Failed\x20to\x20initialize\x20memory\x20storage:\x20'+_0x1eeb17[_0x110daa(0x6c)]);}}async['saveMemory'](_0x5a7eca,_0x41e854,_0x5115b1){const _0x5a94c3=a0_0x2acea5;this['logger'][_0x5a94c3(0x86)]('Saving\x20memory:\x20'+_0x5a7eca);if(!_0x5a7eca||_0x5a7eca[_0x5a94c3(0x7d)]()==='')throw new Error(_0x5a94c3(0x85));if(!_0x5115b1||_0x5115b1[_0x5a94c3(0x7d)]()==='')throw new Error(_0x5a94c3(0x7c));const _0x152539=a0_0xa26271(),_0x54b388={'id':_0x152539,'name':_0x5a7eca,'meaning':_0x41e854||'','content':_0x5115b1,'createdAt':new Date()[_0x5a94c3(0x8d)]()};return this['memories']['set'](_0x152539,_0x54b388),{'action':_0x5a94c3(0x8b),'id':_0x152539,'name':_0x5a7eca,'success':!![]};}async['readMemory'](_0x2f328a){const _0x2fed3f=a0_0x2acea5;this[_0x2fed3f(0x7a)][_0x2fed3f(0x86)](_0x2fed3f(0xa1)+_0x2f328a);if(!this['memories'][_0x2fed3f(0x90)](_0x2f328a))throw new Error('Memory\x20with\x20ID\x20'+_0x2f328a+_0x2fed3f(0x9b));const _0x4f548b=this['memories']['get'](_0x2f328a);return{'action':'read-memory','id':_0x2f328a,'name':_0x4f548b['name'],'meaning':_0x4f548b['meaning'],'content':_0x4f548b[_0x2fed3f(0x8f)],'createdAt':_0x4f548b['createdAt'],'success':!![]};}async[a0_0x2acea5(0x71)](){const _0x422381=a0_0x2acea5;this['logger'][_0x422381(0x86)](_0x422381(0x8c));const _0x329eb1=[];for(const [_0x13d66f,_0x1a8d3d]of this[_0x422381(0x78)][_0x422381(0x7b)]()){_0x329eb1['push']({'id':_0x13d66f,'name':_0x1a8d3d[_0x422381(0x75)],'meaning':_0x1a8d3d[_0x422381(0x82)],'createdAt':_0x1a8d3d[_0x422381(0x98)]});}return{'action':_0x422381(0x97),'memories':_0x329eb1,'count':_0x329eb1['length'],'success':!![]};}async[a0_0x2acea5(0x89)](_0x12e51d){const _0x13fbe5=a0_0x2acea5;this[_0x13fbe5(0x7a)]['info']('Saving\x20memories\x20to\x20disk');try{const _0x5b8f86=a0_0x5a37a9[_0x13fbe5(0x84)](_0x12e51d,'.loxia-state',_0x13fbe5(0x78));await a0_0x5ce7ef[_0x13fbe5(0x9a)](_0x5b8f86,{'recursive':!![]});const _0x1fb2be=a0_0x5a37a9['join'](_0x5b8f86,_0x13fbe5(0x8a)),_0x5471e9={};for(const [_0x711f9d,_0x530226]of this[_0x13fbe5(0x78)][_0x13fbe5(0x7b)]()){_0x5471e9[_0x711f9d]=_0x530226;}await a0_0x5ce7ef[_0x13fbe5(0x8e)](_0x1fb2be,JSON['stringify'](_0x5471e9,null,0x2),'utf-8');}catch(_0x1a5926){this['logger']['error']('Error\x20saving\x20memories\x20to\x20disk:',_0x1a5926);throw new Error('Failed\x20to\x20save\x20memories\x20to\x20disk:\x20'+_0x1a5926[_0x13fbe5(0x6c)]);}}async[a0_0x2acea5(0x95)](){const _0xa793e5=a0_0x2acea5;this[_0xa793e5(0x7a)][_0xa793e5(0x86)]('Shutting\x20down\x20memory\x20tool');}}