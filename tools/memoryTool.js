const a0_0x3a54b4=a0_0x104b;(function(_0x2df852,_0x227335){const _0x1175e5=a0_0x104b,_0x32bdca=_0x2df852();while(!![]){try{const _0x517f5a=-parseInt(_0x1175e5(0x184))/0x1+-parseInt(_0x1175e5(0x192))/0x2+-parseInt(_0x1175e5(0x18f))/0x3+parseInt(_0x1175e5(0x182))/0x4+-parseInt(_0x1175e5(0x194))/0x5*(parseInt(_0x1175e5(0x195))/0x6)+-parseInt(_0x1175e5(0x197))/0x7+-parseInt(_0x1175e5(0x19b))/0x8*(-parseInt(_0x1175e5(0x19f))/0x9);if(_0x517f5a===_0x227335)break;else _0x32bdca['push'](_0x32bdca['shift']());}catch(_0x31e334){_0x32bdca['push'](_0x32bdca['shift']());}}}(a0_0x2cde,0x6f2f8));function a0_0x104b(_0x4ca699,_0x127327){const _0x2cded7=a0_0x2cde();return a0_0x104b=function(_0x104b6f,_0x11e491){_0x104b6f=_0x104b6f-0x170;let _0x1eeaf8=_0x2cded7[_0x104b6f];if(a0_0x104b['FwMWEG']===undefined){var _0x23ba3a=function(_0x29af2c){const _0x13e37f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x45dd75='',_0x2f0dae='';for(let _0x298927=0x0,_0x5cdaef,_0x174607,_0x34cd32=0x0;_0x174607=_0x29af2c['charAt'](_0x34cd32++);~_0x174607&&(_0x5cdaef=_0x298927%0x4?_0x5cdaef*0x40+_0x174607:_0x174607,_0x298927++%0x4)?_0x45dd75+=String['fromCharCode'](0xff&_0x5cdaef>>(-0x2*_0x298927&0x6)):0x0){_0x174607=_0x13e37f['indexOf'](_0x174607);}for(let _0x5a9636=0x0,_0x3342af=_0x45dd75['length'];_0x5a9636<_0x3342af;_0x5a9636++){_0x2f0dae+='%'+('00'+_0x45dd75['charCodeAt'](_0x5a9636)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2f0dae);};a0_0x104b['YcrZKp']=_0x23ba3a,_0x4ca699=arguments,a0_0x104b['FwMWEG']=!![];}const _0x1b4ff2=_0x2cded7[0x0],_0x3e937d=_0x104b6f+_0x1b4ff2,_0x1bfa84=_0x4ca699[_0x3e937d];return!_0x1bfa84?(_0x1eeaf8=a0_0x104b['YcrZKp'](_0x1eeaf8),_0x4ca699[_0x3e937d]=_0x1eeaf8):_0x1eeaf8=_0x1bfa84,_0x1eeaf8;},a0_0x104b(_0x4ca699,_0x127327);}import{promises as a0_0x29af2c}from'fs';import a0_0x13e37f from'path';import{v4 as a0_0x45dd75}from'uuid';function a0_0x2cde(){const _0x326a0d=['ntm5nJqZm0ztvLP4qq','z2v0rgvZy3jPChrPB24','u2f2Aw5Nig1LBw9YEtOG','cK1LBw9YEsbuB29SoIbbBgXVD3mGEw91ihrVihn0B3jLigfUzcbYzxrYAwv2zsbPBxbVCNrHBNqGAw5MB3jTyxrPB24GDgHHDcb5B3uGD2fUDcb0BYbYzw1LBwjLCIb0AhjVDwDOB3v0ihrOzsbJB252zxjZyxrPB24UcGPvC2fNztOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IC2HVCNqGzgvZy3jPChrPDMuGBMfTzsiGBwvHBMLUzZ0ICMvHC29UihLVDsb3yw50ihrVihjLBwvTyMvYihrOAxmIxqPdB250zw50ihrVihjLBwvTyMvYicHJyw4GyMuGy29KzsWGzMfJDhmSihvZzxiGChjLzMvYzw5JzxmSigv0yY4PcLSVBwvTB3j5xqOkw3jLywqTywXSic9DcGPBCMvHzc1Tzw0GAwq9iM1LBw9YEs1PzciGl10kwY90B29SxqOkrxHHBxbSzxm6cJeUifn0B3jLigfUigLTCg9YDgfUDcbWAwvJzsbVzIbPBMzVCM1HDgLVBJOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IuhjVAMvJDcbYzxf1AxjLBwvUDhmIig1Lyw5PBMC9iKnVCMuGCMvXDwLYzw1LBNrZihnWzwnPzMLLzcbIEsb0AguGDxnLCIjDcI0GtxvZDcb3B3jRig9UigjVDgGGv2LUzg93CYbHBMqGtgLUDxGklsbtAg91BgqGC3vWCg9YDcbIB3rOigXPz2H0igfUzcbKyxjRihrOzw1LCWOTie1HEgLTDw0GBwvTB3j5ihvZywDLoIa1mdbnqGPBl21LBw9YEv0kwY90B29SxqOkmI4GuMv0CMLLDMuGywXSig1LBw9YAwvZihrVihnLzsb3Agf0j3mGyxzHAwXHyMXLoGPBDg9VBcbPzd0IBwvTB3j5iL0kw3jLywqTywXSic9DcLSVDg9VBf0kcJmUifjLywqGC3bLy2LMAwmGBwvTB3jPzxm6cLT0B29SigLKpsjTzw1VCNKIxqPBCMvHzc1Tzw0GAwq9iMeXyJjJm2q0ltu2nZGTotbHyI1JzgvMlteYmZq1nJC4otaXmIiGl10kwY90B29SxqOktM90zxm6cI0GvxnLihrOAxmGDg9VBcb0BYbZDg9YzsbPBMzVCM1HDgLVBIb0Agf0ihLVDsbTAwDODcbUzwvKigXHDgvYigLUihrOzsbJB252zxjZyxrPB24klsbnzw1VCMLLCYbWzxjZAxn0igzVCIb0AguGzhvYyxrPB24GB2yGDgHLihnLC3nPB24klsbzB3uGy2fUihnHDMuGy29KzsbZBMLWCgv0CYWGCMvXDwLYzw1LBNrZlcb1C2vYihbYzwzLCMvUy2vZlcbVCIbHBNKGB3rOzxiGAw1WB3j0yw50igLUzM9YBwf0Aw9UcI0Gv2HLBIbZDg9YAw5Nig5LDYbPBMzVCM1HDgLVBIWGywX3yxLZihbYB3zPzguGysbJBgvHCIbUyw1LigfUzcbTzwfUAw5NihrVigHLBhaGEw91ihjLy2fSBcb3AhKGAxqGD2fZigLTCg9YDgfUDaOTifvZzsbYzwfKlwfSBcb0BYbNzxqGysbSAxn0ig9MigfSBcbHDMfPBgfIBguGBwvTB3jPzxmGD2HLBIb5B3uGBMvLzcbHihjLBwLUzgvYcGPsru1ftujfuIbutYbcuK9xu0uGwu9vuIbnru1puKLfuYbsruDvtefstfKGqu5eifvtrsbusevnifrpifjfrKLorsbzt1vsienpreuGqu5eifjfu1bptLnfuY4','ofjRzg16sG','CMvHzc1HBgW','tM8GBwvTB3j5ignVBw1HBMrZihnWzwnPzMLLza','twvTB3j5ig5HBwuGy2fUBM90igjLigvTChr5','mJC4mdyWmtnqwvPIwhe','DhjPBq','BMfTzq','BwvHBMLUzW','C3rYAw5NAwz5','CMvHze1LBw9YEq','Aw5PDgLHBgL6zq','C2f2zs1Tzw1VCNK','CMvHzc1Tzw1VCNK','zw50CMLLCW','vw5RBM93BIbTzw1VCNKGy29TBwfUzdOG','C2v0','Aw5MBW','CMvHzefSBe1LBw9YAwvZ','tg9HzgvKia','ig1LBw9YAwvZ','BwTKAxi','AM9PBG','CMvHzc1Tzw0','BwvTB3jPzxm','twvTB3j5ihDPDgGGsuqG','Bg9Nz2vY','rxjYB3iGBg9HzgLUzYbTzw1VCMLLCZO','y29UDgvUDa','zxjYB3i','y29TBwfUzhm','ChvZAa','CxvLCNK','C2f2zu1LBw9YAwvZvg9eAxnR','lMXVEgLHlxn0yxrL','mtq0odm5nK9fCMPTBG','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','mty5nZaXyxfTCNbN','rxjYB3iGzxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5Kia','CgfYC2vqyxjHBwv0zxjZ','z2v0','ugfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCYb3AxrOifrHz1bHCNnLCG','DxrMltG','rMfPBgvKihrVihnHDMuGBwvTB3jPzxmGDg8GzgLZAZOG','yxr0CMLIDxrLCW','BwvZC2fNzq','sw5PDgLHBgL6Aw5Nig1LBw9YEsbZDg9YywDL','Aw5PDgLHBgL6zwq','mJi3nta4m1jQsvzdDG','ywn0Aw9U','twvTB3j5ignVBNrLBNqGy2fUBM90igjLigvTChr5','mtq2mZC3ofndwwLeAa','BwvTB3jPzxmUANnVBG','mJvLyuLPuw8','nJC4ndq0uwLIDKPi','rxjYB3iGCgfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCZO'];a0_0x2cde=function(){return _0x326a0d;};return a0_0x2cde();}import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x2f0dae,_0x298927){super(_0x2f0dae,_0x298927),this['memories']=new Map(),this['initialized']=![];}[a0_0x3a54b4(0x198)](){const _0x8c4628=a0_0x3a54b4;return _0x8c4628(0x19a);}[a0_0x3a54b4(0x186)](_0x5cdaef){const _0x1e3161=a0_0x3a54b4;this[_0x1e3161(0x179)]['info'](_0x1e3161(0x188));const _0x174607={'commands':[]};try{const _0x34cd32=TagParser[_0x1e3161(0x17f)](_0x5cdaef,'memory');for(const _0x1d71bf of _0x34cd32){const _0x372df4=_0x1d71bf[_0x1e3161(0x18b)][_0x1e3161(0x1a1)],_0x2ca19f=_0x1d71bf[_0x1e3161(0x18b)]['meaning'];_0x372df4&&_0x174607['commands']['push']({'action':'save-memory','name':_0x372df4,'meaning':_0x2ca19f||'','content':_0x1d71bf['content']});}const _0x5a9636=TagParser['query'](_0x5cdaef,_0x1e3161(0x19c));_0x5a9636['length']>0x0&&_0x174607['commands'][_0x1e3161(0x17e)]({'action':_0x1e3161(0x19c)});const _0x3342af=TagParser[_0x1e3161(0x17f)](_0x5cdaef,_0x1e3161(0x176));for(const _0x8e8d80 of _0x3342af){const _0x4798eb=_0x8e8d80[_0x1e3161(0x18b)]['id'];_0x4798eb&&_0x174607['commands'][_0x1e3161(0x17e)]({'action':_0x1e3161(0x1a7),'id':_0x4798eb});}return _0x174607;}catch(_0x2d0f93){return this['logger'][_0x1e3161(0x17c)](_0x1e3161(0x196),_0x2d0f93),{'commands':[]};}}async[a0_0x3a54b4(0x183)](_0xf55dc7,_0x37ea2b){const _0x1df85c=a0_0x3a54b4;this['logger']['info']('Executing\x20memory\x20command\x20with\x20parameters:',_0xf55dc7);!this[_0x1df85c(0x18e)]&&await this[_0x1df85c(0x1a5)](_0x37ea2b);const _0x467f1c=[];if(!_0xf55dc7[_0x1df85c(0x17d)]||_0xf55dc7[_0x1df85c(0x17d)]['length']===0x0)throw new Error(_0x1df85c(0x19d));for(const _0x427137 of _0xf55dc7['commands']){try{let _0x302b9c;switch(_0x427137[_0x1df85c(0x190)]){case _0x1df85c(0x1a6):_0x302b9c=await this['saveMemory'](_0x427137[_0x1df85c(0x1a1)],_0x427137[_0x1df85c(0x1a2)],_0x427137['content']);break;case _0x1df85c(0x19c):_0x302b9c=await this['readAllMemories']();break;case _0x1df85c(0x1a7):_0x302b9c=await this[_0x1df85c(0x1a4)](_0x427137['id']);break;default:throw new Error(_0x1df85c(0x1a9)+_0x427137[_0x1df85c(0x190)]);}_0x467f1c[_0x1df85c(0x17e)](_0x302b9c);}catch(_0x4a9831){this[_0x1df85c(0x179)][_0x1df85c(0x17c)](_0x1df85c(0x185)+_0x427137['action']+':',_0x4a9831),_0x467f1c[_0x1df85c(0x17e)]({'action':_0x427137['action'],'success':![],'error':_0x4a9831['message']});}}return await this[_0x1df85c(0x180)](_0x37ea2b),{'results':_0x467f1c};}async[a0_0x3a54b4(0x1a5)](_0x1b692d){const _0x5cd3bc=a0_0x3a54b4;this['logger'][_0x5cd3bc(0x170)](_0x5cd3bc(0x18d));try{const _0x4943ea=a0_0x13e37f['join'](_0x1b692d,_0x5cd3bc(0x181),'memories');await a0_0x29af2c['mkdir'](_0x4943ea,{'recursive':!![]});try{const _0x4a6e31=a0_0x13e37f['join'](_0x4943ea,_0x5cd3bc(0x193)),_0x532cee=await a0_0x29af2c['readFile'](_0x4a6e31,'utf-8'),_0x51815c=JSON['parse'](_0x532cee);for(const [_0x53e0ca,_0x338ea1]of Object['entries'](_0x51815c)){this[_0x5cd3bc(0x177)][_0x5cd3bc(0x1aa)](_0x53e0ca,_0x338ea1);}this['logger']['info'](_0x5cd3bc(0x172)+this[_0x5cd3bc(0x177)]['size']+_0x5cd3bc(0x173));}catch(_0x371281){_0x371281['code']!=='ENOENT'&&this[_0x5cd3bc(0x179)]['warn'](_0x5cd3bc(0x17a),_0x371281);}this[_0x5cd3bc(0x18e)]=!![];}catch(_0x2a52ba){this['logger'][_0x5cd3bc(0x17c)]('Failed\x20to\x20initialize\x20memory\x20storage:',_0x2a52ba);throw new Error('Failed\x20to\x20initialize\x20memory\x20storage:\x20'+_0x2a52ba[_0x5cd3bc(0x18c)]);}}async['saveMemory'](_0xfb1e61,_0x5a5b7f,_0x41cc93){const _0x1e9f4c=a0_0x3a54b4;this[_0x1e9f4c(0x179)][_0x1e9f4c(0x170)](_0x1e9f4c(0x199)+_0xfb1e61);if(!_0xfb1e61||_0xfb1e61['trim']()==='')throw new Error(_0x1e9f4c(0x19e));if(!_0x41cc93||_0x41cc93[_0x1e9f4c(0x1a0)]()==='')throw new Error(_0x1e9f4c(0x191));const _0x3d3a3e=a0_0x45dd75(),_0x3c71ae={'id':_0x3d3a3e,'name':_0xfb1e61,'meaning':_0x5a5b7f||'','content':_0x41cc93,'createdAt':new Date()['toISOString']()};return this[_0x1e9f4c(0x177)]['set'](_0x3d3a3e,_0x3c71ae),{'action':'save-memory','id':_0x3d3a3e,'name':_0xfb1e61,'success':!![]};}async['readMemory'](_0x444702){const _0x2c30df=a0_0x3a54b4;this[_0x2c30df(0x179)]['info']('Reading\x20memory:\x20'+_0x444702);if(!this[_0x2c30df(0x177)]['has'](_0x444702))throw new Error(_0x2c30df(0x178)+_0x444702+'\x20not\x20found');const _0x25ae15=this[_0x2c30df(0x177)][_0x2c30df(0x187)](_0x444702);return{'action':'read-memory','id':_0x444702,'name':_0x25ae15['name'],'meaning':_0x25ae15[_0x2c30df(0x1a2)],'content':_0x25ae15[_0x2c30df(0x17b)],'createdAt':_0x25ae15['createdAt'],'success':!![]};}async[a0_0x3a54b4(0x171)](){const _0x5a10c8=a0_0x3a54b4;this[_0x5a10c8(0x179)][_0x5a10c8(0x170)]('Reading\x20all\x20memories');const _0x50f9db=[];for(const [_0x312308,_0x2b7c78]of this['memories']['entries']()){_0x50f9db['push']({'id':_0x312308,'name':_0x2b7c78['name'],'meaning':_0x2b7c78['meaning'],'createdAt':_0x2b7c78['createdAt']});}return{'action':'read-all','memories':_0x50f9db,'count':_0x50f9db['length'],'success':!![]};}async['saveMemoriesToDisk'](_0x572fad){const _0x4f9331=a0_0x3a54b4;this['logger']['info']('Saving\x20memories\x20to\x20disk');try{const _0x5bccdf=a0_0x13e37f['join'](_0x572fad,_0x4f9331(0x181),_0x4f9331(0x177));await a0_0x29af2c[_0x4f9331(0x174)](_0x5bccdf,{'recursive':!![]});const _0x1a5a06=a0_0x13e37f[_0x4f9331(0x175)](_0x5bccdf,'memories.json'),_0x21a9ae={};for(const [_0x459d81,_0x2cd2db]of this[_0x4f9331(0x177)][_0x4f9331(0x1a8)]()){_0x21a9ae[_0x459d81]=_0x2cd2db;}await a0_0x29af2c['writeFile'](_0x1a5a06,JSON[_0x4f9331(0x1a3)](_0x21a9ae,null,0x2),_0x4f9331(0x189));}catch(_0x4d09ec){this[_0x4f9331(0x179)]['error']('Error\x20saving\x20memories\x20to\x20disk:',_0x4d09ec);throw new Error(_0x4f9331(0x18a)+_0x4d09ec['message']);}}async['shutdown'](){const _0xbc0575=a0_0x3a54b4;this[_0xbc0575(0x179)]['info']('Shutting\x20down\x20memory\x20tool');}}