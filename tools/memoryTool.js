const a0_0x56cd96=a0_0x36b6;(function(_0x333d41,_0xe79b22){const _0x1c3144=a0_0x36b6,_0x31c629=_0x333d41();while(!![]){try{const _0x5e8a68=-parseInt(_0x1c3144(0x178))/0x1+-parseInt(_0x1c3144(0x150))/0x2*(parseInt(_0x1c3144(0x152))/0x3)+parseInt(_0x1c3144(0x154))/0x4+parseInt(_0x1c3144(0x160))/0x5*(parseInt(_0x1c3144(0x16b))/0x6)+parseInt(_0x1c3144(0x167))/0x7*(parseInt(_0x1c3144(0x181))/0x8)+-parseInt(_0x1c3144(0x183))/0x9+-parseInt(_0x1c3144(0x17f))/0xa;if(_0x5e8a68===_0xe79b22)break;else _0x31c629['push'](_0x31c629['shift']());}catch(_0x4c27c7){_0x31c629['push'](_0x31c629['shift']());}}}(a0_0x2d27,0x5aa51));import{promises as a0_0x240f3c}from'fs';import a0_0x369d67 from'path';function a0_0x36b6(_0x4bd06e,_0x5ae083){const _0x2d27a9=a0_0x2d27();return a0_0x36b6=function(_0x36b6b5,_0x355fef){_0x36b6b5=_0x36b6b5-0x142;let _0x444997=_0x2d27a9[_0x36b6b5];if(a0_0x36b6['zIayAI']===undefined){var _0x225685=function(_0x240f3c){const _0x369d67='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1aa680='',_0x3bce04='';for(let _0x31240d=0x0,_0x24105f,_0xe697be,_0x19fb30=0x0;_0xe697be=_0x240f3c['charAt'](_0x19fb30++);~_0xe697be&&(_0x24105f=_0x31240d%0x4?_0x24105f*0x40+_0xe697be:_0xe697be,_0x31240d++%0x4)?_0x1aa680+=String['fromCharCode'](0xff&_0x24105f>>(-0x2*_0x31240d&0x6)):0x0){_0xe697be=_0x369d67['indexOf'](_0xe697be);}for(let _0x428de7=0x0,_0x2b9fae=_0x1aa680['length'];_0x428de7<_0x2b9fae;_0x428de7++){_0x3bce04+='%'+('00'+_0x1aa680['charCodeAt'](_0x428de7)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3bce04);};a0_0x36b6['Bammpw']=_0x225685,_0x4bd06e=arguments,a0_0x36b6['zIayAI']=!![];}const _0x439f24=_0x2d27a9[0x0],_0x4cc32c=_0x36b6b5+_0x439f24,_0x156ed3=_0x4bd06e[_0x4cc32c];return!_0x156ed3?(_0x444997=a0_0x36b6['Bammpw'](_0x444997),_0x4bd06e[_0x4cc32c]=_0x444997):_0x444997=_0x156ed3,_0x444997;},a0_0x36b6(_0x4bd06e,_0x5ae083);}import{v4 as a0_0x1aa680}from'uuid';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x3bce04,_0x31240d){const _0x3fb69f=a0_0x36b6;super(_0x3bce04,_0x31240d),this[_0x3fb69f(0x14e)]=new Map(),this[_0x3fb69f(0x14c)]=![];}['getDescription'](){return'\x0aMemory\x20Tool:\x20Allows\x20you\x20to\x20store\x20and\x20retrieve\x20important\x20information\x20that\x20you\x20want\x20to\x20remember\x20throughout\x20the\x20conversation.\x0a\x0aUsage:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22short\x20descriptive\x20name\x22\x20meaning=\x22reason\x20you\x20want\x20to\x20remember\x20this\x22]\x0aContent\x20to\x20remember\x20(can\x20be\x20code,\x20facts,\x20user\x20preferences,\x20etc.)\x0a[/memory]\x0a\x0a[read-all\x20/]\x0a\x0a[read-mem\x20id=\x22memory-id\x22\x20/]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20Store\x20an\x20important\x20piece\x20of\x20information:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22Project\x20requirements\x22\x20meaning=\x22Core\x20requirements\x20specified\x20by\x20the\x20user\x22]\x0a-\x20Must\x20work\x20on\x20both\x20Windows\x20and\x20Linux\x0a-\x20Should\x20support\x20both\x20light\x20and\x20dark\x20themes\x0a-\x20Maximum\x20memory\x20usage:\x20500MB\x0a[/memory]\x0a[/tool]\x0a\x0a2.\x20Retrieve\x20all\x20memories\x20to\x20see\x20what\x27s\x20available:\x0a[tool\x20id=\x22memory\x22]\x0a[read-all\x20/]\x0a[/tool]\x0a\x0a3.\x20Read\x20specific\x20memories:\x0a[tool\x20id=\x22memory\x22]\x0a[read-mem\x20id=\x22a1b2c3d4-5678-90ab-cdef-123456789012\x22\x20/]\x0a[/tool]\x0a\x0aNotes:\x0a-\x20Use\x20this\x20tool\x20to\x20store\x20information\x20that\x20you\x20might\x20need\x20later\x20in\x20the\x20conversation\x0a-\x20Memories\x20persist\x20for\x20the\x20duration\x20of\x20the\x20session\x0a-\x20You\x20can\x20save\x20code\x20snippets,\x20requirements,\x20user\x20preferences,\x20or\x20any\x20other\x20important\x20information\x0a-\x20When\x20storing\x20new\x20information,\x20always\x20provide\x20a\x20clear\x20name\x20and\x20meaning\x20to\x20help\x20you\x20recall\x20why\x20it\x20was\x20important\x0a-\x20Use\x20read-all\x20to\x20get\x20a\x20list\x20of\x20all\x20available\x20memories\x20when\x20you\x20need\x20a\x20reminder\x0a';}['parseParameters'](_0x24105f){const _0x4a4a4b=a0_0x36b6;this['logger'][_0x4a4a4b(0x144)](_0x4a4a4b(0x17c));const _0xe697be={'commands':[]};try{const _0x19fb30=TagParser[_0x4a4a4b(0x179)](_0x24105f,_0x4a4a4b(0x147));for(const _0x15e081 of _0x19fb30){const _0x529465=_0x15e081['attributes'][_0x4a4a4b(0x15e)],_0x5ec18a=_0x15e081['attributes'][_0x4a4a4b(0x180)];_0x529465&&_0xe697be[_0x4a4a4b(0x168)]['push']({'action':'save-memory','name':_0x529465,'meaning':_0x5ec18a||'','content':_0x15e081['content']});}const _0x428de7=TagParser[_0x4a4a4b(0x179)](_0x24105f,_0x4a4a4b(0x170));_0x428de7[_0x4a4a4b(0x164)]>0x0&&_0xe697be['commands']['push']({'action':_0x4a4a4b(0x170)});const _0x2b9fae=TagParser['query'](_0x24105f,'read-mem');for(const _0x320689 of _0x2b9fae){const _0x591c60=_0x320689[_0x4a4a4b(0x175)]['id'];_0x591c60&&_0xe697be['commands']['push']({'action':_0x4a4a4b(0x146),'id':_0x591c60});}return _0xe697be;}catch(_0x123087){return this[_0x4a4a4b(0x14d)][_0x4a4a4b(0x163)](_0x4a4a4b(0x157),_0x123087),{'commands':[]};}}async['executeWithParameters'](_0xef3f1b,_0x221da5){const _0x639da6=a0_0x36b6;this['logger']['info'](_0x639da6(0x14f),_0xef3f1b);!this['initialized']&&await this['initialize'](_0x221da5);const _0x128496=[];if(!_0xef3f1b['commands']||_0xef3f1b[_0x639da6(0x168)][_0x639da6(0x164)]===0x0)throw new Error('No\x20memory\x20commands\x20specified');for(const _0x2c9e88 of _0xef3f1b['commands']){try{let _0xcfa6ee;switch(_0x2c9e88['action']){case'save-memory':_0xcfa6ee=await this['saveMemory'](_0x2c9e88['name'],_0x2c9e88['meaning'],_0x2c9e88['content']);break;case'read-all':_0xcfa6ee=await this[_0x639da6(0x172)]();break;case _0x639da6(0x146):_0xcfa6ee=await this[_0x639da6(0x143)](_0x2c9e88['id']);break;default:throw new Error('Unknown\x20memory\x20command:\x20'+_0x2c9e88[_0x639da6(0x17a)]);}_0x128496[_0x639da6(0x159)](_0xcfa6ee);}catch(_0x47c1b4){this['logger']['error'](_0x639da6(0x15c)+_0x2c9e88['action']+':',_0x47c1b4),_0x128496['push']({'action':_0x2c9e88[_0x639da6(0x17a)],'success':![],'error':_0x47c1b4[_0x639da6(0x17b)]});}}return await this['saveMemoriesToDisk'](_0x221da5),{'results':_0x128496};}async[a0_0x56cd96(0x17e)](_0x5bc144){const _0x2a69fa=a0_0x56cd96;this[_0x2a69fa(0x14d)]['info']('Initializing\x20memory\x20storage');try{const _0x49c3f8=a0_0x369d67[_0x2a69fa(0x16c)](_0x5bc144,_0x2a69fa(0x182),'memories');await a0_0x240f3c[_0x2a69fa(0x15a)](_0x49c3f8,{'recursive':!![]});try{const _0x1caf09=a0_0x369d67[_0x2a69fa(0x16c)](_0x49c3f8,_0x2a69fa(0x17d)),_0x3997b6=await a0_0x240f3c[_0x2a69fa(0x166)](_0x1caf09,'utf-8'),_0x56ec6e=JSON[_0x2a69fa(0x15b)](_0x3997b6);for(const [_0x478edc,_0x4fd051]of Object[_0x2a69fa(0x169)](_0x56ec6e)){this[_0x2a69fa(0x14e)]['set'](_0x478edc,_0x4fd051);}this['logger']['info'](_0x2a69fa(0x155)+this[_0x2a69fa(0x14e)]['size']+_0x2a69fa(0x151));}catch(_0xb8ae17){_0xb8ae17['code']!==_0x2a69fa(0x173)&&this[_0x2a69fa(0x14d)][_0x2a69fa(0x149)]('Error\x20loading\x20memories:',_0xb8ae17);}this['initialized']=!![];}catch(_0x4c1c1b){this['logger']['error']('Failed\x20to\x20initialize\x20memory\x20storage:',_0x4c1c1b);throw new Error(_0x2a69fa(0x16d)+_0x4c1c1b['message']);}}async[a0_0x56cd96(0x14a)](_0x41f727,_0x59b364,_0x5092ec){const _0x349bb2=a0_0x56cd96;this[_0x349bb2(0x14d)][_0x349bb2(0x144)](_0x349bb2(0x158)+_0x41f727);if(!_0x41f727||_0x41f727[_0x349bb2(0x15f)]()==='')throw new Error(_0x349bb2(0x176));if(!_0x5092ec||_0x5092ec['trim']()==='')throw new Error(_0x349bb2(0x15d));const _0x4fb9fa=a0_0x1aa680(),_0x1fd929={'id':_0x4fb9fa,'name':_0x41f727,'meaning':_0x59b364||'','content':_0x5092ec,'createdAt':new Date()[_0x349bb2(0x156)]()};return this[_0x349bb2(0x14e)]['set'](_0x4fb9fa,_0x1fd929),{'action':'save-memory','id':_0x4fb9fa,'name':_0x41f727,'success':!![]};}async[a0_0x56cd96(0x143)](_0x6aa022){const _0x6adadb=a0_0x56cd96;this[_0x6adadb(0x14d)]['info']('Reading\x20memory:\x20'+_0x6aa022);if(!this[_0x6adadb(0x14e)]['has'](_0x6aa022))throw new Error(_0x6adadb(0x161)+_0x6aa022+'\x20not\x20found');const _0x55e45c=this['memories'][_0x6adadb(0x14b)](_0x6aa022);return{'action':_0x6adadb(0x146),'id':_0x6aa022,'name':_0x55e45c['name'],'meaning':_0x55e45c[_0x6adadb(0x180)],'content':_0x55e45c[_0x6adadb(0x165)],'createdAt':_0x55e45c['createdAt'],'success':!![]};}async['readAllMemories'](){const _0x51cb90=a0_0x56cd96;this[_0x51cb90(0x14d)]['info'](_0x51cb90(0x177));const _0x380026=[];for(const [_0x2400e4,_0x38cda2]of this[_0x51cb90(0x14e)]['entries']()){_0x380026['push']({'id':_0x2400e4,'name':_0x38cda2[_0x51cb90(0x15e)],'meaning':_0x38cda2['meaning'],'createdAt':_0x38cda2[_0x51cb90(0x145)]});}return{'action':_0x51cb90(0x170),'memories':_0x380026,'count':_0x380026[_0x51cb90(0x164)],'success':!![]};}async[a0_0x56cd96(0x171)](_0x190ae4){const _0x3be18c=a0_0x56cd96;this['logger'][_0x3be18c(0x144)](_0x3be18c(0x174));try{const _0x2777b3=a0_0x369d67[_0x3be18c(0x16c)](_0x190ae4,'.loxia-state','memories');await a0_0x240f3c['mkdir'](_0x2777b3,{'recursive':!![]});const _0x59f2ea=a0_0x369d67[_0x3be18c(0x16c)](_0x2777b3,_0x3be18c(0x17d)),_0x11322c={};for(const [_0x5b605b,_0x48b829]of this[_0x3be18c(0x14e)]['entries']()){_0x11322c[_0x5b605b]=_0x48b829;}await a0_0x240f3c[_0x3be18c(0x153)](_0x59f2ea,JSON[_0x3be18c(0x148)](_0x11322c,null,0x2),_0x3be18c(0x16e));}catch(_0x18c495){this['logger']['error'](_0x3be18c(0x162),_0x18c495);throw new Error(_0x3be18c(0x16f)+_0x18c495['message']);}}async[a0_0x56cd96(0x142)](){const _0x16ff55=a0_0x56cd96;this['logger']['info'](_0x16ff55(0x16a));}}function a0_0x2d27(){const _0x414ebf=['m1DHCxblzG','D3jPDgvgAwXL','mJuXmJq5mMDnuMDZDG','tg9HzgvKia','Dg9ju09tDhjPBMC','rxjYB3iGCgfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCZO','u2f2Aw5Nig1LBw9YEtOG','ChvZAa','BwTKAxi','CgfYC2u','rxjYB3iGzxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5Kia','twvTB3j5ignVBNrLBNqGy2fUBM90igjLigvTChr5','BMfTzq','DhjPBq','nJq3nvniA0fbsa','twvTB3j5ihDPDgGGsuqG','rxjYB3iGC2f2Aw5Nig1LBw9YAwvZihrVigrPC2S6','zxjYB3i','BgvUz3rO','y29UDgvUDa','CMvHzezPBgu','mte0nJK1n3fbuNDJDW','y29TBwfUzhm','zw50CMLLCW','u2H1DhrPBMCGzg93BIbTzw1VCNKGDg9VBa','mZeZofLcz1HyAa','AM9PBG','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6ia','DxrMltG','rMfPBgvKihrVihnHDMuGBwvTB3jPzxmGDg8GzgLZAZOG','CMvHzc1HBgW','C2f2zu1LBw9YAwvZvg9eAxnR','CMvHzefSBe1LBw9YAwvZ','ru5pru5u','u2f2Aw5Nig1LBw9YAwvZihrVigrPC2S','yxr0CMLIDxrLCW','twvTB3j5ig5HBwuGy2fUBM90igjLigvTChr5','uMvHzgLUzYbHBgWGBwvTB3jPzxm','mJC3mdLvwhPdtem','CxvLCNK','ywn0Aw9U','BwvZC2fNzq','ugfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCYb3AxrOifrHz1bHCNnLCG','BwvTB3jPzxmUANnVBG','Aw5PDgLHBgL6zq','nJaYndy4mhrnwg94vW','BwvHBMLUzW','oe93y2DjDq','lMXVEgLHlxn0yxrL','mJu1nJi3mfD3r2Xzua','C2H1DgrVD24','CMvHze1LBw9YEq','Aw5MBW','y3jLyxrLzef0','CMvHzc1Tzw1VCNK','BwvTB3j5','C3rYAw5NAwz5','D2fYBG','C2f2zu1LBw9YEq','z2v0','Aw5PDgLHBgL6zwq','Bg9Nz2vY','BwvTB3jPzxm','rxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5KihDPDgGGCgfYyw1LDgvYCZO','mZy3ntqYzxj3Ehbl','ig1LBw9YAwvZ'];a0_0x2d27=function(){return _0x414ebf;};return a0_0x2d27();}