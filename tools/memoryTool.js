function a0_0x53cc(_0x5b7c1b,_0x1f4f03){const _0x3e15a3=a0_0x3e15();return a0_0x53cc=function(_0x53cc42,_0x5db56c){_0x53cc42=_0x53cc42-0x1c7;let _0x18bd71=_0x3e15a3[_0x53cc42];if(a0_0x53cc['YzPNgT']===undefined){var _0x3f7b56=function(_0x51057e){const _0xe9f563='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1cf099='',_0x38d434='';for(let _0x25268f=0x0,_0x1c03db,_0x2c1f13,_0x23e47a=0x0;_0x2c1f13=_0x51057e['charAt'](_0x23e47a++);~_0x2c1f13&&(_0x1c03db=_0x25268f%0x4?_0x1c03db*0x40+_0x2c1f13:_0x2c1f13,_0x25268f++%0x4)?_0x1cf099+=String['fromCharCode'](0xff&_0x1c03db>>(-0x2*_0x25268f&0x6)):0x0){_0x2c1f13=_0xe9f563['indexOf'](_0x2c1f13);}for(let _0x2d6d67=0x0,_0x5b8559=_0x1cf099['length'];_0x2d6d67<_0x5b8559;_0x2d6d67++){_0x38d434+='%'+('00'+_0x1cf099['charCodeAt'](_0x2d6d67)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x38d434);};a0_0x53cc['gAQXtp']=_0x3f7b56,_0x5b7c1b=arguments,a0_0x53cc['YzPNgT']=!![];}const _0x1fb8c4=_0x3e15a3[0x0],_0x1e51df=_0x53cc42+_0x1fb8c4,_0x21da30=_0x5b7c1b[_0x1e51df];return!_0x21da30?(_0x18bd71=a0_0x53cc['gAQXtp'](_0x18bd71),_0x5b7c1b[_0x1e51df]=_0x18bd71):_0x18bd71=_0x21da30,_0x18bd71;},a0_0x53cc(_0x5b7c1b,_0x1f4f03);}const a0_0x200d5c=a0_0x53cc;(function(_0x1e5cea,_0x5abc67){const _0x385a60=a0_0x53cc,_0x3a6b1b=_0x1e5cea();while(!![]){try{const _0x4d94f9=-parseInt(_0x385a60(0x1e0))/0x1+-parseInt(_0x385a60(0x1e2))/0x2+-parseInt(_0x385a60(0x1d1))/0x3*(-parseInt(_0x385a60(0x1e8))/0x4)+parseInt(_0x385a60(0x1e6))/0x5*(-parseInt(_0x385a60(0x1fc))/0x6)+parseInt(_0x385a60(0x1d9))/0x7+-parseInt(_0x385a60(0x1f2))/0x8*(parseInt(_0x385a60(0x1d7))/0x9)+parseInt(_0x385a60(0x1c8))/0xa;if(_0x4d94f9===_0x5abc67)break;else _0x3a6b1b['push'](_0x3a6b1b['shift']());}catch(_0x321837){_0x3a6b1b['push'](_0x3a6b1b['shift']());}}}(a0_0x3e15,0x902e3));import{promises as a0_0x51057e}from'fs';function a0_0x3e15(){const _0x4405e2=['CMvHzefSBe1LBw9YAwvZ','CMvHzc1Tzw1VCNK','rxjYB3iGC2f2Aw5Nig1LBw9YAwvZihrVigrPC2S6','CMvHzc1HBgW','y29TBwfUzhm','BwvHBMLUzW','BwvZC2fNzq','nJm4mZGXngLrA2vpBa','z2v0rgvZy3jPChrPB24','ig1LBw9YAwvZ','C2f2zu1LBw9YEq','Bg9Nz2vY','rxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5KihDPDgGGCgfYyw1LDgvYCZO','mJKWode0odbIwNffwMS','BgvUz3rO','BwvTB3jPzxmUANnVBG','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6ia','BwvTB3j5','C2v0','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ','Aw5PDgLHBgL6zwq','CxvLCNK','mtj3BwPOzKK','lMXVEgLHlxn0yxrL','Dg9ju09tDhjPBMC','AM9PBG','u2H1DhrPBMCGzg93BIbTzw1VCNKGDg9VBa','DxrMltG','mtaZnJC4odnoD3DZvvO','vw5RBM93BIbTzw1VCNKGy29TBwfUzdOG','mJu4mJC5mhbhs3ziBq','ugfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCYb3AxrOifrHz1bHCNnLCG','cK1LBw9YEsbuB29SoIbbBgXVD3mGEw91ihrVihn0B3jLigfUzcbYzxrYAwv2zsbPBxbVCNrHBNqGAw5MB3jTyxrPB24GDgHHDcb5B3uGD2fUDcb0BYbYzw1LBwjLCIb0AhjVDwDOB3v0ihrOzsbJB252zxjZyxrPB24UcGPvC2fNztOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IC2HVCNqGzgvZy3jPChrPDMuGBMfTzsiGBwvHBMLUzZ0ICMvHC29UihLVDsb3yw50ihrVihjLBwvTyMvYihrOAxmIxqPdB250zw50ihrVihjLBwvTyMvYicHJyw4GyMuGy29KzsWGzMfJDhmSihvZzxiGChjLzMvYzw5JzxmSigv0yY4PcLSVBwvTB3j5xqOkw3jLywqTywXSic9DcGPBCMvHzc1Tzw0GAwq9iM1LBw9YEs1PzciGl10kwY90B29SxqOkrxHHBxbSzxm6cJeUifn0B3jLigfUigLTCg9YDgfUDcbWAwvJzsbVzIbPBMzVCM1HDgLVBJOkw3rVB2WGAwq9iM1LBw9YEsjDcLTTzw1VCNKGBMfTzt0IuhjVAMvJDcbYzxf1AxjLBwvUDhmIig1Lyw5PBMC9iKnVCMuGCMvXDwLYzw1LBNrZihnWzwnPzMLLzcbIEsb0AguGDxnLCIjDcI0GtxvZDcb3B3jRig9UigjVDgGGv2LUzg93CYbHBMqGtgLUDxGklsbtAg91BgqGC3vWCg9YDcbIB3rOigXPz2H0igfUzcbKyxjRihrOzw1LCWOTie1HEgLTDw0GBwvTB3j5ihvZywDLoIa1mdbnqGPBl21LBw9YEv0kwY90B29SxqOkmI4GuMv0CMLLDMuGywXSig1LBw9YAwvZihrVihnLzsb3Agf0j3mGyxzHAwXHyMXLoGPBDg9VBcbPzd0IBwvTB3j5iL0kw3jLywqTywXSic9DcLSVDg9VBf0kcJmUifjLywqGC3bLy2LMAwmGBwvTB3jPzxm6cLT0B29SigLKpsjTzw1VCNKIxqPBCMvHzc1Tzw0GAwq9iMeXyJjJm2q0ltu2nZGTotbHyI1JzgvMlteYmZq1nJC4otaXmIiGl10kwY90B29SxqOktM90zxm6cI0GvxnLihrOAxmGDg9VBcb0BYbZDg9YzsbPBMzVCM1HDgLVBIb0Agf0ihLVDsbTAwDODcbUzwvKigXHDgvYigLUihrOzsbJB252zxjZyxrPB24klsbnzw1VCMLLCYbWzxjZAxn0igzVCIb0AguGzhvYyxrPB24GB2yGDgHLihnLC3nPB24klsbzB3uGy2fUihnHDMuGy29KzsbZBMLWCgv0CYWGCMvXDwLYzw1LBNrZlcb1C2vYihbYzwzLCMvUy2vZlcbVCIbHBNKGB3rOzxiGAw1WB3j0yw50igLUzM9YBwf0Aw9UcI0Gv2HLBIbZDg9YAw5Nig5LDYbPBMzVCM1HDgLVBIWGywX3yxLZihbYB3zPzguGysbJBgvHCIbUyw1LigfUzcbTzwfUAw5NihrVigHLBhaGEw91ihjLy2fSBcb3AhKGAxqGD2fZigLTCg9YDgfUDaOTifvZzsbYzwfKlwfSBcb0BYbNzxqGysbSAxn0ig9MigfSBcbHDMfPBgfIBguGBwvTB3jPzxmGD2HLBIb5B3uGBMvLzcbHihjLBwLUzgvYcG','rMfPBgvKihrVihnHDMuGBwvTB3jPzxmGDg8GzgLZAZOG','rxjYB3iGCgfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCZO','ywn0Aw9U','zxjYB3i','ntKWmdu1u2TUs1Pn','ChvZAa','mtiZodqXnLjICMnRqW','twvTB3j5ig5HBwuGy2fUBM90igjLigvTChr5','y3jLyxrLzef0','zw50CMLLCW','nvr5DhHiuq','z2v0','nZm4nJy0thfoA0TJ','BMfTzq','rxjYB3iGBg9HzgLUzYbTzw1VCMLLCZO','Aw5MBW','AgfZ','CMvHzc1Tzw0','CMvHzezPBgu','uMvHzgLUzYbTzw1VCNK6ia','C2H1DgrVD24','BwvTB3jPzxm','ogPvDK11tq','y29UDgvUDa','D3jPDgvgAwXL'];a0_0x3e15=function(){return _0x4405e2;};return a0_0x3e15();}import a0_0xe9f563 from'path';import{v4 as a0_0x1cf099}from'uuid';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x38d434,_0x25268f){const _0x445238=a0_0x53cc;super(_0x38d434,_0x25268f),this[_0x445238(0x1f1)]=new Map(),this['initialized']=![];}[a0_0x200d5c(0x1fd)](){const _0x76676b=a0_0x200d5c;return _0x76676b(0x1db);}['parseParameters'](_0x1c03db){const _0xc09300=a0_0x200d5c;this[_0xc09300(0x200)][_0xc09300(0x1eb)](_0xc09300(0x1da));const _0x2c1f13={'commands':[]};try{const _0x23e47a=TagParser['query'](_0x1c03db,_0xc09300(0x1cc));for(const _0x558e12 of _0x23e47a){const _0x42fb41=_0x558e12['attributes']['name'],_0x5540f1=_0x558e12['attributes']['meaning'];_0x42fb41&&_0x2c1f13['commands'][_0xc09300(0x1e1)]({'action':'save-memory','name':_0x42fb41,'meaning':_0x5540f1||'','content':_0x558e12[_0xc09300(0x1f3)]});}const _0x2d6d67=TagParser[_0xc09300(0x1d0)](_0x1c03db,_0xc09300(0x1f8));_0x2d6d67['length']>0x0&&_0x2c1f13['commands'][_0xc09300(0x1e1)]({'action':'read-all'});const _0x5b8559=TagParser[_0xc09300(0x1d0)](_0x1c03db,_0xc09300(0x1ed));for(const _0x4413b7 of _0x5b8559){const _0x354b22=_0x4413b7['attributes']['id'];_0x354b22&&_0x2c1f13['commands'][_0xc09300(0x1e1)]({'action':_0xc09300(0x1f6),'id':_0x354b22});}return _0x2c1f13;}catch(_0x3e279e){return this['logger'][_0xc09300(0x1df)](_0xc09300(0x1dd),_0x3e279e),{'commands':[]};}}async[a0_0x200d5c(0x1ce)](_0x276620,_0x2b7847){const _0x31cc4d=a0_0x200d5c;this[_0x31cc4d(0x200)]['info'](_0x31cc4d(0x1c7),_0x276620);!this['initialized']&&await this['initialize'](_0x2b7847);const _0x45e01e=[];if(!_0x276620[_0x31cc4d(0x1f9)]||_0x276620[_0x31cc4d(0x1f9)][_0x31cc4d(0x1c9)]===0x0)throw new Error('No\x20memory\x20commands\x20specified');for(const _0x2b7685 of _0x276620[_0x31cc4d(0x1f9)]){try{let _0x18b1e7;switch(_0x2b7685['action']){case'save-memory':_0x18b1e7=await this['saveMemory'](_0x2b7685['name'],_0x2b7685[_0x31cc4d(0x1fa)],_0x2b7685[_0x31cc4d(0x1f3)]);break;case _0x31cc4d(0x1f8):_0x18b1e7=await this[_0x31cc4d(0x1f5)]();break;case'read-memory':_0x18b1e7=await this['readMemory'](_0x2b7685['id']);break;default:throw new Error(_0x31cc4d(0x1d8)+_0x2b7685[_0x31cc4d(0x1de)]);}_0x45e01e[_0x31cc4d(0x1e1)](_0x18b1e7);}catch(_0x29e975){this[_0x31cc4d(0x200)]['error']('Error\x20executing\x20memory\x20command\x20'+_0x2b7685['action']+':',_0x29e975),_0x45e01e[_0x31cc4d(0x1e1)]({'action':_0x2b7685[_0x31cc4d(0x1de)],'success':![],'error':_0x29e975[_0x31cc4d(0x1fb)]});}}return await this['saveMemoriesToDisk'](_0x2b7847),{'results':_0x45e01e};}async['initialize'](_0x2a99c5){const _0x57ba91=a0_0x200d5c;this['logger']['info']('Initializing\x20memory\x20storage');try{const _0x246ab0=a0_0xe9f563['join'](_0x2a99c5,_0x57ba91(0x1d2),_0x57ba91(0x1f1));await a0_0x51057e['mkdir'](_0x246ab0,{'recursive':!![]});try{const _0xf3634d=a0_0xe9f563['join'](_0x246ab0,'memories.json'),_0x5b62e5=await a0_0x51057e[_0x57ba91(0x1ee)](_0xf3634d,_0x57ba91(0x1d6)),_0xd6ff0c=JSON['parse'](_0x5b62e5);for(const [_0x331eb4,_0x4f1a36]of Object[_0x57ba91(0x1e5)](_0xd6ff0c)){this[_0x57ba91(0x1f1)]['set'](_0x331eb4,_0x4f1a36);}this['logger'][_0x57ba91(0x1eb)]('Loaded\x20'+this['memories']['size']+_0x57ba91(0x1fe));}catch(_0x11429f){_0x11429f['code']!=='ENOENT'&&this[_0x57ba91(0x200)]['warn'](_0x57ba91(0x1ea),_0x11429f);}this[_0x57ba91(0x1cf)]=!![];}catch(_0x4d59e1){this[_0x57ba91(0x200)]['error']('Failed\x20to\x20initialize\x20memory\x20storage:',_0x4d59e1);throw new Error(_0x57ba91(0x1cb)+_0x4d59e1['message']);}}async[a0_0x200d5c(0x1ff)](_0x4fda85,_0x168f2e,_0x27e587){const _0x21763a=a0_0x200d5c;this['logger']['info']('Saving\x20memory:\x20'+_0x4fda85);if(!_0x4fda85||_0x4fda85['trim']()==='')throw new Error(_0x21763a(0x1e3));if(!_0x27e587||_0x27e587['trim']()==='')throw new Error('Memory\x20content\x20cannot\x20be\x20empty');const _0x4e3cf5=a0_0x1cf099(),_0x58d4b2={'id':_0x4e3cf5,'name':_0x4fda85,'meaning':_0x168f2e||'','content':_0x27e587,'createdAt':new Date()[_0x21763a(0x1d3)]()};return this['memories'][_0x21763a(0x1cd)](_0x4e3cf5,_0x58d4b2),{'action':'save-memory','id':_0x4e3cf5,'name':_0x4fda85,'success':!![]};}async['readMemory'](_0xdd00eb){const _0x1b2195=a0_0x200d5c;this[_0x1b2195(0x200)][_0x1b2195(0x1eb)](_0x1b2195(0x1ef)+_0xdd00eb);if(!this[_0x1b2195(0x1f1)][_0x1b2195(0x1ec)](_0xdd00eb))throw new Error('Memory\x20with\x20ID\x20'+_0xdd00eb+'\x20not\x20found');const _0x531103=this[_0x1b2195(0x1f1)][_0x1b2195(0x1e7)](_0xdd00eb);return{'action':_0x1b2195(0x1f6),'id':_0xdd00eb,'name':_0x531103[_0x1b2195(0x1e9)],'meaning':_0x531103[_0x1b2195(0x1fa)],'content':_0x531103['content'],'createdAt':_0x531103[_0x1b2195(0x1e4)],'success':!![]};}async['readAllMemories'](){const _0x331bf3=a0_0x200d5c;this['logger']['info']('Reading\x20all\x20memories');const _0x183cbe=[];for(const [_0x1a4c9d,_0x4d83f6]of this['memories'][_0x331bf3(0x1e5)]()){_0x183cbe['push']({'id':_0x1a4c9d,'name':_0x4d83f6['name'],'meaning':_0x4d83f6[_0x331bf3(0x1fa)],'createdAt':_0x4d83f6[_0x331bf3(0x1e4)]});}return{'action':_0x331bf3(0x1f8),'memories':_0x183cbe,'count':_0x183cbe[_0x331bf3(0x1c9)],'success':!![]};}async['saveMemoriesToDisk'](_0x21a229){const _0x4974df=a0_0x200d5c;this[_0x4974df(0x200)][_0x4974df(0x1eb)]('Saving\x20memories\x20to\x20disk');try{const _0x4993eb=a0_0xe9f563[_0x4974df(0x1d4)](_0x21a229,'.loxia-state',_0x4974df(0x1f1));await a0_0x51057e['mkdir'](_0x4993eb,{'recursive':!![]});const _0x9a8eb3=a0_0xe9f563['join'](_0x4993eb,_0x4974df(0x1ca)),_0x2bd240={};for(const [_0x2c4caf,_0x5c23af]of this[_0x4974df(0x1f1)]['entries']()){_0x2bd240[_0x2c4caf]=_0x5c23af;}await a0_0x51057e[_0x4974df(0x1f4)](_0x9a8eb3,JSON['stringify'](_0x2bd240,null,0x2),_0x4974df(0x1d6));}catch(_0x2f6e33){this['logger'][_0x4974df(0x1df)](_0x4974df(0x1f7),_0x2f6e33);throw new Error(_0x4974df(0x1dc)+_0x2f6e33[_0x4974df(0x1fb)]);}}async[a0_0x200d5c(0x1f0)](){const _0x1069a0=a0_0x200d5c;this['logger']['info'](_0x1069a0(0x1d5));}}