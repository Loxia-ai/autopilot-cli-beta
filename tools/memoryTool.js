const a0_0x40bdc3=a0_0x383b;(function(_0x2b6fa0,_0x1e96ef){const _0x437f1c=a0_0x383b,_0x4f7e75=_0x2b6fa0();while(!![]){try{const _0x45b571=-parseInt(_0x437f1c(0x89))/0x1+-parseInt(_0x437f1c(0x9f))/0x2+-parseInt(_0x437f1c(0x6c))/0x3*(parseInt(_0x437f1c(0x6a))/0x4)+parseInt(_0x437f1c(0x75))/0x5*(parseInt(_0x437f1c(0x7b))/0x6)+parseInt(_0x437f1c(0x8f))/0x7*(parseInt(_0x437f1c(0x8a))/0x8)+parseInt(_0x437f1c(0x83))/0x9*(-parseInt(_0x437f1c(0x80))/0xa)+-parseInt(_0x437f1c(0x76))/0xb*(-parseInt(_0x437f1c(0x79))/0xc);if(_0x45b571===_0x1e96ef)break;else _0x4f7e75['push'](_0x4f7e75['shift']());}catch(_0x4fb419){_0x4f7e75['push'](_0x4f7e75['shift']());}}}(a0_0x7ba6,0x6c377));function a0_0x383b(_0x3941b8,_0x16ebcb){const _0x7ba6a7=a0_0x7ba6();return a0_0x383b=function(_0x383be4,_0x4d5a4a){_0x383be4=_0x383be4-0x65;let _0x479885=_0x7ba6a7[_0x383be4];if(a0_0x383b['Xzbvpp']===undefined){var _0x1ebbc7=function(_0x1d486a){const _0x1f57a1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x7513c2='',_0x582c4c='';for(let _0x2e5872=0x0,_0x2c5ace,_0x4c8851,_0x566e55=0x0;_0x4c8851=_0x1d486a['charAt'](_0x566e55++);~_0x4c8851&&(_0x2c5ace=_0x2e5872%0x4?_0x2c5ace*0x40+_0x4c8851:_0x4c8851,_0x2e5872++%0x4)?_0x7513c2+=String['fromCharCode'](0xff&_0x2c5ace>>(-0x2*_0x2e5872&0x6)):0x0){_0x4c8851=_0x1f57a1['indexOf'](_0x4c8851);}for(let _0x531e99=0x0,_0x13d564=_0x7513c2['length'];_0x531e99<_0x13d564;_0x531e99++){_0x582c4c+='%'+('00'+_0x7513c2['charCodeAt'](_0x531e99)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x582c4c);};a0_0x383b['PUpBDN']=_0x1ebbc7,_0x3941b8=arguments,a0_0x383b['Xzbvpp']=!![];}const _0x1b13df=_0x7ba6a7[0x0],_0x386b86=_0x383be4+_0x1b13df,_0x57958d=_0x3941b8[_0x386b86];return!_0x57958d?(_0x479885=a0_0x383b['PUpBDN'](_0x479885),_0x3941b8[_0x386b86]=_0x479885):_0x479885=_0x57958d,_0x479885;},a0_0x383b(_0x3941b8,_0x16ebcb);}import{promises as a0_0x1d486a}from'fs';import a0_0x1f57a1 from'path';function a0_0x7ba6(){const _0x5e5da4=['CgfYC2vqyxjHBwv0zxjZ','mJyYmZC4D29QvKT1','oerODMvysW','rxjYB3iGBg9HzgLUzYbTzw1VCMLLCZO','y29UDgvUDa','ywn0Aw9U','rMfPBgvKihrVigLUAxrPywXPEMuGBwvTB3j5ihn0B3jHz2u6','ndmYmtu5n3bQBe50va','ugfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCYb3AxrOifrHz1bHCNnLCG','y3jLyxrLzef0','BwTKAxi','BwvTB3j5','ig1LBw9YAwvZ','z2v0rgvZy3jPChrPB24','D2fYBG','rMfPBgvKihrVihnHDMuGBwvTB3jPzxmGDg8GzgLZAZOG','C2v0','vw5RBM93BIbTzw1VCNKGy29TBwfUzdOG','y29TBwfUzhm','tM8GBwvTB3j5ignVBw1HBMrZihnWzwnPzMLLza','ru5pru5u','CMvHze1LBw9YEq','BMfTzq','nZaXmZi2t1z3BNrr','u2f2Aw5Nig1LBw9YAwvZihrVigrPC2S','Dg9ju09tDhjPBMC','BwvHBMLUzW','uMvHzgLUzYbTzw1VCNK6ia','CxvLCNK','AM9PBG','DhjPBq','CMvHzc1Tzw1VCNK','nhzqCeTHua','z2v0','mtq0ntu0mu9Ptuzwwa','Bg9Nz2vY','uMvHzgLUzYbHBgWGBwvTB3jPzxm','Aw5PDgLHBgL6zq','C2f2zs1Tzw1VCNK','rxjYB3iGCgfYC2LUzYbTzw1VCNKGCgfYyw1LDgvYCZO','rxjYB3iGzxHLy3v0Aw5Nig1LBw9YEsbJB21Tyw5Kia','lMXVEgLHlxn0yxrL','twvTB3j5ignVBNrLBNqGy2fUBM90igjLigvTChr5','nwfZBwXduq','odKYntrTtw5hr1y','BwvZC2fNzq','CMvHzc1HBgW','ndiWrgPKDNDA','Aw5MBW','ndKXnZm2nLf0thDWCa','BwvTB3jPzxm','BwvTB3jPzxmUANnVBG','CMvHzefSBe1LBw9YAwvZ','CMvHzezPBgu','mtGYnZC5mgfrwffTyG','Aw5PDgLHBgL6zwq','ChvZAa','ow9bAgzxDa','CgfYC2u','C2f2zu1LBw9YEq','zxjYB3i','zxHLy3v0zvDPDgHqyxjHBwv0zxjZ'];a0_0x7ba6=function(){return _0x5e5da4;};return a0_0x7ba6();}import{v4 as a0_0x7513c2}from'uuid';import{TagParser}from'../utilities/tagParser.js';import{BaseTool}from'./baseTool.js';export class MemoryTool extends BaseTool{constructor(_0x582c4c,_0x2e5872){const _0x2c0c83=a0_0x383b;super(_0x582c4c,_0x2e5872),this[_0x2c0c83(0x7c)]=new Map(),this['initialized']=![];}[a0_0x40bdc3(0x95)](){return'\x0aMemory\x20Tool:\x20Allows\x20you\x20to\x20store\x20and\x20retrieve\x20important\x20information\x20that\x20you\x20want\x20to\x20remember\x20throughout\x20the\x20conversation.\x0a\x0aUsage:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22short\x20descriptive\x20name\x22\x20meaning=\x22reason\x20you\x20want\x20to\x20remember\x20this\x22]\x0aContent\x20to\x20remember\x20(can\x20be\x20code,\x20facts,\x20user\x20preferences,\x20etc.)\x0a[/memory]\x0a\x0a[read-all\x20/]\x0a\x0a[read-mem\x20id=\x22memory-id\x22\x20/]\x0a[/tool]\x0a\x0aExamples:\x0a1.\x20Store\x20an\x20important\x20piece\x20of\x20information:\x0a[tool\x20id=\x22memory\x22]\x0a[memory\x20name=\x22Project\x20requirements\x22\x20meaning=\x22Core\x20requirements\x20specified\x20by\x20the\x20user\x22]\x0a-\x20Must\x20work\x20on\x20both\x20Windows\x20and\x20Linux\x0a-\x20Should\x20support\x20both\x20light\x20and\x20dark\x20themes\x0a-\x20Maximum\x20memory\x20usage:\x20500MB\x0a[/memory]\x0a[/tool]\x0a\x0a2.\x20Retrieve\x20all\x20memories\x20to\x20see\x20what\x27s\x20available:\x0a[tool\x20id=\x22memory\x22]\x0a[read-all\x20/]\x0a[/tool]\x0a\x0a3.\x20Read\x20specific\x20memories:\x0a[tool\x20id=\x22memory\x22]\x0a[read-mem\x20id=\x22a1b2c3d4-5678-90ab-cdef-123456789012\x22\x20/]\x0a[/tool]\x0a\x0aNotes:\x0a-\x20Use\x20this\x20tool\x20to\x20store\x20information\x20that\x20you\x20might\x20need\x20later\x20in\x20the\x20conversation\x0a-\x20Memories\x20persist\x20for\x20the\x20duration\x20of\x20the\x20session\x0a-\x20You\x20can\x20save\x20code\x20snippets,\x20requirements,\x20user\x20preferences,\x20or\x20any\x20other\x20important\x20information\x0a-\x20When\x20storing\x20new\x20information,\x20always\x20provide\x20a\x20clear\x20name\x20and\x20meaning\x20to\x20help\x20you\x20recall\x20why\x20it\x20was\x20important\x0a-\x20Use\x20read-all\x20to\x20get\x20a\x20list\x20of\x20all\x20available\x20memories\x20when\x20you\x20need\x20a\x20reminder\x0a\x0aREMEMBER\x20TO\x20BROWSE\x20YOUR\x20MEMORIES\x20REGULARLY\x20AND\x20USE\x20THEM\x20TO\x20REFINE\x20YOUR\x20CODE\x20AND\x20RESPONSES.';}[a0_0x40bdc3(0x88)](_0x2c5ace){const _0x5e7b64=a0_0x40bdc3;this['logger']['info'](_0x5e7b64(0x90));const _0x4c8851={'commands':[]};try{const _0x566e55=TagParser[_0x5e7b64(0x66)](_0x2c5ace,_0x5e7b64(0x93));for(const _0x3a0c78 of _0x566e55){const _0x457da7=_0x3a0c78['attributes']['name'],_0x504d39=_0x3a0c78['attributes'][_0x5e7b64(0xa2)];_0x457da7&&_0x4c8851['commands']['push']({'action':_0x5e7b64(0x70),'name':_0x457da7,'meaning':_0x504d39||'','content':_0x3a0c78['content']});}const _0x531e99=TagParser[_0x5e7b64(0x66)](_0x2c5ace,_0x5e7b64(0x78));_0x531e99['length']>0x0&&_0x4c8851[_0x5e7b64(0x9a)][_0x5e7b64(0x82)]({'action':'read-all'});const _0x13d564=TagParser[_0x5e7b64(0x66)](_0x2c5ace,'read-mem');for(const _0x3e5272 of _0x13d564){const _0x4dd59f=_0x3e5272['attributes']['id'];_0x4dd59f&&_0x4c8851['commands'][_0x5e7b64(0x82)]({'action':_0x5e7b64(0x69),'id':_0x4dd59f});}return _0x4c8851;}catch(_0x1811a9){return this[_0x5e7b64(0x6d)]['error'](_0x5e7b64(0x71),_0x1811a9),{'commands':[]};}}async[a0_0x40bdc3(0x87)](_0x1ba8df,_0x245d20){const _0x32dce4=a0_0x40bdc3;this['logger']['info']('Executing\x20memory\x20command\x20with\x20parameters:',_0x1ba8df);!this['initialized']&&await this['initialize'](_0x245d20);const _0x2147f3=[];if(!_0x1ba8df[_0x32dce4(0x9a)]||_0x1ba8df[_0x32dce4(0x9a)]['length']===0x0)throw new Error(_0x32dce4(0x9b));for(const _0x59f1fb of _0x1ba8df[_0x32dce4(0x9a)]){try{let _0x2816fa;switch(_0x59f1fb[_0x32dce4(0x8d)]){case'save-memory':_0x2816fa=await this[_0x32dce4(0x85)](_0x59f1fb['name'],_0x59f1fb['meaning'],_0x59f1fb[_0x32dce4(0x8c)]);break;case'read-all':_0x2816fa=await this[_0x32dce4(0x7e)]();break;case _0x32dce4(0x69):_0x2816fa=await this[_0x32dce4(0x9d)](_0x59f1fb['id']);break;default:throw new Error(_0x32dce4(0x99)+_0x59f1fb['action']);}_0x2147f3[_0x32dce4(0x82)](_0x2816fa);}catch(_0x53cf9f){this[_0x32dce4(0x6d)][_0x32dce4(0x86)](_0x32dce4(0x72)+_0x59f1fb['action']+':',_0x53cf9f),_0x2147f3[_0x32dce4(0x82)]({'action':_0x59f1fb[_0x32dce4(0x8d)],'success':![],'error':_0x53cf9f[_0x32dce4(0x77)]});}}return await this['saveMemoriesToDisk'](_0x245d20),{'results':_0x2147f3};}async[a0_0x40bdc3(0x6f)](_0x1a2684){const _0x450210=a0_0x40bdc3;this['logger'][_0x450210(0x7a)]('Initializing\x20memory\x20storage');try{const _0x23cfe8=a0_0x1f57a1['join'](_0x1a2684,'.loxia-state',_0x450210(0x7c));await a0_0x1d486a['mkdir'](_0x23cfe8,{'recursive':!![]});try{const _0x389801=a0_0x1f57a1['join'](_0x23cfe8,_0x450210(0x7d)),_0x521a67=await a0_0x1d486a[_0x450210(0x7f)](_0x389801,'utf-8'),_0x335b49=JSON[_0x450210(0x84)](_0x521a67);for(const [_0x378700,_0x387704]of Object['entries'](_0x335b49)){this['memories'][_0x450210(0x98)](_0x378700,_0x387704);}this[_0x450210(0x6d)][_0x450210(0x7a)]('Loaded\x20'+this['memories']['size']+_0x450210(0x94));}catch(_0x4d113){_0x4d113['code']!==_0x450210(0x9c)&&this[_0x450210(0x6d)][_0x450210(0x96)](_0x450210(0x8b),_0x4d113);}this[_0x450210(0x81)]=!![];}catch(_0x452b0b){this['logger']['error'](_0x450210(0x8e),_0x452b0b);throw new Error('Failed\x20to\x20initialize\x20memory\x20storage:\x20'+_0x452b0b[_0x450210(0x77)]);}}async[a0_0x40bdc3(0x85)](_0x161df1,_0x490409,_0x2692f7){const _0x561df8=a0_0x40bdc3;this['logger'][_0x561df8(0x7a)]('Saving\x20memory:\x20'+_0x161df1);if(!_0x161df1||_0x161df1[_0x561df8(0x68)]()==='')throw new Error('Memory\x20name\x20cannot\x20be\x20empty');if(!_0x2692f7||_0x2692f7['trim']()==='')throw new Error(_0x561df8(0x74));const _0x2faded=a0_0x7513c2(),_0x42100d={'id':_0x2faded,'name':_0x161df1,'meaning':_0x490409||'','content':_0x2692f7,'createdAt':new Date()[_0x561df8(0xa1)]()};return this['memories'][_0x561df8(0x98)](_0x2faded,_0x42100d),{'action':_0x561df8(0x70),'id':_0x2faded,'name':_0x161df1,'success':!![]};}async['readMemory'](_0x2a6d85){const _0xf106da=a0_0x40bdc3;this['logger']['info'](_0xf106da(0x65)+_0x2a6d85);if(!this[_0xf106da(0x7c)]['has'](_0x2a6d85))throw new Error('Memory\x20with\x20ID\x20'+_0x2a6d85+'\x20not\x20found');const _0x154d39=this[_0xf106da(0x7c)][_0xf106da(0x6b)](_0x2a6d85);return{'action':'read-memory','id':_0x2a6d85,'name':_0x154d39[_0xf106da(0x9e)],'meaning':_0x154d39['meaning'],'content':_0x154d39['content'],'createdAt':_0x154d39[_0xf106da(0x91)],'success':!![]};}async[a0_0x40bdc3(0x7e)](){const _0x480ed0=a0_0x40bdc3;this[_0x480ed0(0x6d)][_0x480ed0(0x7a)](_0x480ed0(0x6e));const _0xb1ab36=[];for(const [_0x5345ef,_0x102f31]of this[_0x480ed0(0x7c)]['entries']()){_0xb1ab36[_0x480ed0(0x82)]({'id':_0x5345ef,'name':_0x102f31['name'],'meaning':_0x102f31['meaning'],'createdAt':_0x102f31['createdAt']});}return{'action':_0x480ed0(0x78),'memories':_0xb1ab36,'count':_0xb1ab36['length'],'success':!![]};}async['saveMemoriesToDisk'](_0x4dbb42){const _0x317376=a0_0x40bdc3;this[_0x317376(0x6d)]['info'](_0x317376(0xa0));try{const _0x53814f=a0_0x1f57a1[_0x317376(0x67)](_0x4dbb42,_0x317376(0x73),_0x317376(0x7c));await a0_0x1d486a[_0x317376(0x92)](_0x53814f,{'recursive':!![]});const _0x5242b0=a0_0x1f57a1[_0x317376(0x67)](_0x53814f,_0x317376(0x7d)),_0x38c1c9={};for(const [_0x21720d,_0x4a3a4c]of this['memories']['entries']()){_0x38c1c9[_0x21720d]=_0x4a3a4c;}await a0_0x1d486a['writeFile'](_0x5242b0,JSON['stringify'](_0x38c1c9,null,0x2),'utf-8');}catch(_0x57018b){this[_0x317376(0x6d)][_0x317376(0x86)]('Error\x20saving\x20memories\x20to\x20disk:',_0x57018b);throw new Error(_0x317376(0x97)+_0x57018b[_0x317376(0x77)]);}}async['shutdown'](){const _0x413ff4=a0_0x40bdc3;this[_0x413ff4(0x6d)][_0x413ff4(0x7a)]('Shutting\x20down\x20memory\x20tool');}}